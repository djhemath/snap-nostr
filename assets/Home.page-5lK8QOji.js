var $n=Object.defineProperty;var Sn=(e,t,n)=>t in e?$n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ht=(e,t,n)=>Sn(e,typeof t!="symbol"?t+"":t,n);import{b as bytesToHex$2,h as hexToBytes$2,i as isBytes$1,a as abytes,c as concatBytes$3,r as reactExports,o,g as getDefaultExportFromCjs,d as commonjsGlobal,j as jsxRuntimeExports,e as isSafari,p as proxyImg,t as toReadableStatsFormat,f as defaultImgProxy,k as anumber,l as ahash,m as randomBytes$2,n as hmac$2,s as sha256$2,u as utf8ToBytes$3,q as sha256$3,M as MILLISATS_PER_SAT,v as useNoteContext,w as useRelaysContext,x as getNoteIDFromURL,y as initialNote,z as updateNoteIDInTheURL,A as getBreakpoint,G as GRADIENTS,B as initialGradient,N as NOSTR_BRANDING_COLORS,C as getDataURLFromHTMLDOM,D as copyDataURL,E as trackEvent,F as downloadImage}from"./index-BisNnd1i.js";/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1);function _abool2(e,t=""){if(typeof e!="boolean"){const n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function _abytes2(e,t,n=""){const s=isBytes$1(e),a=e==null?void 0:e.length,l=t!==void 0;if(!s||l&&a!==t){const de=n&&`"${n}" `,pe=l?` of length ${t}`:"",me=s?`length=${a}`:`type=${typeof e}`;throw new Error(de+"expected Uint8Array"+pe+", got "+me)}return e}function numberToHexUnpadded$1(e){const t=e.toString(16);return t.length&1?"0"+t:t}function hexToNumber$1(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?_0n$9:BigInt("0x"+e)}function bytesToNumberBE$1(e){return hexToNumber$1(bytesToHex$2(e))}function bytesToNumberLE$1(e){return abytes(e),hexToNumber$1(bytesToHex$2(Uint8Array.from(e).reverse()))}function numberToBytesBE$1(e,t){return hexToBytes$2(e.toString(16).padStart(t*2,"0"))}function numberToBytesLE$1(e,t){return numberToBytesBE$1(e,t).reverse()}function ensureBytes$1(e,t,n){let s;if(typeof t=="string")try{s=hexToBytes$2(t)}catch(l){throw new Error(e+" must be hex string or Uint8Array, cause: "+l)}else if(isBytes$1(t))s=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");const a=s.length;if(typeof n=="number"&&a!==n)throw new Error(e+" of length "+n+" expected, got "+a);return s}const isPosBig=e=>typeof e=="bigint"&&_0n$9<=e;function inRange(e,t,n){return isPosBig(e)&&isPosBig(t)&&isPosBig(n)&&t<=e&&e<n}function aInRange(e,t,n,s){if(!inRange(t,n,s))throw new Error("expected valid "+e+": "+n+" <= n < "+s+", got "+t)}function bitLen$1(e){let t;for(t=0;e>_0n$9;e>>=_1n$9,t+=1);return t}const bitMask$1=e=>(_1n$9<<BigInt(e))-_1n$9;function createHmacDrbg$1(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const s=nt=>new Uint8Array(nt),a=nt=>Uint8Array.of(nt);let l=s(e),de=s(e),pe=0;const me=()=>{l.fill(1),de.fill(0),pe=0},Le=(...nt)=>n(de,l,...nt),Be=(nt=s(0))=>{de=Le(a(0),nt),l=Le(),nt.length!==0&&(de=Le(a(1),nt),l=Le())},Ye=()=>{if(pe++>=1e3)throw new Error("drbg: tried 1000 values");let nt=0;const ft=[];for(;nt<t;){l=Le();const st=l.slice();ft.push(st),nt+=l.length}return concatBytes$3(...ft)};return(nt,ft)=>{me(),Be(nt);let st;for(;!(st=ft(Ye()));)Be();return me(),st}}function _validateObject(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function s(a,l,de){const pe=e[a];if(de&&pe===void 0)return;const me=typeof pe;if(me!==l||pe===null)throw new Error(`param "${a}" is invalid: expected ${l}, got ${me}`)}Object.entries(t).forEach(([a,l])=>s(a,l,!1)),Object.entries(n).forEach(([a,l])=>s(a,l,!0))}function memoized(e){const t=new WeakMap;return(n,...s)=>{const a=t.get(n);if(a!==void 0)return a;const l=e(n,...s);return t.set(n,l),l}}function r(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=r(e[t]))&&(s&&(s+=" "),s+=n)}else for(n in e)e[n]&&(s&&(s+=" "),s+=n);return s}function clsx(){for(var e,t,n=0,s="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=r(e))&&(s&&(s+=" "),s+=t);return s}const c=e=>typeof e=="number"&&!isNaN(e),d$1=e=>typeof e=="string",u=e=>typeof e=="function",p=e=>d$1(e)||u(e)?e:null,m$1=e=>reactExports.isValidElement(e)||d$1(e)||u(e)||c(e);function f$1(e,t,n){n===void 0&&(n=300);const{scrollHeight:s,style:a}=e;requestAnimationFrame(()=>{a.minHeight="initial",a.height=s+"px",a.transition=`all ${n}ms`,requestAnimationFrame(()=>{a.height="0",a.padding="0",a.margin="0",setTimeout(t,n)})})}function g$1(e){let{enter:t,exit:n,appendPosition:s=!1,collapse:a=!0,collapseDuration:l=300}=e;return function(de){let{children:pe,position:me,preventExitTransition:Le,done:Be,nodeRef:Ye,isIn:tt,playToast:nt}=de;const ft=s?`${t}--${me}`:t,st=s?`${n}--${me}`:n,yt=reactExports.useRef(0);return reactExports.useLayoutEffect(()=>{const mt=Ye.current,_t=ft.split(" "),Rt=At=>{At.target===Ye.current&&(nt(),mt.removeEventListener("animationend",Rt),mt.removeEventListener("animationcancel",Rt),yt.current===0&&At.type!=="animationcancel"&&mt.classList.remove(..._t))};mt.classList.add(..._t),mt.addEventListener("animationend",Rt),mt.addEventListener("animationcancel",Rt)},[]),reactExports.useEffect(()=>{const mt=Ye.current,_t=()=>{mt.removeEventListener("animationend",_t),a?f$1(mt,Be,l):Be()};tt||(Le?_t():(yt.current=1,mt.className+=` ${st}`,mt.addEventListener("animationend",_t)))},[tt]),o.createElement(o.Fragment,null,pe)}}function y$1(e,t){return e!=null?{content:e.content,containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,status:t}:{}}const v$1=new Map;let h=[];const T$1=new Set,E=e=>T$1.forEach(t=>t(e)),b=()=>v$1.size>0;function I$1(e,t){var n;if(t)return!((n=v$1.get(t))==null||!n.isToastActive(e));let s=!1;return v$1.forEach(a=>{a.isToastActive(e)&&(s=!0)}),s}function _$1(e,t){m$1(e)&&(b()||h.push({content:e,options:t}),v$1.forEach(n=>{n.buildToast(e,t)}))}function C$1(e,t){v$1.forEach(n=>{t!=null&&t!=null&&t.containerId?(t==null?void 0:t.containerId)===n.id&&n.toggle(e,t==null?void 0:t.id):n.toggle(e,t==null?void 0:t.id)})}function L$1(e){const{subscribe:t,getSnapshot:n,setProps:s}=reactExports.useRef(function(l){const de=l.containerId||1;return{subscribe(pe){const me=function(Be,Ye,tt){let nt=1,ft=0,st=[],yt=[],mt=[],_t=Ye;const Rt=new Map,At=new Set,Lt=()=>{mt=Array.from(Rt.values()),At.forEach(Bt=>Bt())},Tt=Bt=>{yt=Bt==null?[]:yt.filter(Mt=>Mt!==Bt),Lt()},It=Bt=>{const{toastId:Mt,onOpen:Pt,updateId:vt,children:kt}=Bt.props,wt=vt==null;Bt.staleId&&Rt.delete(Bt.staleId),Rt.set(Mt,Bt),yt=[...yt,Bt.props.toastId].filter(bt=>bt!==Bt.staleId),Lt(),tt(y$1(Bt,wt?"added":"updated")),wt&&u(Pt)&&Pt(reactExports.isValidElement(kt)&&kt.props)};return{id:Be,props:_t,observe:Bt=>(At.add(Bt),()=>At.delete(Bt)),toggle:(Bt,Mt)=>{Rt.forEach(Pt=>{Mt!=null&&Mt!==Pt.props.toastId||u(Pt.toggle)&&Pt.toggle(Bt)})},removeToast:Tt,toasts:Rt,clearQueue:()=>{ft-=st.length,st=[]},buildToast:(Bt,Mt)=>{if((Nt=>{let{containerId:jt,toastId:Ft,updateId:Ut}=Nt;const Ot=jt?jt!==Be:Be!==1,Dt=Rt.has(Ft)&&Ut==null;return Ot||Dt})(Mt))return;const{toastId:Pt,updateId:vt,data:kt,staleId:wt,delay:bt}=Mt,ot=()=>{Tt(Pt)},gt=vt==null;gt&&ft++;const Et={..._t,style:_t.toastStyle,key:nt++,...Object.fromEntries(Object.entries(Mt).filter(Nt=>{let[jt,Ft]=Nt;return Ft!=null})),toastId:Pt,updateId:vt,data:kt,closeToast:ot,isIn:!1,className:p(Mt.className||_t.toastClassName),bodyClassName:p(Mt.bodyClassName||_t.bodyClassName),progressClassName:p(Mt.progressClassName||_t.progressClassName),autoClose:!Mt.isLoading&&(xt=Mt.autoClose,Ct=_t.autoClose,xt===!1||c(xt)&&xt>0?xt:Ct),deleteToast(){const Nt=Rt.get(Pt),{onClose:jt,children:Ft}=Nt.props;u(jt)&&jt(reactExports.isValidElement(Ft)&&Ft.props),tt(y$1(Nt,"removed")),Rt.delete(Pt),ft--,ft<0&&(ft=0),st.length>0?It(st.shift()):Lt()}};var xt,Ct;Et.closeButton=_t.closeButton,Mt.closeButton===!1||m$1(Mt.closeButton)?Et.closeButton=Mt.closeButton:Mt.closeButton===!0&&(Et.closeButton=!m$1(_t.closeButton)||_t.closeButton);let St=Bt;reactExports.isValidElement(Bt)&&!d$1(Bt.type)?St=reactExports.cloneElement(Bt,{closeToast:ot,toastProps:Et,data:kt}):u(Bt)&&(St=Bt({closeToast:ot,toastProps:Et,data:kt}));const $t={content:St,props:Et,staleId:wt};_t.limit&&_t.limit>0&&ft>_t.limit&&gt?st.push($t):c(bt)?setTimeout(()=>{It($t)},bt):It($t)},setProps(Bt){_t=Bt},setToggle:(Bt,Mt)=>{Rt.get(Bt).toggle=Mt},isToastActive:Bt=>yt.some(Mt=>Mt===Bt),getSnapshot:()=>mt}}(de,l,E);v$1.set(de,me);const Le=me.observe(pe);return h.forEach(Be=>_$1(Be.content,Be.options)),h=[],()=>{Le(),v$1.delete(de)}},setProps(pe){var me;(me=v$1.get(de))==null||me.setProps(pe)},getSnapshot(){var pe;return(pe=v$1.get(de))==null?void 0:pe.getSnapshot()}}}(e)).current;s(e);const a=reactExports.useSyncExternalStore(t,n,n);return{getToastToRender:function(l){if(!a)return[];const de=new Map;return e.newestOnTop&&a.reverse(),a.forEach(pe=>{const{position:me}=pe.props;de.has(me)||de.set(me,[]),de.get(me).push(pe)}),Array.from(de,pe=>l(pe[0],pe[1]))},isToastActive:I$1,count:a==null?void 0:a.length}}function N(e){const[t,n]=reactExports.useState(!1),[s,a]=reactExports.useState(!1),l=reactExports.useRef(null),de=reactExports.useRef({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:pe,pauseOnHover:me,closeToast:Le,onClick:Be,closeOnClick:Ye}=e;var tt,nt;function ft(){n(!0)}function st(){n(!1)}function yt(Rt){const At=l.current;de.canDrag&&At&&(de.didMove=!0,t&&st(),de.delta=e.draggableDirection==="x"?Rt.clientX-de.start:Rt.clientY-de.start,de.start!==Rt.clientX&&(de.canCloseOnClick=!1),At.style.transform=`translate3d(${e.draggableDirection==="x"?`${de.delta}px, var(--y)`:`0, calc(${de.delta}px + var(--y))`},0)`,At.style.opacity=""+(1-Math.abs(de.delta/de.removalDistance)))}function mt(){document.removeEventListener("pointermove",yt),document.removeEventListener("pointerup",mt);const Rt=l.current;if(de.canDrag&&de.didMove&&Rt){if(de.canDrag=!1,Math.abs(de.delta)>de.removalDistance)return a(!0),e.closeToast(),void e.collapseAll();Rt.style.transition="transform 0.2s, opacity 0.2s",Rt.style.removeProperty("transform"),Rt.style.removeProperty("opacity")}}(nt=v$1.get((tt={id:e.toastId,containerId:e.containerId,fn:n}).containerId||1))==null||nt.setToggle(tt.id,tt.fn),reactExports.useEffect(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||st(),window.addEventListener("focus",ft),window.addEventListener("blur",st),()=>{window.removeEventListener("focus",ft),window.removeEventListener("blur",st)}},[e.pauseOnFocusLoss]);const _t={onPointerDown:function(Rt){if(e.draggable===!0||e.draggable===Rt.pointerType){de.didMove=!1,document.addEventListener("pointermove",yt),document.addEventListener("pointerup",mt);const At=l.current;de.canCloseOnClick=!0,de.canDrag=!0,At.style.transition="none",e.draggableDirection==="x"?(de.start=Rt.clientX,de.removalDistance=At.offsetWidth*(e.draggablePercent/100)):(de.start=Rt.clientY,de.removalDistance=At.offsetHeight*(e.draggablePercent===80?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(Rt){const{top:At,bottom:Lt,left:Tt,right:It}=l.current.getBoundingClientRect();Rt.nativeEvent.type!=="touchend"&&e.pauseOnHover&&Rt.clientX>=Tt&&Rt.clientX<=It&&Rt.clientY>=At&&Rt.clientY<=Lt?st():ft()}};return pe&&me&&(_t.onMouseEnter=st,e.stacked||(_t.onMouseLeave=ft)),Ye&&(_t.onClick=Rt=>{Be&&Be(Rt),de.canCloseOnClick&&Le()}),{playToast:ft,pauseToast:st,isRunning:t,preventExitTransition:s,toastRef:l,eventHandlers:_t}}function $$1(e){let{delay:t,isRunning:n,closeToast:s,type:a="default",hide:l,className:de,style:pe,controlledProgress:me,progress:Le,rtl:Be,isIn:Ye,theme:tt}=e;const nt=l||me&&Le===0,ft={...pe,animationDuration:`${t}ms`,animationPlayState:n?"running":"paused"};me&&(ft.transform=`scaleX(${Le})`);const st=clsx("Toastify__progress-bar",me?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${tt}`,`Toastify__progress-bar--${a}`,{"Toastify__progress-bar--rtl":Be}),yt=u(de)?de({rtl:Be,type:a,defaultClassName:st}):clsx(st,de),mt={[me&&Le>=1?"onTransitionEnd":"onAnimationEnd"]:me&&Le<1?null:()=>{Ye&&s()}};return o.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":nt},o.createElement("div",{className:`Toastify__progress-bar--bg Toastify__progress-bar-theme--${tt} Toastify__progress-bar--${a}`}),o.createElement("div",{role:"progressbar","aria-hidden":nt?"true":"false","aria-label":"notification timer",className:yt,style:ft,...mt}))}let w$1=1;const k$1=()=>""+w$1++;function P(e){return e&&(d$1(e.toastId)||c(e.toastId))?e.toastId:k$1()}function M$1(e,t){return _$1(e,t),t.toastId}function x$1(e,t){return{...t,type:t&&t.type||e,toastId:P(t)}}function A$1(e){return(t,n)=>M$1(t,x$1(e,n))}function B$1(e,t){return M$1(e,x$1("default",t))}B$1.loading=(e,t)=>M$1(e,x$1("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...t})),B$1.promise=function(e,t,n){let s,{pending:a,error:l,success:de}=t;a&&(s=d$1(a)?B$1.loading(a,n):B$1.loading(a.render,{...n,...a}));const pe={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},me=(Be,Ye,tt)=>{if(Ye==null)return void B$1.dismiss(s);const nt={type:Be,...pe,...n,data:tt},ft=d$1(Ye)?{render:Ye}:Ye;return s?B$1.update(s,{...nt,...ft}):B$1(ft.render,{...nt,...ft}),tt},Le=u(e)?e():e;return Le.then(Be=>me("success",de,Be)).catch(Be=>me("error",l,Be)),Le},B$1.success=A$1("success"),B$1.info=A$1("info"),B$1.error=A$1("error"),B$1.warning=A$1("warning"),B$1.warn=B$1.warning,B$1.dark=(e,t)=>M$1(e,x$1("default",{theme:"dark",...t})),B$1.dismiss=function(e){(function(t){var n;if(b()){if(t==null||d$1(n=t)||c(n))v$1.forEach(s=>{s.removeToast(t)});else if(t&&("containerId"in t||"id"in t)){const s=v$1.get(t.containerId);s?s.removeToast(t.id):v$1.forEach(a=>{a.removeToast(t.id)})}}else h=h.filter(s=>t!=null&&s.options.toastId!==t)})(e)},B$1.clearWaitingQueue=function(e){e===void 0&&(e={}),v$1.forEach(t=>{!t.props.limit||e.containerId&&t.id!==e.containerId||t.clearQueue()})},B$1.isActive=I$1,B$1.update=function(e,t){t===void 0&&(t={});const n=((s,a)=>{var l;let{containerId:de}=a;return(l=v$1.get(de||1))==null?void 0:l.toasts.get(s)})(e,t);if(n){const{props:s,content:a}=n,l={delay:100,...s,...t,toastId:t.toastId||e,updateId:k$1()};l.toastId!==e&&(l.staleId=e);const de=l.render||a;delete l.render,M$1(de,l)}},B$1.done=e=>{B$1.update(e,{progress:1})},B$1.onChange=function(e){return T$1.add(e),()=>{T$1.delete(e)}},B$1.play=e=>C$1(!0,e),B$1.pause=e=>C$1(!1,e);const O$1=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,D$1=e=>{let{theme:t,type:n,isLoading:s,...a}=e;return o.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:t==="colored"?"currentColor":`var(--toastify-icon-color-${n})`,...a})},z$1={info:function(e){return o.createElement(D$1,{...e},o.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return o.createElement(D$1,{...e},o.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return o.createElement(D$1,{...e},o.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return o.createElement(D$1,{...e},o.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return o.createElement("div",{className:"Toastify__spinner"})}},R$1=e=>{const{isRunning:t,preventExitTransition:n,toastRef:s,eventHandlers:a,playToast:l}=N(e),{closeButton:de,children:pe,autoClose:me,onClick:Le,type:Be,hideProgressBar:Ye,closeToast:tt,transition:nt,position:ft,className:st,style:yt,bodyClassName:mt,bodyStyle:_t,progressClassName:Rt,progressStyle:At,updateId:Lt,role:Tt,progress:It,rtl:Bt,toastId:Mt,deleteToast:Pt,isIn:vt,isLoading:kt,closeOnClick:wt,theme:bt}=e,ot=clsx("Toastify__toast",`Toastify__toast-theme--${bt}`,`Toastify__toast--${Be}`,{"Toastify__toast--rtl":Bt},{"Toastify__toast--close-on-click":wt}),gt=u(st)?st({rtl:Bt,position:ft,type:Be,defaultClassName:ot}):clsx(ot,st),Et=function($t){let{theme:Nt,type:jt,isLoading:Ft,icon:Ut}=$t,Ot=null;const Dt={theme:Nt,type:jt};return Ut===!1||(u(Ut)?Ot=Ut({...Dt,isLoading:Ft}):reactExports.isValidElement(Ut)?Ot=reactExports.cloneElement(Ut,Dt):Ft?Ot=z$1.spinner():(zt=>zt in z$1)(jt)&&(Ot=z$1[jt](Dt))),Ot}(e),xt=!!It||!me,Ct={closeToast:tt,type:Be,theme:bt};let St=null;return de===!1||(St=u(de)?de(Ct):reactExports.isValidElement(de)?reactExports.cloneElement(de,Ct):function($t){let{closeToast:Nt,theme:jt,ariaLabel:Ft="close"}=$t;return o.createElement("button",{className:`Toastify__close-button Toastify__close-button--${jt}`,type:"button",onClick:Ut=>{Ut.stopPropagation(),Nt(Ut)},"aria-label":Ft},o.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},o.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(Ct)),o.createElement(nt,{isIn:vt,done:Pt,position:ft,preventExitTransition:n,nodeRef:s,playToast:l},o.createElement("div",{id:Mt,onClick:Le,"data-in":vt,className:gt,...a,style:yt,ref:s},o.createElement("div",{...vt&&{role:Tt},className:u(mt)?mt({type:Be}):clsx("Toastify__toast-body",mt),style:_t},Et!=null&&o.createElement("div",{className:clsx("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!kt})},Et),o.createElement("div",null,pe)),St,o.createElement($$1,{...Lt&&!xt?{key:`pb-${Lt}`}:{},rtl:Bt,theme:bt,delay:me,isRunning:t,isIn:vt,closeToast:tt,hide:Ye,type:Be,style:At,className:Rt,controlledProgress:xt,progress:It||0})))},S$1=function(e,t){return t===void 0&&(t=!1),{enter:`Toastify--animate Toastify__${e}-enter`,exit:`Toastify--animate Toastify__${e}-exit`,appendPosition:t}},H$1=g$1(S$1("bounce",!0));g$1(S$1("slide",!0));g$1(S$1("zoom"));g$1(S$1("flip"));const q$1={position:"top-right",transition:H$1,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};function Q$1(e){let t={...q$1,...e};const n=e.stacked,[s,a]=reactExports.useState(!0),l=reactExports.useRef(null),{getToastToRender:de,isToastActive:pe,count:me}=L$1(t),{className:Le,style:Be,rtl:Ye,containerId:tt}=t;function nt(st){const yt=clsx("Toastify__toast-container",`Toastify__toast-container--${st}`,{"Toastify__toast-container--rtl":Ye});return u(Le)?Le({position:st,rtl:Ye,defaultClassName:yt}):clsx(yt,p(Le))}function ft(){n&&(a(!0),B$1.play())}return O$1(()=>{if(n){var st;const yt=l.current.querySelectorAll('[data-in="true"]'),mt=12,_t=(st=t.position)==null?void 0:st.includes("top");let Rt=0,At=0;Array.from(yt).reverse().forEach((Lt,Tt)=>{const It=Lt;It.classList.add("Toastify__toast--stacked"),Tt>0&&(It.dataset.collapsed=`${s}`),It.dataset.pos||(It.dataset.pos=_t?"top":"bot");const Bt=Rt*(s?.2:1)+(s?0:mt*Tt);It.style.setProperty("--y",`${_t?Bt:-1*Bt}px`),It.style.setProperty("--g",`${mt}`),It.style.setProperty("--s",""+(1-(s?At:0))),Rt+=It.offsetHeight,At+=.025})}},[s,me,n]),o.createElement("div",{ref:l,className:"Toastify",id:tt,onMouseEnter:()=>{n&&(a(!1),B$1.pause())},onMouseLeave:ft},de((st,yt)=>{const mt=yt.length?{...Be}:{...Be,pointerEvents:"none"};return o.createElement("div",{className:nt(st),style:mt,key:`container-${st}`},yt.map(_t=>{let{content:Rt,props:At}=_t;return o.createElement(R$1,{...At,stacked:n,collapseAll:ft,isIn:pe(At.toastId,At.containerId),style:At.style,key:`toast-${At.key}`},Rt)}))}))}var dayjs_min={exports:{}};(function(e,t){(function(n,s){e.exports=s()})(commonjsGlobal,function(){var n=1e3,s=6e4,a=36e5,l="millisecond",de="second",pe="minute",me="hour",Le="day",Be="week",Ye="month",tt="quarter",nt="year",ft="date",st="Invalid Date",yt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,mt=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_t={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(bt){var ot=["th","st","nd","rd"],gt=bt%100;return"["+bt+(ot[(gt-20)%10]||ot[gt]||ot[0])+"]"}},Rt=function(bt,ot,gt){var Et=String(bt);return!Et||Et.length>=ot?bt:""+Array(ot+1-Et.length).join(gt)+bt},At={s:Rt,z:function(bt){var ot=-bt.utcOffset(),gt=Math.abs(ot),Et=Math.floor(gt/60),xt=gt%60;return(ot<=0?"+":"-")+Rt(Et,2,"0")+":"+Rt(xt,2,"0")},m:function bt(ot,gt){if(ot.date()<gt.date())return-bt(gt,ot);var Et=12*(gt.year()-ot.year())+(gt.month()-ot.month()),xt=ot.clone().add(Et,Ye),Ct=gt-xt<0,St=ot.clone().add(Et+(Ct?-1:1),Ye);return+(-(Et+(gt-xt)/(Ct?xt-St:St-xt))||0)},a:function(bt){return bt<0?Math.ceil(bt)||0:Math.floor(bt)},p:function(bt){return{M:Ye,y:nt,w:Be,d:Le,D:ft,h:me,m:pe,s:de,ms:l,Q:tt}[bt]||String(bt||"").toLowerCase().replace(/s$/,"")},u:function(bt){return bt===void 0}},Lt="en",Tt={};Tt[Lt]=_t;var It="$isDayjsObject",Bt=function(bt){return bt instanceof kt||!(!bt||!bt[It])},Mt=function bt(ot,gt,Et){var xt;if(!ot)return Lt;if(typeof ot=="string"){var Ct=ot.toLowerCase();Tt[Ct]&&(xt=Ct),gt&&(Tt[Ct]=gt,xt=Ct);var St=ot.split("-");if(!xt&&St.length>1)return bt(St[0])}else{var $t=ot.name;Tt[$t]=ot,xt=$t}return!Et&&xt&&(Lt=xt),xt||!Et&&Lt},Pt=function(bt,ot){if(Bt(bt))return bt.clone();var gt=typeof ot=="object"?ot:{};return gt.date=bt,gt.args=arguments,new kt(gt)},vt=At;vt.l=Mt,vt.i=Bt,vt.w=function(bt,ot){return Pt(bt,{locale:ot.$L,utc:ot.$u,x:ot.$x,$offset:ot.$offset})};var kt=function(){function bt(gt){this.$L=Mt(gt.locale,null,!0),this.parse(gt),this.$x=this.$x||gt.x||{},this[It]=!0}var ot=bt.prototype;return ot.parse=function(gt){this.$d=function(Et){var xt=Et.date,Ct=Et.utc;if(xt===null)return new Date(NaN);if(vt.u(xt))return new Date;if(xt instanceof Date)return new Date(xt);if(typeof xt=="string"&&!/Z$/i.test(xt)){var St=xt.match(yt);if(St){var $t=St[2]-1||0,Nt=(St[7]||"0").substring(0,3);return Ct?new Date(Date.UTC(St[1],$t,St[3]||1,St[4]||0,St[5]||0,St[6]||0,Nt)):new Date(St[1],$t,St[3]||1,St[4]||0,St[5]||0,St[6]||0,Nt)}}return new Date(xt)}(gt),this.init()},ot.init=function(){var gt=this.$d;this.$y=gt.getFullYear(),this.$M=gt.getMonth(),this.$D=gt.getDate(),this.$W=gt.getDay(),this.$H=gt.getHours(),this.$m=gt.getMinutes(),this.$s=gt.getSeconds(),this.$ms=gt.getMilliseconds()},ot.$utils=function(){return vt},ot.isValid=function(){return this.$d.toString()!==st},ot.isSame=function(gt,Et){var xt=Pt(gt);return this.startOf(Et)<=xt&&xt<=this.endOf(Et)},ot.isAfter=function(gt,Et){return Pt(gt)<this.startOf(Et)},ot.isBefore=function(gt,Et){return this.endOf(Et)<Pt(gt)},ot.$g=function(gt,Et,xt){return vt.u(gt)?this[Et]:this.set(xt,gt)},ot.unix=function(){return Math.floor(this.valueOf()/1e3)},ot.valueOf=function(){return this.$d.getTime()},ot.startOf=function(gt,Et){var xt=this,Ct=!!vt.u(Et)||Et,St=vt.p(gt),$t=function(Ht,Vt){var qt=vt.w(xt.$u?Date.UTC(xt.$y,Vt,Ht):new Date(xt.$y,Vt,Ht),xt);return Ct?qt:qt.endOf(Le)},Nt=function(Ht,Vt){return vt.w(xt.toDate()[Ht].apply(xt.toDate("s"),(Ct?[0,0,0,0]:[23,59,59,999]).slice(Vt)),xt)},jt=this.$W,Ft=this.$M,Ut=this.$D,Ot="set"+(this.$u?"UTC":"");switch(St){case nt:return Ct?$t(1,0):$t(31,11);case Ye:return Ct?$t(1,Ft):$t(0,Ft+1);case Be:var Dt=this.$locale().weekStart||0,zt=(jt<Dt?jt+7:jt)-Dt;return $t(Ct?Ut-zt:Ut+(6-zt),Ft);case Le:case ft:return Nt(Ot+"Hours",0);case me:return Nt(Ot+"Minutes",1);case pe:return Nt(Ot+"Seconds",2);case de:return Nt(Ot+"Milliseconds",3);default:return this.clone()}},ot.endOf=function(gt){return this.startOf(gt,!1)},ot.$set=function(gt,Et){var xt,Ct=vt.p(gt),St="set"+(this.$u?"UTC":""),$t=(xt={},xt[Le]=St+"Date",xt[ft]=St+"Date",xt[Ye]=St+"Month",xt[nt]=St+"FullYear",xt[me]=St+"Hours",xt[pe]=St+"Minutes",xt[de]=St+"Seconds",xt[l]=St+"Milliseconds",xt)[Ct],Nt=Ct===Le?this.$D+(Et-this.$W):Et;if(Ct===Ye||Ct===nt){var jt=this.clone().set(ft,1);jt.$d[$t](Nt),jt.init(),this.$d=jt.set(ft,Math.min(this.$D,jt.daysInMonth())).$d}else $t&&this.$d[$t](Nt);return this.init(),this},ot.set=function(gt,Et){return this.clone().$set(gt,Et)},ot.get=function(gt){return this[vt.p(gt)]()},ot.add=function(gt,Et){var xt,Ct=this;gt=Number(gt);var St=vt.p(Et),$t=function(Ft){var Ut=Pt(Ct);return vt.w(Ut.date(Ut.date()+Math.round(Ft*gt)),Ct)};if(St===Ye)return this.set(Ye,this.$M+gt);if(St===nt)return this.set(nt,this.$y+gt);if(St===Le)return $t(1);if(St===Be)return $t(7);var Nt=(xt={},xt[pe]=s,xt[me]=a,xt[de]=n,xt)[St]||1,jt=this.$d.getTime()+gt*Nt;return vt.w(jt,this)},ot.subtract=function(gt,Et){return this.add(-1*gt,Et)},ot.format=function(gt){var Et=this,xt=this.$locale();if(!this.isValid())return xt.invalidDate||st;var Ct=gt||"YYYY-MM-DDTHH:mm:ssZ",St=vt.z(this),$t=this.$H,Nt=this.$m,jt=this.$M,Ft=xt.weekdays,Ut=xt.months,Ot=xt.meridiem,Dt=function(Vt,qt,Wt,Gt){return Vt&&(Vt[qt]||Vt(Et,Ct))||Wt[qt].slice(0,Gt)},zt=function(Vt){return vt.s($t%12||12,Vt,"0")},Ht=Ot||function(Vt,qt,Wt){var Gt=Vt<12?"AM":"PM";return Wt?Gt.toLowerCase():Gt};return Ct.replace(mt,function(Vt,qt){return qt||function(Wt){switch(Wt){case"YY":return String(Et.$y).slice(-2);case"YYYY":return vt.s(Et.$y,4,"0");case"M":return jt+1;case"MM":return vt.s(jt+1,2,"0");case"MMM":return Dt(xt.monthsShort,jt,Ut,3);case"MMMM":return Dt(Ut,jt);case"D":return Et.$D;case"DD":return vt.s(Et.$D,2,"0");case"d":return String(Et.$W);case"dd":return Dt(xt.weekdaysMin,Et.$W,Ft,2);case"ddd":return Dt(xt.weekdaysShort,Et.$W,Ft,3);case"dddd":return Ft[Et.$W];case"H":return String($t);case"HH":return vt.s($t,2,"0");case"h":return zt(1);case"hh":return zt(2);case"a":return Ht($t,Nt,!0);case"A":return Ht($t,Nt,!1);case"m":return String(Nt);case"mm":return vt.s(Nt,2,"0");case"s":return String(Et.$s);case"ss":return vt.s(Et.$s,2,"0");case"SSS":return vt.s(Et.$ms,3,"0");case"Z":return St}return null}(Vt)||St.replace(":","")})},ot.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},ot.diff=function(gt,Et,xt){var Ct,St=this,$t=vt.p(Et),Nt=Pt(gt),jt=(Nt.utcOffset()-this.utcOffset())*s,Ft=this-Nt,Ut=function(){return vt.m(St,Nt)};switch($t){case nt:Ct=Ut()/12;break;case Ye:Ct=Ut();break;case tt:Ct=Ut()/3;break;case Be:Ct=(Ft-jt)/6048e5;break;case Le:Ct=(Ft-jt)/864e5;break;case me:Ct=Ft/a;break;case pe:Ct=Ft/s;break;case de:Ct=Ft/n;break;default:Ct=Ft}return xt?Ct:vt.a(Ct)},ot.daysInMonth=function(){return this.endOf(Ye).$D},ot.$locale=function(){return Tt[this.$L]},ot.locale=function(gt,Et){if(!gt)return this.$L;var xt=this.clone(),Ct=Mt(gt,Et,!0);return Ct&&(xt.$L=Ct),xt},ot.clone=function(){return vt.w(this.$d,this)},ot.toDate=function(){return new Date(this.valueOf())},ot.toJSON=function(){return this.isValid()?this.toISOString():null},ot.toISOString=function(){return this.$d.toISOString()},ot.toString=function(){return this.$d.toUTCString()},bt}(),wt=kt.prototype;return Pt.prototype=wt,[["$ms",l],["$s",de],["$m",pe],["$H",me],["$W",Le],["$M",Ye],["$y",nt],["$D",ft]].forEach(function(bt){wt[bt[1]]=function(ot){return this.$g(ot,bt[0],bt[1])}}),Pt.extend=function(bt,ot){return bt.$i||(bt(ot,kt,Pt),bt.$i=!0),Pt},Pt.locale=Mt,Pt.isDayjs=Bt,Pt.unix=function(bt){return Pt(1e3*bt)},Pt.en=Tt[Lt],Pt.Ls=Tt,Pt.p={},Pt})})(dayjs_min);var dayjs_minExports=dayjs_min.exports;const dayjs=getDefaultExportFromCjs(dayjs_minExports);function SearchIcon(){return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M21.71 20.29L18 16.61C19.4401 14.8144 20.1375 12.5353 19.9488 10.2413C19.7601 7.94731 18.6997 5.81279 16.9855 4.27665C15.2714 2.74051 13.0338 1.91951 10.7329 1.98247C8.43207 2.04543 6.24275 2.98757 4.61517 4.61515C2.98759 6.24273 2.04546 8.43204 1.9825 10.7329C1.91954 13.0338 2.74053 15.2714 4.27667 16.9855C5.81281 18.6997 7.94733 19.7601 10.2413 19.9488C12.5353 20.1375 14.8144 19.4401 16.61 18L20.29 21.68C20.383 21.7737 20.4936 21.8481 20.6154 21.8989C20.7373 21.9497 20.868 21.9758 21 21.9758C21.132 21.9758 21.2627 21.9497 21.3846 21.8989C21.5065 21.8481 21.6171 21.7737 21.71 21.68C21.8903 21.4935 21.991 21.2443 21.991 20.985C21.991 20.7257 21.8903 20.4765 21.71 20.29ZM11 18C9.61556 18 8.26218 17.5895 7.11103 16.8203C5.95989 16.0511 5.06268 14.9579 4.53287 13.6788C4.00306 12.3997 3.86443 10.9922 4.13453 9.63437C4.40463 8.2765 5.07131 7.02922 6.05028 6.05026C7.02925 5.07129 8.27653 4.4046 9.63439 4.13451C10.9923 3.86441 12.3997 4.00303 13.6788 4.53285C14.9579 5.06266 16.0511 5.95987 16.8203 7.11101C17.5895 8.26216 18 9.61553 18 11C18 12.8565 17.2625 14.637 15.9498 15.9498C14.637 17.2625 12.8565 18 11 18Z",fill:"#878787"})})}function HeartIcon({isSelected:e=!0}){return jsxRuntimeExports.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 60 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M30 54.095H29.965C23.5075 53.975 4.87503 37.14 4.87503 21.195C4.87503 13.535 11.1875 6.81 18.3825 6.81C24.1075 6.81 27.9575 10.76 29.9975 13.635C32.0325 10.765 35.8825 6.81 41.61 6.81C48.81 6.81 55.12 13.535 55.12 21.1975C55.12 37.1375 36.485 53.9725 30.0275 54.09H30V54.095Z",fill:e?"white":"none"}),jsxRuntimeExports.jsx("path",{d:"M30 54.095H29.965C23.5075 53.975 4.87503 37.14 4.87503 21.195C4.87503 13.535 11.1875 6.81 18.3825 6.81C24.1075 6.81 27.9575 10.76 29.9975 13.635C32.0325 10.765 35.8825 6.81 41.61 6.81C48.81 6.81 55.12 13.535 55.12 21.1975C55.12 37.1375 36.485 53.9725 30.0275 54.09H30V54.095ZM18.385 10.5625C13.185 10.5625 8.62753 15.5325 8.62753 21.2C8.62753 35.55 26.2125 50.19 30.0025 50.345C33.7975 50.19 51.3775 35.5525 51.3775 21.2C51.3775 15.5325 46.82 10.5625 41.62 10.5625C35.3 10.5625 31.77 17.9025 31.74 17.975C31.165 19.38 28.85 19.38 28.2725 17.975C28.2375 17.9 24.7075 10.5625 18.385 10.5625Z",fill:"white",stroke:"white",strokeWidth:"0.520833"})]})}function CopyIcon(){return jsxRuntimeExports.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 60 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M50 22.5H27.5C24.7386 22.5 22.5 24.7386 22.5 27.5V50C22.5 52.7614 24.7386 55 27.5 55H50C52.7614 55 55 52.7614 55 50V27.5C55 24.7386 52.7614 22.5 50 22.5Z",fill:"white",stroke:"white",strokeWidth:"2.08333",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("path",{d:"M12.5 37.5H10C8.67392 37.5 7.40215 36.9732 6.46447 36.0355C5.52678 35.0978 5 33.8261 5 32.5V10C5 8.67392 5.52678 7.40215 6.46447 6.46447C7.40215 5.52678 8.67392 5 10 5H32.5C33.8261 5 35.0978 5.52678 36.0355 6.46447C36.9732 7.40215 37.5 8.67392 37.5 10V12.5",stroke:"white",strokeWidth:"2.08333",strokeLinecap:"round",strokeLinejoin:"round"})]})}function DownloadIcon(){return jsxRuntimeExports.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M35 25V31.6667C35 32.5507 34.6488 33.3986 34.0237 34.0237C33.3986 34.6488 32.5507 35 31.6667 35H8.33333C7.44928 35 6.60143 34.6488 5.97631 34.0237C5.35119 33.3986 5 32.5507 5 31.6667V25",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("path",{d:"M11.6667 16.6667L20 25L28.3333 16.6667",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("path",{d:"M20 25V5",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}function HeartIcon2(){return jsxRuntimeExports.jsx("svg",{width:"25px",height:"25px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M12 5.881C12.981 4.729 14.484 4 16.05 4C18.822 4 21 6.178 21 8.95C21 12.3492 17.945 15.1195 13.3164 19.3167L13.305 19.327L12 20.515L10.695 19.336L10.6595 19.3037C6.04437 15.1098 3 12.3433 3 8.95C3 6.178 5.178 4 7.95 4C9.516 4 11.019 4.729 12 5.881Z",fill:"#F9595F"})})}function Bitcoin(){return jsxRuntimeExports.jsx("svg",{width:"25",height:"25",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M18 1.5C14.7366 1.5 11.5465 2.46771 8.8331 4.28075C6.11969 6.09379 4.00484 8.67074 2.756 11.6857C1.50715 14.7007 1.18039 18.0183 1.81705 21.219C2.45371 24.4197 4.02518 27.3597 6.33275 29.6673C8.64031 31.9748 11.5803 33.5463 14.781 34.183C17.9817 34.8196 21.2993 34.4929 24.3143 33.244C27.3293 31.9952 29.9062 29.8803 31.7193 27.1669C33.5323 24.4535 34.5 21.2634 34.5 18C34.5 13.6239 32.7616 9.42709 29.6673 6.33274C26.5729 3.23839 22.3761 1.5 18 1.5V1.5ZM18 31.5C15.33 31.5 12.7199 30.7082 10.4998 29.2248C8.27975 27.7414 6.54942 25.633 5.52763 23.1662C4.50585 20.6994 4.23851 17.985 4.75941 15.3663C5.28031 12.7475 6.56606 10.3421 8.45407 8.45406C10.3421 6.56605 12.7475 5.2803 15.3663 4.7594C17.985 4.2385 20.6994 4.50584 23.1662 5.52763C25.633 6.54941 27.7414 8.27974 29.2248 10.4998C30.7082 12.7199 31.5 15.33 31.5 18C31.5 21.5804 30.0777 25.0142 27.5459 27.5459C25.0142 30.0777 21.5804 31.5 18 31.5V31.5ZM21 10.5V9C21 8.60218 20.842 8.22065 20.5607 7.93934C20.2794 7.65804 19.8978 7.5 19.5 7.5C19.1022 7.5 18.7207 7.65804 18.4393 7.93934C18.158 8.22065 18 8.60218 18 9V10.5H16.5V9C16.5 8.60218 16.342 8.22065 16.0607 7.93934C15.7794 7.65804 15.3978 7.5 15 7.5C14.6022 7.5 14.2207 7.65804 13.9393 7.93934C13.658 8.22065 13.5 8.60218 13.5 9V10.5H12C11.6022 10.5 11.2207 10.658 10.9393 10.9393C10.658 11.2206 10.5 11.6022 10.5 12C10.5 12.3978 10.658 12.7794 10.9393 13.0607C11.2207 13.342 11.6022 13.5 12 13.5H13.5V22.5H12C11.6022 22.5 11.2207 22.658 10.9393 22.9393C10.658 23.2206 10.5 23.6022 10.5 24C10.5 24.3978 10.658 24.7794 10.9393 25.0607C11.2207 25.342 11.6022 25.5 12 25.5H13.5V27C13.5 27.3978 13.658 27.7794 13.9393 28.0607C14.2207 28.342 14.6022 28.5 15 28.5C15.3978 28.5 15.7794 28.342 16.0607 28.0607C16.342 27.7794 16.5 27.3978 16.5 27V25.5H18V27C18 27.3978 18.158 27.7794 18.4393 28.0607C18.7207 28.342 19.1022 28.5 19.5 28.5C19.8978 28.5 20.2794 28.342 20.5607 28.0607C20.842 27.7794 21 27.3978 21 27V25.5C22.1935 25.5 23.3381 25.0259 24.182 24.182C25.0259 23.3381 25.5 22.1935 25.5 21C25.4975 19.8919 25.0862 18.8237 24.345 18C25.0862 17.1763 25.4975 16.1081 25.5 15C25.5 13.8065 25.0259 12.6619 24.182 11.818C23.3381 10.9741 22.1935 10.5 21 10.5V10.5ZM21 22.5H16.5V19.5H21C21.3978 19.5 21.7794 19.658 22.0607 19.9393C22.342 20.2206 22.5 20.6022 22.5 21C22.5 21.3978 22.342 21.7794 22.0607 22.0607C21.7794 22.342 21.3978 22.5 21 22.5ZM21 16.5H16.5V13.5H21C21.3978 13.5 21.7794 13.658 22.0607 13.9393C22.342 14.2206 22.5 14.6022 22.5 15C22.5 15.3978 22.342 15.7794 22.0607 16.0607C21.7794 16.342 21.3978 16.5 21 16.5Z",fill:"#FE983B"})})}function VerificationCheck(){return jsxRuntimeExports.jsx("svg",{width:"20",height:"20",viewBox:"0 0 13 12",fill:"#ca077c",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.50941 0L9.53314 1.94972L11.759 2.29179L11.4059 4.4533L13 6.00021L11.4061 7.54734L11.7585 9.7082L9.53201 10.0503L8.50838 12L6.4994 11.0066L4.49194 11.9996L3.46887 10.0502L1.24134 9.70816L1.59414 7.5473L0 6.00038L1.59392 4.45325L1.24147 2.29239L3.46783 1.94984L4.49111 0.000754215L6.49943 0.993864L8.50941 0ZM4.11667 5.72772L3.25 6.60044L5.41667 8.78226L9.75 4.41863L8.88333 3.5459L5.41667 7.03681L4.11667 5.72772Z",fill:"#ca077c"})})}function Relays(){return jsxRuntimeExports.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M14.9999 10.9999H9.99989C9.73467 10.9999 9.48032 11.1053 9.29278 11.2928C9.10525 11.4803 8.99989 11.7347 8.99989 11.9999V19.9999C8.99962 20.1816 9.04884 20.3599 9.14227 20.5157C9.23569 20.6715 9.3698 20.7989 9.53018 20.8842C9.69056 20.9696 9.87116 21.0096 10.0526 21C10.234 20.9904 10.4094 20.9316 10.5599 20.8299L12.4999 19.5299L14.3899 20.7899C14.5644 20.9254 14.7789 20.9992 14.9999 20.9999C15.1523 21.0005 15.3028 20.9663 15.4399 20.8999C15.6082 20.8174 15.7499 20.6893 15.8489 20.5302C15.948 20.3711 16.0003 20.1873 15.9999 19.9999V11.9999C15.9999 11.7347 15.8945 11.4803 15.707 11.2928C15.5195 11.1053 15.2651 10.9999 14.9999 10.9999ZM13.9999 18.1199L13.0599 17.4899C12.8945 17.3781 12.6995 17.3184 12.4999 17.3184C12.3003 17.3184 12.1053 17.3781 11.9399 17.4899L10.9999 18.1299V12.9999H13.9999V18.1199ZM18.4199 7.21989C17.8089 5.8159 16.7544 4.65097 15.418 3.90362C14.0815 3.15627 12.5369 2.86773 11.0209 3.0822C9.50477 3.29668 8.10082 4.00235 7.02415 5.09107C5.94747 6.17979 5.25748 7.59151 5.05989 9.10989C4.10648 9.33822 3.27011 9.90873 2.70963 10.7131C2.14914 11.5174 1.90357 12.4996 2.01955 13.4731C2.13553 14.4466 2.60498 15.3436 3.33876 15.9938C4.07253 16.6439 5.01952 17.002 5.99989 16.9999C6.26511 16.9999 6.51946 16.8945 6.707 16.707C6.89453 16.5195 6.99989 16.2651 6.99989 15.9999C6.99989 15.7347 6.89453 15.4803 6.707 15.2928C6.51946 15.1053 6.26511 14.9999 5.99989 14.9999C5.46946 14.9999 4.96075 14.7892 4.58568 14.4141C4.2106 14.039 3.99989 13.5303 3.99989 12.9999C3.99989 12.4695 4.2106 11.9608 4.58568 11.5857C4.96075 11.2106 5.46946 10.9999 5.99989 10.9999C6.26511 10.9999 6.51946 10.8945 6.707 10.707C6.89453 10.5195 6.99989 10.2651 6.99989 9.99989C7.00244 8.81717 7.42418 7.67365 8.19016 6.77248C8.95614 5.87131 10.0168 5.27085 11.1836 5.07777C12.3505 4.88469 13.548 5.1115 14.5635 5.7179C15.5789 6.32431 16.3465 7.27103 16.7299 8.38989C16.7871 8.56173 16.8898 8.71483 17.0272 8.83283C17.1646 8.95083 17.3314 9.02931 17.5099 9.0599C18.1112 9.16874 18.665 9.45863 19.0971 9.89078C19.5292 10.3229 19.819 10.8767 19.9277 11.4781C20.0364 12.0794 19.9589 12.6997 19.7056 13.2558C19.4522 13.8119 19.035 14.2774 18.5099 14.5899C18.2792 14.7225 18.1105 14.9413 18.0412 15.1983C17.9718 15.4552 18.0073 15.7292 18.1399 15.9599C18.2725 16.1906 18.4913 16.3592 18.7483 16.4286C19.0052 16.498 19.2792 16.4625 19.5099 16.3299C20.2681 15.8898 20.8973 15.2581 21.3343 14.4981C21.7714 13.7381 22.0009 12.8766 21.9999 11.9999C21.9969 10.924 21.6469 9.87783 21.0019 9.0167C20.357 8.15557 19.4515 7.52544 18.4199 7.21989Z",fill:"#FFF"})})}function Close(){return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M13.41 12L17.71 7.71C17.8983 7.5217 18.0041 7.2663 18.0041 7C18.0041 6.7337 17.8983 6.47831 17.71 6.29C17.5217 6.1017 17.2663 5.99591 17 5.99591C16.7337 5.99591 16.4783 6.1017 16.29 6.29L12 10.59L7.71 6.29C7.5217 6.1017 7.2663 5.99591 7 5.99591C6.7337 5.99591 6.4783 6.1017 6.29 6.29C6.1017 6.47831 5.99591 6.7337 5.99591 7C5.99591 7.2663 6.1017 7.5217 6.29 7.71L10.59 12L6.29 16.29C6.19627 16.383 6.12188 16.4936 6.07111 16.6154C6.02034 16.7373 5.9942 16.868 5.9942 17C5.9942 17.132 6.02034 17.2627 6.07111 17.3846C6.12188 17.5064 6.19627 17.617 6.29 17.71C6.38296 17.8037 6.49356 17.8781 6.61542 17.9289C6.73728 17.9797 6.86799 18.0058 7 18.0058C7.13201 18.0058 7.26272 17.9797 7.38458 17.9289C7.50644 17.8781 7.61704 17.8037 7.71 17.71L12 13.41L16.29 17.71C16.383 17.8037 16.4936 17.8781 16.6154 17.9289C16.7373 17.9797 16.868 18.0058 17 18.0058C17.132 18.0058 17.2627 17.9797 17.3846 17.9289C17.5064 17.8781 17.617 17.8037 17.71 17.71C17.8037 17.617 17.8781 17.5064 17.9289 17.3846C17.9797 17.2627 18.0058 17.132 18.0058 17C18.0058 16.868 17.9797 16.7373 17.9289 16.6154C17.8781 16.4936 17.8037 16.383 17.71 16.29L13.41 12Z",fill:"#848484"})})}function Delete(){return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M10 18C10.2652 18 10.5196 17.8946 10.7071 17.7071C10.8946 17.5196 11 17.2652 11 17V11C11 10.7348 10.8946 10.4804 10.7071 10.2929C10.5196 10.1054 10.2652 10 10 10C9.73478 10 9.48043 10.1054 9.29289 10.2929C9.10536 10.4804 9 10.7348 9 11V17C9 17.2652 9.10536 17.5196 9.29289 17.7071C9.48043 17.8946 9.73478 18 10 18ZM20 6H16V5C16 4.20435 15.6839 3.44129 15.1213 2.87868C14.5587 2.31607 13.7956 2 13 2H11C10.2044 2 9.44129 2.31607 8.87868 2.87868C8.31607 3.44129 8 4.20435 8 5V6H4C3.73478 6 3.48043 6.10536 3.29289 6.29289C3.10536 6.48043 3 6.73478 3 7C3 7.26522 3.10536 7.51957 3.29289 7.70711C3.48043 7.89464 3.73478 8 4 8H5V19C5 19.7956 5.31607 20.5587 5.87868 21.1213C6.44129 21.6839 7.20435 22 8 22H16C16.7956 22 17.5587 21.6839 18.1213 21.1213C18.6839 20.5587 19 19.7956 19 19V8H20C20.2652 8 20.5196 7.89464 20.7071 7.70711C20.8946 7.51957 21 7.26522 21 7C21 6.73478 20.8946 6.48043 20.7071 6.29289C20.5196 6.10536 20.2652 6 20 6ZM10 5C10 4.73478 10.1054 4.48043 10.2929 4.29289C10.4804 4.10536 10.7348 4 11 4H13C13.2652 4 13.5196 4.10536 13.7071 4.29289C13.8946 4.48043 14 4.73478 14 5V6H10V5ZM17 19C17 19.2652 16.8946 19.5196 16.7071 19.7071C16.5196 19.8946 16.2652 20 16 20H8C7.73478 20 7.48043 19.8946 7.29289 19.7071C7.10536 19.5196 7 19.2652 7 19V8H17V19ZM14 18C14.2652 18 14.5196 17.8946 14.7071 17.7071C14.8946 17.5196 15 17.2652 15 17V11C15 10.7348 14.8946 10.4804 14.7071 10.2929C14.5196 10.1054 14.2652 10 14 10C13.7348 10 13.4804 10.1054 13.2929 10.2929C13.1054 10.4804 13 10.7348 13 11V17C13 17.2652 13.1054 17.5196 13.2929 17.7071C13.4804 17.8946 13.7348 18 14 18Z",fill:"#FE3B3B"})})}function Plus(){return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M19 11H13V5C13 4.73478 12.8946 4.48043 12.7071 4.29289C12.5196 4.10536 12.2652 4 12 4C11.7348 4 11.4804 4.10536 11.2929 4.29289C11.1054 4.48043 11 4.73478 11 5V11H5C4.73478 11 4.48043 11.1054 4.29289 11.2929C4.10536 11.4804 4 11.7348 4 12C4 12.2652 4.10536 12.5196 4.29289 12.7071C4.48043 12.8946 4.73478 13 5 13H11V19C11 19.2652 11.1054 19.5196 11.2929 19.7071C11.4804 19.8946 11.7348 20 12 20C12.2652 20 12.5196 19.8946 12.7071 19.7071C12.8946 19.5196 13 19.2652 13 19V13H19C19.2652 13 19.5196 12.8946 19.7071 12.7071C19.8946 12.5196 20 12.2652 20 12C20 11.7348 19.8946 11.4804 19.7071 11.2929C19.5196 11.1054 19.2652 11 19 11Z",fill:"#FFFFFF"})})}function QuestionMark(){return jsxRuntimeExports.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M9.4083 12.7417C9.37246 12.7813 9.33906 12.823 9.3083 12.8667C9.27676 12.9131 9.25154 12.9636 9.2333 13.0167C9.20927 13.0639 9.19242 13.1145 9.1833 13.1667C9.17921 13.2222 9.17921 13.2779 9.1833 13.3333C9.18048 13.4427 9.20331 13.5511 9.24996 13.65C9.28739 13.7534 9.3471 13.8473 9.42487 13.9251C9.50263 14.0029 9.59655 14.0626 9.69996 14.1C9.79971 14.1441 9.90757 14.1669 10.0166 14.1669C10.1257 14.1669 10.2335 14.1441 10.3333 14.1C10.4367 14.0626 10.5306 14.0029 10.6084 13.9251C10.6862 13.8473 10.7459 13.7534 10.7833 13.65C10.8203 13.5487 10.8373 13.4411 10.8333 13.3333C10.8339 13.2237 10.8129 13.1149 10.7714 13.0134C10.73 12.9119 10.6689 12.8195 10.5916 12.7417C10.5142 12.6636 10.422 12.6016 10.3204 12.5593C10.2189 12.517 10.11 12.4952 9.99996 12.4952C9.88995 12.4952 9.78103 12.517 9.67948 12.5593C9.57793 12.6016 9.48576 12.6636 9.4083 12.7417ZM9.99996 1.66667C8.35179 1.66667 6.74062 2.15541 5.37021 3.07109C3.9998 3.98677 2.9317 5.28826 2.30097 6.81098C1.67024 8.33369 1.50521 10.0092 1.82675 11.6258C2.1483 13.2423 2.94197 14.7271 4.10741 15.8926C5.27284 17.058 6.7577 17.8517 8.37421 18.1732C9.99072 18.4948 11.6663 18.3297 13.189 17.699C14.7117 17.0683 16.0132 16.0002 16.9289 14.6298C17.8446 13.2593 18.3333 11.6482 18.3333 10C18.3333 8.90566 18.1177 7.82202 17.699 6.81098C17.2802 5.79993 16.6663 4.88127 15.8925 4.10745C15.1187 3.33363 14.2 2.7198 13.189 2.30101C12.1779 1.88222 11.0943 1.66667 9.99996 1.66667ZM9.99996 16.6667C8.68142 16.6667 7.39249 16.2757 6.29616 15.5431C5.19983 14.8106 4.34535 13.7694 3.84077 12.5512C3.33618 11.3331 3.20416 9.99261 3.46139 8.6994C3.71863 7.4062 4.35357 6.21831 5.28592 5.28596C6.21827 4.35361 7.40615 3.71867 8.69936 3.46144C9.99257 3.2042 11.333 3.33622 12.5512 3.84081C13.7694 4.34539 14.8105 5.19988 15.5431 6.2962C16.2756 7.39253 16.6666 8.68146 16.6666 10C16.6666 11.7681 15.9642 13.4638 14.714 14.714C13.4638 15.9643 11.7681 16.6667 9.99996 16.6667ZM9.99996 5.83334C9.56085 5.83306 9.12941 5.94844 8.74905 6.16787C8.3687 6.38731 8.05285 6.70305 7.8333 7.08334C7.773 7.17819 7.73252 7.28425 7.71427 7.39515C7.69603 7.50605 7.70041 7.6195 7.72715 7.72866C7.75389 7.83782 7.80244 7.94045 7.86987 8.03037C7.9373 8.12028 8.02222 8.19563 8.11952 8.25187C8.21683 8.30812 8.3245 8.3441 8.43607 8.35765C8.54764 8.37121 8.6608 8.36205 8.76874 8.33074C8.87668 8.29942 8.97717 8.2466 9.06417 8.17544C9.15116 8.10428 9.22287 8.01626 9.27496 7.91667C9.34838 7.7895 9.4541 7.68399 9.58142 7.61082C9.70873 7.53765 9.85312 7.49942 9.99996 7.5C10.221 7.5 10.4329 7.5878 10.5892 7.74408C10.7455 7.90036 10.8333 8.11232 10.8333 8.33334C10.8333 8.55435 10.7455 8.76631 10.5892 8.92259C10.4329 9.07887 10.221 9.16667 9.99996 9.16667C9.77895 9.16667 9.56699 9.25447 9.41071 9.41075C9.25443 9.56703 9.16663 9.77899 9.16663 10V10.8333C9.16663 11.0544 9.25443 11.2663 9.41071 11.4226C9.56699 11.5789 9.77895 11.6667 9.99996 11.6667C10.221 11.6667 10.4329 11.5789 10.5892 11.4226C10.7455 11.2663 10.8333 11.0544 10.8333 10.8333V10.6833C11.3844 10.4834 11.8478 10.096 12.1423 9.58906C12.4368 9.0821 12.5437 8.48775 12.4445 7.90991C12.3452 7.33208 12.046 6.80752 11.5991 6.42793C11.1523 6.04835 10.5862 5.83789 9.99996 5.83334Z",fill:"#4C9EFF"})})}function Mail(){return jsxRuntimeExports.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M11.6666 9.59165H13.6833C13.793 9.59229 13.9017 9.57127 14.0032 9.5298C14.1047 9.48833 14.1971 9.42722 14.275 9.34999L18.0916 5.53332C18.1697 5.45585 18.2317 5.36368 18.274 5.26214C18.3163 5.16059 18.3381 5.05166 18.3381 4.94165C18.3381 4.83164 18.3163 4.72272 18.274 4.62117C18.2317 4.51962 18.1697 4.42746 18.0916 4.34999L16.075 2.33332C15.9975 2.25521 15.9053 2.19322 15.8038 2.15091C15.7022 2.1086 15.5933 2.08682 15.4833 2.08682C15.3733 2.08682 15.2644 2.1086 15.1628 2.15091C15.0613 2.19322 14.9691 2.25521 14.8916 2.33332L11.075 6.14999C10.9227 6.30968 10.8364 6.52102 10.8333 6.74165V8.75832C10.8333 8.97933 10.9211 9.1913 11.0774 9.34758C11.2337 9.50386 11.4456 9.59165 11.6666 9.59165ZM12.5 7.09165L15.4833 4.10832L16.3166 4.94165L13.3333 7.92499H12.5V7.09165ZM17.5 8.75832C17.2789 8.75832 17.067 8.84612 16.9107 9.0024C16.7544 9.15868 16.6666 9.37064 16.6666 9.59165V15.425C16.6666 15.646 16.5788 15.858 16.4225 16.0142C16.2663 16.1705 16.0543 16.2583 15.8333 16.2583H4.16663C3.94561 16.2583 3.73365 16.1705 3.57737 16.0142C3.42109 15.858 3.33329 15.646 3.33329 15.425V7.41665L8.23329 12.325C8.46585 12.5606 8.74287 12.7476 9.04829 12.8753C9.3537 13.003 9.68143 13.0687 10.0125 13.0687C10.3435 13.0687 10.6712 13.003 10.9766 12.8753C11.2821 12.7476 11.5591 12.5606 11.7916 12.325C11.9443 12.1692 12.0298 11.9598 12.0298 11.7417C12.0298 11.5235 11.9443 11.3141 11.7916 11.1583C11.714 11.0789 11.6213 11.0159 11.519 10.9728C11.4167 10.9298 11.3068 10.9076 11.1958 10.9076C11.0848 10.9076 10.9749 10.9298 10.8726 10.9728C10.7703 11.0159 10.6776 11.0789 10.6 11.1583C10.4442 11.311 10.2348 11.3965 10.0166 11.3965C9.7985 11.3965 9.58907 11.311 9.43329 11.1583L4.50829 6.24165H8.33329C8.55431 6.24165 8.76627 6.15386 8.92255 5.99758C9.07883 5.8413 9.16663 5.62933 9.16663 5.40832C9.16663 5.18731 9.07883 4.97535 8.92255 4.81907C8.76627 4.66279 8.55431 4.57499 8.33329 4.57499H4.16663C3.50358 4.57499 2.8677 4.83838 2.39886 5.30722C1.93002 5.77606 1.66663 6.41195 1.66663 7.07499V15.4083C1.66663 16.0714 1.93002 16.7072 2.39886 17.1761C2.8677 17.6449 3.50358 17.9083 4.16663 17.9083H15.8333C16.4963 17.9083 17.1322 17.6449 17.6011 17.1761C18.0699 16.7072 18.3333 16.0714 18.3333 15.4083V9.57499C18.3333 9.35397 18.2455 9.14201 18.0892 8.98573C17.9329 8.82945 17.721 8.74165 17.5 8.74165V8.75832Z",fill:"#CE66FF"})})}function Github(){return jsxRuntimeExports.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M12 2.2467C9.6255 2.2468 7.32849 3.09182 5.51999 4.63055C3.71149 6.16929 2.50953 8.30133 2.12916 10.6452C1.74879 12.989 2.21485 15.3918 3.44393 17.4235C4.67301 19.4551 6.58491 20.9832 8.83755 21.7342C9.33755 21.8217 9.52505 21.5217 9.52505 21.2592C9.52505 21.0217 9.51254 20.2342 9.51254 19.3967C7.00003 19.8592 6.35003 18.7842 6.15003 18.2217C5.9281 17.6747 5.5763 17.1899 5.12503 16.8092C4.77503 16.6217 4.27503 16.1592 5.11252 16.1467C5.4323 16.1814 5.73901 16.2927 6.00666 16.4711C6.2743 16.6495 6.49499 16.8899 6.65003 17.1717C6.7868 17.4174 6.97071 17.6337 7.19122 17.8082C7.41173 17.9827 7.6645 18.112 7.93506 18.1886C8.20562 18.2652 8.48864 18.2877 8.76791 18.2548C9.04717 18.2219 9.3172 18.1342 9.56251 17.9967C9.6058 17.4883 9.83237 17.013 10.2 16.6592C7.97503 16.4092 5.65003 15.5467 5.65003 11.7217C5.63597 10.7279 6.00271 9.76631 6.67503 9.03423C6.36931 8.17045 6.40508 7.22252 6.77503 6.38423C6.77503 6.38423 7.6125 6.12172 9.52503 7.40923C11.1613 6.95921 12.8887 6.95921 14.525 7.40923C16.4375 6.10923 17.275 6.38423 17.275 6.38423C17.645 7.22251 17.6808 8.17046 17.375 9.03423C18.0494 9.76506 18.4164 10.7275 18.4 11.7217C18.4 15.5592 16.0625 16.4092 13.8375 16.6592C14.0762 16.9011 14.26 17.1915 14.3764 17.5107C14.4929 17.83 14.5393 18.1705 14.5125 18.5092C14.5125 19.8468 14.5 20.9217 14.5 21.2592C14.5 21.5217 14.6875 21.8342 15.1875 21.7342C17.4362 20.9771 19.3426 19.4455 20.5664 17.4128C21.7903 15.38 22.2519 12.9785 21.8689 10.6369C21.4859 8.29535 20.2832 6.16608 18.4755 4.62922C16.6678 3.09235 14.3727 2.24794 12 2.2467Z",fill:"#FFF"})})}function NostrichHead({fill:e}){return jsxRuntimeExports.jsx("svg",{width:"24",height:"24",viewBox:"0 0 56 56",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"M56 24.4076V53.9817C56 55.0939 55.1041 55.9964 54.0001 55.9964H30.0016C28.8977 55.9964 28.0018 55.0939 28.0018 53.9817V48.4741C28.1111 41.7228 28.8201 35.2558 30.3085 32.3137C31.2009 30.5442 32.6717 29.5812 34.3612 29.066C37.5532 28.0995 43.1543 28.7604 45.5315 28.6467C45.5315 28.6467 52.7127 28.9345 52.7127 24.8376C52.7127 21.5401 49.5031 21.7995 49.5031 21.7995C45.9654 21.8919 43.2706 21.6503 41.5247 20.9574C38.6007 19.799 38.502 17.6741 38.4914 16.9635C38.3468 8.75533 26.3334 7.77107 15.7486 9.80711C4.1761 12.0244 15.8755 28.7355 15.8755 51.0431V54.0208C15.8544 55.1152 14.9761 56 13.8827 56H1.99987C0.895887 56 0 55.0975 0 53.9853V2.83553C0 1.72335 0.895887 0.820813 1.99987 0.820813H13.1702C14.2742 0.820813 15.1701 1.72335 15.1701 2.83553C15.1701 4.48782 17.0148 5.40812 18.3481 4.44518C22.3654 1.54569 27.5221 0 33.2924 0C46.2193 0 55.993 7.58985 55.993 24.4076H56ZM34.541 18.4061C34.541 16.0254 32.6258 14.0959 30.2626 14.0959C27.8995 14.0959 25.9843 16.0254 25.9843 18.4061C25.9843 20.7868 27.8995 22.7162 30.2626 22.7162C32.6258 22.7162 34.541 20.7868 34.541 18.4061Z",fill:e})})}function SadComputer(){return jsxRuntimeExports.jsx("svg",{width:"100px",height:"100px",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:jsxRuntimeExports.jsx("path",{d:"m 3 0 c -1.660156 0 -3 1.339844 -3 3 v 7 c 0 1.660156 1.339844 3 3 3 h 10 c 1.660156 0 3 -1.339844 3 -3 v -7 c 0 -1.660156 -1.339844 -3 -3 -3 z m 0 2 h 10 c 0.554688 0 1 0.445312 1 1 v 7 c 0 0.554688 -0.445312 1 -1 1 h -10 c -0.554688 0 -1 -0.445312 -1 -1 v -7 c 0 -0.554688 0.445312 -1 1 -1 z m 3 2 c -0.550781 0 -1 0.449219 -1 1 s 0.449219 1 1 1 s 1 -0.449219 1 -1 s -0.449219 -1 -1 -1 z m 4 0 c -0.550781 0 -1 0.449219 -1 1 s 0.449219 1 1 1 s 1 -0.449219 1 -1 s -0.449219 -1 -1 -1 z m -2 3 c -1.429688 0 -2.75 0.761719 -3.464844 2 c -0.136718 0.238281 -0.054687 0.546875 0.183594 0.683594 c 0.238281 0.136718 0.546875 0.054687 0.683594 -0.183594 c 0.535156 -0.929688 1.523437 -1.5 2.597656 -1.5 s 2.0625 0.570312 2.597656 1.5 c 0.136719 0.238281 0.445313 0.320312 0.683594 0.183594 c 0.238281 -0.136719 0.320312 -0.445313 0.183594 -0.683594 c -0.714844 -1.238281 -2.035156 -2 -3.464844 -2 z m -3 7 c -1.105469 0 -2 0.894531 -2 2 h 10 c 0 -1.105469 -0.894531 -2 -2 -2 z m 0 0",fill:"#3c3c3c"})})}function Nostrich(){return jsxRuntimeExports.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 620 620",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M78.3722 125.197C61.7248 144.89 48.7317 167.831 40.8141 193.005C85.8839 182.854 145.774 180.418 179.678 177.778C190.235 134.333 220.281 101.241 270.629 103.474C292.352 104.489 311.436 118.497 324.632 140.017C334.377 129.663 347.37 122.761 364.626 120.325C365.844 120.325 368.484 120.122 370.514 120.122C334.783 81.1422 283.825 56.3742 226.778 56.3742C216.424 56.3742 206.273 57.3892 196.122 59.0134C194.092 59.0134 191.453 59.4194 188.001 60.2315C187.798 60.2315 187.392 60.2315 187.189 60.2315C186.986 60.2315 186.783 60.2315 186.377 60.2315C146.992 69.7733 117.351 62.0586 100.501 39.1177C98.6739 36.6815 91.5683 25.9216 89.3351 7.04102C76.9511 19.8311 68.8304 40.9449 75.733 63.4797C81.2145 81.3452 91.5683 90.887 102.734 96.3685C85.6808 97.3836 71.4696 94.1353 57.2585 83.3754C48.9348 77.0819 43.6563 70.1793 34.9266 52.1108C26.8059 64.9009 27.618 79.1121 29.2421 86.4207C31.2723 96.1655 36.3477 107.128 42.8442 113.422C52.7921 123.167 67.0033 125.4 78.5752 125.197H78.3722Z",fill:"#AC7FF0"}),jsxRuntimeExports.jsx("path",{d:"M270.828 293.094C296.056 293.094 316.507 258.1 316.507 214.933C316.507 171.765 296.056 136.771 270.828 136.771C245.601 136.771 225.149 171.765 225.149 214.933C225.149 258.1 245.601 293.094 270.828 293.094Z",fill:"#AC7FF0"}),jsxRuntimeExports.jsx("path",{d:"M371.321 274.215C391.055 274.215 407.052 246.402 407.052 212.092C407.052 177.782 391.055 149.969 371.321 149.969C351.588 149.969 335.59 177.782 335.59 212.092C335.59 246.402 351.588 274.215 371.321 274.215Z",fill:"#AC7FF0"}),jsxRuntimeExports.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M194.407 619.567C194.612 610.476 198.001 581.848 226.982 524.537C239.772 499.565 268.803 465.053 290.526 446.375C302.098 436.224 313.67 427.697 325.039 419.78C330.927 416.328 336.408 412.674 341.687 408.817C436.779 350.515 520.723 362.689 590.364 372.789L592.413 373.086C592.413 373.086 609.06 323.55 540.44 297.97C503.085 284.164 459.03 272.998 422.284 265.284C417.006 274.826 410.306 282.946 402.389 289.037C402.28 289.118 402.169 289.202 402.054 289.288C396.166 293.713 382.204 304.205 356.913 301.218C343.92 299.594 333.972 294.315 326.054 286.601C312.655 308.729 293.369 323.144 271.037 325.174C209.116 330.452 177.852 278.48 175.822 221.026C129.331 225.492 65.9894 254.118 32.2886 270.765L32.4629 569.354C75.4629 586.018 139.97 606.583 194.407 619.567Z",fill:"#AC7FF0"})]})}var __assign=function(){return __assign=Object.assign||function(t){for(var n,s=1,a=arguments.length;s<a;s++){n=arguments[s];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(t[l]=n[l])}return t},__assign.apply(this,arguments)};function __spreadArray$2(e,t,n){if(n||arguments.length===2)for(var s=0,a=t.length,l;s<a;s++)(l||!(s in t))&&(l||(l=Array.prototype.slice.call(t,0,s)),l[s]=t[s]);return e.concat(l||Array.prototype.slice.call(t))}typeof SuppressedError=="function"&&SuppressedError;var MS="-ms-",MOZ="-moz-",WEBKIT="-webkit-",COMMENT="comm",RULESET="rule",DECLARATION="decl",IMPORT="@import",KEYFRAMES="@keyframes",LAYER="@layer",abs=Math.abs,from=String.fromCharCode,assign=Object.assign;function hash$2(e,t){return charat(e,0)^45?(((t<<2^charat(e,0))<<2^charat(e,1))<<2^charat(e,2))<<2^charat(e,3):0}function trim(e){return e.trim()}function match(e,t){return(e=t.exec(e))?e[0]:e}function replace(e,t,n){return e.replace(t,n)}function indexof(e,t,n){return e.indexOf(t,n)}function charat(e,t){return e.charCodeAt(t)|0}function substr(e,t,n){return e.slice(t,n)}function strlen(e){return e.length}function sizeof(e){return e.length}function append(e,t){return t.push(e),e}function combine(e,t){return e.map(t).join("")}function filter(e,t){return e.filter(function(n){return!match(n,t)})}var line=1,column=1,length=0,position=0,character=0,characters="";function node(e,t,n,s,a,l,de,pe){return{value:e,root:t,parent:n,type:s,props:a,children:l,line,column,length:de,return:"",siblings:pe}}function copy(e,t){return assign(node("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function lift(e){for(;e.root;)e=copy(e.root,{children:[e]});append(e,e.siblings)}function char(){return character}function prev(){return character=position>0?charat(characters,--position):0,column--,character===10&&(column=1,line--),character}function next(){return character=position<length?charat(characters,position++):0,column++,character===10&&(column=1,line++),character}function peek(){return charat(characters,position)}function caret(){return position}function slice(e,t){return substr(characters,e,t)}function token(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function alloc(e){return line=column=1,length=strlen(characters=e),position=0,[]}function dealloc(e){return characters="",e}function delimit(e){return trim(slice(position-1,delimiter(e===91?e+2:e===40?e+1:e)))}function whitespace(e){for(;(character=peek())&&character<33;)next();return token(e)>2||token(character)>3?"":" "}function escaping(e,t){for(;--t&&next()&&!(character<48||character>102||character>57&&character<65||character>70&&character<97););return slice(e,caret()+(t<6&&peek()==32&&next()==32))}function delimiter(e){for(;next();)switch(character){case e:return position;case 34:case 39:e!==34&&e!==39&&delimiter(character);break;case 40:e===41&&delimiter(e);break;case 92:next();break}return position}function commenter(e,t){for(;next()&&e+character!==57;)if(e+character===84&&peek()===47)break;return"/*"+slice(t,position-1)+"*"+from(e===47?e:next())}function identifier(e){for(;!token(peek());)next();return slice(e,position)}function compile(e){return dealloc(parse$1("",null,null,null,[""],e=alloc(e),0,[0],e))}function parse$1(e,t,n,s,a,l,de,pe,me){for(var Le=0,Be=0,Ye=de,tt=0,nt=0,ft=0,st=1,yt=1,mt=1,_t=0,Rt="",At=a,Lt=l,Tt=s,It=Rt;yt;)switch(ft=_t,_t=next()){case 40:if(ft!=108&&charat(It,Ye-1)==58){indexof(It+=replace(delimit(_t),"&","&\f"),"&\f",abs(Le?pe[Le-1]:0))!=-1&&(mt=-1);break}case 34:case 39:case 91:It+=delimit(_t);break;case 9:case 10:case 13:case 32:It+=whitespace(ft);break;case 92:It+=escaping(caret()-1,7);continue;case 47:switch(peek()){case 42:case 47:append(comment(commenter(next(),caret()),t,n,me),me);break;default:It+="/"}break;case 123*st:pe[Le++]=strlen(It)*mt;case 125*st:case 59:case 0:switch(_t){case 0:case 125:yt=0;case 59+Be:mt==-1&&(It=replace(It,/\f/g,"")),nt>0&&strlen(It)-Ye&&append(nt>32?declaration(It+";",s,n,Ye-1,me):declaration(replace(It," ","")+";",s,n,Ye-2,me),me);break;case 59:It+=";";default:if(append(Tt=ruleset(It,t,n,Le,Be,a,pe,Rt,At=[],Lt=[],Ye,l),l),_t===123)if(Be===0)parse$1(It,t,Tt,Tt,At,l,Ye,pe,Lt);else switch(tt===99&&charat(It,3)===110?100:tt){case 100:case 108:case 109:case 115:parse$1(e,Tt,Tt,s&&append(ruleset(e,Tt,Tt,0,0,a,pe,Rt,a,At=[],Ye,Lt),Lt),a,Lt,Ye,pe,s?At:Lt);break;default:parse$1(It,Tt,Tt,Tt,[""],Lt,0,pe,Lt)}}Le=Be=nt=0,st=mt=1,Rt=It="",Ye=de;break;case 58:Ye=1+strlen(It),nt=ft;default:if(st<1){if(_t==123)--st;else if(_t==125&&st++==0&&prev()==125)continue}switch(It+=from(_t),_t*st){case 38:mt=Be>0?1:(It+="\f",-1);break;case 44:pe[Le++]=(strlen(It)-1)*mt,mt=1;break;case 64:peek()===45&&(It+=delimit(next())),tt=peek(),Be=Ye=strlen(Rt=It+=identifier(caret())),_t++;break;case 45:ft===45&&strlen(It)==2&&(st=0)}}return l}function ruleset(e,t,n,s,a,l,de,pe,me,Le,Be,Ye){for(var tt=a-1,nt=a===0?l:[""],ft=sizeof(nt),st=0,yt=0,mt=0;st<s;++st)for(var _t=0,Rt=substr(e,tt+1,tt=abs(yt=de[st])),At=e;_t<ft;++_t)(At=trim(yt>0?nt[_t]+" "+Rt:replace(Rt,/&\f/g,nt[_t])))&&(me[mt++]=At);return node(e,t,n,a===0?RULESET:pe,me,Le,Be,Ye)}function comment(e,t,n,s){return node(e,t,n,COMMENT,from(char()),substr(e,2,-2),0,s)}function declaration(e,t,n,s,a){return node(e,t,n,DECLARATION,substr(e,0,s),substr(e,s+1,-1),s,a)}function prefix(e,t,n){switch(hash$2(e,t)){case 5103:return WEBKIT+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return WEBKIT+e+e;case 4789:return MOZ+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return WEBKIT+e+MOZ+e+MS+e+e;case 5936:switch(charat(e,t+11)){case 114:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return WEBKIT+e+MS+replace(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return WEBKIT+e+MS+e+e;case 6165:return WEBKIT+e+MS+"flex-"+e+e;case 5187:return WEBKIT+e+replace(e,/(\w+).+(:[^]+)/,WEBKIT+"box-$1$2"+MS+"flex-$1$2")+e;case 5443:return WEBKIT+e+MS+"flex-item-"+replace(e,/flex-|-self/g,"")+(match(e,/flex-|baseline/)?"":MS+"grid-row-"+replace(e,/flex-|-self/g,""))+e;case 4675:return WEBKIT+e+MS+"flex-line-pack"+replace(e,/align-content|flex-|-self/g,"")+e;case 5548:return WEBKIT+e+MS+replace(e,"shrink","negative")+e;case 5292:return WEBKIT+e+MS+replace(e,"basis","preferred-size")+e;case 6060:return WEBKIT+"box-"+replace(e,"-grow","")+WEBKIT+e+MS+replace(e,"grow","positive")+e;case 4554:return WEBKIT+replace(e,/([^-])(transform)/g,"$1"+WEBKIT+"$2")+e;case 6187:return replace(replace(replace(e,/(zoom-|grab)/,WEBKIT+"$1"),/(image-set)/,WEBKIT+"$1"),e,"")+e;case 5495:case 3959:return replace(e,/(image-set\([^]*)/,WEBKIT+"$1$`$1");case 4968:return replace(replace(e,/(.+:)(flex-)?(.*)/,WEBKIT+"box-pack:$3"+MS+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+WEBKIT+e+e;case 4200:if(!match(e,/flex-|baseline/))return MS+"grid-column-align"+substr(e,t)+e;break;case 2592:case 3360:return MS+replace(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(s,a){return t=a,match(s.props,/grid-\w+-end/)})?~indexof(e+(n=n[t].value),"span",0)?e:MS+replace(e,"-start","")+e+MS+"grid-row-span:"+(~indexof(n,"span",0)?match(n,/\d+/):+match(n,/\d+/)-+match(e,/\d+/))+";":MS+replace(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(s){return match(s.props,/grid-\w+-start/)})?e:MS+replace(replace(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return replace(e,/(.+)-inline(.+)/,WEBKIT+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(strlen(e)-1-t>6)switch(charat(e,t+1)){case 109:if(charat(e,t+4)!==45)break;case 102:return replace(e,/(.+:)(.+)-([^]+)/,"$1"+WEBKIT+"$2-$3$1"+MOZ+(charat(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~indexof(e,"stretch",0)?prefix(replace(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return replace(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,a,l,de,pe,me,Le){return MS+a+":"+l+Le+(de?MS+a+"-span:"+(pe?me:+me-+l)+Le:"")+e});case 4949:if(charat(e,t+6)===121)return replace(e,":",":"+WEBKIT)+e;break;case 6444:switch(charat(e,charat(e,14)===45?18:11)){case 120:return replace(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+WEBKIT+(charat(e,14)===45?"inline-":"")+"box$3$1"+WEBKIT+"$2$3$1"+MS+"$2box$3")+e;case 100:return replace(e,":",":"+MS)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return replace(e,"scroll-","scroll-snap-")+e}return e}function serialize$1(e,t){for(var n="",s=0;s<e.length;s++)n+=t(e[s],s,e,t)||"";return n}function stringify(e,t,n,s){switch(e.type){case LAYER:if(e.children.length)break;case IMPORT:case DECLARATION:return e.return=e.return||e.value;case COMMENT:return"";case KEYFRAMES:return e.return=e.value+"{"+serialize$1(e.children,s)+"}";case RULESET:if(!strlen(e.value=e.props.join(",")))return""}return strlen(n=serialize$1(e.children,s))?e.return=e.value+"{"+n+"}":""}function middleware(e){var t=sizeof(e);return function(n,s,a,l){for(var de="",pe=0;pe<t;pe++)de+=e[pe](n,s,a,l)||"";return de}}function rulesheet(e){return function(t){t.root||(t=t.return)&&e(t)}}function prefixer(e,t,n,s){if(e.length>-1&&!e.return)switch(e.type){case DECLARATION:e.return=prefix(e.value,e.length,n);return;case KEYFRAMES:return serialize$1([copy(e,{value:replace(e.value,"@","@"+WEBKIT)})],s);case RULESET:if(e.length)return combine(n=e.props,function(a){switch(match(a,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":lift(copy(e,{props:[replace(a,/:(read-\w+)/,":"+MOZ+"$1")]})),lift(copy(e,{props:[a]})),assign(e,{props:filter(n,s)});break;case"::placeholder":lift(copy(e,{props:[replace(a,/:(plac\w+)/,":"+WEBKIT+"input-$1")]})),lift(copy(e,{props:[replace(a,/:(plac\w+)/,":"+MOZ+"$1")]})),lift(copy(e,{props:[replace(a,/:(plac\w+)/,MS+"input-$1")]})),lift(copy(e,{props:[a]})),assign(e,{props:filter(n,s)});break}return""})}}var unitlessKeys={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},define_process_env_default={},f=typeof process<"u"&&define_process_env_default!==void 0&&(define_process_env_default.REACT_APP_SC_ATTR||define_process_env_default.SC_ATTR)||"data-styled",m="active",y="data-styled-version",v="6.1.19",g=`/*!sc*/
`,S=typeof window<"u"&&typeof document<"u",w=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&define_process_env_default!==void 0&&define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!==""?define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&define_process_env_default.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&define_process_env_default!==void 0&&define_process_env_default.SC_DISABLE_SPEEDY!==void 0&&define_process_env_default.SC_DISABLE_SPEEDY!==""&&define_process_env_default.SC_DISABLE_SPEEDY!=="false"&&define_process_env_default.SC_DISABLE_SPEEDY),_=Object.freeze([]),C=Object.freeze({});function I(e,t,n){return n===void 0&&(n=C),e.theme!==n.theme&&e.theme||t||n.theme}var A=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),O=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,D=/(^-|-$)/g;function R(e){return e.replace(O,"-").replace(D,"")}var T=/(a)(d)/gi,k=52,j=function(e){return String.fromCharCode(e+(e>25?39:97))};function x(e){var t,n="";for(t=Math.abs(e);t>k;t=t/k|0)n=j(t%k)+n;return(j(t%k)+n).replace(T,"$1-$2")}var V,F=5381,M=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},z=function(e){return M(F,e)};function $(e){return x(z(e)>>>0)}function B(e){return e.displayName||e.name||"Component"}function L(e){return typeof e=="string"&&!0}var G=typeof Symbol=="function"&&Symbol.for,Y=G?Symbol.for("react.memo"):60115,W=G?Symbol.for("react.forward_ref"):60112,q={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},H={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},U={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},J=((V={})[W]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},V[Y]=U,V);function X(e){return("type"in(t=e)&&t.type.$$typeof)===Y?U:"$$typeof"in e?J[e.$$typeof]:q;var t}var Z=Object.defineProperty,K=Object.getOwnPropertyNames,Q=Object.getOwnPropertySymbols,ee$1=Object.getOwnPropertyDescriptor,te=Object.getPrototypeOf,ne=Object.prototype;function oe(e,t,n){if(typeof t!="string"){if(ne){var s=te(t);s&&s!==ne&&oe(e,s,n)}var a=K(t);Q&&(a=a.concat(Q(t)));for(var l=X(e),de=X(t),pe=0;pe<a.length;++pe){var me=a[pe];if(!(me in H||n&&n[me]||de&&me in de||l&&me in l)){var Le=ee$1(t,me);try{Z(e,me,Le)}catch{}}}}return e}function re(e){return typeof e=="function"}function se(e){return typeof e=="object"&&"styledComponentId"in e}function ie(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function ae(e,t){if(e.length===0)return"";for(var n=e[0],s=1;s<e.length;s++)n+=e[s];return n}function ce(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function le(e,t,n){if(n===void 0&&(n=!1),!n&&!ce(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var s=0;s<t.length;s++)e[s]=le(e[s],t[s]);else if(ce(t))for(var s in t)e[s]=le(e[s],t[s]);return e}function ue(e,t){Object.defineProperty(e,"toString",{value:t})}function he(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var fe$1=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,s=0;s<t;s++)n+=this.groupSizes[s];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var s=this.groupSizes,a=s.length,l=a;t>=l;)if((l<<=1)<0)throw he(16,"".concat(t));this.groupSizes=new Uint32Array(l),this.groupSizes.set(s),this.length=l;for(var de=a;de<l;de++)this.groupSizes[de]=0}for(var pe=this.indexOfGroup(t+1),me=(de=0,n.length);de<me;de++)this.tag.insertRule(pe,n[de])&&(this.groupSizes[t]++,pe++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],s=this.indexOfGroup(t),a=s+n;this.groupSizes[t]=0;for(var l=s;l<a;l++)this.tag.deleteRule(s)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var s=this.groupSizes[t],a=this.indexOfGroup(t),l=a+s,de=a;de<l;de++)n+="".concat(this.tag.getRule(de)).concat(g);return n},e}(),ye=new Map,ve=new Map,ge$1=1,Se=function(e){if(ye.has(e))return ye.get(e);for(;ve.has(ge$1);)ge$1++;var t=ge$1++;return ye.set(e,t),ve.set(t,e),t},we=function(e,t){ge$1=t+1,ye.set(e,t),ve.set(t,e)},be="style[".concat(f,"][").concat(y,'="').concat(v,'"]'),Ee=new RegExp("^".concat(f,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Ne=function(e,t,n){for(var s,a=n.split(","),l=0,de=a.length;l<de;l++)(s=a[l])&&e.registerName(t,s)},Pe=function(e,t){for(var n,s=((n=t.textContent)!==null&&n!==void 0?n:"").split(g),a=[],l=0,de=s.length;l<de;l++){var pe=s[l].trim();if(pe){var me=pe.match(Ee);if(me){var Le=0|parseInt(me[1],10),Be=me[2];Le!==0&&(we(Be,Le),Ne(e,Be,me[3]),e.getTag().insertRules(Le,a)),a.length=0}else a.push(pe)}}},_e=function(e){for(var t=document.querySelectorAll(be),n=0,s=t.length;n<s;n++){var a=t[n];a&&a.getAttribute(f)!==m&&(Pe(e,a),a.parentNode&&a.parentNode.removeChild(a))}};function Ce(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var Ie=function(e){var t=document.head,n=e||t,s=document.createElement("style"),a=function(pe){var me=Array.from(pe.querySelectorAll("style[".concat(f,"]")));return me[me.length-1]}(n),l=a!==void 0?a.nextSibling:null;s.setAttribute(f,m),s.setAttribute(y,v);var de=Ce();return de&&s.setAttribute("nonce",de),n.insertBefore(s,l),s},Ae=function(){function e(t){this.element=Ie(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var s=document.styleSheets,a=0,l=s.length;a<l;a++){var de=s[a];if(de.ownerNode===n)return de}throw he(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),Oe=function(){function e(t){this.element=Ie(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var s=document.createTextNode(n);return this.element.insertBefore(s,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),De=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),Re=S,Te={isServer:!S,useCSSOMInjection:!w},ke=function(){function e(t,n,s){t===void 0&&(t=C),n===void 0&&(n={});var a=this;this.options=__assign(__assign({},Te),t),this.gs=n,this.names=new Map(s),this.server=!!t.isServer,!this.server&&S&&Re&&(Re=!1,_e(this)),ue(this,function(){return function(l){for(var de=l.getTag(),pe=de.length,me="",Le=function(Ye){var tt=function(mt){return ve.get(mt)}(Ye);if(tt===void 0)return"continue";var nt=l.names.get(tt),ft=de.getGroup(Ye);if(nt===void 0||!nt.size||ft.length===0)return"continue";var st="".concat(f,".g").concat(Ye,'[id="').concat(tt,'"]'),yt="";nt!==void 0&&nt.forEach(function(mt){mt.length>0&&(yt+="".concat(mt,","))}),me+="".concat(ft).concat(st,'{content:"').concat(yt,'"}').concat(g)},Be=0;Be<pe;Be++)Le(Be);return me}(a)})}return e.registerId=function(t){return Se(t)},e.prototype.rehydrate=function(){!this.server&&S&&_e(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(__assign(__assign({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var s=n.useCSSOMInjection,a=n.target;return n.isServer?new De(a):s?new Ae(a):new Oe(a)}(this.options),new fe$1(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Se(t),this.names.has(t))this.names.get(t).add(n);else{var s=new Set;s.add(n),this.names.set(t,s)}},e.prototype.insertRules=function(t,n,s){this.registerName(t,n),this.getTag().insertRules(Se(t),s)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Se(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),je=/&/g,xe=/^\s*\/\/.*$/gm;function Ve(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(s){return"".concat(t," ").concat(s)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=Ve(n.children,t)),n})}function Fe(e){var t,n,s,a=C,l=a.options,de=l===void 0?C:l,pe=a.plugins,me=pe===void 0?_:pe,Le=function(tt,nt,ft){return ft.startsWith(n)&&ft.endsWith(n)&&ft.replaceAll(n,"").length>0?".".concat(t):tt},Be=me.slice();Be.push(function(tt){tt.type===RULESET&&tt.value.includes("&")&&(tt.props[0]=tt.props[0].replace(je,n).replace(s,Le))}),de.prefix&&Be.push(prefixer),Be.push(stringify);var Ye=function(tt,nt,ft,st){nt===void 0&&(nt=""),ft===void 0&&(ft=""),st===void 0&&(st="&"),t=st,n=nt,s=new RegExp("\\".concat(n,"\\b"),"g");var yt=tt.replace(xe,""),mt=compile(ft||nt?"".concat(ft," ").concat(nt," { ").concat(yt," }"):yt);de.namespace&&(mt=Ve(mt,de.namespace));var _t=[];return serialize$1(mt,middleware(Be.concat(rulesheet(function(Rt){return _t.push(Rt)})))),_t};return Ye.hash=me.length?me.reduce(function(tt,nt){return nt.name||he(15),M(tt,nt.name)},F).toString():"",Ye}var Me=new ke,ze=Fe(),$e=o.createContext({shouldForwardProp:void 0,styleSheet:Me,stylis:ze});$e.Consumer;o.createContext(void 0);function Ge(){return reactExports.useContext($e)}var We=function(){function e(t,n){var s=this;this.inject=function(a,l){l===void 0&&(l=ze);var de=s.name+l.hash;a.hasNameForId(s.id,de)||a.insertRules(s.id,de,l(s.rules,de,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,ue(this,function(){throw he(12,String(s.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=ze),this.name+t.hash},e}(),qe=function(e){return e>="A"&&e<="Z"};function He(e){for(var t="",n=0;n<e.length;n++){var s=e[n];if(n===1&&s==="-"&&e[0]==="-")return e;qe(s)?t+="-"+s.toLowerCase():t+=s}return t.startsWith("ms-")?"-"+t:t}var Ue=function(e){return e==null||e===!1||e===""},Je=function(e){var t,n,s=[];for(var a in e){var l=e[a];e.hasOwnProperty(a)&&!Ue(l)&&(Array.isArray(l)&&l.isCss||re(l)?s.push("".concat(He(a),":"),l,";"):ce(l)?s.push.apply(s,__spreadArray$2(__spreadArray$2(["".concat(a," {")],Je(l),!1),["}"],!1)):s.push("".concat(He(a),": ").concat((t=a,(n=l)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in unitlessKeys||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return s};function Xe(e,t,n,s){if(Ue(e))return[];if(se(e))return[".".concat(e.styledComponentId)];if(re(e)){if(!re(l=e)||l.prototype&&l.prototype.isReactComponent||!t)return[e];var a=e(t);return Xe(a,t,n,s)}var l;return e instanceof We?n?(e.inject(n,s),[e.getName(s)]):[e]:ce(e)?Je(e):Array.isArray(e)?Array.prototype.concat.apply(_,e.map(function(de){return Xe(de,t,n,s)})):[e.toString()]}function Ze(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(re(n)&&!se(n))return!1}return!0}var Ke=z(v),Qe=function(){function e(t,n,s){this.rules=t,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&Ze(t),this.componentId=n,this.baseHash=M(Ke,n),this.baseStyle=s,ke.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,s){var a=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))a=ie(a,this.staticRulesId);else{var l=ae(Xe(this.rules,t,n,s)),de=x(M(this.baseHash,l)>>>0);if(!n.hasNameForId(this.componentId,de)){var pe=s(l,".".concat(de),void 0,this.componentId);n.insertRules(this.componentId,de,pe)}a=ie(a,de),this.staticRulesId=de}else{for(var me=M(this.baseHash,s.hash),Le="",Be=0;Be<this.rules.length;Be++){var Ye=this.rules[Be];if(typeof Ye=="string")Le+=Ye;else if(Ye){var tt=ae(Xe(Ye,t,n,s));me=M(me,tt+Be),Le+=tt}}if(Le){var nt=x(me>>>0);n.hasNameForId(this.componentId,nt)||n.insertRules(this.componentId,nt,s(Le,".".concat(nt),void 0,this.componentId)),a=ie(a,nt)}}return a},e}(),et=o.createContext(void 0);et.Consumer;var rt={};function it(e,t,n){var s=se(e),a=e,l=!L(e),de=t.attrs,pe=de===void 0?_:de,me=t.componentId,Le=me===void 0?function(At,Lt){var Tt=typeof At!="string"?"sc":R(At);rt[Tt]=(rt[Tt]||0)+1;var It="".concat(Tt,"-").concat($(v+Tt+rt[Tt]));return Lt?"".concat(Lt,"-").concat(It):It}(t.displayName,t.parentComponentId):me,Be=t.displayName,Ye=Be===void 0?function(At){return L(At)?"styled.".concat(At):"Styled(".concat(B(At),")")}(e):Be,tt=t.displayName&&t.componentId?"".concat(R(t.displayName),"-").concat(t.componentId):t.componentId||Le,nt=s&&a.attrs?a.attrs.concat(pe).filter(Boolean):pe,ft=t.shouldForwardProp;if(s&&a.shouldForwardProp){var st=a.shouldForwardProp;if(t.shouldForwardProp){var yt=t.shouldForwardProp;ft=function(At,Lt){return st(At,Lt)&&yt(At,Lt)}}else ft=st}var mt=new Qe(n,tt,s?a.componentStyle:void 0);function _t(At,Lt){return function(Tt,It,Bt){var Mt=Tt.attrs,Pt=Tt.componentStyle,vt=Tt.defaultProps,kt=Tt.foldedComponentIds,wt=Tt.styledComponentId,bt=Tt.target,ot=o.useContext(et),gt=Ge(),Et=Tt.shouldForwardProp||gt.shouldForwardProp,xt=I(It,ot,vt)||C,Ct=function(Ut,Ot,Dt){for(var zt,Ht=__assign(__assign({},Ot),{className:void 0,theme:Dt}),Vt=0;Vt<Ut.length;Vt+=1){var qt=re(zt=Ut[Vt])?zt(Ht):zt;for(var Wt in qt)Ht[Wt]=Wt==="className"?ie(Ht[Wt],qt[Wt]):Wt==="style"?__assign(__assign({},Ht[Wt]),qt[Wt]):qt[Wt]}return Ot.className&&(Ht.className=ie(Ht.className,Ot.className)),Ht}(Mt,It,xt),St=Ct.as||bt,$t={};for(var Nt in Ct)Ct[Nt]===void 0||Nt[0]==="$"||Nt==="as"||Nt==="theme"&&Ct.theme===xt||(Nt==="forwardedAs"?$t.as=Ct.forwardedAs:Et&&!Et(Nt,St)||($t[Nt]=Ct[Nt]));var jt=function(Ut,Ot){var Dt=Ge(),zt=Ut.generateAndInjectStyles(Ot,Dt.styleSheet,Dt.stylis);return zt}(Pt,Ct),Ft=ie(kt,wt);return jt&&(Ft+=" "+jt),Ct.className&&(Ft+=" "+Ct.className),$t[L(St)&&!A.has(St)?"class":"className"]=Ft,Bt&&($t.ref=Bt),reactExports.createElement(St,$t)}(Rt,At,Lt)}_t.displayName=Ye;var Rt=o.forwardRef(_t);return Rt.attrs=nt,Rt.componentStyle=mt,Rt.displayName=Ye,Rt.shouldForwardProp=ft,Rt.foldedComponentIds=s?ie(a.foldedComponentIds,a.styledComponentId):"",Rt.styledComponentId=tt,Rt.target=s?a.target:e,Object.defineProperty(Rt,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(At){this._foldedDefaultProps=s?function(Lt){for(var Tt=[],It=1;It<arguments.length;It++)Tt[It-1]=arguments[It];for(var Bt=0,Mt=Tt;Bt<Mt.length;Bt++)le(Lt,Mt[Bt],!0);return Lt}({},a.defaultProps,At):At}}),ue(Rt,function(){return".".concat(Rt.styledComponentId)}),l&&oe(Rt,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),Rt}function at(e,t){for(var n=[e[0]],s=0,a=t.length;s<a;s+=1)n.push(t[s],e[s+1]);return n}var ct=function(e){return Object.assign(e,{isCss:!0})};function lt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(re(e)||ce(e))return ct(Xe(at(_,__spreadArray$2([e],t,!0))));var s=e;return t.length===0&&s.length===1&&typeof s[0]=="string"?Xe(s):ct(Xe(at(s,t)))}function ut$1(e,t,n){if(n===void 0&&(n=C),!t)throw he(1,t);var s=function(a){for(var l=[],de=1;de<arguments.length;de++)l[de-1]=arguments[de];return e(t,n,lt.apply(void 0,__spreadArray$2([a],l,!1)))};return s.attrs=function(a){return ut$1(e,t,__assign(__assign({},n),{attrs:Array.prototype.concat(n.attrs,a).filter(Boolean)}))},s.withConfig=function(a){return ut$1(e,t,__assign(__assign({},n),a))},s}var pt=function(e){return ut$1(it,e)},dt=pt;A.forEach(function(e){dt[e]=pt(e)});const size={tablet:"900px"},tablet=e=>lt`
  @media (max-width: ${size.tablet}) {
    ${e};
  }
`,Divider=dt.hr`
    display: block;
    width: 100%;
    color: #3b3b3b;
    border: 0.5px solid;
`,AbsoluteFull=lt`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
`,Pointer=dt.span`
  cursor: pointer;
`,HelperText=dt.small`
  display: inline-block;
  width: 100%;
  margin-top: 10px;
  text-align: center;
  min-height: 17px;
  color: #ffffff80;
  transform: translateX(-10%);
  -webkit-transform: translateX(-10%);
  font-weight: bold;

  ${tablet(`
    transform: unset;
    -webkit-transform: unset;
  `)}
`,ErrorText=dt(HelperText)`
  color: #f87171;
`,skeletonStyle=`
  @keyframes shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  background: linear-gradient(
    90deg,
    rgba(0, 0, 0, 0.05) 25%,
    rgba(0, 0, 0, 0.1) 37%,
    rgba(0, 0, 0, 0.05) 63%
  );

  background-size: 200% 100%;
  border-radius: 4px;
  color: transparent;
  animation: shimmer 1.8s ease-in-out infinite;
`,CanvasContainer=dt.div`
  flex: 1;
  height: 100%;

  display: flex;
  justify-content: center;
  align-items: center;
  user-select: none;
  -webkit-user-select: none;

  ${tablet(`
    transform: scale(0.5);
    -webkit-transform: scale(0.5);
  `)}
`,CardWrapper=dt.div`
  position: relative;
  // width: 800px;
  // height: 460px;
`,ResizeKnobs=dt.div`
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 10;
  top: 0;
  left: 0;
`;var ResizeKnobPosition=(e=>(e[e.left=0]="left",e[e.bottom=1]="bottom",e[e.right=2]="right",e))(ResizeKnobPosition||{});const ResizeKnobContainer=dt.div`
    touch-action: none;
    -webkit-touch-callout: none;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 2em;
    height: 2em;

    ${e=>e.$position===0?`
            top: 50%;
            left: 0;
            transform: translateX(-50%) translateY(-50%);
            -webkit-transform: translateX(-50%) translateY(-50%);
            cursor: ew-resize;
        `:""}

    ${e=>e.$position===2?`
            top: 50%;
            right: 0;
            transform: translateX(50%) translateY(-50%);
            -webkit-transform: translateX(50%) translateY(-50%);
            cursor: ew-resize;
        `:""}

    ${e=>e.$position===1?`
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) translateY(50%);
            -webkit-transform: translateX(-50%) translateY(50%);
            cursor: ns-resize;
        `:""}

    position: absolute;
    pointer-events: auto;

    &:hover div {
      transform: scale(2.5);
      -webkit-transform: scale(2.5);
    }
`,ResizeKnob=dt.div`
    transition-property: -webkit-transform, transform;
    transition-timing-function: cubic-bezier(.4,0,.2,1);
    transition-duration: .15s;
    -webkit-transition-property: -webkit-transform, transform;
    -webkit-transition-timing-function: cubic-bezier(.4,0,.2,1);
    -webkit-transition-duration: .15s;
    box-shadow: 0 0 #0000,0 0 #0000,0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);
    background-color: #FFF;
    border-radius: 50%;
    width: .375rem;
    height: .375rem;
`,CardContainer=dt.div`
  box-shadow: 0 90px 150px -80px #0e0f1180, 0 40px 120px #000000b3;
  border-radius: 0.5rem;
  overflow: hidden;
  width: 100%;
  height: 100%;
  position: relative;
  pointer-events: none;
`,CardContent=dt.div`
  padding: 50px;
  font-size: 16px;
  perspective: 1000px;
  transition: background-color 0.15s cubic-bezier(.4,0,.2,1), 
              border-color 0.15s cubic-bezier(.4,0,.2,1), 
              color 0.15s cubic-bezier(.4,0,.2,1), 
              fill 0.15s cubic-bezier(.4,0,.2,1), 
              stroke 0.15s cubic-bezier(.4,0,.2,1);
  -webkit-transition: background-color 0.15s cubic-bezier(.4,0,.2,1), 
              border-color 0.15s cubic-bezier(.4,0,.2,1), 
              color 0.15s cubic-bezier(.4,0,.2,1), 
              fill 0.15s cubic-bezier(.4,0,.2,1), 
              stroke 0.15s cubic-bezier(.4,0,.2,1);
  display: grid;
  place-items: center;
  width: 100%;
  height: 100%;
`,BackgroundGradient=dt.div`
  ${AbsoluteFull}
  background-image: ${e=>e.$gradient};
  background-repeat: no-repeat;
`,CardBlurShadow=dt.div`
  ${AbsoluteFull}
  background-image: ${e=>e.$gradient};
  background-size: ${e=>`${e.width}px ${e.height}px`};
  border-radius: 1em;
  z-index: 0;

  ${isSafari()?"":`
      &:before {
        position: absolute;
        content: "";
        left: 0;
        top: 3em;
        width: 100%;
        height: 100%;
        border-radius: 1em;
        background-color: #0000002e;
        transform: translateZ(-1px);
        -webkit-transform: translateZ(-1px);
        filter: blur(60px);
        -webkit-filter: blur(10px);
        z-index: -1;
      }

      &:after {
        position: absolute;
        content: "";
        left: 0;
        top: 3em;
        width: 100%;
        height: 100%;
        border-radius: 1em;
        background-color: #0000002e;
        transform: translateZ(-1px);
        -webkit-transform: translateZ(-1px);
        filter: blur(60px);
        -webkit-filter: blur(10px);: blur(60px);
        z-index: -1;
        filter: blur(20px);
        -webkit-filter: blur(10px);: blur(20px);
        left: 3%;
        right: 3%;
        width: initial;
        top: 1em;
      }
    `}
`,CardContentContainer=dt.div`
  position: relative;
  padding: 2em 2em 1.5em;
  width: 100%;
  height: 100%;
  border-radius: 1em;
  border: 1px solid;
  backdrop-filter: blur(18px) saturate(177%);
  -webkit-backdrop-filter: blur(18px) saturate(177%);
  transition: all 0.15s cubic-bezier(.4,0,.2,1);
  -webkit-transition: all 0.15s cubic-bezier(.4,0,.2,1);
`,InnerGradient=dt.div`
  ${AbsoluteFull}
  background-image: linear-gradient(-50deg, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.95) 80%);
  box-shadow: inset 0 0 0 2px #ffffff26;
  border-radius: 1em;
  z-index: -1;
`,CardHeader=dt.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 0.75rem;
`,AuthorInfo=dt.div`
  display: flex;
  align-items: center;
`,AuthorNameAndNip05Container=dt.div`
  display: flex;
  flex-direction: column;
  gap: 5px;
`,AuthorNameContainer=dt.div`
  display: flex;
  gap: 2px;
`,AuthorName=dt.div`
  font-weight: 600;
  font-size: 18px;
  line-height: 1.2;
  color: #111;
  white-space: nowrap;
  ${({isLoading:e})=>e&&skeletonStyle}
  min-width: ${({isLoading:e})=>e?"100px":"auto"};
  min-height: ${({isLoading:e})=>e?"18px":"auto"};
`,VerificationCheckContainer=dt.div`
  width: 20px;
  height: 20px;
`,AuthorNip05=dt.div`
  font-weight: 400;
  font-size: 14px;
  display: flex;
  color: rgba(0, 0, 0, 0.5);
  line-height: 1.2;
  white-space: nowrap;
  ${({isLoading:e})=>e&&skeletonStyle}
  min-width: ${({isLoading:e})=>e?"80px":"auto"};
  min-height: ${({isLoading:e})=>e?"14px":"auto"};
`,VerificationIconContainer=dt.div`
  width: 20px;
  height: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-inline: 4px;
`,NostrBrand=dt.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
`,NostrName=dt.span`
  font-weight: bold;
  font-size: 12px;
  color: ${e=>e.$color};
`,TweetTimestamp=dt.div`
  color: rgba(0, 0, 0, 0.5);
  padding-bottom: 0.7em;
  font-weight: 500;

  ${({isLoading:e})=>e&&skeletonStyle}
  ${({isLoading:e})=>e&&"max-width: 40%; max-height: 26px"}
`,TweetStats=dt.div`
  display: flex;
  gap: 1em;
`,StatItem=dt.div`
  color: rgba(0, 0, 0, 0.7);

  span:first-child {
    color: #111;
    font-weight: 600;
  }

  ${({isLoading:e})=>e&&`
      display: flex;
      margin-top: 12px;
      gap: 4px;
      align-items: center;

      span:first-child {
        display: none;
      }

      span {
        ${skeletonStyle}
        width: 75px;
        min-height: 14px;
      }
    `}
`,useResizable=({cardWrapperRef:e,leftResizeKnob:t,rightResizeKnob:n,bottomResizeKnob:s,initialWidth:a=300,initialHeight:l=200})=>{const[de,pe]=reactExports.useState(a),[me,Le]=reactExports.useState(l),Be=reactExports.useRef(!1),Ye=reactExports.useRef("left"),tt=reactExports.useRef(0),nt=reactExports.useRef(0),ft=reactExports.useRef(de),st=reactExports.useRef(me),yt=reactExports.useRef(de),mt=reactExports.useRef(me),_t=(Lt,Tt)=>{var Mt,Pt;Be.current=!0,Ye.current=Tt;const It="touches"in Lt?Lt.touches[0].clientX:Lt.clientX,Bt="touches"in Lt?Lt.touches[0].clientY:Lt.clientY;(Tt==="left"||Tt==="right")&&(tt.current=It,ft.current=((Mt=e.current)==null?void 0:Mt.offsetWidth)||0),Tt==="bottom"&&(nt.current=Bt,st.current=((Pt=e.current)==null?void 0:Pt.offsetHeight)||0),document.body.style.userSelect="none"},Rt=Lt=>{if(!Be.current)return;const Tt="touches"in Lt?Lt.touches[0].clientX:Lt.clientX,It="touches"in Lt?Lt.touches[0].clientY:Lt.clientY;if(Ye.current==="left"){const Bt=ft.current-(Tt-tt.current);yt.current=Math.max(Bt,400)}else if(Ye.current==="right"){const Bt=ft.current+(Tt-tt.current);yt.current=Math.max(Bt,400)}else if(Ye.current==="bottom"){const Bt=st.current+(It-nt.current);mt.current=Math.max(Bt,380)}e.current&&(Ye.current==="left"||Ye.current==="right"?e.current.style.width=Math.max(yt.current,50)+"px":Ye.current==="bottom"&&(e.current.style.height=Math.max(mt.current,50)+"px"))},At=()=>{Be.current=!1,document.body.style.userSelect="",pe(yt.current),Le(mt.current)};return reactExports.useEffect(()=>{const Lt=(Mt,Pt)=>{if(Mt&&Mt.current){const vt=kt=>_t(kt,Pt);return Mt.current.addEventListener("mousedown",vt),Mt.current.addEventListener("touchstart",vt,{passive:!1}),()=>{Mt.current&&(Mt.current.removeEventListener("mousedown",vt),Mt.current.removeEventListener("touchstart",vt))}}},Tt=Lt(t,"left"),It=Lt(n,"right"),Bt=Lt(s,"bottom");return document.addEventListener("mousemove",Rt),document.addEventListener("mouseup",At),document.addEventListener("touchmove",Rt,{passive:!1}),document.addEventListener("touchend",At),()=>{Tt&&Tt(),It&&It(),Bt&&Bt(),document.removeEventListener("mousemove",Rt),document.removeEventListener("mouseup",At),document.removeEventListener("touchmove",Rt),document.removeEventListener("touchend",At)}},[t,n,s,e]),{width:de,height:me,setWidth:pe,setHeight:Le}},AuthorImage=dt.img`
  width: 3em;
  height: 3em;
  margin-right: 0.75em;
  object-fit: cover;
  border-radius: 50%;
`,AuthorImageSkeleton=dt.div`
  width: 3em;
  height: 3em;
  margin-right: 0.75em;
  border-radius: 50%;
  background: linear-gradient(
    90deg,
    #e9eef3 25%,
    #f6f8fa 37%,
    #e9eef3 63%
  );
  background-size: 400% 100%;
  animation: shimmer 1.8s ease-in-out infinite;

  @keyframes shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
`,NostrichContainer=dt.div`
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 1px solid #DFDFDF;
  background-color: #000;
  margin-right: 6px;
`,AuthorAvatar=({isLoading:e,...t})=>e?jsxRuntimeExports.jsx(AuthorImageSkeleton,{}):t.src?jsxRuntimeExports.jsx(AuthorImage,{...t}):jsxRuntimeExports.jsx(NostrichContainer,{children:jsxRuntimeExports.jsx(Nostrich,{})}),Content=dt.div`
  font-size: 1.4em;
  line-height: 1.5;
  margin-bottom: 1em;
  font-weight: 500;
  word-break: break-word;
  pointer-events: none;
  color: #111;
  min-width: auto;
  min-height: auto;
`,LoadingContent=dt.div`
  font-size: 1.4em;
  line-height: 1.5;
  margin-bottom: 1em;
  font-weight: 500;
  word-break: break-word;
  pointer-events: none;
  color: #111;

  ${({isLoading:e})=>e&&skeletonStyle}
  min-width: ${({isLoading:e})=>e?"200px":"auto"};
  min-height: ${({isLoading:e})=>e?"8em":"auto"};
`;function TweetContent({isLoading:e=!0,noteHTML:t=""}){return e?jsxRuntimeExports.jsx(LoadingContent,{isLoading:e}):jsxRuntimeExports.jsx(Content,{dangerouslySetInnerHTML:{__html:t}})}const Canvas=reactExports.forwardRef(({noteHTML:e,note:t,showResponse:n,gradient:s,nostrBrandingColor:a,isLoading:l},de)=>{var nt,ft,st;const pe=reactExports.useRef(null),me=reactExports.useRef(null),Le=reactExports.useRef(null),Be=reactExports.useRef(null),{width:Ye,height:tt}=useResizable({cardWrapperRef:pe,leftResizeKnob:me,rightResizeKnob:Le,bottomResizeKnob:Be,initialWidth:650,initialHeight:325});return jsxRuntimeExports.jsx(CanvasContainer,{children:jsxRuntimeExports.jsxs(CardWrapper,{ref:pe,style:{width:Ye},children:[jsxRuntimeExports.jsxs(ResizeKnobs,{children:[jsxRuntimeExports.jsx(ResizeKnobContainer,{ref:me,$position:ResizeKnobPosition.left,children:jsxRuntimeExports.jsx(ResizeKnob,{})}),jsxRuntimeExports.jsx(ResizeKnobContainer,{ref:Le,$position:ResizeKnobPosition.right,children:jsxRuntimeExports.jsx(ResizeKnob,{})}),jsxRuntimeExports.jsx(ResizeKnobContainer,{ref:Be,$position:ResizeKnobPosition.bottom,children:jsxRuntimeExports.jsx(ResizeKnob,{})})]}),jsxRuntimeExports.jsx(CardContainer,{ref:de,children:jsxRuntimeExports.jsxs(CardContent,{children:[jsxRuntimeExports.jsx(BackgroundGradient,{$gradient:s}),jsxRuntimeExports.jsxs("div",{style:{width:"100%",position:"relative"},children:[jsxRuntimeExports.jsx(CardBlurShadow,{width:Ye,height:tt,$gradient:s}),jsxRuntimeExports.jsxs(CardContentContainer,{children:[jsxRuntimeExports.jsx(InnerGradient,{}),jsxRuntimeExports.jsxs(CardHeader,{children:[jsxRuntimeExports.jsxs(AuthorInfo,{children:[jsxRuntimeExports.jsx(AuthorAvatar,{isLoading:l,src:proxyImg(((nt=t.author)==null?void 0:nt.image)||"",defaultImgProxy),alt:"Image of the Nostr note author"}),jsxRuntimeExports.jsxs(AuthorNameAndNip05Container,{children:[jsxRuntimeExports.jsxs(AuthorNameContainer,{children:[jsxRuntimeExports.jsx(AuthorName,{isLoading:l,children:(ft=t.author)==null?void 0:ft.name}),jsxRuntimeExports.jsx(VerificationCheckContainer,{children:jsxRuntimeExports.jsx(VerificationIconContainer,{children:jsxRuntimeExports.jsx(VerificationCheck,{})})})]}),jsxRuntimeExports.jsx(AuthorNip05,{isLoading:l,children:(st=t.author)==null?void 0:st.nip05})]})]}),jsxRuntimeExports.jsxs(NostrBrand,{children:[jsxRuntimeExports.jsx(NostrichHead,{fill:a}),jsxRuntimeExports.jsx(NostrName,{$color:a,children:"Nostr"})]})]}),jsxRuntimeExports.jsx(TweetContent,{isLoading:l,noteHTML:e}),jsxRuntimeExports.jsxs(TweetTimestamp,{isLoading:l,children:[dayjs(t.createdAt*1e3).format("hh:mm A"),"  ",dayjs(t.createdAt*1e3).format("DD MMM, YYYY")]}),n?jsxRuntimeExports.jsxs(TweetStats,{children:[jsxRuntimeExports.jsxs(StatItem,{isLoading:l,children:[jsxRuntimeExports.jsx("span",{children:toReadableStatsFormat(t.replies)})," ",jsxRuntimeExports.jsx("span",{children:"replies"})]}),jsxRuntimeExports.jsxs(StatItem,{isLoading:l,children:[jsxRuntimeExports.jsx("span",{children:toReadableStatsFormat(t.zaps)})," ",jsxRuntimeExports.jsx("span",{children:"zaps"})]}),jsxRuntimeExports.jsxs(StatItem,{isLoading:l,children:[jsxRuntimeExports.jsx("span",{children:toReadableStatsFormat(t.likes)})," ",jsxRuntimeExports.jsx("span",{children:"likes"})]}),jsxRuntimeExports.jsxs(StatItem,{isLoading:l,children:[jsxRuntimeExports.jsx("span",{children:toReadableStatsFormat(t.reposts)})," ",jsxRuntimeExports.jsx("span",{children:"reposts"})]})]}):null]})]})]})})]})})}),HelpButtonContainer=dt.div`
    position: relative;
`,StyledHelpButton=dt.button`
    border: none;
    background-color: transparent;
    cursor: pointer;
    font-size: 36px;
    color: #FFF;
    width: 65px;
    height: 65px;
    border-radius: 5px;

    display: flex;
    justify-content: center;
    align-items: center;

    &:hover {
        background-color: rgba(39,39,40,1);
    }

    &:focus {
        outline: #CE66FF solid 2px;
    }

    ${tablet(`
        width: 36px;
        height: 36px;
        font-size: 24px;
    `)}
`,HelpContainer=dt.ul`
    list-style-type: none;
    background-color: #272727;
    border: 1px solid #71717187;
    border-radius: 8px;
    box-shadow: 0 25px 40px 11px #00000040;
    padding: 10px;

    width: max-content;
    display: flex;
    flex-direction: column;
    gap: 8px;

    position: absolute;
    right: 0px;
    top: 60px;

    transform: translateY(-5%);
    opacity: 0;
    z-index: -1;

    transition: transform 0.2s, opacity 0.4s, z-index 0.2s;
`,HelpItem=dt.li`
    color: #FFF;
    transition: background-color 0.2s;
    border-radius: 8px;
    cursor: pointer;

    font-size: 14px;

    min-height: 45px;
    min-width: 200px;

    svg {
        width: 20px;
        height: 20px;
    }

    &:hover {
        background-color: #222222;
    }

    &:hover svg {
        width: 25px;
        height: 25px;
    }
`,HelpAnchor=dt.a`
    padding: 10px;
    display: flex;
    gap: 12px;
    align-items: center;
    text-decoration: none;
    color: inherit;
`,HELP_ITEMS=[{text:"What's this?",icon:jsxRuntimeExports.jsx(QuestionMark,{}),link:"/about"},{text:"What's Nostr?",icon:jsxRuntimeExports.jsx(QuestionMark,{}),link:"https://nostr.com"},{text:"Not working?",icon:jsxRuntimeExports.jsx(QuestionMark,{}),link:"/not-working"},{text:"Credits",icon:jsxRuntimeExports.jsx(HeartIcon2,{}),link:"/credits"},{text:"Feedback",icon:jsxRuntimeExports.jsx(Mail,{}),link:"/feedback"},{text:"Donate",icon:jsxRuntimeExports.jsx(Bitcoin,{}),link:"/donate"},{text:"Github",icon:jsxRuntimeExports.jsx(Github,{}),link:"https://github.com/djhemath/snap-nostr"}];function HelpButton(){const[e,t]=reactExports.useState(!1),n=reactExports.useRef(null),s=reactExports.useRef(null);reactExports.useEffect(()=>{function l(de){n.current&&!n.current.contains(de.target)&&s.current&&!s.current.contains(de.target)&&t(!1)}return document.addEventListener("click",de=>l(de)),()=>{document.removeEventListener("click",l)}},[]);const a=()=>{t(!1)};return jsxRuntimeExports.jsxs(HelpButtonContainer,{children:[jsxRuntimeExports.jsx(StyledHelpButton,{"aria-label":"Help button",ref:s,onClick:()=>t(l=>!l),className:"rammetto-one-regular",children:"?"}),jsxRuntimeExports.jsx(HelpContainer,{ref:n,style:{transform:e?"translateY(0)":"",opacity:e?1:0,zIndex:e?1:-1},children:HELP_ITEMS.map(l=>jsxRuntimeExports.jsx(HelpItem,{onClick:()=>a(),children:jsxRuntimeExports.jsxs(HelpAnchor,{href:l.link,target:"_blank",children:[l.icon,jsxRuntimeExports.jsx("span",{children:l.text})]})},l.text))})]})}const LogoContainer=dt.div`
    position: relative;
`,StyledLogo=dt.h1`
    color: #FFF;
    font-size: 40px;
    margin: 0px;
    background: linear-gradient(90deg, #CE66FF, #FE983B);
    background-clip: text;
    -webkit-text-fill-color: transparent;
    user-select: none;
    -webkit-user-select: none;
`;dt.small`
    color: #FFF;
    font-size: 12px;
    font-weight: bold;
    background: linear-gradient(90deg, #CE66FF, #FE983B);
    background-clip: text;
    -webkit-text-fill-color: transparent;
    user-select: none;
    -webkit-user-select: none;

    position: absolute;
    right: 0;
    bottom: 0;
`;function Logo(){return jsxRuntimeExports.jsx(LogoContainer,{children:jsxRuntimeExports.jsx(StyledLogo,{className:"rammetto-one-regular",children:"SnapNostr"})})}const SearchBarWrapper=dt.div`
    display: flex;
    flex-direction: column;
    position: relative;
    top: 17px;

    ${tablet(`
        width: 100%;
    `)}
`,SearchBarContainer=dt.label`
    background-color: #272727;
    border: 1px solid #71717187;
    border-radius: 8px;
    padding: 10px 40px;
    width: 550px;
    height: 50px;
    box-shadow: 0 25px 40px 11px #00000040;
    transform: translateX(-10%);
    -webkit-transform: translateX(-10%);

    display: flex;
    align-items: center;
    gap: 10px;

    transition: all 0.2s;
    -webkit-transition: all 0.2s;

    cursor: text;

    &:hover {
        border: 1px solid #717171;
    }

    &:has(input:focus) {
        outline: #CE66FF solid 2px;
    }

    &:focus-within, &:has(input:not(:placeholder-shown)) {
        padding-left: 10px;
    }

    position: relative;

    ${tablet(`
        width: 100%;
        transform: unset;
        -webkit-transform: unset;
        padding: 10px 10px;
    `)}
`,SearchBarForm=dt.form`
    height: 100%;
    width: 100%;
`,SearchInput=dt.input`
    border: none;
    background-color: transparent !important;
    height: 100%;
    width: 100%;
    font-size: 16px;
    outline: none;
    color: #FFF;
`,SearchBarProgressContainer=dt.div`
    position: absolute;
    inset: 3px 3px 1px;
    border-radius: .5rem;
    overflow: hidden;
    pointer-events: none;
    width: 100.5%;
    left: -2px;
    bottom: 0px;
`,SearchBarProgress=dt.div`
    background: #27c4f5 linear-gradient(to right,#CE66FF,#FE983B);
    -webkit-animation: 3s linear infinite rainbow,.5s ease-out enter;
    animation: 3s linear infinite rainbow,.5s ease-out enter;
    transition: opacity .3s ease-in-out;
    -webkit-transition: opacity .3s ease-in-out;
    transform-origin: left;
    -webkit-transform-origin: left;
    background-size: 500%;
    z-index: 999999;
    position: absolute;
    display: block;
    width: 100%;
    opacity: 1;
    left: 0;
    bottom: 0;
    height: 2px;
`;var lib$1={},types={};Object.defineProperty(types,"__esModule",{value:!0});var ee={},taskCollection$1={},taskCollection={},utils$1={};Object.defineProperty(utils$1,"__esModule",{value:!0});utils$1._fast_remove_single=void 0;function _fast_remove_single(e,t){t!==-1&&(t===0?e.shift():t===e.length-1?e.length=e.length-1:e.splice(t,1))}utils$1._fast_remove_single=_fast_remove_single;var bakeCollection={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(e){var t="";if(e===0)return t;for(var n=0;n<e-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(e-1),t}function generateBodyPartsCode(e,t){for(var n="",s="",a=0;a<t;++a)n+="var f".concat(a," = collection[").concat(a,`];
`),s+="f".concat(a,"(").concat(e,`)
`);return{funcDefCode:n,funcCallCode:s}}function generateBodyPartsVariadicCode(e){for(var t="",n="",s=0;s<e;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),n+="f".concat(s,`.apply(undefined, arguments)
`);return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection);var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var s=0,a=t.length,l;s<a;s++)(l||!(s in t))&&(l||(l=Array.prototype.slice.call(t,0,s)),l[s]=t[s]);return e.concat(l||Array.prototype.slice.call(t))};Object.defineProperty(taskCollection,"__esModule",{value:!0});taskCollection.TaskCollection=void 0;var utils_1$1=utils$1,bake_collection_1=bakeCollection;function push_norebuild(e,t){var n=this.length;if(n>1)if(t){var s;(s=this._tasks).push.apply(s,arguments),this.length+=arguments.length}else this._tasks.push(e),this.length++;else if(t){if(n===1){var a=Array(1+arguments.length);a.push(a),a.push.apply(a,arguments),this._tasks=a}else{var a=Array(arguments.length);a.push.apply(a,arguments),this._tasks=a}this.length+=arguments.length}else n===1?this._tasks=[this._tasks,e]:this._tasks=e,this.length++}function push_rebuild(e,t){var n=this.length;if(n>1)if(t){var s;(s=this._tasks).push.apply(s,arguments),this.length+=arguments.length}else this._tasks.push(e),this.length++;else if(t){if(n===1){var a=Array(1+arguments.length);a.push(a),a.push.apply(a,arguments),this._tasks=a}else{var a=Array(arguments.length);a.push.apply(a,arguments),this._tasks=a}this.length+=arguments.length}else n===1?this._tasks=[this._tasks,e]:this._tasks=e,this.length++;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function removeLast_norebuild(e){this.length!==0&&(this.length===1?this._tasks===e&&(this.length=0):((0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(e)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function removeLast_rebuild(e){if(this.length!==0){if(this.length===1)if(this._tasks===e&&(this.length=0),this.firstEmitBuildStrategy){this.call=bake_collection_1.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(e)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}}function insert_norebuild(e){for(var t,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];this.length===0?(this._tasks=n,this.length=1):this.length===1?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,__spreadArray$1([e,0],n,!1)),this.length=this._tasks.length)}function insert_rebuild(e){for(var t,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];this.length===0?(this._tasks=n,this.length=1):this.length===1?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,__spreadArray$1([e,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function rebuild_noawait(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollection)(this._tasks,this.argsNum)}function rebuild_await(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollectionAwait)(this._tasks,this.argsNum)}function rebuild_on_first_call(){this.rebuild(),this.call.apply(void 0,arguments)}var TaskCollection=function(){function e(t,n,s,a){n===void 0&&(n=!0),s===void 0&&(s=null),a===void 0&&(a=!1),this.awaitTasks=a,this.call=bake_collection_1.BAKED_EMPTY_FUNC,this.argsNum=t,this.firstEmitBuildStrategy=!0,a?this.rebuild=rebuild_await.bind(this):this.rebuild=rebuild_noawait.bind(this),this.setAutoRebuild(n),s?typeof s=="function"?(this._tasks=s,this.length=1):(this._tasks=s,this.length=s.length):(this._tasks=null,this.length=0),n&&this.rebuild()}return e}();taskCollection.TaskCollection=TaskCollection;function fastClear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function clear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function growArgsNum(e){this.argsNum<e&&(this.argsNum=e,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}function setAutoRebuild(e){e?(this.push=push_rebuild.bind(this),this.insert=insert_rebuild.bind(this),this.removeLast=removeLast_rebuild.bind(this)):(this.push=push_norebuild.bind(this),this.insert=insert_norebuild.bind(this),this.removeLast=removeLast_norebuild.bind(this))}function tasksAsArray(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function setTasks(e){e.length===0?(this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC):e.length===1?(this.length=1,this.call=e[0],this._tasks=e[0]):(this.length=e.length,this._tasks=e,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}TaskCollection.prototype.fastClear=fastClear;TaskCollection.prototype.clear=clear;TaskCollection.prototype.growArgsNum=growArgsNum;TaskCollection.prototype.setAutoRebuild=setAutoRebuild;TaskCollection.prototype.tasksAsArray=tasksAsArray;TaskCollection.prototype.setTasks=setTasks;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(s,a,l,de){de===void 0&&(de=l);var pe=Object.getOwnPropertyDescriptor(a,l);(!pe||("get"in pe?!a.__esModule:pe.writable||pe.configurable))&&(pe={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(s,de,pe)}:function(s,a,l,de){de===void 0&&(de=l),s[de]=a[l]}),n=commonjsGlobal&&commonjsGlobal.__exportStar||function(s,a){for(var l in s)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&t(a,s,l)};Object.defineProperty(e,"__esModule",{value:!0}),n(taskCollection,e)})(taskCollection$1);var utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.nullObj=void 0;function nullObj(){var e={};return e.__proto__=null,e}utils.nullObj=nullObj;var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,n){if(n||arguments.length===2)for(var s=0,a=t.length,l;s<a;s++)(l||!(s in t))&&(l||(l=Array.prototype.slice.call(t,0,s)),l[s]=t[s]);return e.concat(l||Array.prototype.slice.call(t))};Object.defineProperty(ee,"__esModule",{value:!0});ee.EventEmitter=void 0;var task_collection_1=taskCollection$1,utils_1=utils$1,utils_2=utils;function emit(e,t,n,s,a,l){var de=this.events[e];if(de){if(de.length===0)return!1;if(de.argsNum<6)de.call(t,n,s,a,l);else{for(var pe=new Array(de.argsNum),me=0,Le=pe.length;me<Le;++me)pe[me]=arguments[me+1];de.call.apply(void 0,pe)}return!0}return!1}function emitHasOnce(e,t,n,s,a,l){var de=this.events[e],pe;if(de!==void 0){if(de.length===0)return!1;if(de.argsNum<6)de.call(t,n,s,a,l);else{pe=new Array(de.argsNum);for(var me=0,Le=pe.length;me<Le;++me)pe[me]=arguments[me+1];de.call.apply(void 0,pe)}}var Be=this.onceEvents[e];if(Be){if(typeof Be=="function")if(this.onceEvents[e]=void 0,arguments.length<6)Be(t,n,s,a,l);else{if(pe===void 0){pe=new Array(arguments.length-1);for(var me=0,Le=pe.length;me<Le;++me)pe[me]=arguments[me+1]}Be.apply(void 0,pe)}else{var Ye=Be;if(this.onceEvents[e]=void 0,arguments.length<6)for(var me=0;me<Ye.length;++me)Ye[me](t,n,s,a,l);else{if(pe===void 0){pe=new Array(arguments.length-1);for(var me=0,Le=pe.length;me<Le;++me)pe[me]=arguments[me+1]}for(var me=0;me<Ye.length;++me)Ye[me].apply(void 0,pe)}}return!0}return de!==void 0}var EventEmitter=function(){function e(){this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(e.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),e}();ee.EventEmitter=EventEmitter;function once(e,t){switch(this.emit===emit&&(this.emit=emitHasOnce),typeof this.onceEvents[e]){case"undefined":this.onceEvents[e]=t,typeof e=="symbol"&&this._symbolKeys.add(e);break;case"function":this.onceEvents[e]=[this.onceEvents[e],t];break;case"object":this.onceEvents[e].push(t)}return this}function addListener(e,t,n){if(n===void 0&&(n=t.length),typeof t!="function")throw new TypeError("The listener must be a function");var s=this.events[e];return s?(s.push(t),s.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=s.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))):(this.events[e]=new task_collection_1.TaskCollection(n,!0,t,!1),typeof e=="symbol"&&this._symbolKeys.add(e)),this}function removeListener(e,t){var n=this.events[e];n&&n.removeLast(t);var s=this.onceEvents[e];return s&&(typeof s=="function"?this.onceEvents[e]=void 0:typeof s=="object"&&(s.length===1&&s[0]===t?this.onceEvents[e]=void 0:(0,utils_1._fast_remove_single)(s,s.lastIndexOf(t)))),this}function addListenerBound(e,t,n,s){n===void 0&&(n=this),s===void 0&&(s=t.length),this.boundFuncs||(this.boundFuncs=new Map);var a=t.bind(n);return this.boundFuncs.set(t,a),this.addListener(e,a,s)}function removeListenerBound(e,t){var n,s,a=(n=this.boundFuncs)===null||n===void 0?void 0:n.get(t);return(s=this.boundFuncs)===null||s===void 0||s.delete(t),this.removeListener(e,a)}function hasListeners(e){return this.events[e]&&!!this.events[e].length}function prependListener(e,t,n){if(n===void 0&&(n=t.length),typeof t!="function")throw new TypeError("The listener must be a function");var s=this.events[e];return!s||!(s instanceof task_collection_1.TaskCollection)?(s=this.events[e]=new task_collection_1.TaskCollection(n,!0,t,!1),typeof e=="symbol"&&this._symbolKeys.add(e)):(s.insert(0,t),s.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=s.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))),this}function prependOnceListener(e,t){this.emit===emit&&(this.emit=emitHasOnce);var n=this.onceEvents[e];return n?typeof n!="object"?(this.onceEvents[e]=[t,n],typeof e=="symbol"&&this._symbolKeys.add(e)):(n.unshift(t),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" once event!'))):(this.onceEvents[e]=[t],typeof e=="symbol"&&this._symbolKeys.add(e)),this}function removeAllListeners(e){return e===void 0?(this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set):(this.events[e]=void 0,this.onceEvents[e]=void 0,typeof e=="symbol"&&this._symbolKeys.delete(e)),this}function setMaxListeners(e){return this.maxListeners=e,this}function getMaxListeners(){return this.maxListeners}function listeners(e){return this.emit===emit?this.events[e]?this.events[e].tasksAsArray().slice():[]:this.events[e]&&this.onceEvents[e]?__spreadArray(__spreadArray([],this.events[e].tasksAsArray(),!0),typeof this.onceEvents[e]=="function"?[this.onceEvents[e]]:this.onceEvents[e],!0):this.events[e]?this.events[e].tasksAsArray():this.onceEvents[e]?typeof this.onceEvents[e]=="function"?[this.onceEvents[e]]:this.onceEvents[e]:[]}function eventNames(){var e=this;if(this.emit===emit){var t=Object.keys(this.events);return __spreadArray(__spreadArray([],t,!0),Array.from(this._symbolKeys),!0).filter(function(s){return s in e.events&&e.events[s]&&e.events[s].length})}else{var t=Object.keys(this.events).filter(function(a){return e.events[a]&&e.events[a].length}),n=Object.keys(this.onceEvents).filter(function(a){return e.onceEvents[a]&&e.onceEvents[a].length});return __spreadArray(__spreadArray(__spreadArray([],t,!0),n,!0),Array.from(this._symbolKeys).filter(function(a){return a in e.events&&e.events[a]&&e.events[a].length||a in e.onceEvents&&e.onceEvents[a]&&e.onceEvents[a].length}),!0)}}function listenerCount(e){return this.emit===emit?this.events[e]&&this.events[e].length||0:(this.events[e]&&this.events[e].length||0)+(this.onceEvents[e]&&this.onceEvents[e].length||0)}EventEmitter.prototype.emit=emit;EventEmitter.prototype.on=addListener;EventEmitter.prototype.once=once;EventEmitter.prototype.addListener=addListener;EventEmitter.prototype.removeListener=removeListener;EventEmitter.prototype.addListenerBound=addListenerBound;EventEmitter.prototype.removeListenerBound=removeListenerBound;EventEmitter.prototype.hasListeners=hasListeners;EventEmitter.prototype.prependListener=prependListener;EventEmitter.prototype.prependOnceListener=prependOnceListener;EventEmitter.prototype.off=removeListener;EventEmitter.prototype.removeAllListeners=removeAllListeners;EventEmitter.prototype.setMaxListeners=setMaxListeners;EventEmitter.prototype.getMaxListeners=getMaxListeners;EventEmitter.prototype.listeners=listeners;EventEmitter.prototype.eventNames=eventNames;EventEmitter.prototype.listenerCount=listenerCount;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(s,a,l,de){de===void 0&&(de=l);var pe=Object.getOwnPropertyDescriptor(a,l);(!pe||("get"in pe?!a.__esModule:pe.writable||pe.configurable))&&(pe={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(s,de,pe)}:function(s,a,l,de){de===void 0&&(de=l),s[de]=a[l]}),n=commonjsGlobal&&commonjsGlobal.__exportStar||function(s,a){for(var l in s)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&t(a,s,l)};Object.defineProperty(e,"__esModule",{value:!0}),n(types,e),n(ee,e)})(lib$1);var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var e=1e3,t=e*60,n=t*60,s=n*24,a=s*7,l=s*365.25;ms=function(Be,Ye){Ye=Ye||{};var tt=typeof Be;if(tt==="string"&&Be.length>0)return de(Be);if(tt==="number"&&isFinite(Be))return Ye.long?me(Be):pe(Be);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(Be))};function de(Be){if(Be=String(Be),!(Be.length>100)){var Ye=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(Be);if(Ye){var tt=parseFloat(Ye[1]),nt=(Ye[2]||"ms").toLowerCase();switch(nt){case"years":case"year":case"yrs":case"yr":case"y":return tt*l;case"weeks":case"week":case"w":return tt*a;case"days":case"day":case"d":return tt*s;case"hours":case"hour":case"hrs":case"hr":case"h":return tt*n;case"minutes":case"minute":case"mins":case"min":case"m":return tt*t;case"seconds":case"second":case"secs":case"sec":case"s":return tt*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return tt;default:return}}}}function pe(Be){var Ye=Math.abs(Be);return Ye>=s?Math.round(Be/s)+"d":Ye>=n?Math.round(Be/n)+"h":Ye>=t?Math.round(Be/t)+"m":Ye>=e?Math.round(Be/e)+"s":Be+"ms"}function me(Be){var Ye=Math.abs(Be);return Ye>=s?Le(Be,Ye,s,"day"):Ye>=n?Le(Be,Ye,n,"hour"):Ye>=t?Le(Be,Ye,t,"minute"):Ye>=e?Le(Be,Ye,e,"second"):Be+" ms"}function Le(Be,Ye,tt,nt){var ft=Ye>=tt*1.5;return Math.round(Be/tt)+" "+nt+(ft?"s":"")}return ms}function setup(e){n.debug=n,n.default=n,n.coerce=me,n.disable=de,n.enable=a,n.enabled=pe,n.humanize=requireMs(),n.destroy=Le,Object.keys(e).forEach(Be=>{n[Be]=e[Be]}),n.names=[],n.skips=[],n.formatters={};function t(Be){let Ye=0;for(let tt=0;tt<Be.length;tt++)Ye=(Ye<<5)-Ye+Be.charCodeAt(tt),Ye|=0;return n.colors[Math.abs(Ye)%n.colors.length]}n.selectColor=t;function n(Be){let Ye,tt=null,nt,ft;function st(...yt){if(!st.enabled)return;const mt=st,_t=Number(new Date),Rt=_t-(Ye||_t);mt.diff=Rt,mt.prev=Ye,mt.curr=_t,Ye=_t,yt[0]=n.coerce(yt[0]),typeof yt[0]!="string"&&yt.unshift("%O");let At=0;yt[0]=yt[0].replace(/%([a-zA-Z%])/g,(Tt,It)=>{if(Tt==="%%")return"%";At++;const Bt=n.formatters[It];if(typeof Bt=="function"){const Mt=yt[At];Tt=Bt.call(mt,Mt),yt.splice(At,1),At--}return Tt}),n.formatArgs.call(mt,yt),(mt.log||n.log).apply(mt,yt)}return st.namespace=Be,st.useColors=n.useColors(),st.color=n.selectColor(Be),st.extend=s,st.destroy=n.destroy,Object.defineProperty(st,"enabled",{enumerable:!0,configurable:!1,get:()=>tt!==null?tt:(nt!==n.namespaces&&(nt=n.namespaces,ft=n.enabled(Be)),ft),set:yt=>{tt=yt}}),typeof n.init=="function"&&n.init(st),st}function s(Be,Ye){const tt=n(this.namespace+(typeof Ye>"u"?":":Ye)+Be);return tt.log=this.log,tt}function a(Be){n.save(Be),n.namespaces=Be,n.names=[],n.skips=[];const Ye=(typeof Be=="string"?Be:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const tt of Ye)tt[0]==="-"?n.skips.push(tt.slice(1)):n.names.push(tt)}function l(Be,Ye){let tt=0,nt=0,ft=-1,st=0;for(;tt<Be.length;)if(nt<Ye.length&&(Ye[nt]===Be[tt]||Ye[nt]==="*"))Ye[nt]==="*"?(ft=nt,st=tt,nt++):(tt++,nt++);else if(ft!==-1)nt=ft+1,st++,tt=st;else return!1;for(;nt<Ye.length&&Ye[nt]==="*";)nt++;return nt===Ye.length}function de(){const Be=[...n.names,...n.skips.map(Ye=>"-"+Ye)].join(",");return n.enable(""),Be}function pe(Be){for(const Ye of n.skips)if(l(Be,Ye))return!1;for(const Ye of n.names)if(l(Be,Ye))return!0;return!1}function me(Be){return Be instanceof Error?Be.stack||Be.message:Be}function Le(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var common=setup;(function(e,t){var n={};t.formatArgs=a,t.save=l,t.load=de,t.useColors=s,t.storage=pe(),t.destroy=(()=>{let Le=!1;return()=>{Le||(Le=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function s(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let Le;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(Le=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(Le[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(Le){if(Le[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+Le[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const Be="color: "+this.color;Le.splice(1,0,Be,"color: inherit");let Ye=0,tt=0;Le[0].replace(/%[a-zA-Z%]/g,nt=>{nt!=="%%"&&(Ye++,nt==="%c"&&(tt=Ye))}),Le.splice(tt,0,Be)}t.log=console.debug||console.log||(()=>{});function l(Le){try{Le?t.storage.setItem("debug",Le):t.storage.removeItem("debug")}catch{}}function de(){let Le;try{Le=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!Le&&typeof process<"u"&&"env"in process&&(Le=n.DEBUG),Le}function pe(){try{return localStorage}catch{}}e.exports=common(t);const{formatters:me}=e.exports;me.j=function(Le){try{return JSON.stringify(Le)}catch(Be){return"[UnexpectedJSONParseError]: "+Be.message}}})(browser,browser.exports);var browserExports=browser.exports;const createDebug5=getDefaultExportFromCjs(browserExports);function number$2(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function bytes$2(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function hash$1(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(e.outputLen),number$2(e.blockLen)}function exists$1(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function output$1(e,t){bytes$2(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=e=>e instanceof Uint8Array,createView$1=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),rotr$1=(e,t)=>e<<32-t|e>>>t,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$2(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function toBytes$1(e){if(typeof e=="string"&&(e=utf8ToBytes$2(e)),!u8a$2(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function concatBytes$2(...e){const t=new Uint8Array(e.reduce((s,a)=>s+a.length,0));let n=0;return e.forEach(s=>{if(!u8a$2(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor$1(e){const t=s=>e().update(toBytes$1(s)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function randomBytes$1(e=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$1(e,t,n,s){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,s);const a=BigInt(32),l=BigInt(4294967295),de=Number(n>>a&l),pe=Number(n&l),me=s?4:0,Le=s?0:4;e.setUint32(t+me,de,s),e.setUint32(t+Le,pe,s)}let SHA2$1=class extends Hash$1{constructor(t,n,s,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView$1(this.buffer)}update(t){exists$1(this);const{view:n,buffer:s,blockLen:a}=this;t=toBytes$1(t);const l=t.length;for(let de=0;de<l;){const pe=Math.min(a-this.pos,l-de);if(pe===a){const me=createView$1(t);for(;a<=l-de;de+=a)this.process(me,de);continue}s.set(t.subarray(de,de+pe),this.pos),this.pos+=pe,de+=pe,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){exists$1(this),output$1(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:a,isLE:l}=this;let{pos:de}=this;n[de++]=128,this.buffer.subarray(de).fill(0),this.padOffset>a-de&&(this.process(s,0),de=0);for(let Ye=de;Ye<a;Ye++)n[Ye]=0;setBigUint64$1(s,a-8,BigInt(this.length*8),l),this.process(s,0);const pe=createView$1(t),me=this.outputLen;if(me%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Le=me/4,Be=this.get();if(Le>Be.length)throw new Error("_sha2: outputLen bigger than state");for(let Ye=0;Ye<Le;Ye++)pe.setUint32(4*Ye,Be[Ye],l)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:a,finished:l,destroyed:de,pos:pe}=this;return t.length=a,t.pos=pe,t.finished=l,t.destroyed=de,a%n&&t.buffer.set(s),t}};const Chi$1=(e,t,n)=>e&t^~e&n,Maj$1=(e,t,n)=>e&t^e&n^t&n,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:t,B:n,C:s,D:a,E:l,F:de,G:pe,H:me}=this;return[t,n,s,a,l,de,pe,me]}set(t,n,s,a,l,de,pe,me){this.A=t|0,this.B=n|0,this.C=s|0,this.D=a|0,this.E=l|0,this.F=de|0,this.G=pe|0,this.H=me|0}process(t,n){for(let Ye=0;Ye<16;Ye++,n+=4)SHA256_W$1[Ye]=t.getUint32(n,!1);for(let Ye=16;Ye<64;Ye++){const tt=SHA256_W$1[Ye-15],nt=SHA256_W$1[Ye-2],ft=rotr$1(tt,7)^rotr$1(tt,18)^tt>>>3,st=rotr$1(nt,17)^rotr$1(nt,19)^nt>>>10;SHA256_W$1[Ye]=st+SHA256_W$1[Ye-7]+ft+SHA256_W$1[Ye-16]|0}let{A:s,B:a,C:l,D:de,E:pe,F:me,G:Le,H:Be}=this;for(let Ye=0;Ye<64;Ye++){const tt=rotr$1(pe,6)^rotr$1(pe,11)^rotr$1(pe,25),nt=Be+tt+Chi$1(pe,me,Le)+SHA256_K$1[Ye]+SHA256_W$1[Ye]|0,st=(rotr$1(s,2)^rotr$1(s,13)^rotr$1(s,22))+Maj$1(s,a,l)|0;Be=Le,Le=me,me=pe,pe=de+nt|0,de=l,l=a,a=s,s=nt+st|0}s=s+this.A|0,a=a+this.B|0,l=l+this.C|0,de=de+this.D|0,pe=pe+this.E|0,me=me+this.F|0,Le=Le+this.G|0,Be=Be+this.H|0,this.set(s,a,l,de,pe,me,Le,Be)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$1=wrapConstructor$1(()=>new SHA256$1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$5=BigInt(2),u8a$1=e=>e instanceof Uint8Array,hexes$1=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function bytesToHex$1(e){if(!u8a$1(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=hexes$1[e[n]];return t}function numberToHexUnpadded(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function hexToNumber(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function hexToBytes$1(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const a=s*2,l=e.slice(a,a+2),de=Number.parseInt(l,16);if(Number.isNaN(de)||de<0)throw new Error("Invalid byte sequence");n[s]=de}return n}function bytesToNumberBE(e){return hexToNumber(bytesToHex$1(e))}function bytesToNumberLE(e){if(!u8a$1(e))throw new Error("Uint8Array expected");return hexToNumber(bytesToHex$1(Uint8Array.from(e).reverse()))}function numberToBytesBE(e,t){return hexToBytes$1(e.toString(16).padStart(t*2,"0"))}function numberToBytesLE(e,t){return numberToBytesBE(e,t).reverse()}function numberToVarBytesBE(e){return hexToBytes$1(numberToHexUnpadded(e))}function ensureBytes(e,t,n){let s;if(typeof t=="string")try{s=hexToBytes$1(t)}catch(l){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${l}`)}else if(u8a$1(t))s=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const a=s.length;if(typeof n=="number"&&a!==n)throw new Error(`${e} expected ${n} bytes, got ${a}`);return s}function concatBytes$1(...e){const t=new Uint8Array(e.reduce((s,a)=>s+a.length,0));let n=0;return e.forEach(s=>{if(!u8a$1(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}function equalBytes$1(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function utf8ToBytes$1(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function bitLen(e){let t;for(t=0;e>_0n$8;e>>=_1n$8,t+=1);return t}function bitGet(e,t){return e>>BigInt(t)&_1n$8}const bitSet=(e,t,n)=>e|(n?_1n$8:_0n$8)<<BigInt(t),bitMask=e=>(_2n$5<<BigInt(e-1))-_1n$8,u8n=e=>new Uint8Array(e),u8fr=e=>Uint8Array.from(e);function createHmacDrbg(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let s=u8n(e),a=u8n(e),l=0;const de=()=>{s.fill(1),a.fill(0),l=0},pe=(...Ye)=>n(a,s,...Ye),me=(Ye=u8n())=>{a=pe(u8fr([0]),Ye),s=pe(),Ye.length!==0&&(a=pe(u8fr([1]),Ye),s=pe())},Le=()=>{if(l++>=1e3)throw new Error("drbg: tried 1000 values");let Ye=0;const tt=[];for(;Ye<t;){s=pe();const nt=s.slice();tt.push(nt),Ye+=s.length}return concatBytes$1(...tt)};return(Ye,tt)=>{de(),me(Ye);let nt;for(;!(nt=tt(Le()));)me();return de(),nt}}const validatorFns={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function validateObject(e,t,n={}){const s=(a,l,de)=>{const pe=validatorFns[l];if(typeof pe!="function")throw new Error(`Invalid validator "${l}", expected function`);const me=e[a];if(!(de&&me===void 0)&&!pe(me,e))throw new Error(`Invalid param ${String(a)}=${me} (${typeof me}), expected ${l}`)};for(const[a,l]of Object.entries(t))s(a,l,!1);for(const[a,l]of Object.entries(n))s(a,l,!0);return e}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen,bitMask,bitSet,bytesToHex:bytesToHex$1,bytesToNumberBE,bytesToNumberLE,concatBytes:concatBytes$1,createHmacDrbg,ensureBytes,equalBytes:equalBytes$1,hexToBytes:hexToBytes$1,hexToNumber,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$1,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$2=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(e,t){const n=e%t;return n>=_0n$7?n:t+n}function pow(e,t,n){if(n<=_0n$7||t<_0n$7)throw new Error("Expected power/modulo > 0");if(n===_1n$7)return _0n$7;let s=_1n$7;for(;t>_0n$7;)t&_1n$7&&(s=s*e%n),e=e*e%n,t>>=_1n$7;return s}function pow2$1(e,t,n){let s=e;for(;t-- >_0n$7;)s*=s,s%=n;return s}function invert$1(e,t){if(e===_0n$7||t<=_0n$7)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=mod$1(e,t),s=t,a=_0n$7,l=_1n$7;for(;n!==_0n$7;){const pe=s/n,me=s%n,Le=a-l*pe;s=n,n=me,a=l,l=Le}if(s!==_1n$7)throw new Error("invert: does not exist");return mod$1(a,t)}function tonelliShanks$1(e){const t=(e-_1n$7)/_2n$4;let n,s,a;for(n=e-_1n$7,s=0;n%_2n$4===_0n$7;n/=_2n$4,s++);for(a=_2n$4;a<e&&pow(a,t,e)!==e-_1n$7;a++);if(s===1){const de=(e+_1n$7)/_4n$2;return function(me,Le){const Be=me.pow(Le,de);if(!me.eql(me.sqr(Be),Le))throw new Error("Cannot find square root");return Be}}const l=(n+_1n$7)/_2n$4;return function(pe,me){if(pe.pow(me,t)===pe.neg(pe.ONE))throw new Error("Cannot find square root");let Le=s,Be=pe.pow(pe.mul(pe.ONE,a),n),Ye=pe.pow(me,l),tt=pe.pow(me,n);for(;!pe.eql(tt,pe.ONE);){if(pe.eql(tt,pe.ZERO))return pe.ZERO;let nt=1;for(let st=pe.sqr(tt);nt<Le&&!pe.eql(st,pe.ONE);nt++)st=pe.sqr(st);const ft=pe.pow(Be,_1n$7<<BigInt(Le-nt-1));Be=pe.sqr(ft),Ye=pe.mul(Ye,ft),tt=pe.mul(tt,Be),Le=nt}return Ye}}function FpSqrt$1(e){if(e%_4n$2===_3n$3){const t=(e+_1n$7)/_4n$2;return function(s,a){const l=s.pow(a,t);if(!s.eql(s.sqr(l),a))throw new Error("Cannot find square root");return l}}if(e%_8n$1===_5n$1){const t=(e-_5n$1)/_8n$1;return function(s,a){const l=s.mul(a,_2n$4),de=s.pow(l,t),pe=s.mul(a,de),me=s.mul(s.mul(pe,_2n$4),de),Le=s.mul(pe,s.sub(me,s.ONE));if(!s.eql(s.sqr(Le),a))throw new Error("Cannot find square root");return Le}}return tonelliShanks$1(e)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=FIELD_FIELDS$1.reduce((s,a)=>(s[a]="function",s),t);return validateObject(e,n)}function FpPow$1(e,t,n){if(n<_0n$7)throw new Error("Expected power > 0");if(n===_0n$7)return e.ONE;if(n===_1n$7)return t;let s=e.ONE,a=t;for(;n>_0n$7;)n&_1n$7&&(s=e.mul(s,a)),a=e.sqr(a),n>>=_1n$7;return s}function FpInvertBatch$1(e,t){const n=new Array(t.length),s=t.reduce((l,de,pe)=>e.is0(de)?l:(n[pe]=l,e.mul(l,de)),e.ONE),a=e.inv(s);return t.reduceRight((l,de,pe)=>e.is0(de)?l:(n[pe]=e.mul(l,n[pe]),e.mul(l,de)),a),n}function nLength$1(e,t){const n=t!==void 0?t:e.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field$1(e,t,n=!1,s={}){if(e<=_0n$7)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:a,nByteLength:l}=nLength$1(e,t);if(l>2048)throw new Error("Field lengths over 2048 bytes are not supported");const de=FpSqrt$1(e),pe=Object.freeze({ORDER:e,BITS:a,BYTES:l,MASK:bitMask(a),ZERO:_0n$7,ONE:_1n$7,create:me=>mod$1(me,e),isValid:me=>{if(typeof me!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof me}`);return _0n$7<=me&&me<e},is0:me=>me===_0n$7,isOdd:me=>(me&_1n$7)===_1n$7,neg:me=>mod$1(-me,e),eql:(me,Le)=>me===Le,sqr:me=>mod$1(me*me,e),add:(me,Le)=>mod$1(me+Le,e),sub:(me,Le)=>mod$1(me-Le,e),mul:(me,Le)=>mod$1(me*Le,e),pow:(me,Le)=>FpPow$1(pe,me,Le),div:(me,Le)=>mod$1(me*invert$1(Le,e),e),sqrN:me=>me*me,addN:(me,Le)=>me+Le,subN:(me,Le)=>me-Le,mulN:(me,Le)=>me*Le,inv:me=>invert$1(me,e),sqrt:s.sqrt||(me=>de(pe,me)),invertBatch:me=>FpInvertBatch$1(pe,me),cmov:(me,Le,Be)=>Be?Le:me,toBytes:me=>n?numberToBytesLE(me,l):numberToBytesBE(me,l),fromBytes:me=>{if(me.length!==l)throw new Error(`Fp.fromBytes: expected ${l}, got ${me.length}`);return n?bytesToNumberLE(me):bytesToNumberBE(me)}});return Object.freeze(pe)}function getFieldBytesLength$1(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function getMinHashLength$1(e){const t=getFieldBytesLength$1(e);return t+Math.ceil(t/2)}function mapHashToField$1(e,t,n=!1){const s=e.length,a=getFieldBytesLength$1(t),l=getMinHashLength$1(t);if(s<16||s<l||s>1024)throw new Error(`expected ${l}-1024 bytes of input, got ${s}`);const de=n?bytesToNumberBE(e):bytesToNumberLE(e),pe=mod$1(de,t-_1n$7)+_1n$7;return n?numberToBytesLE(pe,a):numberToBytesBE(pe,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$6=BigInt(0),_1n$6=BigInt(1);function wNAF$1(e,t){const n=(a,l)=>{const de=l.negate();return a?de:l},s=a=>{const l=Math.ceil(t/a)+1,de=2**(a-1);return{windows:l,windowSize:de}};return{constTimeNegate:n,unsafeLadder(a,l){let de=e.ZERO,pe=a;for(;l>_0n$6;)l&_1n$6&&(de=de.add(pe)),pe=pe.double(),l>>=_1n$6;return de},precomputeWindow(a,l){const{windows:de,windowSize:pe}=s(l),me=[];let Le=a,Be=Le;for(let Ye=0;Ye<de;Ye++){Be=Le,me.push(Be);for(let tt=1;tt<pe;tt++)Be=Be.add(Le),me.push(Be);Le=Be.double()}return me},wNAF(a,l,de){const{windows:pe,windowSize:me}=s(a);let Le=e.ZERO,Be=e.BASE;const Ye=BigInt(2**a-1),tt=2**a,nt=BigInt(a);for(let ft=0;ft<pe;ft++){const st=ft*me;let yt=Number(de&Ye);de>>=nt,yt>me&&(yt-=tt,de+=_1n$6);const mt=st,_t=st+Math.abs(yt)-1,Rt=ft%2!==0,At=yt<0;yt===0?Be=Be.add(n(Rt,l[mt])):Le=Le.add(n(At,l[_t]))}return{p:Le,f:Be}},wNAFCached(a,l,de,pe){const me=a._WINDOW_SIZE||1;let Le=l.get(a);return Le||(Le=this.precomputeWindow(a,me),me!==1&&l.set(a,pe(Le))),this.wNAF(me,Le,de)}}}function validateBasic(e){return validateField$1(e.Fp),validateObject(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(e){const t=validateBasic(e);validateObject(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:s,a}=t;if(n){if(!s.eql(a,s.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER$1={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=DER$1;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],s=e.subarray(2,n+2);if(!n||s.length!==n)throw new t("Invalid signature integer: wrong length");if(s[0]&128)throw new t("Invalid signature integer: negative");if(s[0]===0&&!(s[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:b2n(s),l:e.subarray(n+2)}},toSig(e){const{Err:t}=DER$1,n=typeof e=="string"?h2b(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let s=n.length;if(s<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==s-2)throw new t("Invalid signature: incorrect length");const{d:a,l}=DER$1._parseInt(n.subarray(2)),{d:de,l:pe}=DER$1._parseInt(l);if(pe.length)throw new t("Invalid signature: left bytes after parsing");return{r:a,s:de}},hexFromSig(e){const t=Le=>Number.parseInt(Le[0],16)&8?"00"+Le:Le,n=Le=>{const Be=Le.toString(16);return Be.length&1?`0${Be}`:Be},s=t(n(e.s)),a=t(n(e.r)),l=s.length/2,de=a.length/2,pe=n(l),me=n(de);return`30${n(de+l+4)}02${me}${a}02${pe}${s}`}},_0n$5=BigInt(0),_1n$5=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints(e){const t=validatePointOpts(e),{Fp:n}=t,s=t.toBytes||((ft,st,yt)=>{const mt=st.toAffine();return concatBytes$1(Uint8Array.from([4]),n.toBytes(mt.x),n.toBytes(mt.y))}),a=t.fromBytes||(ft=>{const st=ft.subarray(1),yt=n.fromBytes(st.subarray(0,n.BYTES)),mt=n.fromBytes(st.subarray(n.BYTES,2*n.BYTES));return{x:yt,y:mt}});function l(ft){const{a:st,b:yt}=t,mt=n.sqr(ft),_t=n.mul(mt,ft);return n.add(n.add(_t,n.mul(ft,st)),yt)}if(!n.eql(n.sqr(t.Gy),l(t.Gx)))throw new Error("bad generator point: equation left != right");function de(ft){return typeof ft=="bigint"&&_0n$5<ft&&ft<t.n}function pe(ft){if(!de(ft))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function me(ft){const{allowedPrivateKeyLengths:st,nByteLength:yt,wrapPrivateKey:mt,n:_t}=t;if(st&&typeof ft!="bigint"){if(ft instanceof Uint8Array&&(ft=bytesToHex$1(ft)),typeof ft!="string"||!st.includes(ft.length))throw new Error("Invalid key");ft=ft.padStart(yt*2,"0")}let Rt;try{Rt=typeof ft=="bigint"?ft:bytesToNumberBE(ensureBytes("private key",ft,yt))}catch{throw new Error(`private key must be ${yt} bytes, hex or bigint, not ${typeof ft}`)}return mt&&(Rt=mod$1(Rt,_t)),pe(Rt),Rt}const Le=new Map;function Be(ft){if(!(ft instanceof Ye))throw new Error("ProjectivePoint expected")}class Ye{constructor(st,yt,mt){if(this.px=st,this.py=yt,this.pz=mt,st==null||!n.isValid(st))throw new Error("x required");if(yt==null||!n.isValid(yt))throw new Error("y required");if(mt==null||!n.isValid(mt))throw new Error("z required")}static fromAffine(st){const{x:yt,y:mt}=st||{};if(!st||!n.isValid(yt)||!n.isValid(mt))throw new Error("invalid affine point");if(st instanceof Ye)throw new Error("projective point not allowed");const _t=Rt=>n.eql(Rt,n.ZERO);return _t(yt)&&_t(mt)?Ye.ZERO:new Ye(yt,mt,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(st){const yt=n.invertBatch(st.map(mt=>mt.pz));return st.map((mt,_t)=>mt.toAffine(yt[_t])).map(Ye.fromAffine)}static fromHex(st){const yt=Ye.fromAffine(a(ensureBytes("pointHex",st)));return yt.assertValidity(),yt}static fromPrivateKey(st){return Ye.BASE.multiply(me(st))}_setWindowSize(st){this._WINDOW_SIZE=st,Le.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:st,y:yt}=this.toAffine();if(!n.isValid(st)||!n.isValid(yt))throw new Error("bad point: x or y not FE");const mt=n.sqr(yt),_t=l(st);if(!n.eql(mt,_t))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:st}=this.toAffine();if(n.isOdd)return!n.isOdd(st);throw new Error("Field doesn't support isOdd")}equals(st){Be(st);const{px:yt,py:mt,pz:_t}=this,{px:Rt,py:At,pz:Lt}=st,Tt=n.eql(n.mul(yt,Lt),n.mul(Rt,_t)),It=n.eql(n.mul(mt,Lt),n.mul(At,_t));return Tt&&It}negate(){return new Ye(this.px,n.neg(this.py),this.pz)}double(){const{a:st,b:yt}=t,mt=n.mul(yt,_3n$2),{px:_t,py:Rt,pz:At}=this;let Lt=n.ZERO,Tt=n.ZERO,It=n.ZERO,Bt=n.mul(_t,_t),Mt=n.mul(Rt,Rt),Pt=n.mul(At,At),vt=n.mul(_t,Rt);return vt=n.add(vt,vt),It=n.mul(_t,At),It=n.add(It,It),Lt=n.mul(st,It),Tt=n.mul(mt,Pt),Tt=n.add(Lt,Tt),Lt=n.sub(Mt,Tt),Tt=n.add(Mt,Tt),Tt=n.mul(Lt,Tt),Lt=n.mul(vt,Lt),It=n.mul(mt,It),Pt=n.mul(st,Pt),vt=n.sub(Bt,Pt),vt=n.mul(st,vt),vt=n.add(vt,It),It=n.add(Bt,Bt),Bt=n.add(It,Bt),Bt=n.add(Bt,Pt),Bt=n.mul(Bt,vt),Tt=n.add(Tt,Bt),Pt=n.mul(Rt,At),Pt=n.add(Pt,Pt),Bt=n.mul(Pt,vt),Lt=n.sub(Lt,Bt),It=n.mul(Pt,Mt),It=n.add(It,It),It=n.add(It,It),new Ye(Lt,Tt,It)}add(st){Be(st);const{px:yt,py:mt,pz:_t}=this,{px:Rt,py:At,pz:Lt}=st;let Tt=n.ZERO,It=n.ZERO,Bt=n.ZERO;const Mt=t.a,Pt=n.mul(t.b,_3n$2);let vt=n.mul(yt,Rt),kt=n.mul(mt,At),wt=n.mul(_t,Lt),bt=n.add(yt,mt),ot=n.add(Rt,At);bt=n.mul(bt,ot),ot=n.add(vt,kt),bt=n.sub(bt,ot),ot=n.add(yt,_t);let gt=n.add(Rt,Lt);return ot=n.mul(ot,gt),gt=n.add(vt,wt),ot=n.sub(ot,gt),gt=n.add(mt,_t),Tt=n.add(At,Lt),gt=n.mul(gt,Tt),Tt=n.add(kt,wt),gt=n.sub(gt,Tt),Bt=n.mul(Mt,ot),Tt=n.mul(Pt,wt),Bt=n.add(Tt,Bt),Tt=n.sub(kt,Bt),Bt=n.add(kt,Bt),It=n.mul(Tt,Bt),kt=n.add(vt,vt),kt=n.add(kt,vt),wt=n.mul(Mt,wt),ot=n.mul(Pt,ot),kt=n.add(kt,wt),wt=n.sub(vt,wt),wt=n.mul(Mt,wt),ot=n.add(ot,wt),vt=n.mul(kt,ot),It=n.add(It,vt),vt=n.mul(gt,ot),Tt=n.mul(bt,Tt),Tt=n.sub(Tt,vt),vt=n.mul(bt,kt),Bt=n.mul(gt,Bt),Bt=n.add(Bt,vt),new Ye(Tt,It,Bt)}subtract(st){return this.add(st.negate())}is0(){return this.equals(Ye.ZERO)}wNAF(st){return nt.wNAFCached(this,Le,st,yt=>{const mt=n.invertBatch(yt.map(_t=>_t.pz));return yt.map((_t,Rt)=>_t.toAffine(mt[Rt])).map(Ye.fromAffine)})}multiplyUnsafe(st){const yt=Ye.ZERO;if(st===_0n$5)return yt;if(pe(st),st===_1n$5)return this;const{endo:mt}=t;if(!mt)return nt.unsafeLadder(this,st);let{k1neg:_t,k1:Rt,k2neg:At,k2:Lt}=mt.splitScalar(st),Tt=yt,It=yt,Bt=this;for(;Rt>_0n$5||Lt>_0n$5;)Rt&_1n$5&&(Tt=Tt.add(Bt)),Lt&_1n$5&&(It=It.add(Bt)),Bt=Bt.double(),Rt>>=_1n$5,Lt>>=_1n$5;return _t&&(Tt=Tt.negate()),At&&(It=It.negate()),It=new Ye(n.mul(It.px,mt.beta),It.py,It.pz),Tt.add(It)}multiply(st){pe(st);let yt=st,mt,_t;const{endo:Rt}=t;if(Rt){const{k1neg:At,k1:Lt,k2neg:Tt,k2:It}=Rt.splitScalar(yt);let{p:Bt,f:Mt}=this.wNAF(Lt),{p:Pt,f:vt}=this.wNAF(It);Bt=nt.constTimeNegate(At,Bt),Pt=nt.constTimeNegate(Tt,Pt),Pt=new Ye(n.mul(Pt.px,Rt.beta),Pt.py,Pt.pz),mt=Bt.add(Pt),_t=Mt.add(vt)}else{const{p:At,f:Lt}=this.wNAF(yt);mt=At,_t=Lt}return Ye.normalizeZ([mt,_t])[0]}multiplyAndAddUnsafe(st,yt,mt){const _t=Ye.BASE,Rt=(Lt,Tt)=>Tt===_0n$5||Tt===_1n$5||!Lt.equals(_t)?Lt.multiplyUnsafe(Tt):Lt.multiply(Tt),At=Rt(this,yt).add(Rt(st,mt));return At.is0()?void 0:At}toAffine(st){const{px:yt,py:mt,pz:_t}=this,Rt=this.is0();st==null&&(st=Rt?n.ONE:n.inv(_t));const At=n.mul(yt,st),Lt=n.mul(mt,st),Tt=n.mul(_t,st);if(Rt)return{x:n.ZERO,y:n.ZERO};if(!n.eql(Tt,n.ONE))throw new Error("invZ was invalid");return{x:At,y:Lt}}isTorsionFree(){const{h:st,isTorsionFree:yt}=t;if(st===_1n$5)return!0;if(yt)return yt(Ye,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:st,clearCofactor:yt}=t;return st===_1n$5?this:yt?yt(Ye,this):this.multiplyUnsafe(t.h)}toRawBytes(st=!0){return this.assertValidity(),s(Ye,this,st)}toHex(st=!0){return bytesToHex$1(this.toRawBytes(st))}}Ye.BASE=new Ye(t.Gx,t.Gy,n.ONE),Ye.ZERO=new Ye(n.ZERO,n.ONE,n.ZERO);const tt=t.nBitLength,nt=wNAF$1(Ye,t.endo?Math.ceil(tt/2):tt);return{CURVE:t,ProjectivePoint:Ye,normPrivateKeyToScalar:me,weierstrassEquation:l,isWithinCurveOrder:de}}function validateOpts(e){const t=validateBasic(e);return validateObject(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function weierstrass$1(e){const t=validateOpts(e),{Fp:n,n:s}=t,a=n.BYTES+1,l=2*n.BYTES+1;function de(ot){return _0n$5<ot&&ot<n.ORDER}function pe(ot){return mod$1(ot,s)}function me(ot){return invert$1(ot,s)}const{ProjectivePoint:Le,normPrivateKeyToScalar:Be,weierstrassEquation:Ye,isWithinCurveOrder:tt}=weierstrassPoints({...t,toBytes(ot,gt,Et){const xt=gt.toAffine(),Ct=n.toBytes(xt.x),St=concatBytes$1;return Et?St(Uint8Array.from([gt.hasEvenY()?2:3]),Ct):St(Uint8Array.from([4]),Ct,n.toBytes(xt.y))},fromBytes(ot){const gt=ot.length,Et=ot[0],xt=ot.subarray(1);if(gt===a&&(Et===2||Et===3)){const Ct=bytesToNumberBE(xt);if(!de(Ct))throw new Error("Point is not on curve");const St=Ye(Ct);let $t=n.sqrt(St);const Nt=($t&_1n$5)===_1n$5;return(Et&1)===1!==Nt&&($t=n.neg($t)),{x:Ct,y:$t}}else if(gt===l&&Et===4){const Ct=n.fromBytes(xt.subarray(0,n.BYTES)),St=n.fromBytes(xt.subarray(n.BYTES,2*n.BYTES));return{x:Ct,y:St}}else throw new Error(`Point of length ${gt} was invalid. Expected ${a} compressed bytes or ${l} uncompressed bytes`)}}),nt=ot=>bytesToHex$1(numberToBytesBE(ot,t.nByteLength));function ft(ot){const gt=s>>_1n$5;return ot>gt}function st(ot){return ft(ot)?pe(-ot):ot}const yt=(ot,gt,Et)=>bytesToNumberBE(ot.slice(gt,Et));class mt{constructor(gt,Et,xt){this.r=gt,this.s=Et,this.recovery=xt,this.assertValidity()}static fromCompact(gt){const Et=t.nByteLength;return gt=ensureBytes("compactSignature",gt,Et*2),new mt(yt(gt,0,Et),yt(gt,Et,2*Et))}static fromDER(gt){const{r:Et,s:xt}=DER$1.toSig(ensureBytes("DER",gt));return new mt(Et,xt)}assertValidity(){if(!tt(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!tt(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(gt){return new mt(this.r,this.s,gt)}recoverPublicKey(gt){const{r:Et,s:xt,recovery:Ct}=this,St=It(ensureBytes("msgHash",gt));if(Ct==null||![0,1,2,3].includes(Ct))throw new Error("recovery id invalid");const $t=Ct===2||Ct===3?Et+t.n:Et;if($t>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Nt=Ct&1?"03":"02",jt=Le.fromHex(Nt+nt($t)),Ft=me($t),Ut=pe(-St*Ft),Ot=pe(xt*Ft),Dt=Le.BASE.multiplyAndAddUnsafe(jt,Ut,Ot);if(!Dt)throw new Error("point at infinify");return Dt.assertValidity(),Dt}hasHighS(){return ft(this.s)}normalizeS(){return this.hasHighS()?new mt(this.r,pe(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$1(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$1(this.toCompactHex())}toCompactHex(){return nt(this.r)+nt(this.s)}}const _t={isValidPrivateKey(ot){try{return Be(ot),!0}catch{return!1}},normPrivateKeyToScalar:Be,randomPrivateKey:()=>{const ot=getMinHashLength$1(t.n);return mapHashToField$1(t.randomBytes(ot),t.n)},precompute(ot=8,gt=Le.BASE){return gt._setWindowSize(ot),gt.multiply(BigInt(3)),gt}};function Rt(ot,gt=!0){return Le.fromPrivateKey(ot).toRawBytes(gt)}function At(ot){const gt=ot instanceof Uint8Array,Et=typeof ot=="string",xt=(gt||Et)&&ot.length;return gt?xt===a||xt===l:Et?xt===2*a||xt===2*l:ot instanceof Le}function Lt(ot,gt,Et=!0){if(At(ot))throw new Error("first arg must be private key");if(!At(gt))throw new Error("second arg must be public key");return Le.fromHex(gt).multiply(Be(ot)).toRawBytes(Et)}const Tt=t.bits2int||function(ot){const gt=bytesToNumberBE(ot),Et=ot.length*8-t.nBitLength;return Et>0?gt>>BigInt(Et):gt},It=t.bits2int_modN||function(ot){return pe(Tt(ot))},Bt=bitMask(t.nBitLength);function Mt(ot){if(typeof ot!="bigint")throw new Error("bigint expected");if(!(_0n$5<=ot&&ot<Bt))throw new Error(`bigint expected < 2^${t.nBitLength}`);return numberToBytesBE(ot,t.nByteLength)}function Pt(ot,gt,Et=vt){if(["recovered","canonical"].some(Ht=>Ht in Et))throw new Error("sign() legacy options not supported");const{hash:xt,randomBytes:Ct}=t;let{lowS:St,prehash:$t,extraEntropy:Nt}=Et;St==null&&(St=!0),ot=ensureBytes("msgHash",ot),$t&&(ot=ensureBytes("prehashed msgHash",xt(ot)));const jt=It(ot),Ft=Be(gt),Ut=[Mt(Ft),Mt(jt)];if(Nt!=null){const Ht=Nt===!0?Ct(n.BYTES):Nt;Ut.push(ensureBytes("extraEntropy",Ht))}const Ot=concatBytes$1(...Ut),Dt=jt;function zt(Ht){const Vt=Tt(Ht);if(!tt(Vt))return;const qt=me(Vt),Wt=Le.BASE.multiply(Vt).toAffine(),Gt=pe(Wt.x);if(Gt===_0n$5)return;const bn=pe(qt*pe(Dt+Gt*Ft));if(bn===_0n$5)return;let vn=(Wt.x===Gt?0:2)|Number(Wt.y&_1n$5),xn=bn;return St&&ft(bn)&&(xn=st(bn),vn^=1),new mt(Gt,xn,vn)}return{seed:Ot,k2sig:zt}}const vt={lowS:t.lowS,prehash:!1},kt={lowS:t.lowS,prehash:!1};function wt(ot,gt,Et=vt){const{seed:xt,k2sig:Ct}=Pt(ot,gt,Et),St=t;return createHmacDrbg(St.hash.outputLen,St.nByteLength,St.hmac)(xt,Ct)}Le.BASE._setWindowSize(8);function bt(ot,gt,Et,xt=kt){var Wt;const Ct=ot;if(gt=ensureBytes("msgHash",gt),Et=ensureBytes("publicKey",Et),"strict"in xt)throw new Error("options.strict was renamed to lowS");const{lowS:St,prehash:$t}=xt;let Nt,jt;try{if(typeof Ct=="string"||Ct instanceof Uint8Array)try{Nt=mt.fromDER(Ct)}catch(Gt){if(!(Gt instanceof DER$1.Err))throw Gt;Nt=mt.fromCompact(Ct)}else if(typeof Ct=="object"&&typeof Ct.r=="bigint"&&typeof Ct.s=="bigint"){const{r:Gt,s:bn}=Ct;Nt=new mt(Gt,bn)}else throw new Error("PARSE");jt=Le.fromHex(Et)}catch(Gt){if(Gt.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(St&&Nt.hasHighS())return!1;$t&&(gt=t.hash(gt));const{r:Ft,s:Ut}=Nt,Ot=It(gt),Dt=me(Ut),zt=pe(Ot*Dt),Ht=pe(Ft*Dt),Vt=(Wt=Le.BASE.multiplyAndAddUnsafe(jt,zt,Ht))==null?void 0:Wt.toAffine();return Vt?pe(Vt.x)===Ft:!1}return{CURVE:t,getPublicKey:Rt,getSharedSecret:Lt,sign:wt,verify:bt,ProjectivePoint:Le,Signature:mt,utils:_t}}let HMAC$1=class extends Hash$1{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,hash$1(t);const s=toBytes$1(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,l=new Uint8Array(a);l.set(s.length>a?t.create().update(s).digest():s);for(let de=0;de<l.length;de++)l[de]^=54;this.iHash.update(l),this.oHash=t.create();for(let de=0;de<l.length;de++)l[de]^=106;this.oHash.update(l),l.fill(0)}update(t){return exists$1(this),this.iHash.update(t),this}digestInto(t){exists$1(this),bytes$2(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:a,destroyed:l,blockLen:de,outputLen:pe}=this;return t=t,t.finished=a,t.destroyed=l,t.blockLen=de,t.outputLen=pe,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(e,t,n)=>new HMAC$1(e,t).update(n).digest();hmac$1.create=(e,t)=>new HMAC$1(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(e){return{hash:e,hmac:(t,...n)=>hmac$1(e,t,concatBytes$2(...n)),randomBytes:randomBytes$1}}function createCurve$1(e,t){const n=s=>weierstrass$1({...e,...getHash(s)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$4=BigInt(1),_2n$3=BigInt(2),divNearest$1=(e,t)=>(e+t/_2n$3)/t;function sqrtMod$1(e){const t=secp256k1P,n=BigInt(3),s=BigInt(6),a=BigInt(11),l=BigInt(22),de=BigInt(23),pe=BigInt(44),me=BigInt(88),Le=e*e*e%t,Be=Le*Le*e%t,Ye=pow2$1(Be,n,t)*Be%t,tt=pow2$1(Ye,n,t)*Be%t,nt=pow2$1(tt,_2n$3,t)*Le%t,ft=pow2$1(nt,a,t)*nt%t,st=pow2$1(ft,l,t)*ft%t,yt=pow2$1(st,pe,t)*st%t,mt=pow2$1(yt,me,t)*yt%t,_t=pow2$1(mt,pe,t)*st%t,Rt=pow2$1(_t,n,t)*Be%t,At=pow2$1(Rt,de,t)*ft%t,Lt=pow2$1(At,s,t)*Le%t,Tt=pow2$1(Lt,_2n$3,t);if(!Fp.eql(Fp.sqr(Tt),e))throw new Error("Cannot find square root");return Tt}const Fp=Field$1(secp256k1P,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=secp256k1N,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),s=-_1n$4*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),l=n,de=BigInt("0x100000000000000000000000000000000"),pe=divNearest$1(l*e,t),me=divNearest$1(-s*e,t);let Le=mod$1(e-pe*n-me*a,t),Be=mod$1(-pe*s-me*l,t);const Ye=Le>de,tt=Be>de;if(Ye&&(Le=t-Le),tt&&(Be=t-Be),Le>de||Be>de)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:Ye,k1:Le,k2neg:tt,k2:Be}}}},sha256$1),_0n$4=BigInt(0),fe=e=>typeof e=="bigint"&&_0n$4<e&&e<secp256k1P,ge=e=>typeof e=="bigint"&&_0n$4<e&&e<secp256k1N,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(e,...t){let n=TAGGED_HASH_PREFIXES$1[e];if(n===void 0){const s=sha256$1(Uint8Array.from(e,a=>a.charCodeAt(0)));n=concatBytes$1(s,s),TAGGED_HASH_PREFIXES$1[e]=n}return sha256$1(concatBytes$1(n,...t))}const pointToBytes$1=e=>e.toRawBytes(!0).slice(1),numTo32b=e=>numberToBytesBE(e,32),modP=e=>mod$1(e,secp256k1P),modN=e=>mod$1(e,secp256k1N),Point=secp256k1$1.ProjectivePoint,GmulAdd=(e,t,n)=>Point.BASE.multiplyAndAddUnsafe(e,t,n);function schnorrGetExtPubKey$1(e){let t=secp256k1$1.utils.normPrivateKeyToScalar(e),n=Point.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:modN(-t),bytes:pointToBytes$1(n)}}function lift_x$1(e){if(!fe(e))throw new Error("bad x: need 0 < x < p");const t=modP(e*e),n=modP(t*e+BigInt(7));let s=sqrtMod$1(n);s%_2n$3!==_0n$4&&(s=modP(-s));const a=new Point(e,s,_1n$4);return a.assertValidity(),a}function challenge$1(...e){return modN(bytesToNumberBE(taggedHash$1("BIP0340/challenge",...e)))}function schnorrGetPublicKey$1(e){return schnorrGetExtPubKey$1(e).bytes}function schnorrSign$1(e,t,n=randomBytes$1(32)){const s=ensureBytes("message",e),{bytes:a,scalar:l}=schnorrGetExtPubKey$1(t),de=ensureBytes("auxRand",n,32),pe=numTo32b(l^bytesToNumberBE(taggedHash$1("BIP0340/aux",de))),me=taggedHash$1("BIP0340/nonce",pe,a,s),Le=modN(bytesToNumberBE(me));if(Le===_0n$4)throw new Error("sign failed: k is zero");const{bytes:Be,scalar:Ye}=schnorrGetExtPubKey$1(Le),tt=challenge$1(Be,a,s),nt=new Uint8Array(64);if(nt.set(Be,0),nt.set(numTo32b(modN(Ye+tt*l)),32),!schnorrVerify$1(nt,s,a))throw new Error("sign: Invalid signature produced");return nt}function schnorrVerify$1(e,t,n){const s=ensureBytes("signature",e,64),a=ensureBytes("message",t),l=ensureBytes("publicKey",n,32);try{const de=lift_x$1(bytesToNumberBE(l)),pe=bytesToNumberBE(s.subarray(0,32));if(!fe(pe))return!1;const me=bytesToNumberBE(s.subarray(32,64));if(!ge(me))return!1;const Le=challenge$1(numTo32b(pe),pointToBytes$1(de),a),Be=GmulAdd(de,me,modN(-Le));return!(!Be||!Be.hasEvenY()||Be.toAffine().x!==pe)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE,bytesToNumberBE,taggedHash:taggedHash$1,mod:mod$1}},crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=e=>e instanceof Uint8Array,createView=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),rotr=(e,t)=>e<<32-t|e>>>t,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function bytesToHex(e){if(!u8a(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=hexes[e[n]];return t}function hexToBytes(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let s=0;s<n.length;s++){const a=s*2,l=e.slice(a,a+2),de=Number.parseInt(l,16);if(Number.isNaN(de)||de<0)throw new Error("Invalid byte sequence");n[s]=de}return n}function utf8ToBytes(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function toBytes(e){if(typeof e=="string"&&(e=utf8ToBytes(e)),!u8a(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function concatBytes(...e){const t=new Uint8Array(e.reduce((s,a)=>s+a.length,0));let n=0;return e.forEach(s=>{if(!u8a(s))throw new Error("Uint8Array expected");t.set(s,n),n+=s.length}),t}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(e){const t=s=>e().update(toBytes(s)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function randomBytes(e=32){if(crypto&&typeof crypto.getRandomValues=="function")return crypto.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function number$1(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function bool$1(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function bytes$1(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function hash(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$1(e.outputLen),number$1(e.blockLen)}function exists(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function output(e,t){bytes$1(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const assert={number:number$1,bool:bool$1,bytes:bytes$1,hash,exists,output};function setBigUint64(e,t,n,s){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,s);const a=BigInt(32),l=BigInt(4294967295),de=Number(n>>a&l),pe=Number(n&l),me=s?4:0,Le=s?0:4;e.setUint32(t+me,de,s),e.setUint32(t+Le,pe,s)}class SHA2 extends Hash{constructor(t,n,s,a){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=createView(this.buffer)}update(t){assert.exists(this);const{view:n,buffer:s,blockLen:a}=this;t=toBytes(t);const l=t.length;for(let de=0;de<l;){const pe=Math.min(a-this.pos,l-de);if(pe===a){const me=createView(t);for(;a<=l-de;de+=a)this.process(me,de);continue}s.set(t.subarray(de,de+pe),this.pos),this.pos+=pe,de+=pe,this.pos===a&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){assert.exists(this),assert.output(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:a,isLE:l}=this;let{pos:de}=this;n[de++]=128,this.buffer.subarray(de).fill(0),this.padOffset>a-de&&(this.process(s,0),de=0);for(let Ye=de;Ye<a;Ye++)n[Ye]=0;setBigUint64(s,a-8,BigInt(this.length*8),l),this.process(s,0);const pe=createView(t),me=this.outputLen;if(me%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const Le=me/4,Be=this.get();if(Le>Be.length)throw new Error("_sha2: outputLen bigger than state");for(let Ye=0;Ye<Le;Ye++)pe.setUint32(4*Ye,Be[Ye],l)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:a,finished:l,destroyed:de,pos:pe}=this;return t.length=a,t.pos=pe,t.finished=l,t.destroyed=de,a%n&&t.buffer.set(s),t}}const Chi=(e,t,n)=>e&t^~e&n,Maj=(e,t,n)=>e&t^e&n^t&n,SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:t,B:n,C:s,D:a,E:l,F:de,G:pe,H:me}=this;return[t,n,s,a,l,de,pe,me]}set(t,n,s,a,l,de,pe,me){this.A=t|0,this.B=n|0,this.C=s|0,this.D=a|0,this.E=l|0,this.F=de|0,this.G=pe|0,this.H=me|0}process(t,n){for(let Ye=0;Ye<16;Ye++,n+=4)SHA256_W[Ye]=t.getUint32(n,!1);for(let Ye=16;Ye<64;Ye++){const tt=SHA256_W[Ye-15],nt=SHA256_W[Ye-2],ft=rotr(tt,7)^rotr(tt,18)^tt>>>3,st=rotr(nt,17)^rotr(nt,19)^nt>>>10;SHA256_W[Ye]=st+SHA256_W[Ye-7]+ft+SHA256_W[Ye-16]|0}let{A:s,B:a,C:l,D:de,E:pe,F:me,G:Le,H:Be}=this;for(let Ye=0;Ye<64;Ye++){const tt=rotr(pe,6)^rotr(pe,11)^rotr(pe,25),nt=Be+tt+Chi(pe,me,Le)+SHA256_K[Ye]+SHA256_W[Ye]|0,st=(rotr(s,2)^rotr(s,13)^rotr(s,22))+Maj(s,a,l)|0;Be=Le,Le=me,me=pe,pe=de+nt|0,de=l,l=a,a=s,s=nt+st|0}s=s+this.A|0,a=a+this.B|0,l=l+this.C|0,de=de+this.D|0,pe=pe+this.E|0,me=me+this.F|0,Le=Le+this.G|0,Be=Be+this.H|0,this.set(s,a,l,de,pe,me,Le,Be)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class SHA224 extends SHA256{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256=wrapConstructor(()=>new SHA256);wrapConstructor(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function chain(...e){const t=(a,l)=>de=>a(l(de)),n=Array.from(e).reverse().reduce((a,l)=>a?t(a,l.encode):l.encode,void 0),s=e.reduce((a,l)=>a?t(a,l.decode):l.decode,void 0);return{encode:n,decode:s}}function alphabet(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(assertNumber(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const s=e.indexOf(n);if(s===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return s})}}}function join(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function padding(e,t="="){if(assertNumber(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of n)if(typeof s!="string")throw new Error(`padding.encode: non-string input=${s}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let a of n)if(typeof a!="string")throw new Error(`padding.decode: non-string input=${a}`);let s=n.length;if(s*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;s>0&&n[s-1]===t;s--)if(!((s-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,s)}}}function normalize$1(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function convertRadix(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let s=0;const a=[],l=Array.from(e);for(l.forEach(de=>{if(assertNumber(de),de<0||de>=t)throw new Error(`Wrong integer: ${de}`)});;){let de=0,pe=!0;for(let me=s;me<l.length;me++){const Le=l[me],Be=t*de+Le;if(!Number.isSafeInteger(Be)||t*de/t!==de||Be-Le!==t*de)throw new Error("convertRadix: carry overflow");if(de=Be%n,l[me]=Math.floor(Be/n),!Number.isSafeInteger(l[me])||l[me]*n+de!==Be)throw new Error("convertRadix: carry overflow");if(pe)l[me]?pe=!1:s=me;else continue}if(a.push(de),pe)break}for(let de=0;de<e.length-1&&e[de]===0;de++)a.push(0);return a.reverse()}const gcd=(e,t)=>t?gcd(t,e%t):e,radix2carry=(e,t)=>e+(t-gcd(e,t));function convertRadix2(e,t,n,s){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(radix2carry(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${radix2carry(t,n)}`);let a=0,l=0;const de=2**n-1,pe=[];for(const me of e){if(assertNumber(me),me>=2**t)throw new Error(`convertRadix2: invalid data word=${me} from=${t}`);if(a=a<<t|me,l+t>32)throw new Error(`convertRadix2: carry overflow pos=${l} from=${t}`);for(l+=t;l>=n;l-=n)pe.push((a>>l-n&de)>>>0);a&=2**l-1}if(a=a<<n-l&de,!s&&l>=t)throw new Error("Excess padding");if(!s&&a)throw new Error(`Non-zero padding: ${a}`);return s&&l>0&&pe.push(a>>>0),pe}function radix(e){return assertNumber(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(t,e,2**8))}}}function radix2(e,t=!1){if(assertNumber(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,e)>32||radix2carry(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2(n,e,8,t))}}}function unsafeWrapper(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const base16=chain(radix2(4),alphabet("0123456789ABCDEF"),join("")),base32=chain(radix2(5),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join(""));chain(radix2(5),alphabet("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join(""),normalize$1(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join("")),base64url=chain(radix2(6),alphabet("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join("")),genBase58=e=>chain(radix(58),alphabet(e),join("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(e){let t="";for(let n=0;n<e.length;n+=8){const s=e.subarray(n,n+8);t+=base58.encode(s).padStart(XMR_BLOCK_LEN[s.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const s=e.slice(n,n+11),a=XMR_BLOCK_LEN.indexOf(s.length),l=base58.decode(s);for(let de=0;de<l.length-a;de++)if(l[de]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(l.slice(l.length-a)))}return Uint8Array.from(t)}},BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(e){const t=e>>25;let n=(e&33554431)<<5;for(let s=0;s<POLYMOD_GENERATORS.length;s++)(t>>s&1)===1&&(n^=POLYMOD_GENERATORS[s]);return n}function bechChecksum(e,t,n=1){const s=e.length;let a=1;for(let l=0;l<s;l++){const de=e.charCodeAt(l);if(de<33||de>126)throw new Error(`Invalid prefix (${e})`);a=bech32Polymod(a)^de>>5}a=bech32Polymod(a);for(let l=0;l<s;l++)a=bech32Polymod(a)^e.charCodeAt(l)&31;for(let l of t)a=bech32Polymod(a)^l;for(let l=0;l<6;l++)a=bech32Polymod(a);return a^=n,BECH_ALPHABET.encode(convertRadix2([a%2**30],30,5,!1))}function genBech32(e){const t=e==="bech32"?1:734539939,n=radix2(5),s=n.decode,a=n.encode,l=unsafeWrapper(s);function de(Be,Ye,tt=90){if(typeof Be!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof Be}`);if(!Array.isArray(Ye)||Ye.length&&typeof Ye[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof Ye}`);const nt=Be.length+7+Ye.length;if(tt!==!1&&nt>tt)throw new TypeError(`Length ${nt} exceeds limit ${tt}`);return Be=Be.toLowerCase(),`${Be}1${BECH_ALPHABET.encode(Ye)}${bechChecksum(Be,Ye,t)}`}function pe(Be,Ye=90){if(typeof Be!="string")throw new Error(`bech32.decode input should be string, not ${typeof Be}`);if(Be.length<8||Ye!==!1&&Be.length>Ye)throw new TypeError(`Wrong string length: ${Be.length} (${Be}). Expected (8..${Ye})`);const tt=Be.toLowerCase();if(Be!==tt&&Be!==Be.toUpperCase())throw new Error("String must be lowercase or uppercase");Be=tt;const nt=Be.lastIndexOf("1");if(nt===0||nt===-1)throw new Error('Letter "1" must be present between prefix and data only');const ft=Be.slice(0,nt),st=Be.slice(nt+1);if(st.length<6)throw new Error("Data must be at least 6 characters long");const yt=BECH_ALPHABET.decode(st).slice(0,-6),mt=bechChecksum(ft,yt,t);if(!st.endsWith(mt))throw new Error(`Invalid checksum in ${Be}: expected "${mt}"`);return{prefix:ft,words:yt}}const me=unsafeWrapper(pe);function Le(Be){const{prefix:Ye,words:tt}=pe(Be,!1);return{prefix:Ye,words:tt,bytes:s(tt)}}return{encode:de,decode:pe,decodeToBytes:Le,decodeUnsafe:me,fromWords:s,fromWordsUnsafe:l,toWords:a}}const bech32$1=genBech32("bech32");genBech32("bech32m");const utf8$1={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},hex$1=chain(radix2(4),alphabet("0123456789abcdef"),join(""),normalize$1(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),CODERS={utf8:utf8$1,hex:hex$1,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function bool(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function isBytes(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function bytes(e,...t){if(!isBytes(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function equalBytes(e,t){if(e.length!==t.length)return!1;let n=0;for(let s=0;s<e.length;s++)n|=e[s]^t[s];return n===0}const wrapCipher=(e,t)=>(Object.assign(t,e),t),BLOCK_SIZE=16,POLY=283;function mul2(e){return e<<1^POLY&-(e>>7)}function mul(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=mul2(e);return n}const sbox=(()=>{let e=new Uint8Array(256);for(let n=0,s=1;n<256;n++,s^=mul2(s))e[n]=s;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let s=e[255-n];s|=s<<8,t[e[n]]=(s^s>>4^s>>5^s>>6^s>>7^99)&255}return t})(),invSbox=sbox.map((e,t)=>sbox.indexOf(t)),rotr32_8=e=>e<<24|e>>>8,rotl32_8=e=>e<<8|e>>>24;function genTtable(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((Le,Be)=>t(e[Be])),s=n.map(rotl32_8),a=s.map(rotl32_8),l=a.map(rotl32_8),de=new Uint32Array(256*256),pe=new Uint32Array(256*256),me=new Uint16Array(256*256);for(let Le=0;Le<256;Le++)for(let Be=0;Be<256;Be++){const Ye=Le*256+Be;de[Ye]=n[Le]^s[Be],pe[Ye]=a[Le]^l[Be],me[Ye]=e[Le]<<8|e[Be]}return{sbox:e,sbox2:me,T0:n,T1:s,T2:a,T3:l,T01:de,T23:pe}}const tableEncoding=genTtable(sbox,e=>mul(e,3)<<24|e<<16|e<<8|mul(e,2)),tableDecoding=genTtable(invSbox,e=>mul(e,11)<<24|mul(e,13)<<16|mul(e,9)<<8|mul(e,14)),xPowers=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=mul2(n))e[t]=n;return e})();function expandKeyLE(e){bytes(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=tableEncoding,s=u32(e),a=s.length,l=pe=>applySbox(n,pe,pe,pe,pe),de=new Uint32Array(t+28);de.set(s);for(let pe=a;pe<de.length;pe++){let me=de[pe-1];pe%a===0?me=l(rotr32_8(me))^xPowers[pe/a-1]:a>6&&pe%a===4&&(me=l(me)),de[pe]=de[pe-a]^me}return de}function expandKeyDecLE(e){const t=expandKeyLE(e),n=t.slice(),s=t.length,{sbox2:a}=tableEncoding,{T0:l,T1:de,T2:pe,T3:me}=tableDecoding;for(let Le=0;Le<s;Le+=4)for(let Be=0;Be<4;Be++)n[Le+Be]=t[s-Le-4+Be];t.fill(0);for(let Le=4;Le<s-4;Le++){const Be=n[Le],Ye=applySbox(a,Be,Be,Be,Be);n[Le]=l[Ye&255]^de[Ye>>>8&255]^pe[Ye>>>16&255]^me[Ye>>>24]}return n}function apply0123(e,t,n,s,a,l){return e[n<<8&65280|s>>>8&255]^t[a>>>8&65280|l>>>24&255]}function applySbox(e,t,n,s,a){return e[t&255|n&65280]|e[s>>>16&255|a>>>16&65280]<<16}function encrypt$2(e,t,n,s,a){const{sbox2:l,T01:de,T23:pe}=tableEncoding;let me=0;t^=e[me++],n^=e[me++],s^=e[me++],a^=e[me++];const Le=e.length/4-2;for(let ft=0;ft<Le;ft++){const st=e[me++]^apply0123(de,pe,t,n,s,a),yt=e[me++]^apply0123(de,pe,n,s,a,t),mt=e[me++]^apply0123(de,pe,s,a,t,n),_t=e[me++]^apply0123(de,pe,a,t,n,s);t=st,n=yt,s=mt,a=_t}const Be=e[me++]^applySbox(l,t,n,s,a),Ye=e[me++]^applySbox(l,n,s,a,t),tt=e[me++]^applySbox(l,s,a,t,n),nt=e[me++]^applySbox(l,a,t,n,s);return{s0:Be,s1:Ye,s2:tt,s3:nt}}function decrypt$2(e,t,n,s,a){const{sbox2:l,T01:de,T23:pe}=tableDecoding;let me=0;t^=e[me++],n^=e[me++],s^=e[me++],a^=e[me++];const Le=e.length/4-2;for(let ft=0;ft<Le;ft++){const st=e[me++]^apply0123(de,pe,t,a,s,n),yt=e[me++]^apply0123(de,pe,n,t,a,s),mt=e[me++]^apply0123(de,pe,s,n,t,a),_t=e[me++]^apply0123(de,pe,a,s,n,t);t=st,n=yt,s=mt,a=_t}const Be=e[me++]^applySbox(l,t,a,s,n),Ye=e[me++]^applySbox(l,n,t,a,s),tt=e[me++]^applySbox(l,s,n,t,a),nt=e[me++]^applySbox(l,a,s,n,t);return{s0:Be,s1:Ye,s2:tt,s3:nt}}function getDst(e,t){if(!t)return new Uint8Array(e);if(bytes(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function validateBlockDecrypt(e){if(bytes(e),e.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(e,t,n){let s=e.length;const a=s%BLOCK_SIZE;if(!t&&a!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const l=u32(e);if(t){let me=BLOCK_SIZE-a;me||(me=BLOCK_SIZE),s=s+me}const de=getDst(s,n),pe=u32(de);return{b:l,o:pe,out:de}}function validatePCKS(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const s=e[n-1];if(s<=0||s>16)throw new Error(`aes/pcks5: wrong padding byte: ${s}`);const a=e.subarray(0,-s);for(let l=0;l<s;l++)if(e[n-l-1]!==s)throw new Error("aes/pcks5: wrong padding");return a}function padPCKS(e){const t=new Uint8Array(16),n=u32(t);t.set(e);const s=BLOCK_SIZE-e.length;for(let a=BLOCK_SIZE-s;a<BLOCK_SIZE;a++)t[a]=s;return n}const cbc=wrapCipher({blockSize:16,nonceLength:16},function e(t,n,s={}){bytes(t),bytes(n,16);const a=!s.disablePadding;return{encrypt:(l,de)=>{const pe=expandKeyLE(t),{b:me,o:Le,out:Be}=validateBlockEncrypt(l,a,de),Ye=u32(n);let tt=Ye[0],nt=Ye[1],ft=Ye[2],st=Ye[3],yt=0;for(;yt+4<=me.length;)tt^=me[yt+0],nt^=me[yt+1],ft^=me[yt+2],st^=me[yt+3],{s0:tt,s1:nt,s2:ft,s3:st}=encrypt$2(pe,tt,nt,ft,st),Le[yt++]=tt,Le[yt++]=nt,Le[yt++]=ft,Le[yt++]=st;if(a){const mt=padPCKS(l.subarray(yt*4));tt^=mt[0],nt^=mt[1],ft^=mt[2],st^=mt[3],{s0:tt,s1:nt,s2:ft,s3:st}=encrypt$2(pe,tt,nt,ft,st),Le[yt++]=tt,Le[yt++]=nt,Le[yt++]=ft,Le[yt++]=st}return pe.fill(0),Be},decrypt:(l,de)=>{validateBlockDecrypt(l);const pe=expandKeyDecLE(t),me=u32(n),Le=getDst(l.length,de),Be=u32(l),Ye=u32(Le);let tt=me[0],nt=me[1],ft=me[2],st=me[3];for(let yt=0;yt+4<=Be.length;){const mt=tt,_t=nt,Rt=ft,At=st;tt=Be[yt+0],nt=Be[yt+1],ft=Be[yt+2],st=Be[yt+3];const{s0:Lt,s1:Tt,s2:It,s3:Bt}=decrypt$2(pe,tt,nt,ft,st);Ye[yt++]=Lt^mt,Ye[yt++]=Tt^_t,Ye[yt++]=It^Rt,Ye[yt++]=Bt^At}return pe.fill(0),validatePCKS(Le,a)}}}),_utf8ToBytes=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(e,t){return e<<t|e>>>32-t}function isAligned32(e){return e.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(e,t,n,s,a,l,de,pe){const me=a.length,Le=new Uint8Array(BLOCK_LEN),Be=u32(Le),Ye=isAligned32(a)&&isAligned32(l),tt=Ye?u32(a):U32_EMPTY,nt=Ye?u32(l):U32_EMPTY;for(let ft=0;ft<me;de++){if(e(t,n,s,Be,de,pe),de>=MAX_COUNTER)throw new Error("arx: counter overflow");const st=Math.min(BLOCK_LEN,me-ft);if(Ye&&st===BLOCK_LEN){const yt=ft/4;if(ft%4!==0)throw new Error("arx: invalid block position");for(let mt=0,_t;mt<BLOCK_LEN32;mt++)_t=yt+mt,nt[_t]=tt[_t]^Be[mt];ft+=BLOCK_LEN;continue}for(let yt=0,mt;yt<st;yt++)mt=ft+yt,l[mt]=a[mt]^Le[yt];ft+=st}}function createCipher(e,t){const{allowShortKeys:n,extendNonceFn:s,counterLength:a,counterRight:l,rounds:de}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return number(a),number(de),bool(l),bool(n),(pe,me,Le,Be,Ye=0)=>{bytes(pe),bytes(me),bytes(Le);const tt=Le.length;if(Be||(Be=new Uint8Array(tt)),bytes(Be),number(Ye),Ye<0||Ye>=MAX_COUNTER)throw new Error("arx: counter overflow");if(Be.length<tt)throw new Error(`arx: output (${Be.length}) is shorter than data (${tt})`);const nt=[];let ft=pe.length,st,yt;if(ft===32)st=pe.slice(),nt.push(st),yt=sigma32_32;else if(ft===16&&n)st=new Uint8Array(32),st.set(pe),st.set(pe,16),yt=sigma16_32,nt.push(st);else throw new Error(`arx: invalid 32-byte key, got length=${ft}`);isAligned32(me)||(me=me.slice(),nt.push(me));const mt=u32(st);if(s){if(me.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(yt,mt,u32(me.subarray(0,16)),mt),me=me.subarray(16)}const _t=16-a;if(_t!==me.length)throw new Error(`arx: nonce must be ${_t} or 16 bytes`);if(_t!==12){const At=new Uint8Array(12);At.set(me,l?0:12-me.length),me=At,nt.push(me)}const Rt=u32(me);for(runCipher(e,yt,mt,Rt,Le,Be,Ye,de);nt.length>0;)nt.pop().fill(0);return Be}}function chachaCore(e,t,n,s,a,l=20){let de=e[0],pe=e[1],me=e[2],Le=e[3],Be=t[0],Ye=t[1],tt=t[2],nt=t[3],ft=t[4],st=t[5],yt=t[6],mt=t[7],_t=a,Rt=n[0],At=n[1],Lt=n[2],Tt=de,It=pe,Bt=me,Mt=Le,Pt=Be,vt=Ye,kt=tt,wt=nt,bt=ft,ot=st,gt=yt,Et=mt,xt=_t,Ct=Rt,St=At,$t=Lt;for(let jt=0;jt<l;jt+=2)Tt=Tt+Pt|0,xt=rotl(xt^Tt,16),bt=bt+xt|0,Pt=rotl(Pt^bt,12),Tt=Tt+Pt|0,xt=rotl(xt^Tt,8),bt=bt+xt|0,Pt=rotl(Pt^bt,7),It=It+vt|0,Ct=rotl(Ct^It,16),ot=ot+Ct|0,vt=rotl(vt^ot,12),It=It+vt|0,Ct=rotl(Ct^It,8),ot=ot+Ct|0,vt=rotl(vt^ot,7),Bt=Bt+kt|0,St=rotl(St^Bt,16),gt=gt+St|0,kt=rotl(kt^gt,12),Bt=Bt+kt|0,St=rotl(St^Bt,8),gt=gt+St|0,kt=rotl(kt^gt,7),Mt=Mt+wt|0,$t=rotl($t^Mt,16),Et=Et+$t|0,wt=rotl(wt^Et,12),Mt=Mt+wt|0,$t=rotl($t^Mt,8),Et=Et+$t|0,wt=rotl(wt^Et,7),Tt=Tt+vt|0,$t=rotl($t^Tt,16),gt=gt+$t|0,vt=rotl(vt^gt,12),Tt=Tt+vt|0,$t=rotl($t^Tt,8),gt=gt+$t|0,vt=rotl(vt^gt,7),It=It+kt|0,xt=rotl(xt^It,16),Et=Et+xt|0,kt=rotl(kt^Et,12),It=It+kt|0,xt=rotl(xt^It,8),Et=Et+xt|0,kt=rotl(kt^Et,7),Bt=Bt+wt|0,Ct=rotl(Ct^Bt,16),bt=bt+Ct|0,wt=rotl(wt^bt,12),Bt=Bt+wt|0,Ct=rotl(Ct^Bt,8),bt=bt+Ct|0,wt=rotl(wt^bt,7),Mt=Mt+Pt|0,St=rotl(St^Mt,16),ot=ot+St|0,Pt=rotl(Pt^ot,12),Mt=Mt+Pt|0,St=rotl(St^Mt,8),ot=ot+St|0,Pt=rotl(Pt^ot,7);let Nt=0;s[Nt++]=de+Tt|0,s[Nt++]=pe+It|0,s[Nt++]=me+Bt|0,s[Nt++]=Le+Mt|0,s[Nt++]=Be+Pt|0,s[Nt++]=Ye+vt|0,s[Nt++]=tt+kt|0,s[Nt++]=nt+wt|0,s[Nt++]=ft+bt|0,s[Nt++]=st+ot|0,s[Nt++]=yt+gt|0,s[Nt++]=mt+Et|0,s[Nt++]=_t+xt|0,s[Nt++]=Rt+Ct|0,s[Nt++]=At+St|0,s[Nt++]=Lt+$t|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});class HMAC extends Hash{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,assert.hash(t);const s=toBytes(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const a=this.blockLen,l=new Uint8Array(a);l.set(s.length>a?t.create().update(s).digest():s);for(let de=0;de<l.length;de++)l[de]^=54;this.iHash.update(l),this.oHash=t.create();for(let de=0;de<l.length;de++)l[de]^=106;this.oHash.update(l),l.fill(0)}update(t){return assert.exists(this),this.iHash.update(t),this}digestInto(t){assert.exists(this),assert.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:s,finished:a,destroyed:l,blockLen:de,outputLen:pe}=this;return t=t,t.finished=a,t.destroyed=l,t.blockLen=de,t.outputLen=pe,t.oHash=n._cloneInto(t.oHash),t.iHash=s._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(e,t,n)=>new HMAC(e,t).update(n).digest();hmac.create=(e,t)=>new HMAC(e,t);function extract(e,t,n){return assert.hash(e),hmac(e,toBytes(n),toBytes(t))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(e,t,n,s=32){if(assert.hash(e),assert.number(s),s>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const a=Math.ceil(s/e.outputLen);n===void 0&&(n=EMPTY_BUFFER);const l=new Uint8Array(a*e.outputLen),de=hmac.create(e,t),pe=de._cloneInto(),me=new Uint8Array(de.outputLen);for(let Le=0;Le<a;Le++)HKDF_COUNTER[0]=Le+1,pe.update(Le===0?EMPTY_BUFFER:me).update(n).update(HKDF_COUNTER).digestInto(me),l.set(me,e.outputLen*Le),de._cloneInto(pe);return de.destroy(),pe.destroy(),me.fill(0),HKDF_COUNTER.fill(0),l.slice(0,s)}var __defProp=Object.defineProperty,__export=(e,t)=>{for(var n in t)__defProp(e,n,{get:t[n],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=e=>e instanceof Object;function validateEvent(e){if(!isRecord(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let s=0;s<n.length;s++)if(typeof n[s]!="string")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,bytesToHex:()=>bytesToHex,hexToBytes:()=>hexToBytes,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function insertEventIntoDescendingList(e,t){const[n,s]=binarySearch(e,a=>t.id===a.id?0:t.created_at===a.created_at?-1:a.created_at-t.created_at);return s||e.splice(n,0,t),e}function insertEventIntoAscendingList(e,t){const[n,s]=binarySearch(e,a=>t.id===a.id?0:t.created_at===a.created_at?-1:t.created_at-a.created_at);return s||e.splice(n,0,t),e}function binarySearch(e,t){let n=0,s=e.length-1;for(;n<=s;){const a=Math.floor((n+s)/2),l=t(e[a]);if(l===0)return[a,!0];l<0?s=a-1:n=a+1}return[n,!1]}var QueueNode=class{constructor(e){ht(this,"value");ht(this,"next",null);ht(this,"prev",null);this.value=e}},Queue$1=class{constructor(){ht(this,"first");ht(this,"last");this.first=null,this.last=null}enqueue(t){const n=new QueueNode(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(e){return bytesToHex(schnorr$1.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=bytesToHex(schnorr$1.getPublicKey(t)),n.id=getEventHash$1(n),n.sig=bytesToHex(schnorr$1.sign(getEventHash$1(n),t)),n[verifiedSymbol]=!0,n}verifyEvent(e){if(typeof e[verifiedSymbol]=="boolean")return e[verifiedSymbol];const t=getEventHash$1(e);if(t!==e.id)return e[verifiedSymbol]=!1,!1;try{const n=schnorr$1.verify(e.sig,t,e.pubkey);return e[verifiedSymbol]=n,n}catch{return e[verifiedSymbol]=!1,!1}}};function serializeEvent(e){if(!validateEvent(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function getEventHash$1(e){let t=sha256(utf8Encoder.encode(serializeEvent(e)));return bytesToHex(t)}var i=new JS,generateSecretKey=i.generateSecretKey,getPublicKey=i.getPublicKey,finalizeEvent=i.finalizeEvent,verifyEvent=i.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList$1,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isAddressableKind:()=>isAddressableKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function isReplaceableKind(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function isEphemeralKind(e){return 2e4<=e&&e<3e4}function isAddressableKind(e){return 3e4<=e&&e<4e4}function classifyKind(e){return isRegularKind(e)?"regular":isReplaceableKind(e)?"replaceable":isEphemeralKind(e)?"ephemeral":isAddressableKind(e)?"parameterized":"unknown"}function isKind(e,t){const n=t instanceof Array?t:[t];return validateEvent(e)&&n.includes(e.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList$1=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let s=n.slice(1),a=e[`#${s}`];if(a&&!t.tags.find(([l,de])=>l===n.slice(1)&&a.indexOf(de)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function matchFilters(e,t){for(let n=0;n<e.length;n++)if(matchFilter(e[n],t))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(e,t){let n=t.length+3,s=e.indexOf(`"${t}":`)+n,a=e.slice(s).indexOf('"')+s+1;return e.slice(a,a+64)}function getInt(e,t){let n=t.length,s=e.indexOf(`"${t}":`)+n+3,a=e.slice(s),l=Math.min(a.indexOf(","),a.indexOf("}"));return parseInt(a.slice(0,l),10)}function getSubscriptionId(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let s=t+7+1+n,a=e.slice(s+1,80).indexOf('"');if(a===-1)return null;let l=s+1+a;return e.slice(s+1,l)}function matchEventId(e,t){return t===getHex64(e,"id")}function matchEventPubkey(e,t){return t===getHex64(e,"pubkey")}function matchEventKind(e,t){return t===getInt(e,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(e,t){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode$1,decodeNostrURI:()=>decodeNostrURI,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function decodeNostrURI(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),decode$1(e)}catch{return{type:"invalid",data:null}}}function decode$1(e){var a,l,de,pe,me,Le,Be;let{prefix:t,words:n}=bech32$1.decode(e,Bech32MaxSize),s=new Uint8Array(bech32$1.fromWords(n));switch(t){case"nprofile":{let Ye=parseTLV(s);if(!((a=Ye[0])!=null&&a[0]))throw new Error("missing TLV 0 for nprofile");if(Ye[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex(Ye[0][0]),relays:Ye[1]?Ye[1].map(tt=>utf8Decoder.decode(tt)):[]}}}case"nevent":{let Ye=parseTLV(s);if(!((l=Ye[0])!=null&&l[0]))throw new Error("missing TLV 0 for nevent");if(Ye[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(Ye[2]&&Ye[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(Ye[3]&&Ye[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex(Ye[0][0]),relays:Ye[1]?Ye[1].map(tt=>utf8Decoder.decode(tt)):[],author:(de=Ye[2])!=null&&de[0]?bytesToHex(Ye[2][0]):void 0,kind:(pe=Ye[3])!=null&&pe[0]?parseInt(bytesToHex(Ye[3][0]),16):void 0}}}case"naddr":{let Ye=parseTLV(s);if(!((me=Ye[0])!=null&&me[0]))throw new Error("missing TLV 0 for naddr");if(!((Le=Ye[2])!=null&&Le[0]))throw new Error("missing TLV 2 for naddr");if(Ye[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((Be=Ye[3])!=null&&Be[0]))throw new Error("missing TLV 3 for naddr");if(Ye[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(Ye[0][0]),pubkey:bytesToHex(Ye[2][0]),kind:parseInt(bytesToHex(Ye[3][0]),16),relays:Ye[1]?Ye[1].map(tt=>utf8Decoder.decode(tt)):[]}}}case"nsec":return{type:t,data:s};case"npub":case"note":return{type:t,data:bytesToHex(s)};default:throw new Error(`unknown prefix ${t}`)}}function parseTLV(e){let t={},n=e;for(;n.length>0;){let s=n[0],a=n[1],l=n.slice(2,2+a);if(n=n.slice(2+a),l.length<a)throw new Error(`not enough data to read on TLV ${s}`);t[s]=t[s]||[],t[s].push(l)}return t}function nsecEncode(e){return encodeBytes("nsec",e)}function npubEncode(e){return encodeBytes("npub",hexToBytes(e))}function noteEncode(e){return encodeBytes("note",hexToBytes(e))}function encodeBech32(e,t){let n=bech32$1.toWords(t);return bech32$1.encode(e,n,Bech32MaxSize)}function encodeBytes(e,t){return encodeBech32(e,t)}function nprofileEncode(e){let t=encodeTLV({0:[hexToBytes(e.pubkey)],1:(e.relays||[]).map(n=>utf8Encoder.encode(n))});return encodeBech32("nprofile",t)}function neventEncode(e){let t;e.kind!==void 0&&(t=integerToUint8Array(e.kind));let n=encodeTLV({0:[hexToBytes(e.id)],1:(e.relays||[]).map(s=>utf8Encoder.encode(s)),2:e.author?[hexToBytes(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return encodeBech32("nevent",n)}function naddrEncode(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=encodeTLV({0:[utf8Encoder.encode(e.identifier)],1:(e.relays||[]).map(s=>utf8Encoder.encode(s)),2:[hexToBytes(e.pubkey)],3:[new Uint8Array(t)]});return encodeBech32("naddr",n)}function encodeTLV(e){let t=[];return Object.entries(e).reverse().forEach(([n,s])=>{s.forEach(a=>{let l=new Uint8Array(a.length+2);l.set([parseInt(n)],0),l.set([a.length],1),l.set(a,2),t.push(l)})}),concatBytes(...t)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});function encrypt$1(e,t,n){const s=e instanceof Uint8Array?bytesToHex(e):e,a=secp256k1$1.getSharedSecret(s,"02"+t),l=getNormalizedX(a);let de=Uint8Array.from(randomBytes(16)),pe=utf8Encoder.encode(n),me=cbc(l,de).encrypt(pe),Le=base64.encode(new Uint8Array(me)),Be=base64.encode(new Uint8Array(de.buffer));return`${Le}?iv=${Be}`}function decrypt$1(e,t,n){const s=e instanceof Uint8Array?bytesToHex(e):e;let[a,l]=n.split("?iv="),de=secp256k1$1.getSharedSecret(s,"02"+t),pe=getNormalizedX(de),me=base64.decode(l),Le=base64.decode(a),Be=cbc(pe,me).decrypt(Le);return utf8Decoder.decode(Be)}function getNormalizedX(e){return e.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=e=>NIP05_REGEX$1.test(e||""),_fetch;try{_fetch=fetch}catch(e){}function useFetchImplementation(e){_fetch=e}async function searchDomain(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,s=await _fetch(n,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");return(await s.json()).names}catch{return{}}}async function queryProfile(e){var a;const t=e.match(NIP05_REGEX$1);if(!t)return null;const[,n="_",s]=t;try{const l=`https://${s}/.well-known/nostr.json?name=${n}`,de=await _fetch(l,{redirect:"manual"});if(de.status!==200)throw Error("Wrong response code");const pe=await de.json(),me=pe.names[n];return me?{pubkey:me,relays:(a=pe.relays)==null?void 0:a[me]}:null}catch{return null}}async function isValid(e,t){const n=await queryProfile(t);return n?n.pubkey===e:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,s;for(let a=e.tags.length-1;a>=0;a--){const l=e.tags[a];if(l[0]==="e"&&l[1]){const[de,pe,me,Le,Be]=l,Ye={id:pe,relays:me?[me]:[],author:Be};if(Le==="root"){t.root=Ye;continue}if(Le==="reply"){t.reply=Ye;continue}if(Le==="mention"){t.mentions.push(Ye);continue}n?s=Ye:n=Ye,t.mentions.push(Ye);continue}if(l[0]==="q"&&l[1]){const[de,pe,me]=l;t.quotes.push({id:pe,relays:me?[me]:[]})}if(l[0]==="p"&&l[1]){t.profiles.push({pubkey:l[1],relays:l[2]?[l[2]]:[]});continue}}return t.root||(t.root=s||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(a=>{if(!a)return;let l=t.mentions.indexOf(a);if(l!==-1&&t.mentions.splice(l,1),a.author){let de=t.profiles.find(pe=>pe.pubkey===a.author);de&&de.relays&&(a.relays||(a.relays=[]),de.relays.forEach(pe=>{var me;((me=a.relays)==null?void 0:me.indexOf(pe))===-1&&a.relays.push(pe)}),de.relays=a.relays)}}),t.mentions.forEach(a=>{if(a.author){let l=t.profiles.find(de=>de.pubkey===a.author);l&&l.relays&&(a.relays||(a.relays=[]),l.relays.forEach(de=>{a.relays.indexOf(de)===-1&&a.relays.push(de)}),l.relays=a.relays)}}),t}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(e){_fetch2=e}async function fetchRelayInformation(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(e){let t=0;for(let n=0;n<64;n+=8){const s=parseInt(e.substring(n,n+8),16);if(s===0)t+=32;else{t+=Math.clz32(s);break}}return t}function minePow(e,t){let n=0;const s=e,a=["nonce",n.toString(),t.toString()];for(s.tags.push(a);;){const l=Math.floor(new Date().getTime()/1e3);if(l!==s.created_at&&(n=0,s.created_at=l),a[1]=(++n).toString(),s.id=fastEventHash(s),getPow(s.id)>=t)break}return s}function fastEventHash(e){return bytesToHex(sha256(utf8Encoder.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var nip17_exports={};__export(nip17_exports,{unwrapEvent:()=>unwrapEvent2,unwrapManyEvents:()=>unwrapManyEvents2,wrapEvent:()=>wrapEvent2,wrapManyEvents:()=>wrapManyEvents2});var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent$1,wrapManyEvents:()=>wrapManyEvents});var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(e,t){const n=secp256k1$1.getSharedSecret(e,"02"+t).subarray(1,33);return extract(sha256,n,"nip44-v2")}function getMessageKeys(e,t){const n=expand(sha256,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function calcPaddedLen(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function writeU16BE(e){if(!Number.isSafeInteger(e)||e<minPlaintextSize||e>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function pad(e){const t=utf8Encoder.encode(e),n=t.length,s=writeU16BE(n),a=new Uint8Array(calcPaddedLen(n)-n);return concatBytes(s,t,a)}function unpad(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<minPlaintextSize||t>maxPlaintextSize||n.length!==t||e.length!==2+calcPaddedLen(t))throw new Error("invalid padding");return utf8Decoder.decode(n)}function hmacAad(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const s=concatBytes(n,t);return hmac(sha256,e,s)}function decodePayload(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=base64.decode(e)}catch(l){throw new Error("invalid base64: "+l.message)}const s=n.length;if(s<99||s>65603)throw new Error("invalid data length: "+s);const a=n[0];if(a!==2)throw new Error("unknown encryption version "+a);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function encrypt2(e,t,n=randomBytes(32)){const{chacha_key:s,chacha_nonce:a,hmac_key:l}=getMessageKeys(t,n),de=pad(e),pe=chacha20(s,a,de),me=hmacAad(l,pe,n);return base64.encode(concatBytes(new Uint8Array([2]),n,pe,me))}function decrypt2(e,t){const{nonce:n,ciphertext:s,mac:a}=decodePayload(e),{chacha_key:l,chacha_nonce:de,hmac_key:pe}=getMessageKeys(t,n),me=hmacAad(pe,s,n);if(!equalBytes(me,a))throw new Error("invalid MAC");const Le=chacha20(l,de,s);return unpad(Le)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(e,t)=>getConversationKey(e,t),nip44Encrypt=(e,t,n)=>encrypt2(JSON.stringify(e),nip44ConversationKey(t,n)),nip44Decrypt=(e,t)=>JSON.parse(decrypt2(e.content,nip44ConversationKey(t,e.pubkey)));function createRumor(e,t){const n={created_at:now(),content:"",tags:[],...e,pubkey:getPublicKey(t)};return n.id=getEventHash$1(n),n}function createSeal(e,t,n){return finalizeEvent({kind:Seal,content:nip44Encrypt(e,t,n),created_at:randomNow(),tags:[]},t)}function createWrap(e,t){const n=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(e,n,t),created_at:randomNow(),tags:[["p",t]]},n)}function wrapEvent$1(e,t,n){const s=createRumor(e,t),a=createSeal(s,t,n);return createWrap(a,n)}function wrapManyEvents(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const s=getPublicKey(t),a=[wrapEvent$1(e,t,s)];return n.forEach(l=>{a.push(wrapEvent$1(e,t,l))}),a}function unwrapEvent(e,t){const n=nip44Decrypt(e,t);return nip44Decrypt(n,t)}function unwrapManyEvents(e,t){let n=[];return e.forEach(s=>{n.push(unwrapEvent(s,t))}),n.sort((s,a)=>s.created_at-a.created_at),n}function createEvent(e,t,n,s){const a={created_at:Math.ceil(Date.now()/1e3),kind:PrivateDirectMessage,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:de,relayUrl:pe})=>{a.tags.push(pe?["p",de,pe]:["p",de])}),s&&a.tags.push(["e",s.eventId,s.relayUrl||"","reply"]),n&&a.tags.push(["subject",n]),a}function wrapEvent2(e,t,n,s,a){const l=createEvent(t,n,s,a);return wrapEvent$1(l,e,t.publicKey)}function wrapManyEvents2(e,t,n,s,a){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:getPublicKey(e)},...t].map(de=>wrapEvent2(e,de,n,s,a))}var unwrapEvent2=unwrapEvent,unwrapManyEvents2=unwrapManyEvents,nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(e,t,n,s){var de;let a;const l=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===ShortTextNote?a=Repost:(a=GenericRepost,l.push(["k",String(t.kind)])),finalizeEvent({kind:a,tags:l,content:e.content===""||(de=t.tags)!=null&&de.find(pe=>pe[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},s)}function getRepostedEventPointer(e){if(![Repost,GenericRepost].includes(e.kind))return;let t,n;for(let s=e.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const a=e.tags[s];a.length>=2&&(a[0]==="e"&&t===void 0?t=a:a[0]==="p"&&n===void 0&&(n=a))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(s=>typeof s=="string"),author:n==null?void 0:n[1]}}function getRepostedEvent(e,{skipVerification:t}={}){const n=getRepostedEventPointer(e);if(n===void 0||e.content==="")return;let s;try{s=JSON.parse(e.content)}catch{return}if(s.id===n.id&&!(!t&&!verifyEvent(s)))return s}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(e){return typeof e=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(e)}function parse2(e){const t=e.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:decode$1(t[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(e,t,n){const s=t.tags.filter(a=>a.length>=2&&(a[0]==="e"||a[0]==="p"));return finalizeEvent({...e,kind:Reaction,tags:[...e.tags??[],...s,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function getReactedEventPointer(e){if(e.kind!==Reaction)return;let t,n;for(let s=e.tags.length-1;s>=0&&(t===void 0||n===void 0);s--){const a=e.tags[s];a.length>=2&&(a[0]==="e"&&t===void 0?t=a:a[0]==="p"&&n===void 0&&(n=a))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(s=>s!==void 0),author:n[1]}}var nip27_exports={};__export(nip27_exports,{parse:()=>parse3});var noCharacter=/\W/m,noURLCharacter=/\W |\W$|$|,| /m;function*parse3(e){const t=e.length;let n=0,s=0;for(;s<t;){let a=e.indexOf(":",s);if(a===-1)break;if(e.substring(a-5,a)==="nostr"){const l=e.substring(a+60).match(noCharacter),de=l?a+60+l.index:t;try{let pe,{data:me,type:Le}=decode$1(e.substring(a+1,de));switch(Le){case"npub":pe={pubkey:me};break;case"nsec":case"note":s=de+1;continue;default:pe=me}n!==a-5&&(yield{type:"text",text:e.substring(n,a-5)}),yield{type:"reference",pointer:pe},s=de,n=s;continue}catch{s=a+1;continue}}else if(e.substring(a-5,a)==="https"||e.substring(a-4,a)==="http"){const l=e.substring(a+4).match(noURLCharacter),de=l?a+4+l.index:t,pe=e[a-1]==="s"?5:4;try{let me=new URL(e.substring(a-pe,de));if(me.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==a-pe&&(yield{type:"text",text:e.substring(n,a-pe)}),/\.(png|jpe?g|gif|webp)$/i.test(me.pathname)){yield{type:"image",url:me.toString()},s=de,n=s;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(me.pathname)){yield{type:"video",url:me.toString()},s=de,n=s;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(me.pathname)){yield{type:"audio",url:me.toString()},s=de,n=s;continue}yield{type:"url",url:me.toString()},s=de,n=s;continue}catch{s=de+1;continue}}else if(e.substring(a-3,a)==="wss"||e.substring(a-2,a)==="ws"){const l=e.substring(a+4).match(noURLCharacter),de=l?a+4+l.index:t,pe=e[a-1]==="s"?3:2;try{let me=new URL(e.substring(a-pe,de));if(me.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==a-pe&&(yield{type:"text",text:e.substring(n,a-pe)}),yield{type:"relay",url:me.toString()},s=de,n=s;continue}catch{s=de+1;continue}}else{s=a+1;continue}}n!==t&&(yield{type:"text",text:e.substring(n)})}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},channelMetadataEvent=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},channelMessageEvent=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},channelHideMessageEvent=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},channelMuteUserEvent=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll,regex:()=>regex,replaceAll:()=>replaceAll});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll(e){const t=e.matchAll(regex());for(const n of t)try{const[s,a]=n;yield{shortcode:s,name:a,start:n.index,end:n.index+s.length}}catch{}}function replaceAll(e,t){return e.replaceAll(regex(),(n,s)=>t({shortcode:n,name:s}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(e){_fetch3=e}async function validateGithub(e,t,n){try{return await(await _fetch3(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(e){const{host:t,pathname:n,searchParams:s}=new URL(e),a=n||t,l=s.get("relay"),de=s.get("secret");if(!a||!l||!de)throw new Error("invalid connection string");return{pubkey:a,relay:l,secret:de}}async function makeNwcRequestEvent(e,t,n){const a=encrypt$1(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),l={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:a,tags:[["p",e]]};return finalizeEvent(l,t)}var nip54_exports={};__export(nip54_exports,{normalizeIdentifier:()=>normalizeIdentifier});function normalizeIdentifier(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var nip57_exports={};__export(nip57_exports,{getSatoshisAmountFromBolt11:()=>getSatoshisAmountFromBolt11,getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(e){_fetch4=e}async function getZapEndpoint(e){try{let t="",{lud06:n,lud16:s}=JSON.parse(e.content);if(n){let{words:de}=bech32$1.decode(n,1e3),pe=bech32$1.fromWords(de);t=utf8Decoder.decode(pe)}else if(s){let[de,pe]=s.split("@");t=new URL(`/.well-known/lnurlp/${de}`,`https://${pe}`).toString()}else return null;let l=await(await _fetch4(t)).json();if(l.allowsNostr&&l.nostrPubkey)return l.callback}catch{}return null}function makeZapRequest(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),isReplaceableKind(e.event.kind)){const n=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(n)}else if(isAddressableKind(e.event.kind)){let n=e.event.tags.find(([a,l])=>a==="d"&&l);if(!n)throw new Error("d tag not found or is empty");const s=["a",`${e.event.kind}:${e.event.pubkey}:${n[1]}`];t.tags.push(s)}t.tags.push(["k",e.event.kind.toString()])}return t}function validateZapRequest(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!validateEvent(t))return"Zap request is not a valid Nostr event.";if(!verifyEvent(t))return"Invalid signature on zap request.";let n=t.tags.find(([l,de])=>l==="p"&&de);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let s=t.tags.find(([l,de])=>l==="e"&&de);return s&&!s[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([l,de])=>l==="relays"&&de)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:e,preimage:t,bolt11:n,paidAt:s}){let a=JSON.parse(e),l=a.tags.filter(([pe])=>pe==="e"||pe==="p"||pe==="a"),de={kind:9735,created_at:Math.round(s.getTime()/1e3),content:"",tags:[...l,["P",a.pubkey],["bolt11",n],["description",e]]};return t&&de.tags.push(["preimage",t]),de}function getSatoshisAmountFromBolt11(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const s=n.substring(4);if(s.length<1)return 0;const a=s[s.length-1],l=a.charCodeAt(0)-48,de=l>=0&&l<=9;let pe=s.length-1;if(de&&pe++,pe<1)return 0;const me=parseInt(s.substring(0,pe));switch(a){case"m":return me*1e5;case"u":return me*100;case"n":return me/10;case"p":return me/1e4;default:return me*1e8}}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(e,t,n,s=!1,a){const l={kind:HTTPAuth,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};a&&l.tags.push(["payload",hashPayload(a)]);const de=await n(l);return(s?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(de)))}async function validateToken(e,t,n){const s=await unpackEventFromToken(e).catch(l=>{throw l});return await validateEvent2(s,t,n).catch(l=>{throw l})}async function unpackEventFromToken(e){if(!e)throw new Error("Missing token");e=e.replace(_authorizationScheme,"");const t=utf8Decoder.decode(base64.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function validateEventTimestamp(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function validateEventKind(e){return e.kind===HTTPAuth}function validateEventUrlTag(e,t){const n=e.tags.find(s=>s[0]==="u");return n?n.length>0&&n[1]===t:!1}function validateEventMethodTag(e,t){const n=e.tags.find(s=>s[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function hashPayload(e){const t=sha256(utf8Encoder.encode(JSON.stringify(e)));return bytesToHex(t)}function validateEventPayloadTag(e,t){const n=e.tags.find(a=>a[0]==="payload");if(!n)return!1;const s=hashPayload(t);return n.length>0&&n[1]===s}async function validateEvent2(e,t,n,s){if(!verifyEvent(e))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(e))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(e,n))throw new Error("Invalid nostr event, method tag invalid");if(s&&typeof s=="object"&&Object.keys(s).length>0&&!validateEventPayloadTag(e,s))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$2=BigInt(2),_3n$1=BigInt(3),_4n$1=BigInt(4),_5n=BigInt(5),_7n=BigInt(7),_8n=BigInt(8),_9n=BigInt(9),_16n=BigInt(16);function mod(e,t){const n=e%t;return n>=_0n$3?n:t+n}function pow2(e,t,n){let s=e;for(;t-- >_0n$3;)s*=s,s%=n;return s}function invert(e,t){if(e===_0n$3)throw new Error("invert: expected non-zero number");if(t<=_0n$3)throw new Error("invert: expected positive modulus, got "+t);let n=mod(e,t),s=t,a=_0n$3,l=_1n$3;for(;n!==_0n$3;){const pe=s/n,me=s%n,Le=a-l*pe;s=n,n=me,a=l,l=Le}if(s!==_1n$3)throw new Error("invert: does not exist");return mod(a,t)}function assertIsSquare(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function sqrt3mod4(e,t){const n=(e.ORDER+_1n$3)/_4n$1,s=e.pow(t,n);return assertIsSquare(e,s,t),s}function sqrt5mod8(e,t){const n=(e.ORDER-_5n)/_8n,s=e.mul(t,_2n$2),a=e.pow(s,n),l=e.mul(t,a),de=e.mul(e.mul(l,_2n$2),a),pe=e.mul(l,e.sub(de,e.ONE));return assertIsSquare(e,pe,t),pe}function sqrt9mod16(e){const t=Field(e),n=tonelliShanks(e),s=n(t,t.neg(t.ONE)),a=n(t,s),l=n(t,t.neg(s)),de=(e+_7n)/_16n;return(pe,me)=>{let Le=pe.pow(me,de),Be=pe.mul(Le,s);const Ye=pe.mul(Le,a),tt=pe.mul(Le,l),nt=pe.eql(pe.sqr(Be),me),ft=pe.eql(pe.sqr(Ye),me);Le=pe.cmov(Le,Be,nt),Be=pe.cmov(tt,Ye,ft);const st=pe.eql(pe.sqr(Be),me),yt=pe.cmov(Le,Be,st);return assertIsSquare(pe,yt,me),yt}}function tonelliShanks(e){if(e<_3n$1)throw new Error("sqrt is not defined for small field");let t=e-_1n$3,n=0;for(;t%_2n$2===_0n$3;)t/=_2n$2,n++;let s=_2n$2;const a=Field(e);for(;FpLegendre(a,s)===1;)if(s++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return sqrt3mod4;let l=a.pow(s,t);const de=(t+_1n$3)/_2n$2;return function(me,Le){if(me.is0(Le))return Le;if(FpLegendre(me,Le)!==1)throw new Error("Cannot find square root");let Be=n,Ye=me.mul(me.ONE,l),tt=me.pow(Le,t),nt=me.pow(Le,de);for(;!me.eql(tt,me.ONE);){if(me.is0(tt))return me.ZERO;let ft=1,st=me.sqr(tt);for(;!me.eql(st,me.ONE);)if(ft++,st=me.sqr(st),ft===Be)throw new Error("Cannot find square root");const yt=_1n$3<<BigInt(Be-ft-1),mt=me.pow(Ye,yt);Be=ft,Ye=me.sqr(mt),tt=me.mul(tt,Ye),nt=me.mul(nt,mt)}return nt}}function FpSqrt(e){return e%_4n$1===_3n$1?sqrt3mod4:e%_8n===_5n?sqrt5mod8:e%_16n===_9n?sqrt9mod16(e):tonelliShanks(e)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=FIELD_FIELDS.reduce((s,a)=>(s[a]="function",s),t);return _validateObject(e,n),e}function FpPow(e,t,n){if(n<_0n$3)throw new Error("invalid exponent, negatives unsupported");if(n===_0n$3)return e.ONE;if(n===_1n$3)return t;let s=e.ONE,a=t;for(;n>_0n$3;)n&_1n$3&&(s=e.mul(s,a)),a=e.sqr(a),n>>=_1n$3;return s}function FpInvertBatch(e,t,n=!1){const s=new Array(t.length).fill(n?e.ZERO:void 0),a=t.reduce((de,pe,me)=>e.is0(pe)?de:(s[me]=de,e.mul(de,pe)),e.ONE),l=e.inv(a);return t.reduceRight((de,pe,me)=>e.is0(pe)?de:(s[me]=e.mul(de,s[me]),e.mul(de,pe)),l),s}function FpLegendre(e,t){const n=(e.ORDER-_1n$3)/_2n$2,s=e.pow(t,n),a=e.eql(s,e.ONE),l=e.eql(s,e.ZERO),de=e.eql(s,e.neg(e.ONE));if(!a&&!l&&!de)throw new Error("invalid Legendre symbol result");return a?1:l?0:-1}function nLength(e,t){t!==void 0&&anumber(t);const n=t!==void 0?t:e.toString(2).length,s=Math.ceil(n/8);return{nBitLength:n,nByteLength:s}}function Field(e,t,n=!1,s={}){if(e<=_0n$3)throw new Error("invalid field: expected ORDER > 0, got "+e);let a,l,de=!1,pe;if(typeof t=="object"&&t!=null){if(s.sqrt||n)throw new Error("cannot specify opts in two arguments");const tt=t;tt.BITS&&(a=tt.BITS),tt.sqrt&&(l=tt.sqrt),typeof tt.isLE=="boolean"&&(n=tt.isLE),typeof tt.modFromBytes=="boolean"&&(de=tt.modFromBytes),pe=tt.allowedLengths}else typeof t=="number"&&(a=t),s.sqrt&&(l=s.sqrt);const{nBitLength:me,nByteLength:Le}=nLength(e,a);if(Le>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let Be;const Ye=Object.freeze({ORDER:e,isLE:n,BITS:me,BYTES:Le,MASK:bitMask$1(me),ZERO:_0n$3,ONE:_1n$3,allowedLengths:pe,create:tt=>mod(tt,e),isValid:tt=>{if(typeof tt!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof tt);return _0n$3<=tt&&tt<e},is0:tt=>tt===_0n$3,isValidNot0:tt=>!Ye.is0(tt)&&Ye.isValid(tt),isOdd:tt=>(tt&_1n$3)===_1n$3,neg:tt=>mod(-tt,e),eql:(tt,nt)=>tt===nt,sqr:tt=>mod(tt*tt,e),add:(tt,nt)=>mod(tt+nt,e),sub:(tt,nt)=>mod(tt-nt,e),mul:(tt,nt)=>mod(tt*nt,e),pow:(tt,nt)=>FpPow(Ye,tt,nt),div:(tt,nt)=>mod(tt*invert(nt,e),e),sqrN:tt=>tt*tt,addN:(tt,nt)=>tt+nt,subN:(tt,nt)=>tt-nt,mulN:(tt,nt)=>tt*nt,inv:tt=>invert(tt,e),sqrt:l||(tt=>(Be||(Be=FpSqrt(e)),Be(Ye,tt))),toBytes:tt=>n?numberToBytesLE$1(tt,Le):numberToBytesBE$1(tt,Le),fromBytes:(tt,nt=!0)=>{if(pe){if(!pe.includes(tt.length)||tt.length>Le)throw new Error("Field.fromBytes: expected "+pe+" bytes, got "+tt.length);const st=new Uint8Array(Le);st.set(tt,n?0:st.length-tt.length),tt=st}if(tt.length!==Le)throw new Error("Field.fromBytes: expected "+Le+" bytes, got "+tt.length);let ft=n?bytesToNumberLE$1(tt):bytesToNumberBE$1(tt);if(de&&(ft=mod(ft,e)),!nt&&!Ye.isValid(ft))throw new Error("invalid field element: outside of range 0..ORDER");return ft},invertBatch:tt=>FpInvertBatch(Ye,tt),cmov:(tt,nt,ft)=>ft?nt:tt});return Object.freeze(Ye)}function getFieldBytesLength(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function getMinHashLength(e){const t=getFieldBytesLength(e);return t+Math.ceil(t/2)}function mapHashToField(e,t,n=!1){const s=e.length,a=getFieldBytesLength(t),l=getMinHashLength(t);if(s<16||s<l||s>1024)throw new Error("expected "+l+"-1024 bytes of input, got "+s);const de=n?bytesToNumberLE$1(e):bytesToNumberBE$1(e),pe=mod(de,t-_1n$3)+_1n$3;return n?numberToBytesLE$1(pe,a):numberToBytesBE$1(pe,a)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1);function negateCt(e,t){const n=t.negate();return e?n:t}function normalizeZ(e,t){const n=FpInvertBatch(e.Fp,t.map(s=>s.Z));return t.map((s,a)=>e.fromAffine(s.toAffine(n[a])))}function validateW(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function calcWOpts(e,t){validateW(e,t);const n=Math.ceil(t/e)+1,s=2**(e-1),a=2**e,l=bitMask$1(e),de=BigInt(e);return{windows:n,windowSize:s,mask:l,maxNumber:a,shiftBy:de}}function calcOffsets(e,t,n){const{windowSize:s,mask:a,maxNumber:l,shiftBy:de}=n;let pe=Number(e&a),me=e>>de;pe>s&&(pe-=l,me+=_1n$2);const Le=t*s,Be=Le+Math.abs(pe)-1,Ye=pe===0,tt=pe<0,nt=t%2!==0;return{nextN:me,offset:Be,isZero:Ye,isNeg:tt,isNegF:nt,offsetF:Le}}function validateMSMPoints(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,s)=>{if(!(n instanceof t))throw new Error("invalid point at index "+s)})}function validateMSMScalars(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,s)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+s)})}const pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function getW(e){return pointWindowSizes.get(e)||1}function assert0(e){if(e!==_0n$2)throw new Error("invalid wNAF")}class wNAF{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,s=this.ZERO){let a=t;for(;n>_0n$2;)n&_1n$2&&(s=s.add(a)),a=a.double(),n>>=_1n$2;return s}precomputeWindow(t,n){const{windows:s,windowSize:a}=calcWOpts(n,this.bits),l=[];let de=t,pe=de;for(let me=0;me<s;me++){pe=de,l.push(pe);for(let Le=1;Le<a;Le++)pe=pe.add(de),l.push(pe);de=pe.double()}return l}wNAF(t,n,s){if(!this.Fn.isValid(s))throw new Error("invalid scalar");let a=this.ZERO,l=this.BASE;const de=calcWOpts(t,this.bits);for(let pe=0;pe<de.windows;pe++){const{nextN:me,offset:Le,isZero:Be,isNeg:Ye,isNegF:tt,offsetF:nt}=calcOffsets(s,pe,de);s=me,Be?l=l.add(negateCt(tt,n[nt])):a=a.add(negateCt(Ye,n[Le]))}return assert0(s),{p:a,f:l}}wNAFUnsafe(t,n,s,a=this.ZERO){const l=calcWOpts(t,this.bits);for(let de=0;de<l.windows&&s!==_0n$2;de++){const{nextN:pe,offset:me,isZero:Le,isNeg:Be}=calcOffsets(s,de,l);if(s=pe,!Le){const Ye=n[me];a=a.add(Be?Ye.negate():Ye)}}return assert0(s),a}getPrecomputes(t,n,s){let a=pointPrecomputes.get(n);return a||(a=this.precomputeWindow(n,t),t!==1&&(typeof s=="function"&&(a=s(a)),pointPrecomputes.set(n,a))),a}cached(t,n,s){const a=getW(t);return this.wNAF(a,this.getPrecomputes(a,t,s),n)}unsafe(t,n,s,a){const l=getW(t);return l===1?this._unsafeLadder(t,n,a):this.wNAFUnsafe(l,this.getPrecomputes(l,t,s),n,a)}createCache(t,n){validateW(n,this.bits),pointWindowSizes.set(t,n),pointPrecomputes.delete(t)}hasCache(t){return getW(t)!==1}}function mulEndoUnsafe(e,t,n,s){let a=t,l=e.ZERO,de=e.ZERO;for(;n>_0n$2||s>_0n$2;)n&_1n$2&&(l=l.add(a)),s&_1n$2&&(de=de.add(a)),a=a.double(),n>>=_1n$2,s>>=_1n$2;return{p1:l,p2:de}}function pippenger(e,t,n,s){validateMSMPoints(n,e),validateMSMScalars(s,t);const a=n.length,l=s.length;if(a!==l)throw new Error("arrays of points and scalars must have equal length");const de=e.ZERO,pe=bitLen$1(BigInt(a));let me=1;pe>12?me=pe-3:pe>4?me=pe-2:pe>0&&(me=2);const Le=bitMask$1(me),Be=new Array(Number(Le)+1).fill(de),Ye=Math.floor((t.BITS-1)/me)*me;let tt=de;for(let nt=Ye;nt>=0;nt-=me){Be.fill(de);for(let st=0;st<l;st++){const yt=s[st],mt=Number(yt>>BigInt(nt)&Le);Be[mt]=Be[mt].add(n[st])}let ft=de;for(let st=Be.length-1,yt=de;st>0;st--)yt=yt.add(Be[st]),ft=ft.add(yt);if(tt=tt.add(ft),nt!==0)for(let st=0;st<me;st++)tt=tt.double()}return tt}function createField(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return validateField(t),t}else return Field(e,{isLE:n})}function _createCurveFields(e,t,n={},s){if(s===void 0&&(s=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(const me of["p","n","h"]){const Le=t[me];if(!(typeof Le=="bigint"&&Le>_0n$2))throw new Error(`CURVE.${me} must be positive bigint`)}const a=createField(t.p,n.Fp,s),l=createField(t.n,n.Fn,s),pe=["Gx","Gy","a","b"];for(const me of pe)if(!a.isValid(t[me]))throw new Error(`CURVE.${me} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:a,Fn:l}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const divNearest=(e,t)=>(e+(e>=0?t:-t)/_2n$1)/t;function _splitEndoScalar(e,t,n){const[[s,a],[l,de]]=t,pe=divNearest(de*e,n),me=divNearest(-a*e,n);let Le=e-pe*s-me*l,Be=-pe*a-me*de;const Ye=Le<_0n$1,tt=Be<_0n$1;Ye&&(Le=-Le),tt&&(Be=-Be);const nt=bitMask$1(Math.ceil(bitLen$1(n)/2))+_1n$1;if(Le<_0n$1||Le>=nt||Be<_0n$1||Be>=nt)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:Ye,k1:Le,k2neg:tt,k2:Be}}function validateSigFormat(e){if(!["compact","recovered","der"].includes(e))throw new Error('Signature format must be "compact", "recovered", or "der"');return e}function validateSigOpts(e,t){const n={};for(let s of Object.keys(t))n[s]=e[s]===void 0?t[s]:e[s];return _abool2(n.lowS,"lowS"),_abool2(n.prehash,"prehash"),n.format!==void 0&&validateSigFormat(n.format),n}class DERErr extends Error{constructor(t=""){super(t)}}const DER={Err:DERErr,_tlv:{encode:(e,t)=>{const{Err:n}=DER;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length&1)throw new n("tlv.encode: unpadded data");const s=t.length/2,a=numberToHexUnpadded$1(s);if(a.length/2&128)throw new n("tlv.encode: long form length too big");const l=s>127?numberToHexUnpadded$1(a.length/2|128):"";return numberToHexUnpadded$1(e)+l+a+t},decode(e,t){const{Err:n}=DER;let s=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[s++]!==e)throw new n("tlv.decode: wrong tlv");const a=t[s++],l=!!(a&128);let de=0;if(!l)de=a;else{const me=a&127;if(!me)throw new n("tlv.decode(long): indefinite length not supported");if(me>4)throw new n("tlv.decode(long): byte length is too big");const Le=t.subarray(s,s+me);if(Le.length!==me)throw new n("tlv.decode: length bytes not complete");if(Le[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const Be of Le)de=de<<8|Be;if(s+=me,de<128)throw new n("tlv.decode(long): not minimal encoding")}const pe=t.subarray(s,s+de);if(pe.length!==de)throw new n("tlv.decode: wrong value length");return{v:pe,l:t.subarray(s+de)}}},_int:{encode(e){const{Err:t}=DER;if(e<_0n$1)throw new t("integer: negative integers are not allowed");let n=numberToHexUnpadded$1(e);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=DER;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return bytesToNumberBE$1(e)}},toSig(e){const{Err:t,_int:n,_tlv:s}=DER,a=ensureBytes$1("signature",e),{v:l,l:de}=s.decode(48,a);if(de.length)throw new t("invalid signature: left bytes after parsing");const{v:pe,l:me}=s.decode(2,l),{v:Le,l:Be}=s.decode(2,me);if(Be.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(pe),s:n.decode(Le)}},hexFromSig(e){const{_tlv:t,_int:n}=DER,s=t.encode(2,n.encode(e.r)),a=t.encode(2,n.encode(e.s)),l=s+a;return t.encode(48,l)}},_0n$1=BigInt(0),_1n$1=BigInt(1),_2n$1=BigInt(2),_3n=BigInt(3),_4n=BigInt(4);function _normFnElement(e,t){const{BYTES:n}=e;let s;if(typeof t=="bigint")s=t;else{let a=ensureBytes$1("private key",t);try{s=e.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof t}`)}}if(!e.isValidNot0(s))throw new Error("invalid private key: out of range [1..N-1]");return s}function weierstrassN(e,t={}){const n=_createCurveFields("weierstrass",e,t),{Fp:s,Fn:a}=n;let l=n.CURVE;const{h:de,n:pe}=l;_validateObject(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:me}=t;if(me&&(!s.is0(l.a)||typeof me.beta!="bigint"||!Array.isArray(me.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const Le=getWLengths(s,a);function Be(){if(!s.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function Ye(kt,wt,bt){const{x:ot,y:gt}=wt.toAffine(),Et=s.toBytes(ot);if(_abool2(bt,"isCompressed"),bt){Be();const xt=!s.isOdd(gt);return concatBytes$3(pprefix(xt),Et)}else return concatBytes$3(Uint8Array.of(4),Et,s.toBytes(gt))}function tt(kt){_abytes2(kt,void 0,"Point");const{publicKey:wt,publicKeyUncompressed:bt}=Le,ot=kt.length,gt=kt[0],Et=kt.subarray(1);if(ot===wt&&(gt===2||gt===3)){const xt=s.fromBytes(Et);if(!s.isValid(xt))throw new Error("bad point: is not on curve, wrong x");const Ct=st(xt);let St;try{St=s.sqrt(Ct)}catch(jt){const Ft=jt instanceof Error?": "+jt.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ft)}Be();const $t=s.isOdd(St);return(gt&1)===1!==$t&&(St=s.neg(St)),{x:xt,y:St}}else if(ot===bt&&gt===4){const xt=s.BYTES,Ct=s.fromBytes(Et.subarray(0,xt)),St=s.fromBytes(Et.subarray(xt,xt*2));if(!yt(Ct,St))throw new Error("bad point: is not on curve");return{x:Ct,y:St}}else throw new Error(`bad point: got length ${ot}, expected compressed=${wt} or uncompressed=${bt}`)}const nt=t.toBytes||Ye,ft=t.fromBytes||tt;function st(kt){const wt=s.sqr(kt),bt=s.mul(wt,kt);return s.add(s.add(bt,s.mul(kt,l.a)),l.b)}function yt(kt,wt){const bt=s.sqr(wt),ot=st(kt);return s.eql(bt,ot)}if(!yt(l.Gx,l.Gy))throw new Error("bad curve params: generator point");const mt=s.mul(s.pow(l.a,_3n),_4n),_t=s.mul(s.sqr(l.b),BigInt(27));if(s.is0(s.add(mt,_t)))throw new Error("bad curve params: a or b");function Rt(kt,wt,bt=!1){if(!s.isValid(wt)||bt&&s.is0(wt))throw new Error(`bad point coordinate ${kt}`);return wt}function At(kt){if(!(kt instanceof Mt))throw new Error("ProjectivePoint expected")}function Lt(kt){if(!me||!me.basises)throw new Error("no endo");return _splitEndoScalar(kt,me.basises,a.ORDER)}const Tt=memoized((kt,wt)=>{const{X:bt,Y:ot,Z:gt}=kt;if(s.eql(gt,s.ONE))return{x:bt,y:ot};const Et=kt.is0();wt==null&&(wt=Et?s.ONE:s.inv(gt));const xt=s.mul(bt,wt),Ct=s.mul(ot,wt),St=s.mul(gt,wt);if(Et)return{x:s.ZERO,y:s.ZERO};if(!s.eql(St,s.ONE))throw new Error("invZ was invalid");return{x:xt,y:Ct}}),It=memoized(kt=>{if(kt.is0()){if(t.allowInfinityPoint&&!s.is0(kt.Y))return;throw new Error("bad point: ZERO")}const{x:wt,y:bt}=kt.toAffine();if(!s.isValid(wt)||!s.isValid(bt))throw new Error("bad point: x or y not field elements");if(!yt(wt,bt))throw new Error("bad point: equation left != right");if(!kt.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Bt(kt,wt,bt,ot,gt){return bt=new Mt(s.mul(bt.X,kt),bt.Y,bt.Z),wt=negateCt(ot,wt),bt=negateCt(gt,bt),wt.add(bt)}class Mt{constructor(wt,bt,ot){this.X=Rt("x",wt),this.Y=Rt("y",bt,!0),this.Z=Rt("z",ot),Object.freeze(this)}static CURVE(){return l}static fromAffine(wt){const{x:bt,y:ot}=wt||{};if(!wt||!s.isValid(bt)||!s.isValid(ot))throw new Error("invalid affine point");if(wt instanceof Mt)throw new Error("projective point not allowed");return s.is0(bt)&&s.is0(ot)?Mt.ZERO:new Mt(bt,ot,s.ONE)}static fromBytes(wt){const bt=Mt.fromAffine(ft(_abytes2(wt,void 0,"point")));return bt.assertValidity(),bt}static fromHex(wt){return Mt.fromBytes(ensureBytes$1("pointHex",wt))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(wt=8,bt=!0){return vt.createCache(this,wt),bt||this.multiply(_3n),this}assertValidity(){It(this)}hasEvenY(){const{y:wt}=this.toAffine();if(!s.isOdd)throw new Error("Field doesn't support isOdd");return!s.isOdd(wt)}equals(wt){At(wt);const{X:bt,Y:ot,Z:gt}=this,{X:Et,Y:xt,Z:Ct}=wt,St=s.eql(s.mul(bt,Ct),s.mul(Et,gt)),$t=s.eql(s.mul(ot,Ct),s.mul(xt,gt));return St&&$t}negate(){return new Mt(this.X,s.neg(this.Y),this.Z)}double(){const{a:wt,b:bt}=l,ot=s.mul(bt,_3n),{X:gt,Y:Et,Z:xt}=this;let Ct=s.ZERO,St=s.ZERO,$t=s.ZERO,Nt=s.mul(gt,gt),jt=s.mul(Et,Et),Ft=s.mul(xt,xt),Ut=s.mul(gt,Et);return Ut=s.add(Ut,Ut),$t=s.mul(gt,xt),$t=s.add($t,$t),Ct=s.mul(wt,$t),St=s.mul(ot,Ft),St=s.add(Ct,St),Ct=s.sub(jt,St),St=s.add(jt,St),St=s.mul(Ct,St),Ct=s.mul(Ut,Ct),$t=s.mul(ot,$t),Ft=s.mul(wt,Ft),Ut=s.sub(Nt,Ft),Ut=s.mul(wt,Ut),Ut=s.add(Ut,$t),$t=s.add(Nt,Nt),Nt=s.add($t,Nt),Nt=s.add(Nt,Ft),Nt=s.mul(Nt,Ut),St=s.add(St,Nt),Ft=s.mul(Et,xt),Ft=s.add(Ft,Ft),Nt=s.mul(Ft,Ut),Ct=s.sub(Ct,Nt),$t=s.mul(Ft,jt),$t=s.add($t,$t),$t=s.add($t,$t),new Mt(Ct,St,$t)}add(wt){At(wt);const{X:bt,Y:ot,Z:gt}=this,{X:Et,Y:xt,Z:Ct}=wt;let St=s.ZERO,$t=s.ZERO,Nt=s.ZERO;const jt=l.a,Ft=s.mul(l.b,_3n);let Ut=s.mul(bt,Et),Ot=s.mul(ot,xt),Dt=s.mul(gt,Ct),zt=s.add(bt,ot),Ht=s.add(Et,xt);zt=s.mul(zt,Ht),Ht=s.add(Ut,Ot),zt=s.sub(zt,Ht),Ht=s.add(bt,gt);let Vt=s.add(Et,Ct);return Ht=s.mul(Ht,Vt),Vt=s.add(Ut,Dt),Ht=s.sub(Ht,Vt),Vt=s.add(ot,gt),St=s.add(xt,Ct),Vt=s.mul(Vt,St),St=s.add(Ot,Dt),Vt=s.sub(Vt,St),Nt=s.mul(jt,Ht),St=s.mul(Ft,Dt),Nt=s.add(St,Nt),St=s.sub(Ot,Nt),Nt=s.add(Ot,Nt),$t=s.mul(St,Nt),Ot=s.add(Ut,Ut),Ot=s.add(Ot,Ut),Dt=s.mul(jt,Dt),Ht=s.mul(Ft,Ht),Ot=s.add(Ot,Dt),Dt=s.sub(Ut,Dt),Dt=s.mul(jt,Dt),Ht=s.add(Ht,Dt),Ut=s.mul(Ot,Ht),$t=s.add($t,Ut),Ut=s.mul(Vt,Ht),St=s.mul(zt,St),St=s.sub(St,Ut),Ut=s.mul(zt,Ot),Nt=s.mul(Vt,Nt),Nt=s.add(Nt,Ut),new Mt(St,$t,Nt)}subtract(wt){return this.add(wt.negate())}is0(){return this.equals(Mt.ZERO)}multiply(wt){const{endo:bt}=t;if(!a.isValidNot0(wt))throw new Error("invalid scalar: out of range");let ot,gt;const Et=xt=>vt.cached(this,xt,Ct=>normalizeZ(Mt,Ct));if(bt){const{k1neg:xt,k1:Ct,k2neg:St,k2:$t}=Lt(wt),{p:Nt,f:jt}=Et(Ct),{p:Ft,f:Ut}=Et($t);gt=jt.add(Ut),ot=Bt(bt.beta,Nt,Ft,xt,St)}else{const{p:xt,f:Ct}=Et(wt);ot=xt,gt=Ct}return normalizeZ(Mt,[ot,gt])[0]}multiplyUnsafe(wt){const{endo:bt}=t,ot=this;if(!a.isValid(wt))throw new Error("invalid scalar: out of range");if(wt===_0n$1||ot.is0())return Mt.ZERO;if(wt===_1n$1)return ot;if(vt.hasCache(this))return this.multiply(wt);if(bt){const{k1neg:gt,k1:Et,k2neg:xt,k2:Ct}=Lt(wt),{p1:St,p2:$t}=mulEndoUnsafe(Mt,ot,Et,Ct);return Bt(bt.beta,St,$t,gt,xt)}else return vt.unsafe(ot,wt)}multiplyAndAddUnsafe(wt,bt,ot){const gt=this.multiplyUnsafe(bt).add(wt.multiplyUnsafe(ot));return gt.is0()?void 0:gt}toAffine(wt){return Tt(this,wt)}isTorsionFree(){const{isTorsionFree:wt}=t;return de===_1n$1?!0:wt?wt(Mt,this):vt.unsafe(this,pe).is0()}clearCofactor(){const{clearCofactor:wt}=t;return de===_1n$1?this:wt?wt(Mt,this):this.multiplyUnsafe(de)}isSmallOrder(){return this.multiplyUnsafe(de).is0()}toBytes(wt=!0){return _abool2(wt,"isCompressed"),this.assertValidity(),nt(Mt,this,wt)}toHex(wt=!0){return bytesToHex$2(this.toBytes(wt))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(wt=!0){return this.toBytes(wt)}_setWindowSize(wt){this.precompute(wt)}static normalizeZ(wt){return normalizeZ(Mt,wt)}static msm(wt,bt){return pippenger(Mt,a,wt,bt)}static fromPrivateKey(wt){return Mt.BASE.multiply(_normFnElement(a,wt))}}Mt.BASE=new Mt(l.Gx,l.Gy,s.ONE),Mt.ZERO=new Mt(s.ZERO,s.ONE,s.ZERO),Mt.Fp=s,Mt.Fn=a;const Pt=a.BITS,vt=new wNAF(Mt,t.endo?Math.ceil(Pt/2):Pt);return Mt.BASE.precompute(8),Mt}function pprefix(e){return Uint8Array.of(e?2:3)}function getWLengths(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ecdh(e,t={}){const{Fn:n}=e,s=t.randomBytes||randomBytes$2,a=Object.assign(getWLengths(e.Fp,n),{seed:getMinHashLength(n.ORDER)});function l(nt){try{return!!_normFnElement(n,nt)}catch{return!1}}function de(nt,ft){const{publicKey:st,publicKeyUncompressed:yt}=a;try{const mt=nt.length;return ft===!0&&mt!==st||ft===!1&&mt!==yt?!1:!!e.fromBytes(nt)}catch{return!1}}function pe(nt=s(a.seed)){return mapHashToField(_abytes2(nt,a.seed,"seed"),n.ORDER)}function me(nt,ft=!0){return e.BASE.multiply(_normFnElement(n,nt)).toBytes(ft)}function Le(nt){const ft=pe(nt);return{secretKey:ft,publicKey:me(ft)}}function Be(nt){if(typeof nt=="bigint")return!1;if(nt instanceof e)return!0;const{secretKey:ft,publicKey:st,publicKeyUncompressed:yt}=a;if(n.allowedLengths||ft===st)return;const mt=ensureBytes$1("key",nt).length;return mt===st||mt===yt}function Ye(nt,ft,st=!0){if(Be(nt)===!0)throw new Error("first arg must be private key");if(Be(ft)===!1)throw new Error("second arg must be public key");const yt=_normFnElement(n,nt);return e.fromHex(ft).multiply(yt).toBytes(st)}return Object.freeze({getPublicKey:me,getSharedSecret:Ye,keygen:Le,Point:e,utils:{isValidSecretKey:l,isValidPublicKey:de,randomSecretKey:pe,isValidPrivateKey:l,randomPrivateKey:pe,normPrivateKeyToScalar:nt=>_normFnElement(n,nt),precompute(nt=8,ft=e.BASE){return ft.precompute(nt,!1)}},lengths:a})}function ecdsa(e,t,n={}){ahash(t),_validateObject(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const s=n.randomBytes||randomBytes$2,a=n.hmac||((bt,...ot)=>hmac$2(t,bt,concatBytes$3(...ot))),{Fp:l,Fn:de}=e,{ORDER:pe,BITS:me}=de,{keygen:Le,getPublicKey:Be,getSharedSecret:Ye,utils:tt,lengths:nt}=ecdh(e,n),ft={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},st="compact";function yt(bt){const ot=pe>>_1n$1;return bt>ot}function mt(bt,ot){if(!de.isValidNot0(ot))throw new Error(`invalid signature ${bt}: out of range 1..Point.Fn.ORDER`);return ot}function _t(bt,ot){validateSigFormat(ot);const gt=nt.signature,Et=ot==="compact"?gt:ot==="recovered"?gt+1:void 0;return _abytes2(bt,Et,`${ot} signature`)}class Rt{constructor(ot,gt,Et){this.r=mt("r",ot),this.s=mt("s",gt),Et!=null&&(this.recovery=Et),Object.freeze(this)}static fromBytes(ot,gt=st){_t(ot,gt);let Et;if(gt==="der"){const{r:$t,s:Nt}=DER.toSig(_abytes2(ot));return new Rt($t,Nt)}gt==="recovered"&&(Et=ot[0],gt="compact",ot=ot.subarray(1));const xt=de.BYTES,Ct=ot.subarray(0,xt),St=ot.subarray(xt,xt*2);return new Rt(de.fromBytes(Ct),de.fromBytes(St),Et)}static fromHex(ot,gt){return this.fromBytes(hexToBytes$2(ot),gt)}addRecoveryBit(ot){return new Rt(this.r,this.s,ot)}recoverPublicKey(ot){const gt=l.ORDER,{r:Et,s:xt,recovery:Ct}=this;if(Ct==null||![0,1,2,3].includes(Ct))throw new Error("recovery id invalid");if(pe*_2n$1<gt&&Ct>1)throw new Error("recovery id is ambiguous for h>1 curve");const $t=Ct===2||Ct===3?Et+pe:Et;if(!l.isValid($t))throw new Error("recovery id 2 or 3 invalid");const Nt=l.toBytes($t),jt=e.fromBytes(concatBytes$3(pprefix((Ct&1)===0),Nt)),Ft=de.inv($t),Ut=Lt(ensureBytes$1("msgHash",ot)),Ot=de.create(-Ut*Ft),Dt=de.create(xt*Ft),zt=e.BASE.multiplyUnsafe(Ot).add(jt.multiplyUnsafe(Dt));if(zt.is0())throw new Error("point at infinify");return zt.assertValidity(),zt}hasHighS(){return yt(this.s)}toBytes(ot=st){if(validateSigFormat(ot),ot==="der")return hexToBytes$2(DER.hexFromSig(this));const gt=de.toBytes(this.r),Et=de.toBytes(this.s);if(ot==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return concatBytes$3(Uint8Array.of(this.recovery),gt,Et)}return concatBytes$3(gt,Et)}toHex(ot){return bytesToHex$2(this.toBytes(ot))}assertValidity(){}static fromCompact(ot){return Rt.fromBytes(ensureBytes$1("sig",ot),"compact")}static fromDER(ot){return Rt.fromBytes(ensureBytes$1("sig",ot),"der")}normalizeS(){return this.hasHighS()?new Rt(this.r,de.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return bytesToHex$2(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return bytesToHex$2(this.toBytes("compact"))}}const At=n.bits2int||function(ot){if(ot.length>8192)throw new Error("input is too large");const gt=bytesToNumberBE$1(ot),Et=ot.length*8-me;return Et>0?gt>>BigInt(Et):gt},Lt=n.bits2int_modN||function(ot){return de.create(At(ot))},Tt=bitMask$1(me);function It(bt){return aInRange("num < 2^"+me,bt,_0n$1,Tt),de.toBytes(bt)}function Bt(bt,ot){return _abytes2(bt,void 0,"message"),ot?_abytes2(t(bt),void 0,"prehashed message"):bt}function Mt(bt,ot,gt){if(["recovered","canonical"].some(Ot=>Ot in gt))throw new Error("sign() legacy options not supported");const{lowS:Et,prehash:xt,extraEntropy:Ct}=validateSigOpts(gt,ft);bt=Bt(bt,xt);const St=Lt(bt),$t=_normFnElement(de,ot),Nt=[It($t),It(St)];if(Ct!=null&&Ct!==!1){const Ot=Ct===!0?s(nt.secretKey):Ct;Nt.push(ensureBytes$1("extraEntropy",Ot))}const jt=concatBytes$3(...Nt),Ft=St;function Ut(Ot){const Dt=At(Ot);if(!de.isValidNot0(Dt))return;const zt=de.inv(Dt),Ht=e.BASE.multiply(Dt).toAffine(),Vt=de.create(Ht.x);if(Vt===_0n$1)return;const qt=de.create(zt*de.create(Ft+Vt*$t));if(qt===_0n$1)return;let Wt=(Ht.x===Vt?0:2)|Number(Ht.y&_1n$1),Gt=qt;return Et&&yt(qt)&&(Gt=de.neg(qt),Wt^=1),new Rt(Vt,Gt,Wt)}return{seed:jt,k2sig:Ut}}function Pt(bt,ot,gt={}){bt=ensureBytes$1("message",bt);const{seed:Et,k2sig:xt}=Mt(bt,ot,gt);return createHmacDrbg$1(t.outputLen,de.BYTES,a)(Et,xt)}function vt(bt){let ot;const gt=typeof bt=="string"||isBytes$1(bt),Et=!gt&&bt!==null&&typeof bt=="object"&&typeof bt.r=="bigint"&&typeof bt.s=="bigint";if(!gt&&!Et)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(Et)ot=new Rt(bt.r,bt.s);else if(gt){try{ot=Rt.fromBytes(ensureBytes$1("sig",bt),"der")}catch(xt){if(!(xt instanceof DER.Err))throw xt}if(!ot)try{ot=Rt.fromBytes(ensureBytes$1("sig",bt),"compact")}catch{return!1}}return ot||!1}function kt(bt,ot,gt,Et={}){const{lowS:xt,prehash:Ct,format:St}=validateSigOpts(Et,ft);if(gt=ensureBytes$1("publicKey",gt),ot=Bt(ensureBytes$1("message",ot),Ct),"strict"in Et)throw new Error("options.strict was renamed to lowS");const $t=St===void 0?vt(bt):Rt.fromBytes(ensureBytes$1("sig",bt),St);if($t===!1)return!1;try{const Nt=e.fromBytes(gt);if(xt&&$t.hasHighS())return!1;const{r:jt,s:Ft}=$t,Ut=Lt(ot),Ot=de.inv(Ft),Dt=de.create(Ut*Ot),zt=de.create(jt*Ot),Ht=e.BASE.multiplyUnsafe(Dt).add(Nt.multiplyUnsafe(zt));return Ht.is0()?!1:de.create(Ht.x)===jt}catch{return!1}}function wt(bt,ot,gt={}){const{prehash:Et}=validateSigOpts(gt,ft);return ot=Bt(ot,Et),Rt.fromBytes(bt,"recovered").recoverPublicKey(ot).toBytes()}return Object.freeze({keygen:Le,getPublicKey:Be,getSharedSecret:Ye,utils:tt,lengths:nt,Point:e,sign:Pt,verify:kt,recoverPublicKey:wt,Signature:Rt,hash:t})}function _weierstrass_legacy_opts_to_new(e){const t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp;let s=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(de=>Math.ceil(de/2)))):void 0;const a=Field(t.n,{BITS:e.nBitLength,allowedLengths:s,modFromBytes:e.wrapPrivateKey}),l={Fp:n,Fn:a,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:l}}function _ecdsa_legacy_opts_to_new(e){const{CURVE:t,curveOpts:n}=_weierstrass_legacy_opts_to_new(e),s={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:n,hash:e.hash,ecdsaOpts:s}}function _ecdsa_new_output_to_legacy(e,t){const n=t.Point;return Object.assign({},t,{ProjectivePoint:n,CURVE:Object.assign({},e,nLength(n.Fn.ORDER,n.Fn.BITS))})}function weierstrass(e){const{CURVE:t,curveOpts:n,hash:s,ecdsaOpts:a}=_ecdsa_legacy_opts_to_new(e),l=weierstrassN(t,n),de=ecdsa(l,s,a);return _ecdsa_new_output_to_legacy(e,de)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function createCurve(e,t){const n=s=>weierstrass({...e,hash:s});return{...n(t),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1_CURVE={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},secp256k1_ENDO={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},_0n=BigInt(0),_1n=BigInt(1),_2n=BigInt(2);function sqrtMod(e){const t=secp256k1_CURVE.p,n=BigInt(3),s=BigInt(6),a=BigInt(11),l=BigInt(22),de=BigInt(23),pe=BigInt(44),me=BigInt(88),Le=e*e*e%t,Be=Le*Le*e%t,Ye=pow2(Be,n,t)*Be%t,tt=pow2(Ye,n,t)*Be%t,nt=pow2(tt,_2n,t)*Le%t,ft=pow2(nt,a,t)*nt%t,st=pow2(ft,l,t)*ft%t,yt=pow2(st,pe,t)*st%t,mt=pow2(yt,me,t)*yt%t,_t=pow2(mt,pe,t)*st%t,Rt=pow2(_t,n,t)*Be%t,At=pow2(Rt,de,t)*ft%t,Lt=pow2(At,s,t)*Le%t,Tt=pow2(Lt,_2n,t);if(!Fpk1.eql(Fpk1.sqr(Tt),e))throw new Error("Cannot find square root");return Tt}const Fpk1=Field(secp256k1_CURVE.p,{sqrt:sqrtMod}),secp256k1=createCurve({...secp256k1_CURVE,Fp:Fpk1,lowS:!0,endo:secp256k1_ENDO},sha256$2),TAGGED_HASH_PREFIXES={};function taggedHash(e,...t){let n=TAGGED_HASH_PREFIXES[e];if(n===void 0){const s=sha256$2(utf8ToBytes$3(e));n=concatBytes$3(s,s),TAGGED_HASH_PREFIXES[e]=n}return sha256$2(concatBytes$3(n,...t))}const pointToBytes=e=>e.toBytes(!0).slice(1),Pointk1=secp256k1.Point,hasEven=e=>e%_2n===_0n;function schnorrGetExtPubKey(e){const{Fn:t,BASE:n}=Pointk1,s=_normFnElement(t,e),a=n.multiply(s);return{scalar:hasEven(a.y)?s:t.neg(s),bytes:pointToBytes(a)}}function lift_x(e){const t=Fpk1;if(!t.isValidNot0(e))throw new Error("invalid x: Fail if x  p");const n=t.create(e*e),s=t.create(n*e+BigInt(7));let a=t.sqrt(s);hasEven(a)||(a=t.neg(a));const l=Pointk1.fromAffine({x:e,y:a});return l.assertValidity(),l}const num=bytesToNumberBE$1;function challenge(...e){return Pointk1.Fn.create(num(taggedHash("BIP0340/challenge",...e)))}function schnorrGetPublicKey(e){return schnorrGetExtPubKey(e).bytes}function schnorrSign(e,t,n=randomBytes$2(32)){const{Fn:s}=Pointk1,a=ensureBytes$1("message",e),{bytes:l,scalar:de}=schnorrGetExtPubKey(t),pe=ensureBytes$1("auxRand",n,32),me=s.toBytes(de^num(taggedHash("BIP0340/aux",pe))),Le=taggedHash("BIP0340/nonce",me,l,a),{bytes:Be,scalar:Ye}=schnorrGetExtPubKey(Le),tt=challenge(Be,l,a),nt=new Uint8Array(64);if(nt.set(Be,0),nt.set(s.toBytes(s.create(Ye+tt*de)),32),!schnorrVerify(nt,a,l))throw new Error("sign: Invalid signature produced");return nt}function schnorrVerify(e,t,n){const{Fn:s,BASE:a}=Pointk1,l=ensureBytes$1("signature",e,64),de=ensureBytes$1("message",t),pe=ensureBytes$1("publicKey",n,32);try{const me=lift_x(num(pe)),Le=num(l.subarray(0,32));if(!inRange(Le,_1n,secp256k1_CURVE.p))return!1;const Be=num(l.subarray(32,64));if(!inRange(Be,_1n,secp256k1_CURVE.n))return!1;const Ye=challenge(s.toBytes(Le),pointToBytes(me),de),tt=a.multiplyUnsafe(Be).add(me.multiplyUnsafe(s.neg(Ye))),{x:nt,y:ft}=tt.toAffine();return!(tt.is0()||!hasEven(ft)||nt!==Le)}catch{return!1}}const schnorr=(()=>{const n=(a=randomBytes$2(48))=>mapHashToField(a,secp256k1_CURVE.n);secp256k1.utils.randomSecretKey;function s(a){const l=n(a);return{secretKey:l,publicKey:schnorrGetPublicKey(l)}}return{keygen:s,getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,Point:Pointk1,utils:{randomSecretKey:n,randomPrivateKey:n,taggedHash,lift_x,pointToBytes,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,mod},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:32*2,seed:48}}})();var dist={},LRUCache$1={},LRUCacheNode$1={};Object.defineProperty(LRUCacheNode$1,"__esModule",{value:!0});LRUCacheNode$1.LRUCacheNode=void 0;class LRUCacheNode{constructor(t,n,s){const{entryExpirationTimeInMS:a=null,next:l=null,prev:de=null,onEntryEvicted:pe,onEntryMarkedAsMostRecentlyUsed:me,clone:Le,cloneFn:Be}=s??{};if(typeof a=="number"&&(a<=0||Number.isNaN(a)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=Le??!1,this.cloneFn=Be??this.defaultClone,this.key=t,this.internalValue=this.clone?this.cloneFn(n):n,this.created=Date.now(),this.entryExpirationTimeInMS=a,this.next=l,this.prev=de,this.onEntryEvicted=pe,this.onEntryMarkedAsMostRecentlyUsed=me}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:t,value:n,isExpired:s}=this;this.onEntryEvicted({key:t,value:n,isExpired:s})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:t,value:n}=this;this.onEntryMarkedAsMostRecentlyUsed({key:t,value:n})}}defaultClone(t){return typeof t=="boolean"||typeof t=="string"||typeof t=="number"?t:JSON.parse(JSON.stringify(t))}}LRUCacheNode$1.LRUCacheNode=LRUCacheNode;Object.defineProperty(LRUCache$1,"__esModule",{value:!0});LRUCache$1.LRUCache=void 0;const LRUCacheNode_1=LRUCacheNode$1;class LRUCache{constructor(t){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:n=25,entryExpirationTimeInMS:s=null,onEntryEvicted:a,onEntryMarkedAsMostRecentlyUsed:l,cloneFn:de,clone:pe}=t??{};if(Number.isNaN(n)||n<=0)throw new Error("maxSize must be greater than 0.");if(typeof s=="number"&&(s<=0||Number.isNaN(s)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=n,this.entryExpirationTimeInMS=s,this.onEntryEvicted=a,this.onEntryMarkedAsMostRecentlyUsed=l,this.clone=pe,this.cloneFn=de}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(t){if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=t,this.enforceSizeLimit()}set(t,n,s){const a=this.lookupTable.get(t);a&&this.removeNodeFromListAndLookupTable(a);const l=new LRUCacheNode_1.LRUCacheNode(t,n,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...s});return this.setNodeAsHead(l),this.lookupTable.set(t,l),this.enforceSizeLimit(),this}get(t){const n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),null):(this.setNodeAsHead(n),n.value):null}peek(t){const n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),null):n.value:null}delete(t){const n=this.lookupTable.get(t);return n?this.removeNodeFromListAndLookupTable(n):!1}has(t){const n=this.lookupTable.get(t);return n?n.isExpired?(this.removeNodeFromListAndLookupTable(n),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(t){let n=this.head;for(;n;){if(n.isExpired){const a=n.next;this.removeNodeFromListAndLookupTable(n),n=a;continue}const s=this.mapNodeToEntry(n);if(t(s))return this.setNodeAsHead(n),s;n=n.next}return null}forEach(t){let n=this.head,s=0;for(;n;){if(n.isExpired){const a=n.next;this.removeNodeFromListAndLookupTable(n),n=a;continue}t(n.value,n.key,s),n=n.next,s++}}*values(){let t=this.head;for(;t;){if(t.isExpired){const n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield t.value,t=t.next}}*keys(){let t=this.head;for(;t;){if(t.isExpired){const n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield t.key,t=t.next}}*entries(){let t=this.head;for(;t;){if(t.isExpired){const n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield this.mapNodeToEntry(t),t=t.next}}*[Symbol.iterator](){let t=this.head;for(;t;){if(t.isExpired){const n=t.next;this.removeNodeFromListAndLookupTable(t),t=n;continue}yield this.mapNodeToEntry(t),t=t.next}}enforceSizeLimit(){let t=this.tail;for(;t!==null&&this.size>this.maxSizeInternal;){const n=t.prev;this.removeNodeFromListAndLookupTable(t),t=n}}mapNodeToEntry({key:t,value:n}){return{key:t,value:n}}setNodeAsHead(t){this.removeNodeFromList(t),this.head?(t.next=this.head,this.head.prev=t,this.head=t):(this.head=t,this.tail=t),t.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(t){t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.head===t&&(this.head=t.next),this.tail===t&&(this.tail=t.prev),t.next=null,t.prev=null}removeNodeFromListAndLookupTable(t){return t.invokeOnEvicted(),this.removeNodeFromList(t),this.lookupTable.delete(t.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const t=[];for(const n of this.lookupTable.values())n.isExpired&&t.push(n);t.forEach(n=>this.removeNodeFromListAndLookupTable(n))}}LRUCache$1.LRUCache=LRUCache;(function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(s,a,l,de){de===void 0&&(de=l);var pe=Object.getOwnPropertyDescriptor(a,l);(!pe||("get"in pe?!a.__esModule:pe.writable||pe.configurable))&&(pe={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(s,de,pe)}:function(s,a,l,de){de===void 0&&(de=l),s[de]=a[l]}),n=commonjsGlobal&&commonjsGlobal.__exportStar||function(s,a){for(var l in s)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&t(a,s,l)};Object.defineProperty(e,"__esModule",{value:!0}),n(LRUCache$1,e)})(dist);var lib={};(function(e){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0;function t(vt){if(!Number.isSafeInteger(vt))throw new Error(`Wrong integer: ${vt}`)}e.assertNumber=t;function n(...vt){const kt=(ot,gt)=>Et=>ot(gt(Et)),wt=Array.from(vt).reverse().reduce((ot,gt)=>ot?kt(ot,gt.encode):gt.encode,void 0),bt=vt.reduce((ot,gt)=>ot?kt(ot,gt.decode):gt.decode,void 0);return{encode:wt,decode:bt}}function s(vt){return{encode:kt=>{if(!Array.isArray(kt)||kt.length&&typeof kt[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return kt.map(wt=>{if(t(wt),wt<0||wt>=vt.length)throw new Error(`Digit index outside alphabet: ${wt} (alphabet: ${vt.length})`);return vt[wt]})},decode:kt=>{if(!Array.isArray(kt)||kt.length&&typeof kt[0]!="string")throw new Error("alphabet.decode input should be array of strings");return kt.map(wt=>{if(typeof wt!="string")throw new Error(`alphabet.decode: not string element=${wt}`);const bt=vt.indexOf(wt);if(bt===-1)throw new Error(`Unknown letter: "${wt}". Allowed: ${vt}`);return bt})}}}function a(vt=""){if(typeof vt!="string")throw new Error("join separator should be string");return{encode:kt=>{if(!Array.isArray(kt)||kt.length&&typeof kt[0]!="string")throw new Error("join.encode input should be array of strings");for(let wt of kt)if(typeof wt!="string")throw new Error(`join.encode: non-string input=${wt}`);return kt.join(vt)},decode:kt=>{if(typeof kt!="string")throw new Error("join.decode input should be string");return kt.split(vt)}}}function l(vt,kt="="){if(t(vt),typeof kt!="string")throw new Error("padding chr should be string");return{encode(wt){if(!Array.isArray(wt)||wt.length&&typeof wt[0]!="string")throw new Error("padding.encode input should be array of strings");for(let bt of wt)if(typeof bt!="string")throw new Error(`padding.encode: non-string input=${bt}`);for(;wt.length*vt%8;)wt.push(kt);return wt},decode(wt){if(!Array.isArray(wt)||wt.length&&typeof wt[0]!="string")throw new Error("padding.encode input should be array of strings");for(let ot of wt)if(typeof ot!="string")throw new Error(`padding.decode: non-string input=${ot}`);let bt=wt.length;if(bt*vt%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;bt>0&&wt[bt-1]===kt;bt--)if(!((bt-1)*vt%8))throw new Error("Invalid padding: string has too much padding");return wt.slice(0,bt)}}}function de(vt){if(typeof vt!="function")throw new Error("normalize fn should be function");return{encode:kt=>kt,decode:kt=>vt(kt)}}function pe(vt,kt,wt){if(kt<2)throw new Error(`convertRadix: wrong from=${kt}, base cannot be less than 2`);if(wt<2)throw new Error(`convertRadix: wrong to=${wt}, base cannot be less than 2`);if(!Array.isArray(vt))throw new Error("convertRadix: data should be array");if(!vt.length)return[];let bt=0;const ot=[],gt=Array.from(vt);for(gt.forEach(Et=>{if(t(Et),Et<0||Et>=kt)throw new Error(`Wrong integer: ${Et}`)});;){let Et=0,xt=!0;for(let Ct=bt;Ct<gt.length;Ct++){const St=gt[Ct],$t=kt*Et+St;if(!Number.isSafeInteger($t)||kt*Et/kt!==Et||$t-St!==kt*Et)throw new Error("convertRadix: carry overflow");if(Et=$t%wt,gt[Ct]=Math.floor($t/wt),!Number.isSafeInteger(gt[Ct])||gt[Ct]*wt+Et!==$t)throw new Error("convertRadix: carry overflow");if(xt)gt[Ct]?xt=!1:bt=Ct;else continue}if(ot.push(Et),xt)break}for(let Et=0;Et<vt.length-1&&vt[Et]===0;Et++)ot.push(0);return ot.reverse()}const me=(vt,kt)=>kt?me(kt,vt%kt):vt,Le=(vt,kt)=>vt+(kt-me(vt,kt));function Be(vt,kt,wt,bt){if(!Array.isArray(vt))throw new Error("convertRadix2: data should be array");if(kt<=0||kt>32)throw new Error(`convertRadix2: wrong from=${kt}`);if(wt<=0||wt>32)throw new Error(`convertRadix2: wrong to=${wt}`);if(Le(kt,wt)>32)throw new Error(`convertRadix2: carry overflow from=${kt} to=${wt} carryBits=${Le(kt,wt)}`);let ot=0,gt=0;const Et=2**wt-1,xt=[];for(const Ct of vt){if(t(Ct),Ct>=2**kt)throw new Error(`convertRadix2: invalid data word=${Ct} from=${kt}`);if(ot=ot<<kt|Ct,gt+kt>32)throw new Error(`convertRadix2: carry overflow pos=${gt} from=${kt}`);for(gt+=kt;gt>=wt;gt-=wt)xt.push((ot>>gt-wt&Et)>>>0);ot&=2**gt-1}if(ot=ot<<wt-gt&Et,!bt&&gt>=kt)throw new Error("Excess padding");if(!bt&&ot)throw new Error(`Non-zero padding: ${ot}`);return bt&&gt>0&&xt.push(ot>>>0),xt}function Ye(vt){return t(vt),{encode:kt=>{if(!(kt instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return pe(Array.from(kt),2**8,vt)},decode:kt=>{if(!Array.isArray(kt)||kt.length&&typeof kt[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(pe(kt,vt,2**8))}}}function tt(vt,kt=!1){if(t(vt),vt<=0||vt>32)throw new Error("radix2: bits should be in (0..32]");if(Le(8,vt)>32||Le(vt,8)>32)throw new Error("radix2: carry overflow");return{encode:wt=>{if(!(wt instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Be(Array.from(wt),8,vt,!kt)},decode:wt=>{if(!Array.isArray(wt)||wt.length&&typeof wt[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Be(wt,vt,8,kt))}}}function nt(vt){if(typeof vt!="function")throw new Error("unsafeWrapper fn should be function");return function(...kt){try{return vt.apply(null,kt)}catch{}}}function ft(vt,kt){if(t(vt),typeof kt!="function")throw new Error("checksum fn should be function");return{encode(wt){if(!(wt instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const bt=kt(wt).slice(0,vt),ot=new Uint8Array(wt.length+vt);return ot.set(wt),ot.set(bt,wt.length),ot},decode(wt){if(!(wt instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const bt=wt.slice(0,-vt),ot=kt(bt).slice(0,vt),gt=wt.slice(-vt);for(let Et=0;Et<vt;Et++)if(ot[Et]!==gt[Et])throw new Error("Invalid checksum");return bt}}}e.utils={alphabet:s,chain:n,checksum:ft,radix:Ye,radix2:tt,join:a,padding:l},e.base16=n(tt(4),s("0123456789ABCDEF"),a("")),e.base32=n(tt(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),l(5),a("")),e.base32hex=n(tt(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),l(5),a("")),e.base32crockford=n(tt(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),a(""),de(vt=>vt.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),e.base64=n(tt(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),l(6),a("")),e.base64url=n(tt(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),l(6),a(""));const st=vt=>n(Ye(58),s(vt),a(""));e.base58=st("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=st("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=st("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const yt=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(vt){let kt="";for(let wt=0;wt<vt.length;wt+=8){const bt=vt.subarray(wt,wt+8);kt+=e.base58.encode(bt).padStart(yt[bt.length],"1")}return kt},decode(vt){let kt=[];for(let wt=0;wt<vt.length;wt+=11){const bt=vt.slice(wt,wt+11),ot=yt.indexOf(bt.length),gt=e.base58.decode(bt);for(let Et=0;Et<gt.length-ot;Et++)if(gt[Et]!==0)throw new Error("base58xmr: wrong padding");kt=kt.concat(Array.from(gt.slice(gt.length-ot)))}return Uint8Array.from(kt)}};const mt=vt=>n(ft(4,kt=>vt(vt(kt))),e.base58);e.base58check=mt;const _t=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),a("")),Rt=[996825010,642813549,513874426,1027748829,705979059];function At(vt){const kt=vt>>25;let wt=(vt&33554431)<<5;for(let bt=0;bt<Rt.length;bt++)(kt>>bt&1)===1&&(wt^=Rt[bt]);return wt}function Lt(vt,kt,wt=1){const bt=vt.length;let ot=1;for(let gt=0;gt<bt;gt++){const Et=vt.charCodeAt(gt);if(Et<33||Et>126)throw new Error(`Invalid prefix (${vt})`);ot=At(ot)^Et>>5}ot=At(ot);for(let gt=0;gt<bt;gt++)ot=At(ot)^vt.charCodeAt(gt)&31;for(let gt of kt)ot=At(ot)^gt;for(let gt=0;gt<6;gt++)ot=At(ot);return ot^=wt,_t.encode(Be([ot%2**30],30,5,!1))}function Tt(vt){const kt=vt==="bech32"?1:734539939,wt=tt(5),bt=wt.decode,ot=wt.encode,gt=nt(bt);function Et($t,Nt,jt=90){if(typeof $t!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof $t}`);if(!Array.isArray(Nt)||Nt.length&&typeof Nt[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof Nt}`);const Ft=$t.length+7+Nt.length;if(jt!==!1&&Ft>jt)throw new TypeError(`Length ${Ft} exceeds limit ${jt}`);return $t=$t.toLowerCase(),`${$t}1${_t.encode(Nt)}${Lt($t,Nt,kt)}`}function xt($t,Nt=90){if(typeof $t!="string")throw new Error(`bech32.decode input should be string, not ${typeof $t}`);if($t.length<8||Nt!==!1&&$t.length>Nt)throw new TypeError(`Wrong string length: ${$t.length} (${$t}). Expected (8..${Nt})`);const jt=$t.toLowerCase();if($t!==jt&&$t!==$t.toUpperCase())throw new Error("String must be lowercase or uppercase");$t=jt;const Ft=$t.lastIndexOf("1");if(Ft===0||Ft===-1)throw new Error('Letter "1" must be present between prefix and data only');const Ut=$t.slice(0,Ft),Ot=$t.slice(Ft+1);if(Ot.length<6)throw new Error("Data must be at least 6 characters long");const Dt=_t.decode(Ot).slice(0,-6),zt=Lt(Ut,Dt,kt);if(!Ot.endsWith(zt))throw new Error(`Invalid checksum in ${$t}: expected "${zt}"`);return{prefix:Ut,words:Dt}}const Ct=nt(xt);function St($t){const{prefix:Nt,words:jt}=xt($t,!1);return{prefix:Nt,words:jt,bytes:bt(jt)}}return{encode:Et,decode:xt,decodeToBytes:St,decodeUnsafe:Ct,fromWords:bt,fromWordsUnsafe:gt,toWords:ot}}e.bech32=Tt("bech32"),e.bech32m=Tt("bech32m"),e.utf8={encode:vt=>new TextDecoder().decode(vt),decode:vt=>new TextEncoder().encode(vt)},e.hex=n(tt(4),s("0123456789abcdef"),a(""),de(vt=>{if(typeof vt!="string"||vt.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof vt} with length ${vt.length}`);return vt.toLowerCase()}));const It={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},Bt=`Invalid encoding type. Available types: ${Object.keys(It).join(", ")}`,Mt=(vt,kt)=>{if(typeof vt!="string"||!It.hasOwnProperty(vt))throw new TypeError(Bt);if(!(kt instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return It[vt].encode(kt)};e.bytesToString=Mt,e.str=e.bytesToString;const Pt=(vt,kt)=>{if(!It.hasOwnProperty(vt))throw new TypeError(Bt);if(typeof kt!="string")throw new TypeError("stringToBytes() expects string");return It[vt].decode(kt)};e.stringToBytes=Pt,e.bytes=e.stringToBytes})(lib);const{bech32,hex,utf8}=lib,DEFAULTNETWORK={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},TESTNETWORK={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIGNETNETWORK={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},REGTESTNETWORK={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},SIMNETWORK={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},FEATUREBIT_ORDER=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],DIVISORS={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},MAX_MILLISATS=BigInt("2100000000000000000"),MILLISATS_PER_BTC=BigInt(1e11),TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},TAGNAMES={};for(let e=0,t=Object.keys(TAGCODES);e<t.length;e++){const n=t[e],s=TAGCODES[t[e]].toString();TAGNAMES[s]=n}const TAGPARSERS={1:e=>hex.encode(bech32.fromWordsUnsafe(e)),16:e=>hex.encode(bech32.fromWordsUnsafe(e)),13:e=>utf8.encode(bech32.fromWordsUnsafe(e)),19:e=>hex.encode(bech32.fromWordsUnsafe(e)),23:e=>hex.encode(bech32.fromWordsUnsafe(e)),27:e=>hex.encode(bech32.fromWordsUnsafe(e)),6:wordsToIntBE,24:wordsToIntBE,3:routingInfoParser,5:featureBitsParser};function getUnknownParser(e){return t=>({tagCode:parseInt(e),words:bech32.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function wordsToIntBE(e){return e.reverse().reduce((t,n,s)=>t+n*Math.pow(32,s),0)}function routingInfoParser(e){const t=[];let n,s,a,l,de,pe=bech32.fromWordsUnsafe(e);for(;pe.length>0;)n=hex.encode(pe.slice(0,33)),s=hex.encode(pe.slice(33,41)),a=parseInt(hex.encode(pe.slice(41,45)),16),l=parseInt(hex.encode(pe.slice(45,49)),16),de=parseInt(hex.encode(pe.slice(49,51)),16),pe=pe.slice(51),t.push({pubkey:n,short_channel_id:s,fee_base_msat:a,fee_proportional_millionths:l,cltv_expiry_delta:de});return t}function featureBitsParser(e){const t=e.slice().reverse().map(a=>[!!(a&1),!!(a&2),!!(a&4),!!(a&8),!!(a&16)]).reduce((a,l)=>a.concat(l),[]);for(;t.length<FEATUREBIT_ORDER.length*2;)t.push(!1);const n={};FEATUREBIT_ORDER.forEach((a,l)=>{let de;t[l*2]?de="required":t[l*2+1]?de="supported":de="unsupported",n[a]=de});const s=t.slice(FEATUREBIT_ORDER.length*2);return n.extra_bits={start_bit:FEATUREBIT_ORDER.length*2,bits:s,has_required:s.reduce((a,l,de)=>de%2!==0?a||!1:a||l,!1)},n}function hrpToMillisat(e,t){let n,s;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),s=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");s=e}if(!s.match(/^\d+$/))throw new Error("Not a valid human readable amount");const a=BigInt(s),l=n?a*MILLISATS_PER_BTC/DIVISORS[n]:a*MILLISATS_PER_BTC;if(n==="p"&&a%BigInt(10)!==BigInt(0)||l>MAX_MILLISATS)throw new Error("Amount is outside of valid range");return t?l.toString():l}function decode(e,t){if(typeof e!="string")throw new Error("Lightning Payment Request must be string");if(e.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const n=[],s=bech32.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const a=s.prefix;let l=s.words,de=e.slice(a.length+1),pe=l.slice(-104);l=l.slice(0,-104);let me=a.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(me&&!me[2]&&(me=a.match(/^ln(\S+)$/)),!me)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const Le=me[1];let Be;if(t){if(t.bech32===void 0||t.pubKeyHash===void 0||t.scriptHash===void 0||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");Be=t}else switch(Le){case DEFAULTNETWORK.bech32:Be=DEFAULTNETWORK;break;case TESTNETWORK.bech32:Be=TESTNETWORK;break;case SIGNETNETWORK.bech32:Be=SIGNETNETWORK;break;case REGTESTNETWORK.bech32:Be=REGTESTNETWORK;break;case SIMNETWORK.bech32:Be=SIMNETWORK;break}if(!Be||Be.bech32!==Le)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:Le,value:Be});const Ye=me[2];let tt;if(Ye){const At=me[3];tt=hrpToMillisat(Ye+At,!0),n.push({name:"amount",letters:me[2]+me[3],value:tt})}else tt=null;n.push({name:"separator",letters:"1"});const nt=wordsToIntBE(l.slice(0,7));l=l.slice(7),n.push({name:"timestamp",letters:de.slice(0,7),value:nt}),de=de.slice(7);let ft,st,yt,mt;for(;l.length>0;){const At=l[0].toString();ft=TAGNAMES[At]||"unknown_tag",st=TAGPARSERS[At]||getUnknownParser(At),l=l.slice(1),yt=wordsToIntBE(l.slice(0,2)),l=l.slice(2),mt=l.slice(0,yt),l=l.slice(yt),n.push({name:ft,tag:de[0],letters:de.slice(0,3+yt),value:st(mt)}),de=de.slice(3+yt)}n.push({name:"signature",letters:de.slice(0,104),value:hex.encode(bech32.fromWordsUnsafe(pe))}),de=de.slice(104),n.push({name:"checksum",letters:de});let _t={paymentRequest:e,sections:n,get expiry(){let At=n.find(Lt=>Lt.name==="expiry");if(At)return Rt("timestamp")+At.value},get route_hints(){return n.filter(At=>At.name==="route_hint").map(At=>At.value)}};for(let At in TAGCODES)At!=="route_hint"&&Object.defineProperty(_t,At,{get(){return Rt(At)}});return _t;function Rt(At){let Lt=n.find(Tt=>Tt.name===At);return Lt?Lt.value:void 0}}var bolt11={decode,hrpToMillisat},NDKKind=(e=>(e[e.Metadata=0]="Metadata",e[e.Text=1]="Text",e[e.RecommendRelay=2]="RecommendRelay",e[e.Contacts=3]="Contacts",e[e.EncryptedDirectMessage=4]="EncryptedDirectMessage",e[e.EventDeletion=5]="EventDeletion",e[e.Repost=6]="Repost",e[e.Reaction=7]="Reaction",e[e.BadgeAward=8]="BadgeAward",e[e.GroupChat=9]="GroupChat",e[e.Thread=11]="Thread",e[e.GroupReply=12]="GroupReply",e[e.GiftWrapSeal=13]="GiftWrapSeal",e[e.PrivateDirectMessage=14]="PrivateDirectMessage",e[e.Image=20]="Image",e[e.Video=21]="Video",e[e.ShortVideo=22]="ShortVideo",e[e.Story=23]="Story",e[e.Vanish=62]="Vanish",e[e.CashuWalletBackup=375]="CashuWalletBackup",e[e.GiftWrap=1059]="GiftWrap",e[e.GenericRepost=16]="GenericRepost",e[e.ChannelCreation=40]="ChannelCreation",e[e.ChannelMetadata=41]="ChannelMetadata",e[e.ChannelMessage=42]="ChannelMessage",e[e.ChannelHideMessage=43]="ChannelHideMessage",e[e.ChannelMuteUser=44]="ChannelMuteUser",e[e.WikiMergeRequest=818]="WikiMergeRequest",e[e.GenericReply=1111]="GenericReply",e[e.Media=1063]="Media",e[e.DraftCheckpoint=1234]="DraftCheckpoint",e[e.Task=1934]="Task",e[e.Report=1984]="Report",e[e.Label=1985]="Label",e[e.DVMReqTextExtraction=5e3]="DVMReqTextExtraction",e[e.DVMReqTextSummarization=5001]="DVMReqTextSummarization",e[e.DVMReqTextTranslation=5002]="DVMReqTextTranslation",e[e.DVMReqTextGeneration=5050]="DVMReqTextGeneration",e[e.DVMReqImageGeneration=5100]="DVMReqImageGeneration",e[e.DVMReqTextToSpeech=5250]="DVMReqTextToSpeech",e[e.DVMReqDiscoveryNostrContent=5300]="DVMReqDiscoveryNostrContent",e[e.DVMReqDiscoveryNostrPeople=5301]="DVMReqDiscoveryNostrPeople",e[e.DVMReqTimestamping=5900]="DVMReqTimestamping",e[e.DVMEventSchedule=5905]="DVMEventSchedule",e[e.DVMJobFeedback=7e3]="DVMJobFeedback",e[e.Subscribe=7001]="Subscribe",e[e.Unsubscribe=7002]="Unsubscribe",e[e.SubscriptionReceipt=7003]="SubscriptionReceipt",e[e.CashuReserve=7373]="CashuReserve",e[e.CashuQuote=7374]="CashuQuote",e[e.CashuToken=7375]="CashuToken",e[e.CashuWalletTx=7376]="CashuWalletTx",e[e.GroupAdminAddUser=9e3]="GroupAdminAddUser",e[e.GroupAdminRemoveUser=9001]="GroupAdminRemoveUser",e[e.GroupAdminEditMetadata=9002]="GroupAdminEditMetadata",e[e.GroupAdminEditStatus=9006]="GroupAdminEditStatus",e[e.GroupAdminCreateGroup=9007]="GroupAdminCreateGroup",e[e.GroupAdminRequestJoin=9021]="GroupAdminRequestJoin",e[e.MuteList=1e4]="MuteList",e[e.PinList=10001]="PinList",e[e.RelayList=10002]="RelayList",e[e.BookmarkList=10003]="BookmarkList",e[e.CommunityList=10004]="CommunityList",e[e.PublicChatList=10005]="PublicChatList",e[e.BlockRelayList=10006]="BlockRelayList",e[e.SearchRelayList=10007]="SearchRelayList",e[e.SimpleGroupList=10009]="SimpleGroupList",e[e.InterestList=10015]="InterestList",e[e.CashuMintList=10019]="CashuMintList",e[e.EmojiList=10030]="EmojiList",e[e.DirectMessageReceiveRelayList=10050]="DirectMessageReceiveRelayList",e[e.BlossomList=10063]="BlossomList",e[e.NostrWaletConnectInfo=13194]="NostrWaletConnectInfo",e[e.TierList=17e3]="TierList",e[e.CashuWallet=17375]="CashuWallet",e[e.FollowSet=3e4]="FollowSet",e[e.CategorizedPeopleList=3e4]="CategorizedPeopleList",e[e.CategorizedBookmarkList=30001]="CategorizedBookmarkList",e[e.RelaySet=30002]="RelaySet",e[e.CategorizedRelayList=30002]="CategorizedRelayList",e[e.BookmarkSet=30003]="BookmarkSet",e[e.CurationSet=30004]="CurationSet",e[e.ArticleCurationSet=30004]="ArticleCurationSet",e[e.VideoCurationSet=30005]="VideoCurationSet",e[e.ImageCurationSet=30006]="ImageCurationSet",e[e.InterestSet=30015]="InterestSet",e[e.InterestsList=30015]="InterestsList",e[e.ProjectTemplate=30717]="ProjectTemplate",e[e.EmojiSet=30030]="EmojiSet",e[e.ModularArticle=30040]="ModularArticle",e[e.ModularArticleItem=30041]="ModularArticleItem",e[e.Wiki=30818]="Wiki",e[e.Draft=31234]="Draft",e[e.Project=31933]="Project",e[e.SubscriptionTier=37001]="SubscriptionTier",e[e.EcashMintRecommendation=38e3]="EcashMintRecommendation",e[e.HighlightSet=39802]="HighlightSet",e[e.CategorizedHighlightList=39802]="CategorizedHighlightList",e[e.Nutzap=9321]="Nutzap",e[e.ZapRequest=9734]="ZapRequest",e[e.Zap=9735]="Zap",e[e.Highlight=9802]="Highlight",e[e.ClientAuth=22242]="ClientAuth",e[e.NostrWalletConnectReq=23194]="NostrWalletConnectReq",e[e.NostrWalletConnectRes=23195]="NostrWalletConnectRes",e[e.NostrConnect=24133]="NostrConnect",e[e.BlossomUpload=24242]="BlossomUpload",e[e.HttpAuth=27235]="HttpAuth",e[e.ProfileBadge=30008]="ProfileBadge",e[e.BadgeDefinition=30009]="BadgeDefinition",e[e.MarketStall=30017]="MarketStall",e[e.MarketProduct=30018]="MarketProduct",e[e.Article=30023]="Article",e[e.AppSpecificData=30078]="AppSpecificData",e[e.Classified=30402]="Classified",e[e.HorizontalVideo=34235]="HorizontalVideo",e[e.VerticalVideo=34236]="VerticalVideo",e[e.LegacyCashuWallet=37375]="LegacyCashuWallet",e[e.GroupMetadata=39e3]="GroupMetadata",e[e.GroupAdmins=39001]="GroupAdmins",e[e.GroupMembers=39002]="GroupMembers",e[e.FollowPack=39089]="FollowPack",e[e.MediaFollowPack=39092]="MediaFollowPack",e[e.AppRecommendation=31989]="AppRecommendation",e[e.AppHandler=31990]="AppHandler",e))(NDKKind||{});function getRelaysForSync(e,t,n="write"){if(!e.outboxTracker)return;const s=e.outboxTracker.data.get(t);if(s)return n==="write"?s.writeRelays:s.readRelays}async function getWriteRelaysFor(e,t,n="write"){if(e.outboxTracker)return e.outboxTracker.data.has(t)||await e.outboxTracker.trackUsers([t]),getRelaysForSync(e,t,n)}function getTopRelaysForAuthors(e,t){const n=new Map;return t.forEach(a=>{const l=getRelaysForSync(e,a);l&&l.forEach(de=>{const pe=n.get(de)||0;n.set(de,pe+1)})}),Array.from(n.entries()).sort((a,l)=>l[1]-a[1]).map(a=>a[0])}function getAllRelaysForAllPubkeys(e,t,n="read"){const s=new Map,a=new Set;return t.forEach(l=>{const de=getRelaysForSync(e,l,n);de&&de.size>0?(de.forEach(pe=>{(s.get(pe)||new Set).add(l)}),s.set(l,de)):a.add(l)}),{pubkeysToRelays:s,authorsMissingRelays:a}}function chooseRelayCombinationForPubkeys(e,t,n,{count:s,preferredRelays:a}={}){s??(s=2),a??(a=new Set);const l=e.pool,de=l.connectedRelays();de.forEach(tt=>{a==null||a.add(tt.url)});const pe=new Map,{pubkeysToRelays:me,authorsMissingRelays:Le}=getAllRelaysForAllPubkeys(e,t,n),Be=getTopRelaysForAuthors(e,t),Ye=(tt,nt)=>{const ft=pe.get(nt)||[];ft.push(tt),pe.set(nt,ft)};for(const[tt,nt]of me.entries()){let ft=s;for(const st of de)nt.has(st.url)&&(Ye(tt,st.url),ft--);for(const st of nt)pe.has(st)&&(Ye(tt,st),ft--);if(!(ft<=0))for(const st of Be){if(ft<=0)break;nt.has(st)&&(Ye(tt,st),ft--)}}for(const tt of Le)l.permanentAndConnectedRelays().forEach(nt=>{const ft=pe.get(nt.url)||[];ft.push(tt),pe.set(nt.url,ft)});return pe}function getRelaysForFilterWithAuthors(e,t,n=2){return chooseRelayCombinationForPubkeys(e,t,"write",{count:n})}function tryNormalizeRelayUrl(e){try{return normalizeRelayUrl(e)}catch{return}}function normalizeRelayUrl(e){let t=normalizeUrl(e,{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function normalize(e){const t=new Set;for(const n of e)try{t.add(normalizeRelayUrl(n))}catch{}return Array.from(t)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(e,t)=>t.some(n=>n instanceof RegExp?n.test(e):n===e),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=e=>{try{const{protocol:t}=new URL(e);return t.endsWith(":")&&!t.includes(".")&&!supportedProtocols.has(t)}catch{return!1}},normalizeDataURL=(e,{stripHash:t})=>{var Ye,tt,nt,ft;const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!n)throw new Error(`Invalid URL: ${e}`);const s=((Ye=n.groups)==null?void 0:Ye.type)??"",a=((tt=n.groups)==null?void 0:tt.data)??"";let l=((nt=n.groups)==null?void 0:nt.hash)??"";const de=s.split(";");l=t?"":l;let pe=!1;de[de.length-1]==="base64"&&(de.pop(),pe=!0);const me=((ft=de.shift())==null?void 0:ft.toLowerCase())??"",Be=[...de.map(st=>{let[yt,mt=""]=st.split("=").map(_t=>_t.trim());return yt==="charset"&&(mt=mt.toLowerCase(),mt===DATA_URL_DEFAULT_CHARSET)?"":`${yt}${mt?`=${mt}`:""}`}).filter(Boolean)];return pe&&Be.push("base64"),(Be.length>0||me&&me!==DATA_URL_DEFAULT_MIME_TYPE)&&Be.unshift(me),`data:${Be.join(";")},${pe?a.trim():a}${l?`#${l}`:""}`};function normalizeUrl(e,t={}){if(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t},typeof t.defaultProtocol=="string"&&!t.defaultProtocol.endsWith(":")&&(t.defaultProtocol=`${t.defaultProtocol}:`),e=e.trim(),/^data:/i.test(e))return normalizeDataURL(e,t);if(hasCustomProtocol(e))return e;const n=e.startsWith("//");!n&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const a=new URL(e);if(a.hostname=a.hostname.toLowerCase(),t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&a.protocol==="https:"&&(a.protocol="http:"),t.forceHttps&&a.protocol==="http:"&&(a.protocol="https:"),t.stripAuthentication&&(a.username="",a.password=""),t.stripHash?a.hash="":t.stripTextFragment&&(a.hash=a.hash.replace(/#?:~:text.*?$/i,"")),a.pathname){const de=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let pe=0,me="";for(;;){const Be=de.exec(a.pathname);if(!Be)break;const Ye=Be[0],tt=Be.index,nt=a.pathname.slice(pe,tt);me+=nt.replace(/\/{2,}/g,"/"),me+=Ye,pe=tt+Ye.length}const Le=a.pathname.slice(pe,a.pathname.length);me+=Le.replace(/\/{2,}/g,"/"),a.pathname=me}if(a.pathname)try{a.pathname=decodeURI(a.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let de=a.pathname.split("/");const pe=de[de.length-1];testParameter(pe,t.removeDirectoryIndex)&&(de=de.slice(0,-1),a.pathname=`${de.slice(1).join("/")}/`)}if(a.hostname&&(a.hostname=a.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(a.hostname)&&(a.hostname=a.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const de of[...a.searchParams.keys()])testParameter(de,t.removeQueryParameters)&&a.searchParams.delete(de);if(!Array.isArray(t.keepQueryParameters)&&t.removeQueryParameters===!0&&(a.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const de of[...a.searchParams.keys()])testParameter(de,t.keepQueryParameters)||a.searchParams.delete(de);if(t.sortQueryParameters){a.searchParams.sort();try{a.search=decodeURIComponent(a.search)}catch{}}t.removeTrailingSlash&&(a.pathname=a.pathname.replace(/\/$/,"")),t.removeExplicitPort&&a.port&&(a.port="");const l=e;return e=a.toString(),!t.removeSingleSlash&&a.pathname==="/"&&!l.endsWith("/")&&a.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||a.pathname==="/")&&a.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var NDKRelayKeepalive=class{constructor(e=3e4,t){ht(this,"lastActivity",Date.now());ht(this,"timer");ht(this,"timeout");ht(this,"isRunning",!1);this.onSilenceDetected=t,this.timeout=e}recordActivity(){this.lastActivity=Date.now(),this.isRunning&&this.resetTimer()}start(){this.isRunning||(this.isRunning=!0,this.lastActivity=Date.now(),this.resetTimer())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=void 0)}resetTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{const e=Date.now()-this.lastActivity;if(e>=this.timeout)this.onSilenceDetected();else{const t=this.timeout-e;this.timer=setTimeout(()=>{this.onSilenceDetected()},t)}},this.timeout)}};async function probeRelayConnection(e){const t=`probe-${Math.random().toString(36).substring(7)}`;return new Promise(n=>{let s=!1;const a=setTimeout(()=>{s||(s=!0,e.send(["CLOSE",t]),n(!1))},5e3),l=()=>{s||(s=!0,clearTimeout(a),e.send(["CLOSE",t]),n(!0))};e.once("message",l),e.send(["REQ",t,{kinds:[99999],limit:0}])})}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(e,t){ht(this,"ndkRelay");ht(this,"ws");ht(this,"_status");ht(this,"timeoutMs");ht(this,"connectedAt");ht(this,"_connectionStats",{attempts:0,success:0,durations:[]});ht(this,"debug");ht(this,"netDebug");ht(this,"connectTimeout");ht(this,"reconnectTimeout");ht(this,"ndk");ht(this,"openSubs",new Map);ht(this,"openCountRequests",new Map);ht(this,"openEventPublishes",new Map);ht(this,"serial",0);ht(this,"baseEoseTimeout",4400);ht(this,"keepalive");ht(this,"wsStateMonitor");ht(this,"sleepDetector");ht(this,"lastSleepCheck",Date.now());ht(this,"lastMessageSent",Date.now());ht(this,"wasIdle",!1);ht(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=e,this._status=1;const n=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend(`connectivity${n}`),this.ndk=t,this.setupMonitoring()}setupMonitoring(){this.keepalive=new NDKRelayKeepalive(3e4,async()=>{this.debug("Relay silence detected, probing connection"),await probeRelayConnection({send:t=>this.send(JSON.stringify(t)),once:(t,n)=>{var a;const s=l=>{var de;try{const pe=JSON.parse(l.data);(pe[0]==="EOSE"||pe[0]==="EVENT"||pe[0]==="NOTICE")&&(n(),(de=this.ws)==null||de.removeEventListener("message",s))}catch{}};(a=this.ws)==null||a.addEventListener("message",s)}})||(this.debug("Probe failed, connection is stale"),this.handleStaleConnection())}),this.wsStateMonitor=setInterval(()=>{this._status===5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.debug("WebSocket died silently, reconnecting"),this.handleStaleConnection())},5e3),this.sleepDetector=setInterval(()=>{const e=Date.now(),t=e-this.lastSleepCheck;t>15e3&&(this.debug(`Detected possible sleep/wake (${t}ms gap)`),this.handlePossibleWake()),this.lastSleepCheck=e},1e4)}handleStaleConnection(){this._status=1,this.wasIdle=!0,this.onDisconnect()}handlePossibleWake(){this.debug("System wake detected, checking all connections"),this.wasIdle=!0,this._status>=5&&(!this.ws||this.ws.readyState!==WebSocket.OPEN?this.handleStaleConnection():probeRelayConnection({send:e=>this.send(JSON.stringify(e)),once:(e,t)=>{var s;const n=a=>{var l;try{const de=JSON.parse(a.data);(de[0]==="EOSE"||de[0]==="EVENT"||de[0]==="NOTICE")&&(t(),(l=this.ws)==null||l.removeEventListener("message",n))}catch{}};(s=this.ws)==null||s.addEventListener("message",n)}}).then(e=>{e||this.handleStaleConnection()}))}resetReconnectionState(){this.wasIdle=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0)}async connect(e,t=!0){if(this.ws&&this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING){this.debug("Cleaning up stale WebSocket connection");try{this.ws.close()}catch{}this.ws=void 0,this._status=1}if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),e??(e=this.timeoutMs),!this.timeoutMs&&e&&(this.timeoutMs=e),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(t),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(n){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,n),this._status=1,t?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),n}}disconnect(){var e,t;this._status=0,(e=this.keepalive)==null||e.stop(),this.wsStateMonitor&&(clearInterval(this.wsStateMonitor),this.wsStateMonitor=void 0),this.sleepDetector&&(clearInterval(this.sleepDetector),this.sleepDetector=void 0);try{(t=this.ws)==null||t.close()}catch(n){this.debug("Failed to disconnect",n),this._status=1}}onConnectionError(e){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),e&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var e,t;(e=this.netDebug)==null||e.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,(t=this.keepalive)==null||t.start(),this.wasIdle=!1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var e,t;(e=this.netDebug)==null||e.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),(t=this.keepalive)==null||t.stop(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(e){var t,n;(t=this.netDebug)==null||t.call(this,e.data,this.ndkRelay,"recv"),(n=this.keepalive)==null||n.recordActivity();try{const s=JSON.parse(e.data),[a,l,...de]=s;switch(a){case"EVENT":{const pe=this.openSubs.get(l),me=s[2];if(!pe){this.debug(`Received event for unknown subscription ${l}`);return}pe.onevent(me);return}case"COUNT":{const pe=s[2],me=this.openCountRequests.get(l);me&&(me.resolve(pe.count),this.openCountRequests.delete(l));return}case"EOSE":{const pe=this.openSubs.get(l);if(!pe)return;pe.oneose(l);return}case"OK":{const pe=s[2],me=s[3],Le=this.openEventPublishes.get(l),Be=Le==null?void 0:Le.pop();if(!Le||!Be){this.debug("Received OK for unknown event publish",l);return}pe?Be.resolve(me):Be.reject(new Error(me)),Le.length===0?this.openEventPublishes.delete(l):this.openEventPublishes.set(l,Le);return}case"CLOSED":{const pe=this.openSubs.get(l);if(!pe)return;pe.onclosed(s[2]);return}case"NOTICE":this.onNotice(s[1]);return;case"AUTH":{this.onAuthRequested(s[1]);return}}}catch(s){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${s.message}`,s==null?void 0:s.stack);return}}async onAuthRequested(e){var n,s,a;const t=this.ndkRelay.authPolicy??((n=this.ndk)==null?void 0:n.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!t}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,t){if(this._status>=5){this._status=7;let l;try{l=await t(this.ndkRelay,e)}catch(de){this.debug("Authentication policy threw an error",de),l=!1}if(this.debug("Authentication policy returned",!!l),l instanceof NDKEvent||l===!0){l instanceof NDKEvent&&await this.auth(l);const de=async()=>{if(this._status>=5&&this._status<8){const pe=new NDKEvent(this.ndk);pe.kind=22242,pe.tags=[["relay",this.ndkRelay.url],["challenge",e]],await pe.sign(),this.auth(pe).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(me=>{this._status=6,this.ndkRelay.emit("auth:failed",me),this.debug("Authentication failed",me)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};l===!0&&((s=this.ndk)!=null&&s.signer?de().catch(pe=>{console.error("Error authenticating",pe)}):(this.debug("No signer available for authentication localhost"),(a=this.ndk)==null||a.once("signer:ready",de))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",e)}onError(e){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,e)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const e=this._connectionStats.durations;if(e.length%3!==0)return!1;const n=e.reduce((de,pe)=>de+pe,0)/e.length,s=e.map(de=>(de-n)**2).reduce((de,pe)=>de+pe,0)/e.length;return Math.sqrt(s)<FLAPPING_THRESHOLD_MS}async onNotice(e){this.ndkRelay.emit("notice",e)}handleReconnection(e=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}let t;if(this.wasIdle){const n=[0,1e3,2e3,5e3,1e4,3e4];t=n[Math.min(e,n.length-1)],this.debug(`Using aggressive reconnect after idle, attempt ${e}, delay ${t}ms`)}else this.connectedAt?t=Math.max(0,6e4-(Date.now()-this.connectedAt)):(t=Math.min(1e3*Math.pow(2,e),3e4),this.debug(`Using standard backoff, attempt ${e}, delay ${t}ms`));this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(n=>{e<MAX_RECONNECT_ATTEMPTS?this.handleReconnection(e+1):(this.debug("Max reconnect attempts reached"),this.wasIdle=!1)})},t),this.ndkRelay.emit("delayed-connect",t),this.debug("Reconnecting in",t),this._connectionStats.nextReconnectAt=Date.now()+t}async send(e){var n,s,a,l,de;Date.now()-this.lastMessageSent>12e4&&(this.wasIdle=!0),this._status>=5&&((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN?((s=this.ws)==null||s.send(e),(a=this.netDebug)==null||a.call(this,e,this.ndkRelay,"send"),this.lastMessageSent=Date.now()):(this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${e}`,this._status),this._status>=5&&((l=this.ws)==null?void 0:l.readyState)!==WebSocket.OPEN&&(this.debug(`Stale connection detected, WebSocket state: ${(de=this.ws)==null?void 0:de.readyState}`),this.handleStaleConnection()))}async auth(e){const t=new Promise((n,s)=>{const a=this.openEventPublishes.get(e.id)??[];a.push({resolve:n,reject:s}),this.openEventPublishes.set(e.id,a)});return this.send(`["AUTH",${JSON.stringify(e.rawEvent())}]`),t}async publish(e){const t=new Promise((n,s)=>{const a=this.openEventPublishes.get(e.id)??[];a.length>0&&console.warn(`Duplicate event publishing detected, you are publishing event ${e.id} twice`),a.push({resolve:n,reject:s}),this.openEventPublishes.set(e.id,a)});return this.send(`["EVENT",${JSON.stringify(e)}]`),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||`count:${this.serial}`,s=new Promise((a,l)=>{this.openCountRequests.set(n,{resolve:a,reject:l})});return this.send(`["COUNT","${n}",${JSON.stringify(e).substring(1)}`),s}close(e,t){this.send(`["CLOSE","${e}"]`);const n=this.openSubs.get(e);this.openSubs.delete(e),n&&n.onclose(t)}req(e){`${this.send(`["REQ","${e.subId}",${JSON.stringify(e.executeFilters).substring(1)}`)}`,this.openSubs.set(e.subId,e)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var e;return this._status>=5&&((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(e){ht(this,"ndkRelay");ht(this,"debug");this.ndkRelay=e,this.debug=e.debug.extend("publisher")}async publish(e,t=2500){let n;const s=()=>new Promise((Be,Ye)=>{try{this.publishEvent(e).then(tt=>{this.ndkRelay.emit("published",e),e.emit("relay:published",this.ndkRelay),Be(!0)}).catch(Ye)}catch(tt){Ye(tt)}}),a=new Promise((Be,Ye)=>{n=setTimeout(()=>{n=void 0,Ye(new Error(`Timeout: ${t}ms`))},t)}),l=()=>{s().then(Be=>de(Be)).catch(Be=>pe(Be))};let de,pe;const me=Be=>{throw this.ndkRelay.debug("Publish failed",Be,e.id),this.ndkRelay.emit("publish:failed",e,Be),e.emit("relay:publish:failed",this.ndkRelay,Be),Be},Le=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",l)};return this.ndkRelay.status>=5?Promise.race([s(),a]).catch(me).finally(Le):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((Be,Ye)=>{de=Be,pe=Ye,this.ndkRelay.on("connect",l)}),a]).catch(me).finally(Le))}async publishEvent(e){return this.ndkRelay.connectivity.publish(e.rawEvent())}};function filterFingerprint(e,t){const n=[];for(const a of e){const l=Object.entries(a||{}).map(([de,pe])=>["since","until"].includes(de)?`${de}:${pe}`:de).sort().join("-");n.push(l)}let s=t?"+":"";return s+=n.join("|"),s}function mergeFilters(e){const t=[],n={};return e.filter(s=>!!s.limit).forEach(s=>t.push(s)),e=e.filter(s=>!s.limit),e.length===0?t:(e.forEach(s=>{Object.entries(s).forEach(([a,l])=>{Array.isArray(l)?n[a]===void 0?n[a]=[...l]:n[a]=Array.from(new Set([...n[a],...l])):n[a]=l})}),[...t,n])}var NDKRelaySubscription=class{constructor(e,t,n){ht(this,"fingerprint");ht(this,"items",new Map);ht(this,"topSubManager");ht(this,"debug");ht(this,"status",0);ht(this,"onClose");ht(this,"relay");ht(this,"eosed",!1);ht(this,"executionTimer");ht(this,"fireTime");ht(this,"delayType");ht(this,"executeFilters");ht(this,"id",Math.random().toString(36).substring(7));ht(this,"_subId");ht(this,"subIdParts",new Set);ht(this,"executeOnRelayReady",()=>{if(this.status===2){if(this.items.size===0){this.debug("No items to execute; this relay was probably too slow to respond and the caller gave up",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size,id:this.id,subId:this.subId}),this.cleanup();return}this.debug("Executing on relay ready",{status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.status=1,this.execute()}});ht(this,"reExecuteAfterAuth",(()=>{const e=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:e}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",e,this.subId)}).bind(this));this.relay=e,this.topSubManager=n,this.debug=e.debug.extend(`sub[${this.id}]`),this.fingerprint=t||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(e){this.subIdParts.add(e)}addItem(e,t){if(this.debug("Adding item",{filters:t,internalId:e.internalId,status:this.status,fingerprint:this.fingerprint,id:this.subId,items:this.items,itemsSize:this.items.size}),!this.items.has(e.internalId))switch(e.on("close",this.removeItem.bind(this,e)),this.items.set(e.internalId,{subscription:e,filters:t}),this.status!==3&&e.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(e.subId),this.status){case 0:this.evaluateExecutionPlan(e);break;case 3:break;case 1:this.evaluateExecutionPlan(e);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",e,t),new Error("Cannot add new items to a closed subscription")}}removeItem(e){if(this.items.delete(e.internalId),this.items.size===0){if(!this.eosed)return;this.close(),this.cleanup()}}close(){if(this.status===4)return;const e=this.status;if(this.status=4,e===3)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:e,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(e){if(!e.isGroupable()){this.status=1,this.execute();return}if(e.filters.find(s=>!!s.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const t=e.groupableDelay,n=e.groupableDelayType;if(!t)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(t,n);else{const s=this.delayType,a=this.fireTime-Date.now();if(s==="at-least"&&n==="at-least")a<t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-least"&&n==="at-most")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-most"&&n==="at-most")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else if(s==="at-most"&&n==="at-least")a>t&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(t,n));else throw new Error(`Unknown delay type combination ${s} ${n}`)}}schedule(e,t){this.status=1;const n=Date.now();this.fireTime=n+e,this.delayType=t;const s=setTimeout(this.execute.bind(this),e);t==="at-least"&&(this.executionTimer=s)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+=`-${Math.random().toString(36).substring(2,7)}`}execute(){if(this.status===1){if(!this.relay.connected){this.status=2,this.debug("Waiting for relay to be ready",{status:this.status,id:this.subId,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.relay.once("ready",this.executeOnRelayReady);return}this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(e){this.topSubManager.dispatchEvent(e,this.relay)}oneose(e){if(this.eosed=!0,e!==this.subId){this.debug("Received EOSE for an abandoned subscription",e,this.subId),this.relay.close(e);return}this.items.size===0&&this.close();for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&(this.debug("Removing item because of EOSE",{filters:t.filters,internalId:t.internalId,status:this.status,fingerprint:this.fingerprint,items:this.items,itemsSize:this.items.size}),this.removeItem(t))}onclose(e){this.status=4}onclosed(e){if(e)for(const{subscription:t}of this.items.values())t.closedReceived(this.relay,e)}compileFilters(){const e=[],t=Array.from(this.items.values()).map(s=>s.filters);if(!t[0])return this.debug(" No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const n=t[0].length;for(let s=0;s<n;s++){const a=t.map(l=>l[s]);e.push(...mergeFilters(a))}return e}},NDKRelaySubscriptionManager=class{constructor(e,t){ht(this,"relay");ht(this,"subscriptions");ht(this,"generalSubManager");this.relay=e,this.subscriptions=new Map,this.generalSubManager=t}addSubscription(e,t){let n;if(!e.isGroupable())n=this.createSubscription(e,t);else{const s=filterFingerprint(t,e.closeOnEose);s&&(n=(this.subscriptions.get(s)||[]).find(l=>l.status<3)),n??(n=this.createSubscription(e,t,s))}n.addItem(e,t)}createSubscription(e,t,n){const s=new NDKRelaySubscription(this.relay,n||null,this.generalSubManager);s.onClose=this.onRelaySubscriptionClose.bind(this);const a=this.subscriptions.get(s.fingerprint)??[];return this.subscriptions.set(s.fingerprint,[...a,s]),s}onRelaySubscriptionClose(e){let t=this.subscriptions.get(e.fingerprint)??[];t?t.length===1?this.subscriptions.delete(e.fingerprint):(t=t.filter(n=>n.id!==e.id),this.subscriptions.set(e.fingerprint,t)):console.warn("Unexpectedly did not find a subscription with fingerprint",e.fingerprint)}},gn,NDKRelay=(gn=class extends lib$1.EventEmitter{constructor(n,s,a){super();ht(this,"url");ht(this,"scores");ht(this,"connectivity");ht(this,"subs");ht(this,"publisher");ht(this,"authPolicy");ht(this,"lowestValidationRatio");ht(this,"targetValidationRatio");ht(this,"validationRatioFn");ht(this,"validatedEventCount",0);ht(this,"nonValidatedEventCount",0);ht(this,"trusted",!1);ht(this,"complaining",!1);ht(this,"debug");ht(this,"req");ht(this,"close");this.url=normalizeRelayUrl(n),this.scores=new Map,this.debug=createDebug5(`ndk:relay:${n}`),this.connectivity=new NDKRelayConnectivity(this,a),this.connectivity.netDebug=a==null?void 0:a.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,a.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=s,this.targetValidationRatio=a==null?void 0:a.initialValidationRatio,this.lowestValidationRatio=a==null?void 0:a.lowestValidationRatio,this.validationRatioFn=((a==null?void 0:a.validationRatioFn)??gn.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),a||console.trace("relay created without ndk")}updateValidationRatio(){if(this.validationRatioFn&&this.validatedEventCount>0){const n=this.validationRatioFn(this,this.validatedEventCount,this.nonValidatedEventCount);this.targetValidationRatio=n}setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(n,s=!0){return this.connectivity.connect(n,s)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(n,s){this.subs.addSubscription(n,s)}async publish(n,s=2500){return this.publisher.publish(n,s)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0||this.targetValidationRatio>=1?!0:Math.random()<this.targetValidationRatio}get connected(){return this.connectivity.connected}},ht(gn,"defaultValidationRatioUpdateFn",(n,s,a)=>{if(n.lowestValidationRatio===void 0||n.targetValidationRatio===void 0)return 1;let l=n.validationRatio;if(n.validationRatio>n.targetValidationRatio){const de=s/100;l=Math.max(n.lowestValidationRatio,n.validationRatio-de)}return l<n.validationRatio?l:n.validationRatio}),gn),NDKPublishError=class extends Error{constructor(t,n,s,a){super(t);ht(this,"errors");ht(this,"publishedToRelays");ht(this,"intendedRelaySet");this.errors=n,this.publishedToRelays=s,this.intendedRelaySet=a}get relayErrors(){const t=[];for(const[n,s]of this.errors)t.push(`${n.url}: ${s}`);return t.join(`
`)}},NDKRelaySet=class kn{constructor(t,n,s){ht(this,"relays");ht(this,"debug");ht(this,"ndk");ht(this,"pool");this.relays=t,this.ndk=n,this.pool=s??n.pool,this.debug=n.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map(t=>t.url)}static fromRelayUrls(t,n,s=!0,a){if(a=a??n.pool,!a)throw new Error("No pool provided");const l=new Set;for(const de of t){const pe=a.relays.get(normalizeRelayUrl(de));if(pe)pe.status<5&&s&&pe.connect(),l.add(pe);else{const me=new NDKRelay(normalizeRelayUrl(de),n==null?void 0:n.relayAuthDefaultPolicy,n);a.useTemporaryRelay(me,void 0,`requested from fromRelayUrls ${t}`),l.add(me)}}return new kn(new Set(l),n,a)}async publish(t,n,s=1){var me;const a=new Set,l=new Map,de=t.isEphemeral();t.publishStatus="pending";const pe=Le=>{a.add(Le)};t.on("relay:published",pe);try{const Le=Array.from(this.relays).map(Be=>new Promise(Ye=>{const tt=n?setTimeout(()=>{a.has(Be)||(l.set(Be,new Error(`Publish timeout after ${n}ms`)),Ye(!1))},n):null;Be.publish(t,n).then(nt=>{tt&&clearTimeout(tt),nt?(a.add(Be),Ye(!0)):Ye(!1)}).catch(nt=>{tt&&clearTimeout(tt),de||l.set(Be,nt),Ye(!1)})}));if(await Promise.all(Le),a.size<s){if(!de){const Be=new NDKPublishError("Not enough relays received the event ("+a.size+" published, "+s+" required)",l,a,this);throw t.publishStatus="error",t.publishError=Be,(me=this.ndk)==null||me.emit("event:publish-failed",t,Be,this.relayUrls),Be}}else t.publishStatus="success",t.emit("published",{relaySet:this,publishedToRelays:a});return a}finally{t.off("relay:published",pe)}}get size(){return this.relays.size}},d=createDebug5("ndk:outbox:calculate");async function calculateRelaySetFromEvent(e,t,n){var pe,me;const s=new Set,a=await getWriteRelaysFor(e,t.pubkey);a&&a.forEach(Le=>{var Ye;const Be=(Ye=e.pool)==null?void 0:Ye.getRelay(Le);Be&&s.add(Be)});let l=t.tags.filter(Le=>["a","e"].includes(Le[0])).map(Le=>Le[2]).filter(Le=>Le==null?void 0:Le.startsWith("wss://")).filter(Le=>{try{return new URL(Le),!0}catch{return!1}}).map(Le=>normalizeRelayUrl(Le));l=Array.from(new Set(l)).slice(0,5),l.forEach(Le=>{var Ye;const Be=(Ye=e.pool)==null?void 0:Ye.getRelay(Le,!0,!0);Be&&(d("Adding relay hint %s",Le),s.add(Be))});const de=t.getMatchingTags("p").map(Le=>Le[1]);if(de.length<5?Array.from(chooseRelayCombinationForPubkeys(e,de,"read",{preferredRelays:new Set(a)}).keys()).forEach(Be=>{var tt;const Ye=(tt=e.pool)==null?void 0:tt.getRelay(Be,!1,!0);Ye&&(d("Adding p-tagged relay %s",Be),s.add(Ye))}):d("Too many p-tags to consider %d",de.length),(pe=e.pool)==null||pe.permanentAndConnectedRelays().forEach(Le=>s.add(Le)),n&&s.size<n){const Le=(me=e.explicitRelayUrls)==null?void 0:me.filter(Be=>!Array.from(s).some(Ye=>Ye.url===Be)).slice(0,n-s.size);Le==null||Le.forEach(Be=>{var tt;const Ye=(tt=e.pool)==null?void 0:tt.getRelay(Be,!1,!0);Ye&&(d("Adding explicit relay %s",Be),s.add(Ye))})}return new NDKRelaySet(s,e)}function calculateRelaySetsFromFilter(e,t,n){const s=new Map,a=new Set;if(t.forEach(l=>{l.authors&&l.authors.forEach(de=>a.add(de))}),a.size>0){const l=getRelaysForFilterWithAuthors(e,Array.from(a));for(const de of l.keys())s.set(de,[]);for(const de of t)if(de.authors)for(const[pe,me]of l.entries()){const Le=de.authors.filter(Be=>me.includes(Be));s.set(pe,[...s.get(pe),{...de,authors:Le}])}else for(const pe of l.keys())s.set(pe,[...s.get(pe),de])}else e.explicitRelayUrls&&e.explicitRelayUrls.forEach(l=>{s.set(l,t)});return s.size===0&&n.permanentAndConnectedRelays().slice(0,5).forEach(l=>{s.set(l.url,t)}),s}function calculateRelaySetsFromFilters(e,t,n){return calculateRelaySetsFromFilter(e,t,n)}function mergeTags(e,t){const n=new Map,s=de=>de.join(","),a=(de,pe)=>de.every((me,Le)=>me===pe[Le]),l=de=>{for(const[pe,me]of n)if(a(me,de)||a(de,me)){de.length>=me.length&&n.set(pe,de);return}n.set(s(de),de)};return e.concat(t).forEach(l),Array.from(n.values())}var hashtagRegex=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g");function generateHashtags(e){const t=e.match(hashtagRegex),n=new Set,s=new Set;if(t)for(const a of t)n.has(a.slice(1))||(s.add(a.slice(1)),n.add(a.slice(1)));return Array.from(s)}async function generateContentTags(e,t=[],n,s){var pe,me;if(n!=null&&n.skipContentTagging)return{content:e,tags:t};const a=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,l=[],de=Le=>{t.find(Be=>["q",Le[0]].includes(Be[0])&&Be[1]===Le[1])||t.push(Le)};if(e=e.replace(a,Le=>{var Be;try{const Ye=Le.split(/(@|nostr:)/)[2],{type:tt,data:nt}=nip19_exports.decode(Ye);let ft;if(n!=null&&n.filters){const st=!n.filters.includeTypes||n.filters.includeTypes.includes(tt),yt=(Be=n.filters.excludeTypes)==null?void 0:Be.includes(tt);if(!st||yt)return Le}switch(tt){case"npub":(n==null?void 0:n.pTags)!==!1&&(ft=["p",nt]);break;case"nprofile":(n==null?void 0:n.pTags)!==!1&&(ft=["p",nt.pubkey]);break;case"note":l.push(new Promise(async st=>{const yt=await maybeGetEventRelayUrl(Ye);de(["q",nt,yt]),st()}));break;case"nevent":l.push(new Promise(async st=>{const{id:yt,author:mt}=nt;let{relays:_t}=nt;(!_t||_t.length===0)&&(_t=[await maybeGetEventRelayUrl(Ye)]),de(["q",yt,_t[0]]),mt&&(n==null?void 0:n.pTags)!==!1&&(n==null?void 0:n.pTagOnQTags)!==!1&&de(["p",mt]),st()}));break;case"naddr":l.push(new Promise(async st=>{const yt=[nt.kind,nt.pubkey,nt.identifier].join(":");let mt=nt.relays??[];mt.length===0&&(mt=[await maybeGetEventRelayUrl(Ye)]),de(["q",yt,mt[0]]),(n==null?void 0:n.pTags)!==!1&&(n==null?void 0:n.pTagOnQTags)!==!1&&(n==null?void 0:n.pTagOnATags)!==!1&&de(["p",nt.pubkey]),st()}));break;default:return Le}return ft&&de(ft),`nostr:${Ye}`}catch{return Le}}),await Promise.all(l),!((me=(pe=n==null?void 0:n.filters)==null?void 0:pe.excludeTypes)!=null&&me.includes("hashtag"))){const Le=generateHashtags(e).map(Be=>["t",Be]);t=mergeTags(t,Le)}if((n==null?void 0:n.pTags)!==!1&&(n!=null&&n.copyPTagsFromTarget)&&s){const Le=s.getMatchingTags("p");for(const Be of Le)t.find(Ye=>Ye[0]==="p"&&Ye[1]===Be[1])||t.push(Be)}return{content:e,tags:t}}async function maybeGetEventRelayUrl(e){return""}async function encrypt(e,t,n="nip44"){let s;if(!this.ndk)throw new Error("No NDK instance found!");let a=t;if(a||(this.ndk.assertSigner(),a=this.ndk.signer),!a)throw new Error("no NDK signer");const l=e||(()=>{const de=this.getMatchingTags("p");if(de.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");return this.ndk.getUser({pubkey:de[0][1]})})();if(n==="nip44"&&await isEncryptionEnabled(a,"nip44")&&(s=await a.encrypt(l,this.content,"nip44")),(!s||n==="nip04")&&await isEncryptionEnabled(a,"nip04")&&(s=await a.encrypt(l,this.content,"nip04")),!s)throw new Error("Failed to encrypt event.");this.content=s}async function decrypt(e,t,n){var pe,me,Le,Be;if((me=(pe=this.ndk)==null?void 0:pe.cacheAdapter)!=null&&me.getDecryptedEvent){let Ye=null;if(typeof this.ndk.cacheAdapter.getDecryptedEvent=="function"&&(Ye=this.ndk.cacheAdapter.getDecryptedEvent(this.id)),Ye){this.content=Ye.content;return}}let s;if(!this.ndk)throw new Error("No NDK instance found!");let a=t;if(a||(this.ndk.assertSigner(),a=this.ndk.signer),!a)throw new Error("no NDK signer");const l=e||this.author;if(!l)throw new Error("No sender provided and no author available");const de=n||(this.content.match(/\\?iv=/)?"nip04":"nip44");if((de==="nip04"||this.kind===4)&&await isEncryptionEnabled(a,"nip04")&&this.content.search("\\?iv=")&&(s=await a.decrypt(l,this.content,"nip04")),!s&&de==="nip44"&&await isEncryptionEnabled(a,"nip44")&&(s=await a.decrypt(l,this.content,"nip44")),!s)throw new Error("Failed to decrypt event.");this.content=s,(Be=(Le=this.ndk)==null?void 0:Le.cacheAdapter)!=null&&Be.addDecryptedEvent&&this.ndk.cacheAdapter.addDecryptedEvent(this)}async function isEncryptionEnabled(e,t){return e.encryptionEnabled?t?!!await e.encryptionEnabled(t):!0:!1}function eventHasETagMarkers(e){for(const t of e.tags)if(t[0]==="e"&&(t[3]??"").length>0)return!0;return!1}function getRootTag(e,t){t??(t=e.tagType());const n=e.tags.find(isTagRootTag);if(!n){if(eventHasETagMarkers(e))return;const s=e.getMatchingTags(t);if(s.length<3)return s[0]}return n}var nip22RootTags=new Set(["A","E","I"]),nip22ReplyTags=new Set(["a","e","i"]);function getReplyTag(e,t){if(e.kind===1111){let a;for(const l of e.tags)if(nip22RootTags.has(l[0]))a=l;else if(nip22ReplyTags.has(l[0])){a=l;break}return a}t??(t=e.tagType());let n=!1,s;for(const a of e.tags)if(a[0]===t){if((a[3]??"").length>0&&(n=!0),n&&a[3]==="reply")return a;n&&a[3]==="root"&&(s=a),n||(s=a)}return s}function isTagRootTag(e){return e[0]==="E"||e[3]==="root"}async function fetchTaggedEvent(e,t){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(e,t);if(n.length===0)return;const[s,a,l]=n[0];let de=l!==""?this.ndk.pool.getRelay(l):void 0;return await this.ndk.fetchEvent(a,{},de)}async function fetchRootEvent(e){if(!this.ndk)throw new Error("NDK instance not found");const t=getRootTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,e)}async function fetchReplyEvent(e){if(!this.ndk)throw new Error("NDK instance not found");const t=getReplyTag(this);if(t)return this.ndk.fetchEventFromTag(t,this,e)}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_RELAY_COUNT=2;function encode(e=DEFAULT_RELAY_COUNT){let t=[];return this.onRelays.length>0?t=this.onRelays.map(n=>n.url):this.relay&&(t=[this.relay.url]),t.length>e&&(t=t.slice(0,e)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(e=!0,t){if(!t&&e){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const n=new NDKEvent(this.ndk,{kind:getKind(this)});return this.isProtected||(n.content=JSON.stringify(this.rawEvent())),n.tag(this),this.kind!==1&&n.tags.push(["k",`${this.kind}`]),t&&await n.sign(t),e&&await n.publish(),n}function getKind(e){return e.kind===1?6:16}function serialize(e=!1,t=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return e&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}function deserialize(e){const t=JSON.parse(e),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};if(t.length>=7){const s=t[6],a=t[7];s&&s.length===128?(n.sig=s,a&&a.length===64&&(n.id=a)):s&&s.length===64&&(n.id=s,a&&a.length===128&&(n.sig=a))}return n}var worker,processingQueue={};function signatureVerificationInit(e){worker=e,worker.onmessage=t=>{const[n,s]=t.data,a=processingQueue[n];if(!a){console.error("No record found for event",n);return}delete processingQueue[n];for(const l of a.resolves)l(s)}}async function verifySignatureAsync(e,t,n){const s=e.ndk,a=Date.now();let l;return s.signatureVerificationFunction?(console.log("[NDK-CORE] Using custom signature verification function async"),l=await s.signatureVerificationFunction(e),console.log("Custom signature verification result",e.id,{result:l})):(console.log("Using worker-based signature verification async"),l=await new Promise(de=>{const pe=e.serialize();let me=!1;processingQueue[e.id]||(processingQueue[e.id]={event:e,resolves:[],relay:n},me=!0),processingQueue[e.id].resolves.push(de),me&&(worker==null||worker.postMessage({serialized:pe,id:e.id,sig:e.sig,pubkey:e.pubkey}))})),s.signatureVerificationTimeMs+=Date.now()-a,l}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let e=0;e<this.tags.length;e++){const t=this.tags[e];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]=="object")return!1}return!0}var verifiedSignatures=new dist.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(e){var n;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const t=verifiedSignatures.get(this.id);if(t!==null)return this.signatureVerified=!!t,this.signatureVerified;try{if((n=this.ndk)!=null&&n.asyncSigVerification)verifySignatureAsync(this,e,this.relay).then(s=>{var a,l;e&&(this.signatureVerified=s,s&&verifiedSignatures.set(this.id,this.sig)),s||(this.relay?(a=this.ndk)==null||a.reportInvalidSignature(this,this.relay):(l=this.ndk)==null||l.reportInvalidSignature(this),verifiedSignatures.set(this.id,!1))}).catch(s=>{console.error("signature verification error",this.id,s)});else{const s=sha256$3(new TextEncoder().encode(this.serialize())),a=schnorr.verify(this.sig,s,this.pubkey);return a?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=a,a}}catch{return this.signatureVerified=!1,!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(e){const t=sha256$3(new TextEncoder().encode(e));return bytesToHex$2(t)}var skipClientTagOnKinds=new Set([0,4,1059,13,3,9734,5]),NDKEvent=class pn extends lib$1.EventEmitter{constructor(n,s){var a;super();ht(this,"ndk");ht(this,"created_at");ht(this,"content","");ht(this,"tags",[]);ht(this,"kind");ht(this,"id","");ht(this,"sig");ht(this,"pubkey","");ht(this,"signatureVerified");ht(this,"_author");ht(this,"relay");ht(this,"publishStatus","success");ht(this,"publishError");ht(this,"serialize",serialize.bind(this));ht(this,"getEventHash",getEventHash.bind(this));ht(this,"validate",validate.bind(this));ht(this,"verifySignature",verifySignature.bind(this));ht(this,"isReplaceable",isReplaceable.bind(this));ht(this,"isEphemeral",isEphemeral.bind(this));ht(this,"isDvm",()=>this.kind&&this.kind>=5e3&&this.kind<=7e3);ht(this,"isParamReplaceable",isParamReplaceable.bind(this));ht(this,"encode",encode.bind(this));ht(this,"encrypt",encrypt.bind(this));ht(this,"decrypt",decrypt.bind(this));ht(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));ht(this,"fetchRootEvent",fetchRootEvent.bind(this));ht(this,"fetchReplyEvent",fetchReplyEvent.bind(this));ht(this,"repost",repost.bind(this));this.ndk=n,this.created_at=s==null?void 0:s.created_at,this.content=(s==null?void 0:s.content)||"",this.tags=(s==null?void 0:s.tags)||[],this.id=(s==null?void 0:s.id)||"",this.sig=s==null?void 0:s.sig,this.pubkey=(s==null?void 0:s.pubkey)||"",this.kind=s==null?void 0:s.kind,s instanceof pn&&(this.relay&&(this.relay=s.relay,(a=this.ndk)==null||a.subManager.seenEvent(s.id,this.relay)),this.publishStatus=s.publishStatus,this.publishError=s.publishError)}get onRelays(){let n=[];return this.ndk?n=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&n.push(this.relay),n}static deserialize(n,s){return new pn(n,deserialize(s))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(n){var s;this.pubkey=n.pubkey,this._author=n,(s=this._author).ndk??(s.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const n=this.ndk.getUser({pubkey:this.pubkey});return this._author=n,n}tagExternal(n,s,a){const l=["i"],de=["k"];switch(s){case"url":{const pe=new URL(n);pe.hash="",l.push(pe.toString()),de.push(`${pe.protocol}//${pe.host}`);break}case"hashtag":l.push(`#${n.toLowerCase()}`),de.push("#");break;case"geohash":l.push(`geo:${n.toLowerCase()}`),de.push("geo");break;case"isbn":l.push(`isbn:${n.replace(/-/g,"")}`),de.push("isbn");break;case"podcast:guid":l.push(`podcast:guid:${n}`),de.push("podcast:guid");break;case"podcast:item:guid":l.push(`podcast:item:guid:${n}`),de.push("podcast:item:guid");break;case"podcast:publisher:guid":l.push(`podcast:publisher:guid:${n}`),de.push("podcast:publisher:guid");break;case"isan":l.push(`isan:${n.split("-").slice(0,4).join("-")}`),de.push("isan");break;case"doi":l.push(`doi:${n.toLowerCase()}`),de.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${s}`)}a&&l.push(a),this.tags.push(l),this.tags.push(de)}tag(n,s,a,l,de){let pe=[];if(n.fetchProfile!==void 0){if(l??(l="p"),l==="p"&&(de==null?void 0:de.pTags)===!1)return;const Le=[l,n.pubkey];s&&Le.push("",s),pe.push(Le)}else if(n instanceof pn){const Le=n;if(a??(a=(Le==null?void 0:Le.pubkey)===this.pubkey),pe=Le.referenceTags(s,a,l,de),(de==null?void 0:de.pTags)!==!1)for(const Be of Le.getMatchingTags("p"))Be[1]!==this.pubkey&&(this.tags.find(Ye=>Ye[0]==="p"&&Ye[1]===Be[1])||this.tags.push(["p",Be[1]]))}else if(Array.isArray(n))pe=[n];else throw new Error("Invalid argument",n);this.tags=mergeTags(this.tags,pe)}async toNostrEvent(n,s){var de,pe;if(!n&&this.pubkey===""){const me=await((pe=(de=this.ndk)==null?void 0:de.signer)==null?void 0:pe.user());this.pubkey=(me==null?void 0:me.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:a,tags:l}=await this.generateTags(s);this.content=a||"",this.tags=l;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(n,s){const a=this.tags.filter(l=>l[0]===n);return s===void 0?a:a.filter(l=>l[3]===s)}hasTag(n,s){return this.tags.some(a=>a[0]===n&&(!s||a[3]===s))}tagValue(n,s){const a=this.getMatchingTags(n,s);if(a.length!==0)return a[0][1]}get alt(){return this.tagValue("alt")}set alt(n){this.removeTag("alt"),n&&this.tags.push(["alt",n])}get dTag(){return this.tagValue("d")}set dTag(n){this.removeTag("d"),n&&this.tags.push(["d",n])}removeTag(n,s){const a=Array.isArray(n)?n:[n];this.tags=this.tags.filter(l=>{const de=a.includes(l[0]),pe=s?l[3]===s:!0;return!(de&&pe)})}replaceTag(n){this.removeTag(n[0]),this.tags.push(n)}async sign(n,s){var l,de;n?this.author=await n.user():((l=this.ndk)==null||l.assertSigner(),n=(de=this.ndk)==null?void 0:de.signer);const a=await this.toNostrEvent(void 0,s);return this.sig=await n.sign(a),this.sig}async publishReplaceable(n,s,a){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(n,s,a)}async publish(n,s,a,l){var me,Le,Be;if(a||(a=1),this.sig||await this.sign(void 0,l),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");if((!n||n.size===0)&&(n=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this,a)),this.kind===5&&((me=this.ndk.cacheAdapter)!=null&&me.deleteEventIds)){const Ye=this.getMatchingTags("e").map(tt=>tt[1]);this.ndk.cacheAdapter.deleteEventIds(Ye)}const de=this.rawEvent();if((Le=this.ndk.cacheAdapter)!=null&&Le.addUnpublishedEvent&&shouldTrackUnpublishedEvent(this))try{this.ndk.cacheAdapter.addUnpublishedEvent(this,n.relayUrls)}catch(Ye){console.error("Error adding unpublished event to cache",Ye)}this.kind===5&&((Be=this.ndk.cacheAdapter)!=null&&Be.deleteEventIds)&&this.ndk.cacheAdapter.deleteEventIds(this.getMatchingTags("e").map(Ye=>Ye[1])),this.ndk.subManager.dispatchEvent(de,void 0,!0);const pe=await n.publish(this,s,a);return pe.forEach(Ye=>{var tt;return(tt=this.ndk)==null?void 0:tt.subManager.seenEvent(this.id,Ye)}),pe}async generateTags(n){var de,pe,me;let s=[];const a=await generateContentTags(this.content,this.tags,n,this),l=a.content;if(s=a.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const Be=this.tagValue("title");let tt=[...Array(Be?6:16)].map(()=>Math.random().toString(36)[2]).join("");Be&&Be.length>0&&(tt=`${Be.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")}-${tt}`),s.push(["d",tt])}if(this.shouldAddClientTag){const Le=["client",((de=this.ndk)==null?void 0:de.clientName)??""];(pe=this.ndk)!=null&&pe.clientNip89&&Le.push((me=this.ndk)==null?void 0:me.clientNip89),s.push(Le)}else this.shouldStripClientTag&&(s=s.filter(Le=>Le[0]!=="client"));return{content:l||"",tags:s}}get shouldAddClientTag(){var n,s;return!(!((n=this.ndk)!=null&&n.clientName)&&!((s=this.ndk)!=null&&s.clientNip89)||skipClientTagOnKinds.has(this.kind)||this.isEphemeral()||this.isReplaceable()&&!this.isParamReplaceable()||this.isDvm()||this.hasTag("client"))}get shouldStripClientTag(){return skipClientTagOnKinds.has(this.kind)}muted(){var l,de;const n=(l=this.ndk)==null?void 0:l.mutedIds.get(this.pubkey);if(n&&n==="p")return"author";const s=this.tagReference(),a=(de=this.ndk)==null?void 0:de.mutedIds.get(s[1]);return a&&a===s[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const n=this.getMatchingTags("d")[0];return n?n[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(this.isParamReplaceable()){const n=this.dTag??"";return`${this.kind}:${this.pubkey}:${n}`}if(this.isReplaceable())return`${this.kind}:${this.pubkey}:`;throw new Error("Event is not a replaceable event")}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(n){let s;return this.isParamReplaceable()?s=["a",this.tagAddress()]:s=["e",this.tagId()],this.relay?s.push(this.relay.url):s.push(""),s.push(n??""),this.isParamReplaceable()||s.push(this.pubkey),s}referenceTags(n,s,a,l){let de=[];return this.isParamReplaceable()?de=[[a??"a",this.tagAddress()],[a??"e",this.id]]:de=[[a??"e",this.id]],de=de.map(pe=>{var me,Le,Be;return pe[0]==="e"||n?pe.push(((me=this.relay)==null?void 0:me.url)??""):(Le=this.relay)!=null&&Le.url&&pe.push((Be=this.relay)==null?void 0:Be.url),pe}),de.forEach(pe=>{pe[0]==="e"?(pe.push(n??""),pe.push(this.pubkey)):n&&pe.push(n)}),de=[...de,...this.getMatchingTags("h")],!s&&(l==null?void 0:l.pTags)!==!1&&de.push(...this.author.referenceTags()),de}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}nip22Filter(){return this.isParamReplaceable()?{"#A":[this.tagId()]}:{"#E":[this.tagId()]}}async delete(n,s=!0){var l;if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const a=new pn(this.ndk,{kind:5,content:n||""});return a.tag(this,void 0,!0),a.tags.push(["k",(l=this.kind)==null?void 0:l.toString()]),s&&(this.emit("deleted"),await a.publish()),a}set isProtected(n){this.removeTag("-"),n&&this.tags.push(["-"])}get isProtected(){return this.hasTag("-")}async react(n,s=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const a=new pn(this.ndk,{kind:7,content:n});return a.tag(this),this.kind!==1&&a.tags.push(["k",`${this.kind}`]),s&&await a.publish(),a}get isValid(){return this.validate()}get inspect(){return JSON.stringify(this.rawEvent(),null,4)}dump(){console.debug(JSON.stringify(this.rawEvent(),null,4)),console.debug("Event on relays:",this.onRelays.map(n=>n.url).join(", "))}reply(n,s){var l,de,pe,me,Le;const a=new pn(this.ndk);if(this.kind===1&&!n)a.kind=1,this.hasTag("e")?a.tags=[...a.tags,...this.getMatchingTags("e"),...this.getMatchingTags("p"),...this.getMatchingTags("a"),...this.referenceTags("reply",!1,void 0,s)]:a.tag(this,"root",!1,void 0,s);else{a.kind=1111;const Be=["A","E","I","P"],Ye=this.tags.filter(tt=>Be.includes(tt[0]));if(Ye.length>0){const tt=this.tagValue("K");a.tags.push(...Ye),tt&&a.tags.push(["K",tt]);let nt;if(this.isParamReplaceable()){nt=["a",this.tagAddress()];const ft=((l=this.relay)==null?void 0:l.url)??"";ft&&nt.push(ft)}else{nt=["e",this.tagId()];const ft=((de=this.relay)==null?void 0:de.url)??"";nt.push(ft),nt.push(this.pubkey)}a.tags.push(nt)}else{let tt,nt;const ft=((pe=this.relay)==null?void 0:pe.url)??"";this.isParamReplaceable()?(tt=["a",this.tagAddress(),ft],nt=["A",this.tagAddress(),ft]):(tt=["e",this.tagId(),ft,this.pubkey],nt=["E",this.tagId(),ft,this.pubkey]),a.tags.push(tt),a.tags.push(nt),a.tags.push(["K",(me=this.kind)==null?void 0:me.toString()]),(s==null?void 0:s.pTags)!==!1&&(s==null?void 0:s.pTagOnATags)!==!1&&a.tags.push(["P",this.pubkey])}a.tags.push(["k",(Le=this.kind)==null?void 0:Le.toString()]),(s==null?void 0:s.pTags)!==!1&&(a.tags.push(...this.getMatchingTags("p")),a.tags.push(["p",this.pubkey]))}return a}},untrackedUnpublishedEvents=new Set([24133,13194,23194,23195]);function shouldTrackUnpublishedEvent(e){return!untrackedUnpublishedEvents.has(e.kind)}var NDKPool=class extends lib$1.EventEmitter{constructor(t,n,s,{debug:a,name:l}={}){super();ht(this,"_relays",new Map);ht(this,"status","idle");ht(this,"autoConnectRelays",new Set);ht(this,"poolBlacklistRelayUrls",new Set);ht(this,"debug");ht(this,"temporaryRelayTimers",new Map);ht(this,"flappingRelays",new Set);ht(this,"backoffTimes",new Map);ht(this,"ndk");ht(this,"disconnectionTimes",new Map);ht(this,"systemEventDetector");ht(this,"_name","unnamed");this.debug=a??s.debug.extend("pool"),l&&(this._name=l),this.ndk=s,this.relayUrls=t,this.poolBlacklistRelayUrls=new Set(n),this.ndk.pools.push(this)}get blacklistRelayUrls(){const t=new Set(this.ndk.blacklistRelayUrls);return this.poolBlacklistRelayUrls.forEach(n=>t.add(n)),t}get relays(){return this._relays}set relayUrls(t){this._relays.clear();for(const n of t){const s=new NDKRelay(n,void 0,this.ndk);s.connectivity.netDebug=this.ndk.netDebug,this.addRelay(s)}}get name(){return this._name}set name(t){this._name=t,this.debug=this.debug.extend(t)}useTemporaryRelay(t,n=3e4,s){const a=this.relays.has(t.url);a||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,s));const l=this.temporaryRelayTimers.get(t.url);if(l&&clearTimeout(l),!a||l){const de=setTimeout(()=>{var pe;(pe=this.ndk.explicitRelayUrls)!=null&&pe.includes(t.url)||this.removeRelay(t.url)},n);this.temporaryRelayTimers.set(t.url,de)}}addRelay(t,n=!0){var st,yt;const s=this.relays.has(t.url),a=(st=this.blacklistRelayUrls)==null?void 0:st.has(t.url),l=t.url.includes("/npub1");let de=!0;const pe=t.url;if(s)return;if(a){this.debug(`Refusing to add relay ${pe}: blacklisted`);return}if(l){this.debug(`Refusing to add relay ${pe}: is a filter relay`);return}if((yt=this.ndk.cacheAdapter)!=null&&yt.getRelayStatus){const mt=this.ndk.cacheAdapter.getRelayStatus(pe);if(mt!=null&&mt.dontConnectBefore){if(mt.dontConnectBefore>Date.now()){const _t=mt.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${pe}: delayed connect for ${_t}ms`),setTimeout(()=>{this.addRelay(t,n)},_t);return}de=!1}}const me=mt=>this.emit("notice",t,mt),Le=()=>this.handleRelayConnect(pe),Be=()=>this.handleRelayReady(t),Ye=()=>{this.recordDisconnection(t),this.emit("relay:disconnect",t)},tt=()=>this.handleFlapping(t),nt=mt=>this.emit("relay:auth",t,mt),ft=()=>this.emit("relay:authed",t);t.off("notice",me),t.off("connect",Le),t.off("ready",Be),t.off("disconnect",Ye),t.off("flapping",tt),t.off("auth",nt),t.off("authed",ft),t.on("notice",me),t.on("connect",Le),t.on("ready",Be),t.on("disconnect",Ye),t.on("flapping",tt),t.on("auth",nt),t.on("authed",ft),t.on("delayed-connect",mt=>{var _t;(_t=this.ndk.cacheAdapter)!=null&&_t.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+mt})}),this._relays.set(pe,t),n&&this.autoConnectRelays.add(pe),n&&this.status==="active"&&(this.emit("relay:connecting",t),t.connect(void 0,de).catch(mt=>{this.debug(`Failed to connect to relay ${pe}`,mt)}))}removeRelay(t){const n=this.relays.get(t);if(n)return n.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",n),!0;const s=this.temporaryRelayTimers.get(t);return s&&(clearTimeout(s),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const n=normalizeRelayUrl(t),s=this.relays.get(n);return s?s.status===5:!1}getRelay(t,n=!0,s=!1,a){let l=this.relays.get(normalizeRelayUrl(t));return l||(l=new NDKRelay(t,void 0,this.ndk),l.connectivity.netDebug=this.ndk.netDebug,s?this.useTemporaryRelay(l,3e4,a):this.addRelay(l,n)),l}handleRelayConnect(t){const n=this.relays.get(t);if(!n){console.error("NDK BUG: relay not found in pool",{relayUrl:t});return}this.emit("relay:connect",n),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){this.status="active",this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}ms`:""}...`);const n=Array.from(this.autoConnectRelays.keys()).map(de=>this.relays.get(de)).filter(de=>!!de);for(const de of n)de.status!==5&&de.status!==4&&(this.emit("relay:connecting",de),de.connect().catch(pe=>{this.debug(`Failed to connect to relay ${de.url}: ${pe??"No reason specified"}`)}));const s=()=>n.every(de=>de.status===5),a=new Promise(de=>{if(s()){de();return}const pe=[];for(const me of n){const Le=()=>{if(s()){for(let Be=0;Be<n.length;Be++)n[Be].off("connect",pe[Be]);de()}};pe.push(Le),me.on("connect",Le)}}),l=typeof t=="number"?new Promise(de=>setTimeout(de,t)):new Promise(()=>{});await Promise.race([a,l])}checkOnFlappingRelays(){const t=this.flappingRelays.size,n=this.relays.size;if(t/n>=.8)for(const s of this.flappingRelays)this.backoffTimes.set(s,0)}recordDisconnection(t){const n=Date.now();this.disconnectionTimes.set(t.url,n);for(const[s,a]of this.disconnectionTimes.entries())n-a>1e4&&this.disconnectionTimes.delete(s);this.checkForSystemWideDisconnection()}checkForSystemWideDisconnection(){const t=Date.now(),n=[];for(const s of this.disconnectionTimes.values())t-s<5e3&&n.push(s);n.length>this.relays.size/2&&this.relays.size>1&&(this.debug(`System-wide disconnection detected: ${n.length}/${this.relays.size} relays disconnected`),this.handleSystemWideReconnection())}handleSystemWideReconnection(){this.debug("Initiating system-wide reconnection with reset backoff"),this.systemEventDetector&&clearTimeout(this.systemEventDetector),this.systemEventDetector=setTimeout(()=>{this.systemEventDetector=void 0},1e4);for(const t of this.relays.values())t.connectivity&&(t.connectivity.resetReconnectionState(),t.status!==5&&t.status!==4&&t.connect().catch(n=>{this.debug(`Failed to reconnect relay ${t.url} after system event: ${n}`)}));this.disconnectionTimes.clear()}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let n=this.backoffTimes.get(t.url)||5e3;n=n*2,this.backoffTimes.set(t.url,n),this.debug(`Backoff time for ${t.url} is ${n}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()},n),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const n of this.relays.values())t.total++,n.status===5?t.connected++:n.status===1?t.disconnected++:n.status===4&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url))}urls(){return Array.from(this.relays.keys())}},Jt,NDKCashuMintList=(Jt=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_p2pk");this.kind??(this.kind=10019)}static from(n){return new Jt(n.ndk,n)}set relays(n){this.tags=this.tags.filter(s=>s[0]!=="relay");for(const s of n)this.tags.push(["relay",s])}get relays(){const n=[];for(const s of this.tags)s[0]==="relay"&&n.push(s[1]);return n}set mints(n){this.tags=this.tags.filter(s=>s[0]!=="mint");for(const s of n)this.tags.push(["mint",s])}get mints(){const n=[];for(const s of this.tags)s[0]==="mint"&&n.push(s[1]);return Array.from(new Set(n))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(n){this._p2pk=n,this.removeTag("pubkey"),n&&this.tags.push(["pubkey",n])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},ht(Jt,"kind",10019),ht(Jt,"kinds",[10019]),Jt),Kt,NDKArticle=(Kt=class extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=30023)}static from(t){return new Kt(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get summary(){return this.tagValue("summary")}set summary(t){this.removeTag("summary"),t&&this.tags.push(["summary",t])}get published_at(){const t=this.tagValue("published_at");if(t){let n=Number.parseInt(t);return n>1e12&&(n=Math.floor(n/1e3)),n}}set published_at(t){this.removeTag("published_at"),t!==void 0&&this.tags.push(["published_at",t.toString()])}async generateTags(){return super.generateTags(),this.published_at||(this.published_at=this.created_at),super.generateTags()}get url(){return this.tagValue("url")}set url(t){t?this.tags.push(["url",t]):this.removeTag("url")}},ht(Kt,"kind",30023),ht(Kt,"kinds",[30023]),Kt);function proofsTotalBalance(e){return e.reduce((t,n)=>{if(n.amount<0)throw new Error("proof amount is negative");return t+n.amount},0)}var Qt,NDKCashuToken=(Qt=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_proofs",[]);ht(this,"_mint");ht(this,"_deletes",[]);ht(this,"original");this.kind??(this.kind=7375)}static async from(n){const s=new Qt(n.ndk,n);s.original=n;try{await s.decrypt()}catch{s.content=s.original.content}try{const a=JSON.parse(s.content);if(s.proofs=a.proofs,s.mint=a.mint??s.tagValue("mint"),s.deletedTokens=a.del??[],!Array.isArray(s.proofs))return}catch{return}return s}get proofs(){return this._proofs}set proofs(n){const s=new Set;this._proofs=n.filter(a=>s.has(a.C)?(console.warn("Passed in proofs had duplicates, ignoring",a.C),!1):a.amount<0?(console.warn("Invalid proof with negative amount",a),!1):(s.add(a.C),!0)).map(this.cleanProof)}cleanProof(n){return{id:n.id,amount:n.amount,C:n.C,secret:n.secret}}async toNostrEvent(n){if(!this.ndk)throw new Error("no ndk");if(!this.ndk.signer)throw new Error("no signer");const s={proofs:this.proofs.map(this.cleanProof),mint:this.mint,del:this.deletedTokens??[]};this.content=JSON.stringify(s);const a=await this.ndk.signer.user();return await this.encrypt(a,void 0,"nip44"),super.toNostrEvent(n)}set mint(n){this._mint=n}get mint(){return this._mint}get deletedTokens(){return this._deletes}set deletedTokens(n){this._deletes=n}get amount(){return proofsTotalBalance(this.proofs)}async publish(n,s,a){return this.original?this.original.publish(n,s,a):super.publish(n,s,a)}},ht(Qt,"kind",7375),ht(Qt,"kinds",[7375]),Qt),en,NDKHighlight=(en=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_article");this.kind??(this.kind=9802)}static from(n){return new en(n.ndk,n)}get url(){return this.tagValue("r")}set context(n){n===void 0?this.tags=this.tags.filter(([s,a])=>s!=="context"):(this.tags=this.tags.filter(([s,a])=>s!=="context"),this.tags.push(["context",n]))}get context(){var n;return((n=this.tags.find(([s,a])=>s==="context"))==null?void 0:n[1])??void 0}get article(){return this._article}set article(n){this._article=n,typeof n=="string"?this.tags.push(["r",n]):this.tag(n)}getArticleTag(){return this.getMatchingTags("a")[0]||this.getMatchingTags("e")[0]||this.getMatchingTags("r")[0]}async getArticle(){var a;if(this._article!==void 0)return this._article;let n;const s=this.getArticleTag();if(s){switch(s[0]){case"a":{const[l,de,pe]=s[1].split(":");n=nip19_exports.naddrEncode({kind:Number.parseInt(l),pubkey:de,identifier:pe});break}case"e":n=nip19_exports.noteEncode(s[1]);break;case"r":this._article=s[1];break}if(n){let l=await((a=this.ndk)==null?void 0:a.fetchEvent(n));l&&(l.kind===30023&&(l=NDKArticle.from(l)),this._article=l)}return this._article}}},ht(en,"kind",9802),ht(en,"kinds",[9802]),en);function mapImetaTag(e){const t={};if(e.length===2){const s=e[1].split(" ");for(let a=0;a<s.length;a+=2){const l=s[a],de=s[a+1];l==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(de)):t[l]=de}return t}const n=e.slice(1);for(const s of n){const a=s.split(" "),l=a[0],de=a.slice(1).join(" ");l==="fallback"?(t.fallback||(t.fallback=[]),t.fallback.push(de)):t[l]=de}return t}function imetaTagToTag(e){const t=["imeta"];for(const[n,s]of Object.entries(e))if(Array.isArray(s))for(const a of s)t.push(`${n} ${a}`);else s&&t.push(`${n} ${s}`);return t}var tn,NDKImage=(tn=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_imetas");this.kind??(this.kind=20)}static from(n){return new tn(n.ndk,n.rawEvent())}get isValid(){return this.imetas.length>0}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(n=>n[0]==="imeta").map(mapImetaTag).filter(n=>!!n.url),this._imetas)}set imetas(n){this._imetas=n,this.tags=this.tags.filter(s=>s[0]!=="imeta"),this.tags.push(...n.map(imetaTagToTag))}},ht(tn,"kind",20),ht(tn,"kinds",[20]),tn),yn,NDKList=(yn=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_encryptedTags");ht(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(n){return new yn(n.ndk,n)}get title(){const n=this.tagValue("title")||this.tagValue("name");return n||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(n){this.removeTag(["title","name"]),n&&this.tags.push(["title",n])}get name(){return this.title}set name(n){this.title=n}get description(){return this.tagValue("description")}set description(n){this.removeTag("description"),n&&this.tags.push(["description",n])}get image(){return this.tagValue("image")}set image(n){this.removeTag("image"),n&&this.tags.push(["image",n])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(n=!0){if(n&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=await this.ndk.signer.user();try{if(this.content.length>0)try{const a=await this.ndk.signer.decrypt(s,this.content),l=JSON.parse(a);return l!=null&&l[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=l):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{}}catch{}return[]}validateTag(n){return!0}getItems(n){return this.tags.filter(s=>s[0]===n)}get items(){return this.tags.filter(n=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(n[0]))}async addItem(n,s=void 0,a=!1,l="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let de;if(n instanceof NDKEvent)de=[n.tagReference(s)];else if(n instanceof NDKUser)de=n.referenceTags();else if(n instanceof NDKRelay)de=n.referenceTags();else if(Array.isArray(n))de=[n];else throw new Error("Invalid object type");if(s&&de[0].push(s),a){const pe=await this.ndk.signer.user(),me=await this.encryptedTags();l==="top"?me.unshift(...de):me.push(...de),this._encryptedTags=me,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(me),await this.encrypt(pe)}else l==="top"?this.tags.unshift(...de):this.tags.push(...de);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(n,s=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const a=this.tags.findIndex(me=>me[1]===n);a>=0&&this.tags.splice(a,1);const l=await this.ndk.signer.user(),de=await this.encryptedTags(),pe=de.findIndex(me=>me[1]===n);if(pe>=0&&(de.splice(pe,1),this._encryptedTags=de,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(de),await this.encrypt(l)),s)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(n,s){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(s){const a=await this.ndk.signer.user(),l=await this.encryptedTags();l.splice(n,1),this._encryptedTags=l,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(l),await this.encrypt(a)}else this.tags.splice(n,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(n){return this.items.some(s=>s[1]===n)}filterForItems(){const n=new Set,s=new Map,a=[];for(const l of this.items)if(l[0]==="e"&&l[1])n.add(l[1]);else if(l[0]==="a"&&l[1]){const[de,pe,me]=l[1].split(":");if(!de||!pe)continue;const Le=`${de}:${pe}`,Be=s.get(Le)||[];Be.push(me||""),s.set(Le,Be)}if(n.size>0&&a.push({ids:Array.from(n)}),s.size>0)for(const[l,de]of s.entries()){const[pe,me]=l.split(":");a.push({kinds:[Number.parseInt(pe)],authors:[me],"#d":de})}return a}},ht(yn,"kinds",[10063,30001,10004,10050,10030,10015,10001,10002,10007,10006,10003]),yn),lists_default=NDKList,Yt,NDKNutzap=(Yt=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"debug");ht(this,"_proofs",[]);ht(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(n==null?void 0:n.debug.extend("nutzap"))??createDebug5("ndk:nutzap"),this.alt||(this.alt="This is a nutzap");try{const a=this.getMatchingTags("proof");a.length?this._proofs=a.map(l=>JSON.parse(l[1])):this._proofs=JSON.parse(this.content)}catch{return}}static from(n){const s=new Yt(n.ndk,n);if(!(!s._proofs||!s._proofs.length))return s}set comment(n){this.content=n??""}get comment(){const n=this.tagValue("comment");return n||this.content}set proofs(n){this._proofs=n,this.tags=this.tags.filter(s=>s[0]!=="proof");for(const s of n)this.tags.push(["proof",JSON.stringify(s)])}get proofs(){return this._proofs}get rawP2pk(){var s;const n=this.proofs[0];try{const a=JSON.parse(n.secret);let l;if(typeof a=="string"?(l=JSON.parse(a),this.debug("stringified payload",n.secret)):typeof a=="object"&&(l=a),Array.isArray(l)&&l[0]==="P2PK"&&l.length>1&&typeof l[1]=="object"&&l[1]!==null||typeof l=="object"&&l!==null&&typeof((s=l[1])==null?void 0:s.data)=="string")return l[1].data}catch(a){this.debug("error parsing p2pk pubkey",a,this.proofs[0])}}get p2pk(){const n=this.rawP2pk;if(n)return n.startsWith("02")?n.slice(2):n}get mint(){return this.tagValue("u")}set mint(n){this.replaceTag(["u",n])}get unit(){let n=this.tagValue("unit")??"sat";return n!=null&&n.startsWith("msat")&&(n="sat"),n}set unit(n){if(this.removeTag("unit"),n!=null&&n.startsWith("msat"))throw new Error("msat is not allowed, use sat denomination instead");n&&this.tag(["unit",n])}get amount(){return this.proofs.reduce((s,a)=>s+a.amount,0)}set target(n){this.tags=this.tags.filter(s=>s[0]!=="p"),n instanceof NDKEvent&&this.tags.push(n.tagReference())}set recipientPubkey(n){this.removeTag("p"),this.tag(["p",n])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const n=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:n}):new NDKUser({pubkey:n})}async toNostrEvent(){this.unit==="msat"&&(this.unit="sat"),this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()]);const n=await super.toNostrEvent();return n.content=this.comment,n}get isValid(){let n=0,s=0,a=0;for(const l of this.tags)l[0]==="e"&&n++,l[0]==="p"&&s++,l[0]==="u"&&a++;return s===1&&a===1&&n<=1&&this.proofs.length>0}},ht(Yt,"kind",9321),ht(Yt,"kinds",[Yt.kind]),Yt),nn,NDKSimpleGroupMemberList=(nn=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"relaySet");ht(this,"memberSet",new Set);this.kind??(this.kind=39002),this.memberSet=new Set(this.members)}static from(n){return new nn(n.ndk,n)}get members(){return this.getMatchingTags("p").map(n=>n[1])}hasMember(n){return this.memberSet.has(n)}async publish(n,s,a){return n??(n=this.relaySet),super.publishReplaceable(n,s,a)}},ht(nn,"kind",39002),ht(nn,"kinds",[39002]),nn),rn,NDKSimpleGroupMetadata=(rn=class extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=39e3)}static from(t){return new rn(t.ndk,t)}get name(){return this.tagValue("name")}get picture(){return this.tagValue("picture")}get about(){return this.tagValue("about")}get scope(){if(this.getMatchingTags("public").length>0)return"public";if(this.getMatchingTags("public").length>0)return"private"}set scope(t){this.removeTag("public"),this.removeTag("private"),t==="public"?this.tags.push(["public",""]):t==="private"&&this.tags.push(["private",""])}get access(){if(this.getMatchingTags("open").length>0)return"open";if(this.getMatchingTags("closed").length>0)return"closed"}set access(t){this.removeTag("open"),this.removeTag("closed"),t==="open"?this.tags.push(["open",""]):t==="closed"&&this.tags.push(["closed",""])}},ht(rn,"kind",39e3),ht(rn,"kinds",[39e3]),rn);function strToPosition(e){const[t,n]=e.split(",").map(Number);return{x:t,y:n}}function strToDimension(e){const[t,n]=e.split("x").map(Number);return{width:t,height:n}}var Zt,NDKStorySticker=(Zt=class{constructor(t){ht(this,"type");ht(this,"value");ht(this,"position");ht(this,"dimension");ht(this,"properties");ht(this,"hasValidDimensions",()=>typeof this.dimension.width=="number"&&typeof this.dimension.height=="number"&&!Number.isNaN(this.dimension.width)&&!Number.isNaN(this.dimension.height));ht(this,"hasValidPosition",()=>typeof this.position.x=="number"&&typeof this.position.y=="number"&&!Number.isNaN(this.position.x)&&!Number.isNaN(this.position.y));if(Array.isArray(t)){const n=t;if(n[0]!=="sticker"||n.length<5)throw new Error("Invalid sticker tag");this.type=n[1],this.value=n[2],this.position=strToPosition(n[3]),this.dimension=strToDimension(n[4]);const s={};for(let a=5;a<n.length;a++){const[l,...de]=n[a].split(" ");s[l]=de.join(" ")}Object.keys(s).length>0&&(this.properties=s)}else this.type=t,this.value=void 0,this.position={x:0,y:0},this.dimension={width:0,height:0}}static fromTag(t){try{return new Zt(t)}catch{return null}}get style(){var t;return(t=this.properties)==null?void 0:t.style}set style(t){var n;t?this.properties={...this.properties,style:t}:(n=this.properties)==null||delete n.style}get rotation(){var t;return(t=this.properties)!=null&&t.rot?Number.parseFloat(this.properties.rot):void 0}set rotation(t){var n;t!==void 0?this.properties={...this.properties,rot:t.toString()}:(n=this.properties)==null||delete n.rot}get isValid(){return this.hasValidDimensions()&&this.hasValidPosition()}toTag(){if(!this.isValid){const s=[this.hasValidDimensions()?void 0:"dimensions is invalid",this.hasValidPosition()?void 0:"position is invalid"].filter(Boolean);throw new Error(`Invalid sticker: ${s.join(", ")}`)}let t;switch(this.type){case"event":t=this.value.tagId();break;case"pubkey":t=this.value.pubkey;break;default:t=this.value}const n=["sticker",this.type,t,coordinates(this.position),dimension(this.dimension)];if(this.properties)for(const[s,a]of Object.entries(this.properties))n.push(`${s} ${a}`);return n}},ht(Zt,"Text","text"),ht(Zt,"Pubkey","pubkey"),ht(Zt,"Event","event"),ht(Zt,"Prompt","prompt"),ht(Zt,"Countdown","countdown"),Zt),sn,NDKStory=(sn=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_imeta");ht(this,"_dimensions");if(this.kind??(this.kind=23),s)for(const a of s.tags)switch(a[0]){case"imeta":this._imeta=mapImetaTag(a);break;case"dim":this.dimensions=strToDimension(a[1]);break}}static from(n){return new sn(n.ndk,n)}get isValid(){return!!this.imeta}get imeta(){return this._imeta}set imeta(n){this._imeta=n,this.tags=this.tags.filter(s=>s[0]!=="imeta"),n&&this.tags.push(imetaTagToTag(n))}get dimensions(){const n=this.tagValue("dim");if(n)return strToDimension(n)}set dimensions(n){this.removeTag("dim"),n&&this.tags.push(["dim",`${n.width}x${n.height}`])}get duration(){const n=this.tagValue("dur");if(n)return Number.parseInt(n)}set duration(n){this.removeTag("dur"),n!==void 0&&this.tags.push(["dur",n.toString()])}get stickers(){const n=[];for(const s of this.tags){if(s[0]!=="sticker"||s.length<5)continue;const a=NDKStorySticker.fromTag(s);a&&n.push(a)}return n}addSticker(n){let s;if(n instanceof NDKStorySticker)s=n;else{const a=["sticker",n.type,typeof n.value=="string"?n.value:"",coordinates(n.position),dimension(n.dimension)];if(n.properties)for(const[l,de]of Object.entries(n.properties))a.push(`${l} ${de}`);s=new NDKStorySticker(a),s.value=n.value}s.type==="pubkey"?this.tag(s.value):s.type==="event"&&this.tag(s.value),this.tags.push(s.toTag())}removeSticker(n){const s=this.stickers;if(n<0||n>=s.length)return;let a=0;for(let l=0;l<this.tags.length;l++)if(this.tags[l][0]==="sticker"){if(a===n){this.tags.splice(l,1);break}a++}}},ht(sn,"kind",23),ht(sn,"kinds",[23]),sn),coordinates=e=>`${e.x},${e.y}`,dimension=e=>`${e.width}x${e.height}`,possibleIntervalFrequencies=["daily","weekly","monthly","quarterly","yearly"];function newAmount(e,t,n){return["amount",e.toString(),t,n]}function parseTagToSubscriptionAmount(e){const t=Number.parseInt(e[1]);if(Number.isNaN(t)||t===void 0||t===null||t<=0)return;const n=e[2];if(n===void 0||n==="")return;const s=e[3];if(s!==void 0&&possibleIntervalFrequencies.includes(s))return{amount:t,currency:n,term:s}}var on,NDKSubscriptionTier=(on=class extends NDKArticle{constructor(t,n){const s=(n==null?void 0:n.kind)??37001;super(t,n),this.kind=s}static from(t){return new on(t.ndk,t)}get perks(){return this.getMatchingTags("perk").map(t=>t[1]).filter(t=>t!==void 0)}addPerk(t){this.tags.push(["perk",t])}get amounts(){return this.getMatchingTags("amount").map(t=>parseTagToSubscriptionAmount(t)).filter(t=>t!==void 0)}addAmount(t,n,s){this.tags.push(newAmount(t,n,s))}set relayUrl(t){this.tags.push(["r",t])}get relayUrls(){return this.getMatchingTags("r").map(t=>t[1]).filter(t=>t!==void 0)}get verifierPubkey(){return this.tagValue("p")}set verifierPubkey(t){this.removeTag("p"),t&&this.tags.push(["p",t])}get isValid(){return this.title!==void 0&&this.amounts.length>0}},ht(on,"kind",37001),ht(on,"kinds",[37001]),on),an,NDKVideo=(an=class extends NDKEvent{constructor(){super(...arguments);ht(this,"_imetas")}static from(n){return new an(n.ndk,n.rawEvent())}get title(){return this.tagValue("title")}set title(n){this.removeTag("title"),n&&this.tags.push(["title",n])}get thumbnail(){var s;let n;return this.imetas&&this.imetas.length>0&&(n=(s=this.imetas[0].image)==null?void 0:s[0]),n??this.tagValue("thumb")}get imetas(){return this._imetas?this._imetas:(this._imetas=this.tags.filter(n=>n[0]==="imeta").map(mapImetaTag),this._imetas)}set imetas(n){this._imetas=n,this.tags=this.tags.filter(s=>s[0]!=="imeta"),this.tags.push(...n.map(imetaTagToTag))}get url(){return this.imetas&&this.imetas.length>0?this.imetas[0].url:this.tagValue("url")}get published_at(){const n=this.tagValue("published_at");if(n)return Number.parseInt(n)}async generateTags(){var n,s;if(super.generateTags(),!this.kind&&(s=(n=this.imetas)==null?void 0:n[0])!=null&&s.dim){const[a,l]=this.imetas[0].dim.split("x"),de=a&&l&&Number.parseInt(a)<Number.parseInt(l);this.duration&&this.duration<120&&de?this.kind=22:this.kind=21}return super.generateTags()}get duration(){const n=this.tagValue("duration");if(n)return Number.parseInt(n)}set duration(n){this.removeTag("duration"),n!==void 0&&this.tags.push(["duration",Math.floor(n).toString()])}},ht(an,"kind",21),ht(an,"kinds",[34235,34236,22,21]),an),cn,NDKWiki=(cn=class extends NDKArticle{static from(t){return new cn(t.ndk,t.rawEvent())}get isDefered(){return this.hasTag("a","defer")}get deferedId(){return this.tagValue("a","defer")}set defer(t){this.removeTag("a","defer"),this.tag(t,"defer")}},ht(cn,"kind",30818),ht(cn,"kinds",[30818]),cn),mn,NDKBlossomList=(mn=class extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=10063)}static from(t){return new mn(t.ndk,t.rawEvent())}get servers(){return this.tags.filter(t=>t[0]==="server").map(t=>t[1])}set servers(t){this.tags=this.tags.filter(n=>n[0]!=="server");for(const n of t)this.tags.push(["server",n])}get default(){const t=this.servers;return t.length>0?t[0]:void 0}set default(t){if(!t)return;const s=this.servers.filter(a=>a!==t);this.servers=[t,...s]}addServer(t){if(!t)return;const n=this.servers;n.includes(t)||(this.servers=[...n,t])}removeServer(t){if(!t)return;const n=this.servers;this.servers=n.filter(s=>s!==t)}},ht(mn,"kinds",[10063]),mn),ln,NDKFollowPack=(ln=class extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=39089)}static from(t){return new ln(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get image(){const t=this.tags.find(n=>n[0]==="imeta");if(t){const n=mapImetaTag(t);if(n.url)return n.url}return this.tagValue("image")}set image(t){this.tags=this.tags.filter(n=>n[0]!=="imeta"&&n[0]!=="image"),typeof t=="string"?t!==void 0&&this.tags.push(["image",t]):t&&typeof t=="object"&&(this.tags.push(imetaTagToTag(t)),t.url&&this.tags.push(["image",t.url]))}get pubkeys(){return Array.from(new Set(this.tags.filter(t=>t[0]==="p").map(t=>t[1])))}set pubkeys(t){this.tags=this.tags.filter(n=>n[0]!=="p");for(const n of t)this.tags.push(["p",n])}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}},ht(ln,"kind",39089),ht(ln,"kinds",[39089,39092]),ln),signerRegistry=new Map;function registerSigner(e,t){signerRegistry.set(e,t)}var NDKPrivateKeySigner=class En{constructor(t,n){ht(this,"_user");ht(this,"_privateKey");ht(this,"_pubkey");if(typeof t=="string")if(t.startsWith("nsec1")){const{type:s,data:a}=nip19_exports.decode(t);if(s==="nsec")this._privateKey=a;else throw new Error("Invalid private key provided.")}else if(t.length===64)this._privateKey=hexToBytes$2(t);else throw new Error("Invalid private key provided.");else this._privateKey=t;this._pubkey=getPublicKey(this._privateKey),n&&(this._user=n.getUser({pubkey:this._pubkey})),this._user??(this._user=new NDKUser({pubkey:this._pubkey}))}get privateKey(){if(!this._privateKey)throw new Error("Not ready");return bytesToHex$2(this._privateKey)}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}get nsec(){if(!this._privateKey)throw new Error("Not ready");return nip19_exports.nsecEncode(this._privateKey)}get npub(){if(!this._pubkey)throw new Error("Not ready");return nip19_exports.npubEncode(this._pubkey)}static generate(){const t=generateSecretKey();return new En(t)}async blockUntilReady(){return this._user}async user(){return this._user}get userSync(){return this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(t,this._privateKey).sig}async encryptionEnabled(t){const n=[];return(!t||t==="nip04")&&n.push("nip04"),(!t||t==="nip44")&&n.push("nip44"),n}async encrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to encrypt without a private key");const a=t.pubkey;if(s==="nip44"){const l=nip44_exports.v2.utils.getConversationKey(this._privateKey,a);return await nip44_exports.v2.encrypt(n,l)}return await nip04_exports.encrypt(this._privateKey,a,n)}async decrypt(t,n,s){if(!this._privateKey||!this.privateKey)throw Error("Attempted to decrypt without a private key");const a=t.pubkey;if(s==="nip44"){const l=nip44_exports.v2.utils.getConversationKey(this._privateKey,a);return await nip44_exports.v2.decrypt(n,l)}return await nip04_exports.decrypt(this._privateKey,a,n)}toPayload(){if(!this._privateKey)throw new Error("Private key not available");const t={type:"private-key",payload:this.privateKey};return JSON.stringify(t)}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="private-key")throw new Error(`Invalid payload type: expected 'private-key', got ${s.type}`);if(!s.payload||typeof s.payload!="string")throw new Error("Invalid payload content for private-key signer");return new En(s.payload,n)}};registerSigner("private-key",NDKPrivateKeySigner);var Xt,NDKProject=(Xt=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_signer");this.kind=31933}static from(n){return new Xt(n.ndk,n.rawEvent())}set repo(n){this.removeTag("repo"),n&&this.tags.push(["repo",n])}set hashtags(n){this.removeTag("hashtags"),n.filter(s=>s.length>0).length&&this.tags.push(["hashtags",...n])}get hashtags(){const n=this.tags.find(s=>s[0]==="hashtags");return n?n.slice(1):[]}get repo(){return this.tagValue("repo")}get title(){return this.tagValue("title")}set title(n){this.removeTag("title"),n&&this.tags.push(["title",n])}get picture(){return this.tagValue("picture")}set picture(n){this.removeTag("picture"),n&&this.tags.push(["picture",n])}set description(n){this.content=n}get description(){return this.content}get slug(){return this.dTag??"empty-dtag"}async getSigner(){var s,a;if(this._signer)return this._signer;const n=this.tagValue("key");if(!n)this._signer=NDKPrivateKeySigner.generate(),await this.encryptAndSaveNsec();else{const l=await((a=(s=this.ndk)==null?void 0:s.signer)==null?void 0:a.decrypt(this.ndk.activeUser,n));if(!l)throw new Error("Failed to decrypt project key or missing signer context.");this._signer=new NDKPrivateKeySigner(l)}return this._signer}async getNsec(){return(await this.getSigner()).privateKey}async setNsec(n){this._signer=new NDKPrivateKeySigner(n),await this.encryptAndSaveNsec()}async encryptAndSaveNsec(){var a,l;if(!this._signer)throw new Error("Signer is not set.");const n=this._signer.privateKey,s=await((l=(a=this.ndk)==null?void 0:a.signer)==null?void 0:l.encrypt(this.ndk.activeUser,n));s&&(this.removeTag("key"),this.tags.push(["key",s]))}},ht(Xt,"kind",31933),ht(Xt,"kinds",[Xt.kind]),Xt),un,NDKThread=(un=class extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=11)}static from(t){return new un(t.ndk,t)}get title(){return this.tagValue("title")}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}},ht(un,"kind",11),ht(un,"kinds",[11]),un),hn,NDKDraft=(hn=class extends NDKEvent{constructor(n,s){super(n,s);ht(this,"_event");ht(this,"counterparty");this.kind??(this.kind=31234)}static from(n){return new hn(n.ndk,n)}set identifier(n){this.removeTag("d"),this.tags.push(["d",n])}get identifier(){return this.dTag}set event(n){n instanceof NDKEvent?this._event=n:this._event=new NDKEvent(void 0,n),this.prepareEvent()}set checkpoint(n){n?(this.tags.push(n.tagReference()),this.kind=1234):(this.removeTag("a"),this.kind=31234)}get isCheckpoint(){return this.kind===1234}get isProposal(){const n=this.tagValue("p");return!!n&&n!==this.pubkey}async getEvent(n){var s;if(this._event)return this._event;if(n??(n=(s=this.ndk)==null?void 0:s.signer),!n)throw new Error("No signer available");if(this.content&&this.content.length>0)try{const a=n.pubkey,de=[this.tagValue("p"),this.pubkey].filter(Boolean).find(Le=>Le!==a);let pe;pe=new NDKUser({pubkey:de??a}),await this.decrypt(pe,n);const me=JSON.parse(this.content);return this._event=await wrapEvent(new NDKEvent(this.ndk,me)),this._event}catch(a){console.error(a);return}else return null}prepareEvent(){if(!this._event)throw new Error("No event has been provided");this.removeTag("k"),this._event.kind&&this.tags.push(["k",this._event.kind.toString()]),this.content=JSON.stringify(this._event.rawEvent())}async save({signer:n,publish:s,relaySet:a}){var de;if(n??(n=(de=this.ndk)==null?void 0:de.signer),!n)throw new Error("No signer available");const l=this.counterparty||await n.user();if(await this.encrypt(l,n),this.counterparty){const pe=this.counterparty.pubkey;this.removeTag("p"),this.tags.push(["p",pe])}if(s!==!1)return this.publishReplaceable(a)}},ht(hn,"kind",31234),ht(hn,"kinds",[31234,1234]),hn),dn,NDKTask=(dn=class extends NDKEvent{constructor(t,n){super(t,n),this.kind=1934}static from(t){return new dn(t.ndk,t.rawEvent())}set title(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get title(){return this.tagValue("title")}set project(t){this.removeTag("a"),this.tags.push(t.tagReference())}get projectSlug(){var n;const t=this.getMatchingTags("a")[0];return t?(n=t[1].split(/:/))==null?void 0:n[2]:void 0}},ht(dn,"kind",1934),ht(dn,"kinds",[1934]),dn),fn,NDKProjectTemplate=(fn=class extends NDKEvent{constructor(t,n){super(t,n),this.kind=30717}static from(t){return new fn(t.ndk,t.rawEvent())}get templateId(){return this.dTag??""}set templateId(t){this.dTag=t}get name(){return this.tagValue("title")??""}set name(t){this.removeTag("title"),t&&this.tags.push(["title",t])}get description(){return this.tagValue("description")??""}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get repoUrl(){return this.tagValue("uri")??""}set repoUrl(t){this.removeTag("uri"),t&&this.tags.push(["uri",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}get command(){return this.tagValue("command")}set command(t){this.removeTag("command"),t&&this.tags.push(["command",t])}get agentConfig(){const t=this.tagValue("agent");if(t)try{return JSON.parse(t)}catch{return}}set agentConfig(t){this.removeTag("agent"),t&&this.tags.push(["agent",JSON.stringify(t)])}get templateTags(){return this.getMatchingTags("t").map(t=>t[1]).filter(Boolean)}set templateTags(t){this.tags=this.tags.filter(n=>n[0]!=="t"),t.forEach(n=>{n&&this.tags.push(["t",n])})}},ht(fn,"kind",30717),ht(fn,"kinds",[30717]),fn),registeredEventClasses=new Set;function wrapEvent(e){const t=new Map,s=[...[NDKImage,NDKVideo,NDKCashuMintList,NDKArticle,NDKHighlight,NDKDraft,NDKWiki,NDKNutzap,NDKProject,NDKTask,NDKProjectTemplate,NDKSimpleGroupMemberList,NDKSimpleGroupMetadata,NDKSubscriptionTier,NDKCashuToken,NDKList,NDKStory,NDKBlossomList,NDKFollowPack,NDKThread],...registeredEventClasses];for(const l of s)for(const de of l.kinds)t.set(de,l);const a=t.get(e.kind);return a?a.from(e):e}function queryFullyFilled(e){return!!(filterIncludesIds(e.filter)&&resultHasAllRequestedIds(e))}function filterIncludesIds(e){return!!e.ids}function resultHasAllRequestedIds(e){const t=e.filter.ids;return!!t&&t.length===e.eventFirstSeen.size}function filterFromId(e){let t;if(e.match(NIP33_A_REGEX)){const[n,s,a]=e.split(":"),l={authors:[s],kinds:[Number.parseInt(n)]};return a&&(l["#d"]=[a]),l}if(e.match(BECH32_REGEX))try{switch(t=nip19_exports.decode(e),t.type){case"nevent":{const n={ids:[t.data.id]};return t.data.author&&(n.authors=[t.data.author]),t.data.kind&&(n.kinds=[t.data.kind]),n}case"note":return{ids:[t.data]};case"naddr":{const n={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(n["#d"]=[t.data.identifier]),n}}}catch(n){console.error("Error decoding",e,n)}return{ids:[e]}}function isNip33AValue(e){return e.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(e,t){try{const n=nip19_exports.decode(e);if(["naddr","nevent"].includes(n==null?void 0:n.type)){const s=n.data;if(s!=null&&s.relays)return s.relays.map(a=>new NDKRelay(a,t.relayAuthDefaultPolicy,t))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",dontSaveToCache:!1,groupable:!0,groupableDelay:100,groupableDelayType:"at-most",cacheUnconstrainFilter:["limit","since","until"]},NDKSubscription=class extends lib$1.EventEmitter{constructor(t,n,s,a){super();ht(this,"subId");ht(this,"filters");ht(this,"opts");ht(this,"pool");ht(this,"skipVerification",!1);ht(this,"skipValidation",!1);ht(this,"relayFilters");ht(this,"relaySet");ht(this,"ndk");ht(this,"debug");ht(this,"eventFirstSeen",new Map);ht(this,"eosesSeen",new Set);ht(this,"lastEventReceivedAt");ht(this,"mostRecentCacheEventTimestamp");ht(this,"internalId");ht(this,"closeOnEose");ht(this,"poolMonitor");ht(this,"skipOptimisticPublishEvent",!1);ht(this,"cacheUnconstrainFilter");ht(this,"onStopped");ht(this,"eoseTimeout");ht(this,"eosed",!1);this.ndk=t,this.opts={...defaultOpts,...s||{}},this.pool=this.opts.pool||t.pool,this.filters=Array.isArray(n)?n:[n],this.subId=a||this.opts.subId,this.internalId=Math.random().toString(36).substring(7),this.debug=t.debug.extend(`subscription[${this.opts.subId??this.internalId}]`),this.opts.relaySet?this.relaySet=this.opts.relaySet:this.opts.relayUrls&&(this.relaySet=NDKRelaySet.fromRelayUrls(this.opts.relayUrls,this.ndk)),this.skipVerification=this.opts.skipVerification||!1,this.skipValidation=this.opts.skipValidation||!1,this.closeOnEose=this.opts.closeOnEose||!1,this.skipOptimisticPublishEvent=this.opts.skipOptimisticPublishEvent||!1,this.cacheUnconstrainFilter=this.opts.cacheUnconstrainFilter}relaysMissingEose(){var n;return this.relayFilters?Array.from((n=this.relayFilters)==null?void 0:n.keys()).filter(s=>!this.eosesSeen.has(this.pool.getRelay(s,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var t;if(this.isGroupable())return(t=this.opts)==null?void 0:t.groupableDelay}get groupableDelayType(){var t;return((t=this.opts)==null?void 0:t.groupableDelayType)||"at-most"}isGroupable(){var t;return((t=this.opts)==null?void 0:t.groupable)||!1}shouldQueryCache(){var n;return this.opts.addSinceFromCache?!0:((n=this.opts)==null?void 0:n.cacheUsage)==="ONLY_RELAY"?!1:(this.filters.some(s=>{var a;return(a=s.kinds)==null?void 0:a.some(l=>kindIsEphemeral(l))}),!0)}shouldQueryRelays(){var t;return((t=this.opts)==null?void 0:t.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var t;return this.opts.addSinceFromCache?!0:!!this.opts.closeOnEose&&!!((t=this.ndk.cacheAdapter)!=null&&t.locking)&&this.opts.cacheUsage!=="PARALLEL"}start(t=!0){let n;const s=l=>{if(t)for(const de of l)de.created_at&&(!this.mostRecentCacheEventTimestamp||de.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=de.created_at),this.eventReceived(de,void 0,!0,!1);else{n=[];for(const de of l){de.created_at&&(!this.mostRecentCacheEventTimestamp||de.created_at>this.mostRecentCacheEventTimestamp)&&(this.mostRecentCacheEventTimestamp=de.created_at),de.ndk=this.ndk;const pe=this.opts.wrap?wrapEvent(de):de;if(!pe)break;if(pe instanceof Promise){pe.then(me=>{this.emitEvent(!1,me,void 0,!0,!1)});break}this.eventFirstSeen.set(pe.id,Date.now()),n.push(pe)}}},a=()=>{this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)};return this.shouldQueryCache()?(n=this.startWithCache(),n instanceof Promise?this.shouldWaitForCache()?(n.then(l=>{if(s(l),queryFullyFilled(this)){this.emit("eose",this);return}a()}),null):(n.then(l=>{s(l)}),a(),null):(s(n),queryFullyFilled(this)?this.emit("eose",this):a(),n)):(a(),null)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=t=>{var s,a;if((s=this.relayFilters)!=null&&s.has(t.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(t.url)&&((a=this.relayFilters)==null||a.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){var t;this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),(t=this.onStopped)==null||t.call(this)}hasAuthorsFilter(){return this.filters.some(t=>{var n;return(n=t.authors)==null?void 0:n.length})}startWithCache(){var t;return(t=this.ndk.cacheAdapter)!=null&&t.query?this.ndk.cacheAdapter.query(this):[]}startWithRelays(){let t=this.filters;if(this.opts.addSinceFromCache&&this.mostRecentCacheEventTimestamp){const n=this.mostRecentCacheEventTimestamp+1;t=t.map(s=>({...s,since:Math.max(s.since||0,n)}))}if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,t,this.pool);else{this.relayFilters=new Map;for(const n of this.relaySet.relays)this.relayFilters.set(n.url,t)}for(const[n,s]of this.relayFilters)this.pool.getRelay(n,!0,!0,s).subscribe(this,s)}eventReceived(t,n,s=!1,a=!1){var me;const l=t.id,de=this.eventFirstSeen.has(l);let pe;if(t instanceof NDKEvent&&(pe=t),de){const Le=Date.now()-(this.eventFirstSeen.get(l)||0);if(this.emit("event:dup",t,n,Le,this,s,a),n){const Be=verifiedSignatures.get(l);if(Be&&typeof Be=="string")if(t.sig===Be)n.addValidatedEvent();else{const Ye=t instanceof NDKEvent?t:new NDKEvent(this.ndk,t);this.ndk.reportInvalidSignature(Ye,n)}}}else{if(pe??(pe=new NDKEvent(this.ndk,t)),pe.ndk=this.ndk,pe.relay=n,!s&&!a){if(!this.skipValidation&&!pe.isValid){this.debug("Event failed validation %s from relay %s",l,n==null?void 0:n.url);return}if(n)if(n.shouldValidateEvent()&&!this.skipVerification){if(pe.relay=n,!this.ndk.asyncSigVerification){if(!pe.verifySignature(!0)){this.debug("Event failed signature validation",t),this.ndk.reportInvalidSignature(pe,n);return}n.addValidatedEvent()}}else n.addNonValidatedEvent();this.ndk.cacheAdapter&&!this.opts.dontSaveToCache&&this.ndk.cacheAdapter.setEvent(pe,this.filters,n)}(!a||this.skipOptimisticPublishEvent!==!0)&&(this.emitEvent(((me=this.opts)==null?void 0:me.wrap)??!1,pe,n,s,a),this.eventFirstSeen.set(l,Date.now()))}this.lastEventReceivedAt=Date.now()}emitEvent(t,n,s,a,l){const de=t?wrapEvent(n):n;de instanceof Promise?de.then(pe=>this.emitEvent(!1,pe,s,a,l)):de&&this.emit("event",de,s,this,a,l)}closedReceived(t,n){this.emit("closed",t,n)}eoseReceived(t){var de;this.debug("EOSE received from %s",t.url),this.eosesSeen.add(t);let n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const s=this.eosesSeen.size===((de=this.relayFilters)==null?void 0:de.size),a=queryFullyFilled(this),l=pe=>{var me;this.debug("Performing EOSE: %s %d",pe,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(me=this.opts)!=null&&me.closeOnEose&&this.stop())};if(a||s)l("query filled or seen all");else if(this.relayFilters){let pe=1e3;const me=new Set(this.pool.connectedRelays().map(Ye=>Ye.url)),Le=Array.from(this.relayFilters.keys()).filter(Ye=>me.has(Ye));if(Le.length===0){this.debug("No connected relays, waiting for all relays to connect",Array.from(this.relayFilters.keys()).join(", "));return}const Be=this.eosesSeen.size/Le.length;if(this.debug("Percentage of relays that have sent EOSE",{subId:this.subId,percentageOfRelaysThatHaveSentEose:Be,seen:this.eosesSeen.size,total:Le.length}),this.eosesSeen.size>=2&&Be>=.5){if(pe=pe*(1-Be),pe===0){l("time to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const Ye=()=>{n=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,n!==void 0&&n<20?this.eoseTimeout=setTimeout(Ye,pe):l(`send eose timeout: ${pe}`)};this.eoseTimeout=setTimeout(Ye,pe)}}}},kindIsEphemeral=e=>e>=2e4&&e<3e4;async function follows(e,t,n=3){var a,l;if(!this.ndk)throw new Error("NDK not set");const s=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},e||{groupable:!1});if(s){const de=new Set;return s.tags.forEach(pe=>{pe[0]==="p"&&de.add(pe[1])}),t&&((l=(a=this.ndk)==null?void 0:a.outboxTracker)==null||l.trackUsers(Array.from(de))),[...de].reduce((pe,me)=>{const Le=new NDKUser({pubkey:me});return Le.ndk=this.ndk,pe.add(Le),pe},new Set)}return new Set}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(e,t,n=fetch,s={}){return await e.queuesNip05.add({id:t,func:async()=>{var me,Le,Be;if((me=e.cacheAdapter)!=null&&me.loadNip05){const Ye=await e.cacheAdapter.loadNip05(t);if(Ye!=="missing"){if(Ye){const tt=new NDKUser({pubkey:Ye.pubkey,relayUrls:Ye.relays,nip46Urls:Ye.nip46});return tt.ndk=e,tt}if(s.cache!=="no-cache")return null}}const a=t.match(NIP05_REGEX);if(!a)return null;const[l,de="_",pe]=a;try{const Ye=await n(`https://${pe}/.well-known/nostr.json?name=${de}`,s),{names:tt,relays:nt,nip46:ft}=parseNIP05Result(await Ye.json()),st=tt[de.toLowerCase()];let yt=null;return st&&(yt={pubkey:st,relays:nt==null?void 0:nt[st],nip46:ft==null?void 0:ft[st]}),(Le=e==null?void 0:e.cacheAdapter)!=null&&Le.saveNip05&&e.cacheAdapter.saveNip05(t,yt),yt}catch(Ye){return(Be=e==null?void 0:e.cacheAdapter)!=null&&Be.saveNip05&&(e==null||e.cacheAdapter.saveNip05(t,null)),console.error("Failed to fetch NIP05 for",t,Ye),null}}})}function parseNIP05Result(e){const t={names:{}};for(const[n,s]of Object.entries(e.names))typeof n=="string"&&typeof s=="string"&&(t.names[n.toLowerCase()]=s);if(e.relays){t.relays={};for(const[n,s]of Object.entries(e.relays))typeof n=="string"&&Array.isArray(s)&&(t.relays[n]=s.filter(a=>typeof a=="string"))}if(e.nip46){t.nip46={};for(const[n,s]of Object.entries(e.nip46))typeof n=="string"&&Array.isArray(s)&&(t.nip46[n]=s.filter(a=>typeof a=="string"))}return t}function profileFromEvent(e){const t={};let n;try{n=JSON.parse(e.content)}catch(s){throw new Error(`Failed to parse profile event: ${s}`)}t.profileEvent=JSON.stringify(e.rawEvent());for(const s of Object.keys(n))switch(s){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.picture=n.picture||n.image,t.image=t.picture;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"website":t.website=n.website;break;default:t[s]=n[s];break}return t.created_at=e.created_at,t}function serializeProfile(e){const t={};for(const[n,s]of Object.entries(e))switch(n){case"username":case"name":t.name=s;break;case"displayName":t.display_name=s;break;case"image":case"picture":t.picture=s;break;case"bio":case"about":t.about=s;break;default:t[n]=s;break}return JSON.stringify(t)}var NDKUser=class _n{constructor(t){ht(this,"ndk");ht(this,"profile");ht(this,"profileEvent");ht(this,"_npub");ht(this,"_pubkey");ht(this,"relayUrls",[]);ht(this,"nip46Urls",[]);ht(this,"follows",follows.bind(this));if(t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls),t.nprofile)try{const n=nip19_exports.decode(t.nprofile);n.type==="nprofile"&&(this._pubkey=n.data.pubkey,n.data.relays&&n.data.relays.length>0&&this.relayUrls.push(...n.data.relays))}catch(n){console.error("Failed to decode nprofile",n)}}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}get nprofile(){var n,s;const t=(s=(n=this.profileEvent)==null?void 0:n.onRelays)==null?void 0:s.map(a=>a.url);return nip19_exports.nprofileEncode({pubkey:this.pubkey,relays:t})}set npub(t){this._npub=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}filter(){return{"#p":[this.pubkey]}}async getZapInfo(t){if(!this.ndk)throw new Error("No NDK instance found");const n=async de=>{if(!t)return de;let pe;const me=new Promise((Le,Be)=>{pe=setTimeout(()=>Be(new Error("Timeout")),t)});try{const Le=await Promise.race([de,me]);return pe&&clearTimeout(pe),Le}catch(Le){if(Le instanceof Error&&Le.message==="Timeout")try{return await de}catch{return}return}},[s,a]=await Promise.all([n(this.fetchProfile()),n(this.ndk.fetchEvent({kinds:[10019],authors:[this.pubkey]}))]),l=new Map;if(a){const de=NDKCashuMintList.from(a);de.mints.length>0&&l.set("nip61",{mints:de.mints,relays:de.relays,p2pk:de.p2pk})}if(s){const{lud06:de,lud16:pe}=s;l.set("nip57",{lud06:de,lud16:pe})}return l}static async fromNip05(t,n,s=!1){if(!n)throw new Error("No NDK instance found");const a={};s&&(a.cache="no-cache");const l=await getNip05For(n,t,n==null?void 0:n.httpFetch,a);if(l){const de=new _n({pubkey:l.pubkey,relayUrls:l.relays,nip46Urls:l.nip46});return de.ndk=n,de}}async fetchProfile(t,n=!1){if(!this.ndk)throw new Error("NDK not set");let s=null;if(this.ndk.cacheAdapter&&(this.ndk.cacheAdapter.fetchProfile||this.ndk.cacheAdapter.fetchProfileSync)&&(t==null?void 0:t.cacheUsage)!=="ONLY_RELAY"){let a=null;if(this.ndk.cacheAdapter.fetchProfileSync?a=this.ndk.cacheAdapter.fetchProfileSync(this.pubkey):this.ndk.cacheAdapter.fetchProfile&&(a=await this.ndk.cacheAdapter.fetchProfile(this.pubkey)),a)return this.profile=a,a}return t??(t={}),t.cacheUsage??(t.cacheUsage="ONLY_RELAY"),t.closeOnEose??(t.closeOnEose=!0),t.groupable??(t.groupable=!0),t.groupableDelay??(t.groupableDelay=250),s||(s=await this.ndk.fetchEvent({kinds:[0],authors:[this.pubkey]},t)),s?(this.profile=profileFromEvent(s),n&&this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile):null}async followSet(t,n,s=3){const a=await this.follows(t,n,s);return new Set(Array.from(a).map(l=>l.pubkey))}tagReference(){return["p",this.pubkey]}referenceTags(t){const n=[["p",this.pubkey]];return t&&n[0].push("",t),n}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s)),n.has(t))return!1;n.add(t);const a=new NDKEvent(this.ndk,{kind:s});for(const l of n)a.tag(l);return await a.publish(),!0}async unfollow(t,n,s=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),n||(n=await this.follows(void 0,void 0,s));const a=new Set;let l=!1;for(const pe of n)pe.pubkey!==t.pubkey?a.add(pe):l=!0;if(!l)return!1;const de=new NDKEvent(this.ndk,{kind:s});for(const pe of a)de.tag(pe);return await de.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const n=await getNip05For(this.ndk,t);return n===null?null:n.pubkey===this.pubkey}},READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class Cn extends NDKEvent{constructor(t,n){super(t,n),this.kind??(this.kind=10002)}static from(t){return new Cn(t.ndk,t.rawEvent())}get readRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===READ_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set readRelayUrls(t){for(const n of t)this.tags.push(["r",n,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]||t[2]&&t[2]===WRITE_MARKER).map(t=>tryNormalizeRelayUrl(t[1])).filter(t=>!!t)}set writeRelayUrls(t){for(const n of t)this.tags.push(["r",n,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").filter(t=>!t[2]).map(t=>t[1])}set bothRelayUrls(t){for(const n of t)this.tags.push(["r",n])}get relays(){return this.tags.filter(t=>t[0]==="r"||t[0]==="relay").map(t=>t[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(t=>{var n;return(n=this.ndk)==null?void 0:n.pool.getRelay(t)}).filter(t=>!!t)),this.ndk)}};function relayListFromKind3(e,t){try{const n=JSON.parse(t.content),s=new NDKRelayList(e),a=new Set,l=new Set;for(let[de,pe]of Object.entries(n)){try{de=normalizeRelayUrl(de)}catch{continue}if(!pe)a.add(de),l.add(de);else{const me=pe;me.write&&l.add(de),me.read&&a.add(de)}}return s.readRelayUrls=Array.from(a),s.writeRelayUrls=Array.from(l),s}catch{}}function disconnect(e,t){return t??(t=createDebug5("ndk:relay:auth-policies:disconnect")),async n=>{t==null||t(`Relay ${n.url} requested authentication, disconnecting`),e.removeRelay(n.url)}}async function signAndAuth(e,t,n,s,a,l){try{await e.sign(n),a(e)}catch(de){s==null||s(`Failed to publish auth event to relay ${t.url}`,de),l(e)}}function signIn({ndk:e,signer:t,debug:n}={}){return n??(n=createDebug5("ndk:auth-policies:signIn")),async(s,a)=>{n==null||n(`Relay ${s.url} requested authentication, signing in`);const l=new NDKEvent(e);return l.kind=22242,l.tags=[["relay",s.url],["challenge",a]],t??(t=e==null?void 0:e.signer),new Promise(async(de,pe)=>{t?await signAndAuth(l,s,t,n,de,pe):e==null||e.once("signer:ready",async me=>{await signAndAuth(l,s,me,n,de,pe)})})}}var NDKRelayAuthPolicies={disconnect,signIn},NDKNip07Signer=class Rn{constructor(t=1e3,n){ht(this,"_userPromise");ht(this,"encryptionQueue",[]);ht(this,"encryptionProcessing",!1);ht(this,"debug");ht(this,"waitTimeout");ht(this,"_pubkey");ht(this,"ndk");ht(this,"_user");this.debug=createDebug5("ndk:nip07"),this.waitTimeout=t,this.ndk=n}get pubkey(){if(!this._pubkey)throw new Error("Not ready");return this._pubkey}async blockUntilReady(){var s;await this.waitForExtension();const t=await((s=window.nostr)==null?void 0:s.getPublicKey());if(!t)throw new Error("User rejected access");this._pubkey=t;let n;return this.ndk?n=this.ndk.getUser({pubkey:t}):n=new NDKUser({pubkey:t}),this._user=n,n}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}get userSync(){if(!this._user)throw new Error("User not ready");return this._user}async sign(t){var s;await this.waitForExtension();const n=await((s=window.nostr)==null?void 0:s.signEvent(t));if(!n)throw new Error("Failed to sign event");return n.sig}async relays(t){var a,l;await this.waitForExtension();const n=await((l=(a=window.nostr)==null?void 0:a.getRelays)==null?void 0:l.call(a))||{},s=[];for(const de of Object.keys(n))n[de].read&&n[de].write&&s.push(de);return s.map(de=>new NDKRelay(de,t==null?void 0:t.relayAuthDefaultPolicy,t))}async encryptionEnabled(t){var s,a;const n=[];return(!t||t==="nip04")&&((s=window.nostr)!=null&&s.nip04)&&n.push("nip04"),(!t||t==="nip44")&&((a=window.nostr)!=null&&a.nip44)&&n.push("nip44"),n}async encrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const a=t.pubkey;return this.queueEncryption(s,"encrypt",a,n)}async decrypt(t,n,s="nip04"){if(!await this.encryptionEnabled(s))throw new Error(`${s}encryption is not available from your browser extension`);await this.waitForExtension();const a=t.pubkey;return this.queueEncryption(s,"decrypt",a,n)}async queueEncryption(t,n,s,a){return new Promise((l,de)=>{this.encryptionQueue.push({scheme:t,method:n,counterpartyHexpubkey:s,value:a,resolve:l,reject:de}),this.encryptionProcessing||this.processEncryptionQueue()})}async processEncryptionQueue(t,n=0){var Be,Ye;if(!t&&this.encryptionQueue.length===0){this.encryptionProcessing=!1;return}this.encryptionProcessing=!0;const s=t||this.encryptionQueue.shift();if(!s){this.encryptionProcessing=!1;return}const{scheme:a,method:l,counterpartyHexpubkey:de,value:pe,resolve:me,reject:Le}=s;this.debug("Processing encryption queue item",{method:l,counterpartyHexpubkey:de,value:pe});try{const tt=await((Ye=(Be=window.nostr)==null?void 0:Be[a])==null?void 0:Ye[l](de,pe));if(!tt)throw new Error("Failed to encrypt/decrypt");me(tt)}catch(tt){const nt=tt instanceof Error?tt.message:String(tt);if(nt.includes("call already executing")&&n<5){this.debug("Retrying encryption queue item",{method:l,counterpartyHexpubkey:de,value:pe,retries:n}),setTimeout(()=>{this.processEncryptionQueue(s,n+1)},50*n);return}Le(tt instanceof Error?tt:new Error(nt))}this.processEncryptionQueue()}waitForExtension(){return new Promise((t,n)=>{if(window.nostr){t();return}let s;const a=setInterval(()=>{window.nostr&&(clearTimeout(s),clearInterval(a),t())},100);s=setTimeout(()=>{clearInterval(a),n(new Error("NIP-07 extension not available"))},this.waitTimeout)})}toPayload(){return JSON.stringify({type:"nip07",payload:""})}static async fromPayload(t,n){const s=JSON.parse(t);if(s.type!=="nip07")throw new Error(`Invalid payload type: expected 'nip07', got ${s.type}`);return new Rn(void 0,n)}};registerSigner("nip07",NDKNip07Signer);var NDKNostrRpc=class extends lib$1.EventEmitter{constructor(t,n,s,a){super();ht(this,"ndk");ht(this,"signer");ht(this,"relaySet");ht(this,"debug");ht(this,"encryptionType","nip04");ht(this,"pool");if(this.ndk=t,this.signer=n,a){this.pool=new NDKPool(a,[],t,{debug:s.extend("rpc-pool"),name:"Nostr RPC"}),this.relaySet=new NDKRelaySet(new Set,t,this.pool);for(const l of a){const de=this.pool.getRelay(l,!1,!1);de.authPolicy=NDKRelayAuthPolicies.signIn({ndk:t,signer:n,debug:s}),this.relaySet.addRelay(de),de.connect()}}this.debug=s.extend("rpc")}subscribe(t){const n=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY",pool:this.pool,relaySet:this.relaySet},!1);return n.on("event",async s=>{try{const a=await this.parseEvent(s);a.method?this.emit("request",a):(this.emit(`response-${a.id}`,a),this.emit("response",a))}catch(a){this.debug("error parsing event",a,s.rawEvent())}}),new Promise(s=>{n.on("eose",()=>{this.debug("eosed"),s(n)}),n.start()})}async parseEvent(t){this.encryptionType==="nip44"&&t.content.includes("?iv=")?this.encryptionType="nip04":this.encryptionType==="nip04"&&!t.content.includes("?iv=")&&(this.encryptionType="nip44");const n=this.ndk.getUser({pubkey:t.pubkey});n.ndk=this.ndk;let s;try{s=await this.signer.decrypt(n,t.content,this.encryptionType)}catch{const Ye=this.encryptionType==="nip04"?"nip44":"nip04";s=await this.signer.decrypt(n,t.content,Ye),this.encryptionType=Ye}const a=JSON.parse(s),{id:l,method:de,params:pe,result:me,error:Le}=a;return de?{id:l,pubkey:t.pubkey,method:de,params:pe,event:t}:{id:l,result:me,error:Le,event:t}}async sendResponse(t,n,s,a=24133,l){const de={id:t,result:s};l&&(de.error=l);const pe=await this.signer.user(),me=this.ndk.getUser({pubkey:n}),Le=new NDKEvent(this.ndk,{kind:a,content:JSON.stringify(de),tags:[["p",n]],pubkey:pe.pubkey});Le.content=await this.signer.encrypt(me,Le.content,this.encryptionType),await Le.sign(this.signer),await Le.publish(this.relaySet)}async sendRequest(t,n,s=[],a=24133,l){const de=Math.random().toString(36).substring(7),pe=await this.signer.user(),me=this.ndk.getUser({pubkey:t}),Le={id:de,method:n,params:s},Be=new Promise(()=>{const tt=nt=>{nt.result==="auth_url"?(this.once(`response-${de}`,tt),this.emit("authUrl",nt.error)):l&&l(nt)};this.once(`response-${de}`,tt)}),Ye=new NDKEvent(this.ndk,{kind:a,content:JSON.stringify(Le),tags:[["p",t]],pubkey:pe.pubkey});return Ye.content=await this.signer.encrypt(me,Ye.content,this.encryptionType),await Ye.sign(this.signer),await Ye.publish(this.relaySet),Be}};async function ndkSignerFromPayload(e,t){let n;try{n=JSON.parse(e)}catch(a){console.error("Failed to parse signer payload string",e,a);return}if(!n||typeof n.type!="string"){console.error("Failed to parse signer payload string",e,new Error("Missing type field"));return}const s=signerRegistry.get(n.type);if(!s)throw new Error(`Unknown signer type: ${n.type}`);try{return await s.fromPayload(e,t)}catch(a){const l=a instanceof Error?a.message:String(a);throw new Error(`Failed to deserialize signer type ${n.type}: ${l}`)}}function nostrConnectGenerateSecret(){return Math.random().toString(36).substring(2,15)}function generateNostrConnectUri(e,t,n,s){const a={name:s!=null&&s.name?encodeURIComponent(s.name):"",url:s!=null&&s.url?encodeURIComponent(s.url):"",image:s!=null&&s.image?encodeURIComponent(s.image):"",perms:s!=null&&s.perms?encodeURIComponent(s.perms):""};let l=`nostrconnect://${e}?image=${a.image}&url=${a.url}&name=${a.name}&perms=${a.perms}&secret=${encodeURIComponent(t)}`;return n&&(l+=`&relay=${encodeURIComponent(n)}`),l}var NDKNip46Signer=class wn extends lib$1.EventEmitter{constructor(n,s,a,l,de){super();ht(this,"ndk");ht(this,"_user");ht(this,"bunkerPubkey");ht(this,"userPubkey");ht(this,"secret");ht(this,"localSigner");ht(this,"nip05");ht(this,"rpc");ht(this,"debug");ht(this,"relayUrls");ht(this,"subscription");ht(this,"nostrConnectUri");ht(this,"nostrConnectSecret");this.ndk=n,this.debug=n.debug.extend("nip46:signer"),this.relayUrls=l,a?typeof a=="string"?this.localSigner=new NDKPrivateKeySigner(a):this.localSigner=a:this.localSigner=NDKPrivateKeySigner.generate(),s===!1||(s?s.startsWith("bunker://")?this.bunkerFlowInit(s):this.nip05Init(s):this.nostrconnectFlowInit(de)),this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls)}get pubkey(){if(!this.userPubkey)throw new Error("Not ready");return this.userPubkey}static bunker(n,s,a){return new wn(n,s,a)}static nostrconnect(n,s,a,l){return new wn(n,void 0,a,[s],l)}nostrconnectFlowInit(n){var a;this.nostrConnectSecret=nostrConnectGenerateSecret();const s=this.localSigner.pubkey;this.nostrConnectUri=generateNostrConnectUri(s,this.nostrConnectSecret,(a=this.relayUrls)==null?void 0:a[0],n)}bunkerFlowInit(n){const s=new URL(n),a=s.hostname||s.pathname.replace(/^\/\//,""),l=s.searchParams.get("pubkey"),de=s.searchParams.getAll("relay"),pe=s.searchParams.get("secret");this.bunkerPubkey=a,this.userPubkey=l,this.relayUrls=de,this.secret=pe}nip05Init(n){this.nip05=n}async startListening(){if(this.subscription)return;const n=await this.localSigner.user();if(!n)throw new Error("Local signer not ready");this.subscription=await this.rpc.subscribe({kinds:[24133],"#p":[n.pubkey]})}async user(){return this._user?this._user:this.blockUntilReady()}get userSync(){if(!this._user)throw new Error("Remote user not ready synchronously");return this._user}async blockUntilReadyNostrConnect(){return new Promise((n,s)=>{const a=l=>{l.result===this.nostrConnectSecret&&(this._user=l.event.author,this.userPubkey=l.event.pubkey,this.bunkerPubkey=l.event.pubkey,this.rpc.off("response",a),n(this._user))};this.startListening(),this.rpc.on("response",a)})}async blockUntilReady(){if(!this.bunkerPubkey&&!this.nostrConnectSecret&&!this.nip05)throw new Error("Bunker pubkey not set");if(this.nostrConnectSecret)return this.blockUntilReadyNostrConnect();if(this.nip05&&!this.userPubkey){const n=await NDKUser.fromNip05(this.nip05,this.ndk);n&&(this._user=n,this.userPubkey=n.pubkey,this.relayUrls=n.nip46Urls,this.rpc=new NDKNostrRpc(this.ndk,this.localSigner,this.debug,this.relayUrls))}if(!this.bunkerPubkey&&this.userPubkey)this.bunkerPubkey=this.userPubkey;else if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");return await this.startListening(),this.rpc.on("authUrl",(...n)=>{this.emit("authUrl",...n)}),new Promise((n,s)=>{const a=[this.userPubkey??""];if(this.secret&&a.push(this.secret),!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"connect",a,24133,l=>{l.result==="ack"?this.getPublicKey().then(de=>{this.userPubkey=de,this._user=this.ndk.getUser({pubkey:de}),n(this._user)}):s(l.error)})})}stop(){var n;(n=this.subscription)==null||n.stop(),this.subscription=void 0}async getPublicKey(){return this.userPubkey?this.userPubkey:new Promise((n,s)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"get_public_key",[],24133,a=>{n(a.result)})})}async encryptionEnabled(n){return n?[n]:Promise.resolve(["nip04","nip44"])}async encrypt(n,s,a="nip04"){return this.encryption(n,s,a,"encrypt")}async decrypt(n,s,a="nip04"){return this.encryption(n,s,a,"decrypt")}async encryption(n,s,a,l){return new Promise((pe,me)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,`${a}_${l}`,[n.pubkey,s],24133,Le=>{Le.error?me(Le.error):pe(Le.result)})})}async sign(n){return new Promise((a,l)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"sign_event",[JSON.stringify(n)],24133,de=>{if(de.error)l(de.error);else{const pe=JSON.parse(de.result);a(pe.sig)}})})}async createAccount(n,s,a){await this.startListening();const l=[];return n&&l.push(n),s&&l.push(s),a&&l.push(a),new Promise((de,pe)=>{if(!this.bunkerPubkey)throw new Error("Bunker pubkey not set");this.rpc.sendRequest(this.bunkerPubkey,"create_account",l,24133,me=>{if(me.error)pe(me.error);else{const Le=me.result;de(Le)}})})}toPayload(){if(!this.bunkerPubkey||!this.userPubkey)throw new Error("NIP-46 signer is not fully initialized for serialization");const n={type:"nip46",payload:{bunkerPubkey:this.bunkerPubkey,userPubkey:this.userPubkey,relayUrls:this.relayUrls,secret:this.secret,localSignerPayload:this.localSigner.toPayload(),nip05:this.nip05||null}};return JSON.stringify(n)}static async fromPayload(n,s){if(!s)throw new Error("NDK instance is required to deserialize NIP-46 signer");const a=JSON.parse(n);if(a.type!=="nip46")throw new Error(`Invalid payload type: expected 'nip46', got ${a.type}`);const l=a.payload;if(!l||typeof l!="object"||!l.localSignerPayload)throw new Error("Invalid payload content for nip46 signer");const de=await ndkSignerFromPayload(l.localSignerPayload,s);if(!de)throw new Error("Failed to deserialize local signer for NIP-46");if(!(de instanceof NDKPrivateKeySigner))throw new Error("Local signer must be an instance of NDKPrivateKeySigner");let pe;return pe=new wn(s,!1,de,l.relayUrls),pe.userPubkey=l.userPubkey,pe.bunkerPubkey=l.bunkerPubkey,pe.relayUrls=l.relayUrls,pe.secret=l.secret,l.userPubkey&&(pe._user=new NDKUser({pubkey:l.userPubkey}),pe._user&&(pe._user.ndk=s)),pe}};registerSigner("nip46",NDKNip46Signer);function dedup(e,t){return e.created_at>t.created_at?e:t}async function getRelayListForUser(e,t){return(await getRelayListForUsers([e],t)).get(e)}async function getRelayListForUsers(e,t,n=!1,s=1e3){var Ye;const a=t.outboxPool||t.pool,l=new Set;for(const tt of a.relays.values())l.add(tt);const de=new Map,pe=new Map,me=new NDKRelaySet(l,t);if((Ye=t.cacheAdapter)!=null&&Ye.locking&&!n){const tt=await t.fetchEvents({kinds:[3,10002],authors:Array.from(new Set(e))},{cacheUsage:"ONLY_CACHE",subId:"ndk-relay-list-fetch"});for(const nt of tt)nt.kind===10002&&de.set(nt.pubkey,NDKRelayList.from(nt));for(const nt of tt)if(nt.kind===3){if(de.has(nt.pubkey))continue;const ft=relayListFromKind3(t,nt);ft&&pe.set(nt.pubkey,ft)}e=e.filter(nt=>!de.has(nt)&&!pe.has(nt))}if(e.length===0)return de;const Le=new Map,Be=new Map;return new Promise(tt=>{(async()=>{const ft={closeOnEose:!0,pool:a,groupable:!0,subId:"ndk-relay-list-fetch",addSinceFromCache:!0,relaySet:me};me&&(ft.relaySet=me),t.subscribe({kinds:[3,10002],authors:e},ft,{onEvent:st=>{if(st.kind===10002){const yt=Le.get(st.pubkey);if(yt&&yt.created_at>st.created_at)return;Le.set(st.pubkey,st)}else if(st.kind===3){const yt=Be.get(st.pubkey);if(yt&&yt.created_at>st.created_at)return;Be.set(st.pubkey,st)}},onEose:()=>{for(const st of Le.values())de.set(st.pubkey,NDKRelayList.from(st));for(const st of e){if(de.has(st))continue;const yt=Be.get(st);if(!yt)continue;const mt=relayListFromKind3(t,yt);mt&&de.set(st,mt)}tt(de)}}),setTimeout(()=>{tt(de)},s)})()})}var OutboxItem=class{constructor(e){ht(this,"type");ht(this,"relayUrlScores");ht(this,"readRelays");ht(this,"writeRelays");this.type=e,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends lib$1.EventEmitter{constructor(t){super();ht(this,"data");ht(this,"ndk");ht(this,"debug");this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new dist.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(t,n=!1){const s=[];for(let a=0;a<t.length;a+=400){const de=t.slice(a,a+400).map(pe=>getKeyFromItem(pe)).filter(pe=>!this.data.has(pe));if(de.length!==0){for(const pe of de)this.data.set(pe,new OutboxItem("user"));s.push(new Promise(pe=>{getRelayListForUsers(de,this.ndk,n).then(me=>{for(const[Le,Be]of me){let Ye=this.data.get(Le);if(Ye??(Ye=new OutboxItem("user")),Be){Ye.readRelays=new Set(normalize(Be.readRelayUrls)),Ye.writeRelays=new Set(normalize(Be.writeRelayUrls));for(const tt of Ye.readRelays)this.ndk.pool.blacklistRelayUrls.has(tt)&&Ye.readRelays.delete(tt);for(const tt of Ye.writeRelays)this.ndk.pool.blacklistRelayUrls.has(tt)&&Ye.writeRelays.delete(tt);this.data.set(Le,Ye)}}}).finally(pe)}))}}return Promise.all(s)}track(t,n,s=!0){const a=getKeyFromItem(t);n??(n=getTypeFromItem(t));let l=this.data.get(a);return l||(l=new OutboxItem(n),t instanceof NDKUser&&this.trackUsers([t])),l}};function getKeyFromItem(e){return e instanceof NDKUser?e.pubkey:e}function getTypeFromItem(e){return e instanceof NDKUser?"user":"kind"}function correctRelaySet(e,t){const n=t.connectedRelays();if(!Array.from(e.relays).some(a=>n.map(l=>l.url).includes(a.url)))for(const a of n)e.addRelay(a);if(n.length===0)for(const a of t.relays.values())e.addRelay(a);return e}var NDKSubscriptionManager=class{constructor(){ht(this,"subscriptions");ht(this,"seenEvents",new Map);this.subscriptions=new Map}add(e){this.subscriptions.set(e.internalId,e),e.onStopped,e.onStopped=()=>{this.subscriptions.delete(e.internalId)},e.on("close",()=>{this.subscriptions.delete(e.internalId)})}seenEvent(e,t){const n=this.seenEvents.get(e)||[];n.push(t),this.seenEvents.set(e,n)}dispatchEvent(e,t,n=!1){t&&this.seenEvent(e.id,t);const s=this.subscriptions.values(),a=[];for(const l of s)matchFilters(l.filters,e)&&a.push(l);for(const l of a)l.eventReceived(e,t,!1,n)}},debug7=createDebug5("ndk:active-user");async function getUserRelayList(e){if(!this.autoConnectUserRelays)return;const t=await getRelayListForUser(e.pubkey,this);if(t){for(const n of t.relays){let s=this.pool.relays.get(n);s||(s=new NDKRelay(n,this.relayAuthDefaultPolicy,this),this.pool.addRelay(s))}return t}}async function setActiveUser(e){const t=this.outboxPool||this.pool;t.connectedRelays.length>0?setActiveUserConnected.call(this,e):t.once("connect",()=>{setActiveUserConnected.call(this,e)})}async function setActiveUserConnected(e){var l;const t=await getUserRelayList.call(this,e),n=[{kinds:[10006],authors:[e.pubkey]}];this.autoFetchUserMutelist&&((l=n[0].kinds)==null||l.push(1e4));const s=new Map,a=t?t.relaySet:void 0;this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0,relaySet:a},{onEvent:de=>{const pe=s.get(de.kind);pe&&pe.created_at>=de.created_at||s.set(de.kind,de)},onEose:()=>{for(const de of s.values())processEvent.call(this,de)}})}async function processEvent(e){e.kind===10006?processBlockRelayList.call(this,e):e.kind===1e4&&processMuteList.call(this,e)}function processBlockRelayList(e){const t=lists_default.from(e);for(const n of t.items)this.pool.blacklistRelayUrls.add(n[0]);debug7("Added %d relays to relay blacklist",t.items.length)}function processMuteList(e){const t=lists_default.from(e);for(const n of t.items)this.mutedIds.set(n[1],n[0]);debug7("Added %d users to mute list",t.items.length)}function getEntity(e){try{const t=nip19_exports.decode(e);return t.type==="npub"?npub(this,t.data):t.type==="nprofile"?nprofile(this,t.data):t}catch{return null}}function npub(e,t){return e.getUser({pubkey:t})}function nprofile(e,t){const n=e.getUser({pubkey:t.pubkey});return t.relays&&(n.relayUrls=t.relays),n}function isValidHint(e){if(!e||e==="")return!1;try{return new URL(e),!0}catch{return!1}}async function fetchEventFromTag(e,t,n,s={type:"timeout"}){const a=this.debug.extend("fetch-event-from-tag"),[l,de,pe]=e;n={},a("fetching event from tag",e,n,s);const me=getRelaysForSync(this,t.pubkey);if(me&&me.size>0){a("fetching event from author relays %o",Array.from(me));const st=NDKRelaySet.fromRelayUrls(Array.from(me),this),yt=await this.fetchEvent(de,n,st);if(yt)return yt}else a("no author relays found for %s",t.pubkey,t);const Le=calculateRelaySetsFromFilters(this,[{ids:[de]}],this.pool);a("fetching event without relay hint",Le);const Be=await this.fetchEvent(de,n);if(Be)return Be;if(pe&&pe!==""){const st=await this.fetchEvent(de,n,this.pool.getRelay(pe,!0,!0,[{ids:[de]}]));if(st)return st}let Ye;const tt=isValidHint(pe)?this.pool.getRelay(pe,!1,!0,[{ids:[de]}]):void 0,nt=new Promise(st=>{this.fetchEvent(de,n,tt).then(st)});if(!isValidHint(pe)||s.type==="none")return nt;const ft=new Promise(async st=>{const yt=s.relaySet,mt=s.timeout??1500,_t=new Promise(Rt=>setTimeout(Rt,mt));if(s.type==="timeout"&&await _t,Ye)st(Ye);else{a("fallback fetch triggered");const Rt=await this.fetchEvent(de,n,yt);st(Rt)}});switch(s.type){case"timeout":return Promise.race([nt,ft]);case"eose":return Ye=await nt,Ye||ft}}var Queue=class{constructor(e,t){ht(this,"queue",[]);ht(this,"maxConcurrency");ht(this,"processing",new Set);ht(this,"promises",new Map);this.maxConcurrency=t}add(e){if(this.promises.has(e.id))return this.promises.get(e.id);const t=new Promise((n,s)=>{this.queue.push({...e,func:()=>e.func().then(a=>(n(a),a),a=>{throw s(a),a})}),this.process()});return this.promises.set(e.id,t),t.finally(()=>{this.promises.delete(e.id),this.processing.delete(e.id),this.process()}),t}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const e=this.queue.shift();!e||this.processing.has(e.id)||(this.processing.add(e.id),e.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends lib$1.EventEmitter{constructor(t={}){super();ht(this,"_explicitRelayUrls");ht(this,"blacklistRelayUrls");ht(this,"pool");ht(this,"outboxPool");ht(this,"_signer");ht(this,"_activeUser");ht(this,"cacheAdapter");ht(this,"debug");ht(this,"devWriteRelaySet");ht(this,"outboxTracker");ht(this,"mutedIds");ht(this,"clientName");ht(this,"clientNip89");ht(this,"queuesZapConfig");ht(this,"queuesNip05");ht(this,"asyncSigVerification",!1);ht(this,"initialValidationRatio",1);ht(this,"lowestValidationRatio",.1);ht(this,"validationRatioFn");ht(this,"autoBlacklistInvalidRelays",!1);ht(this,"subManager");ht(this,"_signatureVerificationFunction");ht(this,"_signatureVerificationWorker");ht(this,"signatureVerificationTimeMs",0);ht(this,"publishingFailureHandled",!1);ht(this,"pools",[]);ht(this,"relayAuthDefaultPolicy");ht(this,"httpFetch");ht(this,"netDebug");ht(this,"autoConnectUserRelays",!0);ht(this,"autoFetchUserMutelist",!0);ht(this,"walletConfig");ht(this,"fetchEventFromTag",fetchEventFromTag.bind(this));ht(this,"getEntity",getEntity.bind(this));this.debug=t.debug||createDebug5("ndk"),this.netDebug=t.netDebug,this._explicitRelayUrls=t.explicitRelayUrls||[],this.blacklistRelayUrls=t.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this.subManager=new NDKSubscriptionManager,this.pool=new NDKPool(t.explicitRelayUrls||[],[],this),this.pool.name="Main",this.pool.on("relay:auth",async(n,s)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(n,s)}),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.autoFetchUserMutelist=t.autoFetchUserMutelist??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel&&(this.outboxPool=new NDKPool(t.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,[],this,{debug:this.debug.extend("outbox-pool"),name:"Outbox Pool"}),this.outboxTracker=new OutboxTracker(this)),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.mutedIds=t.mutedIds||new Map,t.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),t.signatureVerificationWorker&&(this.signatureVerificationWorker=t.signatureVerificationWorker),t.signatureVerificationFunction&&(this.signatureVerificationFunction=t.signatureVerificationFunction),this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||.1,this.autoBlacklistInvalidRelays=t.autoBlacklistInvalidRelays||!1,this.validationRatioFn=t.validationRatioFn||this.defaultValidationRatioFn;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(t){this._explicitRelayUrls=t.map(normalizeRelayUrl),this.pool.relayUrls=t}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(t){this._signatureVerificationWorker=t,t?(signatureVerificationInit(t),this.asyncSigVerification=!0):this.asyncSigVerification=!1}set signatureVerificationFunction(t){this._signatureVerificationFunction=t,this.asyncSigVerification=!!t}get signatureVerificationFunction(){return this._signatureVerificationFunction}addExplicitRelay(t,n,s=!0){var l;let a;return typeof t=="string"?a=new NDKRelay(t,n,this):a=t,this.pool.addRelay(a,s),(l=this.explicitRelayUrls)==null||l.push(a.url),a}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){var s;const n=((s=this._activeUser)==null?void 0:s.pubkey)!==(t==null?void 0:t.pubkey);this._activeUser=t,t&&n?setActiveUser.call(this,t):t||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t==null||t.user().then(n=>{n.ndk=this,this.activeUser=n})}async connect(t){var s,a;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((a=(s=this._signer).relays)==null?void 0:a.call(s,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(de=>this.pool.addRelay(de)));const n=[this.pool.connect(t)];return this.outboxPool&&n.push(this.outboxPool.connect(t)),Promise.allSettled(n).then(()=>{})}reportInvalidSignature(t,n){this.debug(`Invalid signature detected for event ${t.id}${n?` from relay ${n.url}`:""}`),this.emit("event:invalid-sig",t,n),this.autoBlacklistInvalidRelays&&n&&this.blacklistRelay(n.url)}blacklistRelay(t){if(this.blacklistRelayUrls||(this.blacklistRelayUrls=[]),!this.blacklistRelayUrls.includes(t)){this.blacklistRelayUrls.push(t),this.debug(`Added relay to blacklist: ${t}`);const n=this.pool.getRelay(t,!1,!1);n&&(n.disconnect(),this.debug(`Disconnected from blacklisted relay: ${t}`))}}defaultValidationRatioFn(t,n,s){if(n<10)return this.initialValidationRatio;const a=Math.min(n/100,1),l=this.initialValidationRatio*(1-a)+this.lowestValidationRatio*a;return Math.max(l,this.lowestValidationRatio)}getUser(t){const n=new NDKUser(t);return n.ndk=this,n}async getUserFromNip05(t,n=!1){return NDKUser.fromNip05(t,this,n)}subscribe(t,n,s=!0,a=!0){var Le;let l=n==null?void 0:n.relaySet,de=a;s instanceof NDKRelaySet?(console.warn("relaySet is deprecated, use opts.relaySet instead. This will be removed in version v2.14.0"),l=s,de=a):(typeof s=="boolean"||typeof s=="object")&&(de=s);const pe=new NDKSubscription(this,t,{relaySet:l,...n});this.subManager.add(pe);const me=pe.pool;if(pe.relaySet)for(const Be of pe.relaySet.relays)me.useTemporaryRelay(Be,void 0,pe.filters);if(this.outboxPool&&pe.hasAuthorsFilter()){const Be=pe.filters.filter(Ye=>{var tt;return Ye.authors&&((tt=Ye.authors)==null?void 0:tt.length)>0}).flatMap(Ye=>Ye.authors);(Le=this.outboxTracker)==null||Le.trackUsers(Be)}if(de){let Be;typeof de=="object"&&(de.onEvent&&pe.on("event",de.onEvent),de.onEose&&pe.on("eose",de.onEose),de.onEvents&&(Be=de.onEvents)),setTimeout(()=>{const Ye=pe.start(!Be);Ye&&Ye.length>0&&Be&&Be(Ye)},0)}return pe}fetchEventSync(t){if(!this.cacheAdapter)throw new Error("Cache adapter not set");let n;typeof t=="string"?n=[filterFromId(t)]:n=t;const s=new NDKSubscription(this,n),a=this.cacheAdapter.query(s);if(a instanceof Promise)throw new Error("Cache adapter is async");return a.map(l=>(l.ndk=this,l))}async fetchEvent(t,n,s){let a,l;if(s instanceof NDKRelay?l=new NDKRelaySet(new Set([s]),this):s instanceof NDKRelaySet&&(l=s),!s&&typeof t=="string"&&!isNip33AValue(t)){const de=relaysFromBech32(t,this);de.length>0&&(l=new NDKRelaySet(new Set(de),this),l=correctRelaySet(l,this.pool))}if(typeof t=="string"?a=[filterFromId(t)]:Array.isArray(t)?a=t:a=[t],a.length===0)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise(de=>{let pe=null;const me={...n||{},closeOnEose:!0};l&&(me.relaySet=l);const Le=this.subscribe(a,me,!1),Be=setTimeout(()=>{Le.stop(),de(pe)},1e4);Le.on("event",Ye=>{Ye.ndk=this,Ye.isReplaceable()?(!pe||pe.created_at<Ye.created_at)&&(pe=Ye):(clearTimeout(Be),de(Ye))}),Le.on("eose",()=>{clearTimeout(Be),de(pe)}),Le.start()})}async fetchEvents(t,n,s){return new Promise(a=>{const l=new Map,de={...n||{},closeOnEose:!0};s&&(de.relaySet=s);const pe=this.subscribe(t,de,!1),me=Le=>{let Be;Le instanceof NDKEvent?Be=Le:Be=new NDKEvent(void 0,Le);const Ye=Be.deduplicationKey(),tt=l.get(Ye);tt&&(Be=dedup(tt,Be)),Be.ndk=this,l.set(Ye,Be)};pe.on("event",me),pe.on("eose",()=>{a(new Set(l.values()))}),pe.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}set wallet(t){var n,s;if(!t){this.walletConfig=void 0;return}this.walletConfig??(this.walletConfig={}),this.walletConfig.lnPay=(n=t==null?void 0:t.lnPay)==null?void 0:n.bind(t),this.walletConfig.cashuPay=(s=t==null?void 0:t.cashuPay)==null?void 0:s.bind(t)}};createDebug5("ndk:zapper:ln");createDebug5("ndk:zapper");function removeNewLineCharactersAtTheEnd(e){return e.replace(/\n+$/,`
`)}async function parseText(e){const t=new NDK({explicitRelayUrls:["wss://relay.damus.io","wss://nostr.wine","wss://relay.nostr.net","wss://nos.lol","wss://nostr-pub.wellorder.net","wss://njump.me","wss://relay.primal.net"]});await t.connect();let n=e;const s=n.matchAll(new RegExp(nip21_exports.NOSTR_URI_REGEX,"g"));for(let me of s){const Be=nip21_exports.parse(me[0]).decoded.data;let Ye="";typeof Be=="string"?Ye=Be:Ye=Be.pubkey;const tt=await t.getUser({pubkey:Ye}).fetchProfile(),nt=(tt==null?void 0:tt.displayName)||(tt==null?void 0:tt.name)||"";n=n.replace(me[0],`<a>@${nt}</a>`)}const a=/(^|\s)(#[a-z\d-]+)/ig;n=n.replace(a,"$1<a>$2</a>");const l=/(https:\/\/(?!njump\.me)[\w.-]+(?:\.[\w.-]+)+(?:\/[^\s]*)?)/g,de=n.match(l),pe=[];if(de){let me=0;for(const Le of de){const Be=n.indexOf(Le,me),Ye=Be+Le.length;if(Be>me){const ft=n.substring(me,Be);ft!==`
`&&pe.push({type:"text",value:removeNewLineCharactersAtTheEnd(ft)})}const tt=new URL(Le);let nt;tt.pathname.endsWith(".jpg")||tt.pathname.endsWith(".jpeg")||tt.pathname.endsWith(".png")?nt="image":tt.pathname.endsWith(".gif")?nt="gif":tt.pathname.endsWith(".mp4")||tt.pathname.endsWith(".mov")||tt.pathname.endsWith(".webm")?nt="video":nt="link",pe.push({type:nt,value:Le}),me=Ye}if(me<n.length){const Le=n.substring(me);Le!==`
`&&pe.push({type:"text",value:removeNewLineCharactersAtTheEnd(Le)})}}else n!==`
`&&pe.push({type:"text",value:removeNewLineCharactersAtTheEnd(n)});return pe}function getHTML(e){const t=[];let n=0,s="";for(const l of e)if(l.type==="text")s+=l.value;else switch(s&&(t.push(`<span class="text-content">${s.replace(/\n/g,"<br />")}</span>`),s=""),l.type){case"image":t.push(`<img style="border-radius: 6px" width="100%" src="${proxyImg(l.value,defaultImgProxy)}" alt="Image embeded in the nostr note">`),n++;break;case"gif":t.push(`<img style="border-radius: 6px" width="100%" src="${proxyImg(l.value,defaultImgProxy)}" alt="GIF embeded in the nostr note">`),n++;break;case"video":t.push(`<video style="border-radius: 6px" width="100%" src="${l.value}" alt="video embeded in the nostr note"></video>`),n++;break;case"link":t.push(`<a href="${l.value}">${l.value}</a>`);break}if(s&&t.push(`<span class="text-content">${s.replace(/\n/g,"<br />")}</span>`),n>1){const l=[];for(let de=0;de<t.length;de++){const pe=t[de];(pe.startsWith("<img")||pe.startsWith("<video"))&&(l.push(pe),t.splice(de,1),de--)}t.push(`
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          ${l.reduce((de,pe)=>de+pe,"")}
        </div>
      `)}return`
    <style>
      a {
        color: #ca077c;
      }
    </style>
  `+t.join("")}function getNip19Bech32RegexMatch(e){return e.match(nip19_exports.BECH32_REGEX)}function getHexRegexMatch(e){return e.match(/^[0-9a-f]{64}$/)}function validateAndGetMatchedNostrEventBech32OrRaw(e){if(!e)return!1;let t="";if(e.startsWith("http")||e.startsWith("https")){const n=e.split("/");for(let s=0;s<n.length;s++){const a=n[s],l=getNip19Bech32RegexMatch(a);l!==null&&(t=l[0])}}else if(e.startsWith("nostr:")){const n=e.substring(6),s=getNip19Bech32RegexMatch(n);s!==null&&(t=s[0])}else{if(e.length===64&&getHexRegexMatch(e))return t=e,t;const n=getNip19Bech32RegexMatch(e);n!==null&&(t=n[0])}if(t==="")return!1;try{const n=nip19_exports.decode(t);return n.type==="nevent"||n.type==="note"?t:!1}catch{return!1}}async function getPostDetails(e,t){const n=await e.fetchEvent(t);if(!n)throw new Error("Invalid post");const s=await(n==null?void 0:n.author.fetchProfile()),a=await getPostStats(e,(n==null?void 0:n.id)||"");return{post:n,author:s,stats:a}}async function getPostStats(e,t){const n=Math.floor(Date.now()/1e3),s=await e.fetchEvents({kinds:[NDKKind.Repost],"#e":[t||""],until:n}),a=Array.from(s).filter(Be=>Be.tags.filter(tt=>tt[0]==="p").length===1).length,l=await e.fetchEvents({kinds:[NDKKind.Reaction],"#e":[t||""],until:n}),de=await e.fetchEvents({kinds:[NDKKind.Zap],"#e":[t||""],until:n}),pe=Array.from(de).reduce((Be,Ye)=>{const tt=Ye.getMatchingTags("bolt11");if(!tt||!Array.isArray(tt)||tt.length===0||!tt[0]||!Array.isArray(tt[0])||tt[0].length===0)return Be;const nt=tt[0][1],st=bolt11.decode(nt).sections.find(yt=>yt.name==="amount");if(st){const yt=Number(st.value);return Be+yt}return Be},0),me=await e.fetchEvents({kinds:[NDKKind.Text],"#e":[t||""],until:n}),Le=Array.from(me).filter(Be=>Be.tags.filter(tt=>tt[0]==="e").length===1).length;return{likes:l.size,reposts:a,zaps:pe/MILLISATS_PER_SAT,replies:Le}}function useNostrEvent(e){const{setNote:t,setNoteLoading:n,isLoading:s,setIsError:a,isError:l}=useNoteContext(),{relays:de}=useRelaysContext();return reactExports.useEffect(()=>{async function pe(me){n(!0);try{const Le=new NDK({explicitRelayUrls:de});await Le.connect();const{post:Be,author:Ye,stats:tt}=await getPostDetails(Le,me),{likes:nt,replies:ft,reposts:st,zaps:yt}=tt,mt=(Be==null?void 0:Be.id)||"",_t=(Be==null?void 0:Be.content)||"",Rt=await parseText(_t),At=getHTML(Rt);t({html:At,author:Ye,createdAt:(Be==null?void 0:Be.created_at)||0,replies:ft,zaps:yt,likes:nt,reposts:st,postId:mt}),a(!1)}catch{a(!0)}finally{n(!1)}}e&&pe(e)},[e]),{isError:l,isLoading:s}}function useShakeAnimation(e){const[t,n]=reactExports.useState(!1);function s(){n(!0),setTimeout(()=>{n(!1)},600)}return reactExports.useEffect(()=>{e&&s()},[e]),{isAnimate:t,addShakeAnimation:s}}const pressEnterToFindNote="Press Enter to find note";function useSearchInput(e){const[t,n]=reactExports.useState(""),[s,a]=reactExports.useState({type:"info",message:""}),{isError:l,isLoading:de}=useNostrEvent(t),{setIsError:pe,setNote:me}=useNoteContext(),{isAnimate:Le,addShakeAnimation:Be}=useShakeAnimation(l);reactExports.useEffect(()=>{const mt=()=>{const _t=getNoteIDFromURL();_t?(e.current&&(e.current.value=_t),Ye(_t,!1)):(e.current&&(e.current.value=""),n(""),me(initialNote))};return mt(),window.addEventListener("popstate",mt),()=>{window.removeEventListener("popstate",mt)}},[]),reactExports.useEffect(()=>{de&&a({type:"info",message:""})},[de]),reactExports.useEffect(()=>{l&&a({type:"error",message:"Something went wrong, please check the pasted ID or URL!"})},[l]);function Ye(mt,_t=!0){pe(!1);const Rt=validateAndGetMatchedNostrEventBech32OrRaw(mt);Rt?(n(Rt),_t&&updateNoteIDInTheURL(Rt)):(Be(),pe(!0),a({type:"error",message:"Invalid note ID or invalid URL!"}))}function tt(mt){mt.preventDefault();const _t=mt.currentTarget[0].value;Ye(_t)}function nt(mt){setTimeout(()=>{const _t=mt.target.value;Ye(_t)})}function ft(mt){mt.target.value===""?a({type:"info",message:""}):s.message!==pressEnterToFindNote&&!de&&a({type:"info",message:pressEnterToFindNote})}function st(){s.type!=="error"&&a({type:"info",message:""})}function yt(mt){s.message===""&&mt.target.value!==""&&!de&&a({type:"info",message:pressEnterToFindNote})}return{helperMessage:s,isAnimate:Le,isLoading:de,onSubmit:tt,onPaste:nt,onInputChange:ft,onInputBlur:st,onInputFocus:yt,bech32OrRawId:t}}function SearchBar(){const e=reactExports.useRef(null),{helperMessage:t,isLoading:n,isAnimate:s,onInputBlur:a,onInputChange:l,onInputFocus:de,onPaste:pe,onSubmit:me}=useSearchInput(e);return e.current&&n&&e.current.blur(),jsxRuntimeExports.jsxs(SearchBarWrapper,{className:s?"shake":"",children:[jsxRuntimeExports.jsxs(SearchBarContainer,{children:[jsxRuntimeExports.jsx(SearchIcon,{}),jsxRuntimeExports.jsxs(SearchBarForm,{onSubmit:me,children:[jsxRuntimeExports.jsx(SearchInput,{type:"text",placeholder:"Paste nostr event id, primal, damus, iris or snort link here",autoComplete:"off",ref:e,onChange:l,onPaste:pe,onBlur:a,onFocus:de,autoFocus:!0}),n?jsxRuntimeExports.jsx(SearchBarProgressContainer,{children:jsxRuntimeExports.jsx(SearchBarProgress,{})}):null]})]}),t.message&&t.type==="error"?jsxRuntimeExports.jsx(ErrorText,{children:t.message}):jsxRuntimeExports.jsx(HelperText,{children:t.message})]})}const HomePageHeader=dt.header`
    height: 75px;
    padding: 50px 60px 0 60px;

    display: flex;
    justify-content: space-between;
    align-items: center;

    ${tablet(`
        flex-direction: column-reverse;
        height: auto;
        padding: 20px;
    `)}
`,HeaderActions=dt.div`
    display: flex;
    align-items: center;
    gap: 12px;

    ${tablet(`
        width: 100%;
        justify-content: space-between;
    `)}
`,breakpoint$1=getBreakpoint();function Header(){return jsxRuntimeExports.jsxs(HomePageHeader,{children:[breakpoint$1==="large"?jsxRuntimeExports.jsx(Logo,{}):null,jsxRuntimeExports.jsx(SearchBar,{}),jsxRuntimeExports.jsxs(HeaderActions,{children:[breakpoint$1==="small"||breakpoint$1==="medium"?jsxRuntimeExports.jsx(Logo,{}):null,jsxRuntimeExports.jsx(HelpButton,{})]})]})}const GradientPickerStyled=dt.div`
    padding: 20px;

    position: absolute;
    left: 10px;
    top: 0px;

    background-color: #222;
    box-shadow: 0 0 15px #444;
    border: 1px solid #71717187;
    border-radius: 6px;

    transform: rotateX(25deg) translateY(-100%);
    -webkit-transform: rotateX(25deg) translateY(-100%);
    will-change: -webkit-transform, transform, opacity;
    transition-property: -webkit-transform, transform, opacity;
    transition-duration: 150ms;
    -webkit-transition-property: -webkit-transform, transform, opacity;
    -webkit-transition-duration: 150ms;
    opacity: 0;
    pointer-events: none;
    transition-timing-function: cubic-bezier(.4,0,.2,1);
    -webkit-transition-timing-function: cubic-bezier(.4,0,.2,1);

    display: flex;
    flex-wrap: wrap;
    gap: 15px;

    width: 300px;
`,GradientContainer=dt.div`
    border: none;
    cursor: pointer;
    background: transparent;

    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;

    width: max-content;
`,Gradient=dt.div`
    width: 40px;
    height: 40px;
    border-radius: 6px;
    background: ${e=>e.$background};
    transition: box-shadow 0.1s;
    -webkit-transition: box-shadow 0.1s;
    position: relative;

    &::before {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        right: -5px;
        bottom: -5px;
        border: 2px solid transparent;
        transition: transform 0.4s ease, border-color 0.4s ease;
        -webkit-transition: transform 0.4s ease, border-color 0.4s ease;
        border-radius: 10px;
    }

    ${e=>e.$isSelected?`
            &::before {
                border-color: #CE66FF; 
                transform: scale(1); 
                -webkit-transform: scale(1); 
            }
        `:""}

    &:hover {
        box-shadow: 0 0 2px 4px #ffffff26;
    }

    &:active {
        transform: scale(0.9);
        -webkit-transform: scale(0.9);
    }
`,GradientName=dt.small`
    color: #FFF;
`;function GradientPicker({gradient:e,onGradientChange:t}){return jsxRuntimeExports.jsx(GradientPickerStyled,{className:"color-picker",children:Object.keys(GRADIENTS).map(n=>jsxRuntimeExports.jsxs(GradientContainer,{"aria-label":"Gradient buton",onClick:()=>t(n),children:[jsxRuntimeExports.jsx(Gradient,{$background:GRADIENTS[n],$isSelected:e===n}),jsxRuntimeExports.jsx(GradientName,{children:n})]},n))})}const ToolbarContainer=dt.ul`
    width: 100px;
    height: max-content;
    border-radius: 8px;
    background-color: #272727;
    padding: 20px 5px 10px 5px;
    margin: none;
    list-style-type: none;

    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;

    position: fixed;
    top: 50vh;
    transform: translateY(-25vh);

    ${tablet(`
        flex-direction: row;
        width: 90%;
        padding: 10px;
        margin: 0;
        justify-content: space-between;
        gap: 0px;

        position: absolute;
        top: 350px;

        & hr {
            width: 1px;
            height: 40px;
            margin: 0;
        }
    `)}
`,ToolbarListItem=dt.li`
    width: 100%;

    ${tablet(`
        width: auto !important;
    `)}
`,Tool=dt.button`
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    width: 90%;
    padding: 10px;
    border-radius: 5px;
    transition: background-color 0.1s;
    -webkit-transition: background-color 0.1s;
    border: none;
    position: relative;

    background: ${e=>e.$withBackground?"linear-gradient(45deg, #CE66FF, #FE983B)":"transparent"};

    & span {
        color: ${e=>e.$withBackground?"#FFF":"#9F9F9F"};
        font-weight: ${e=>e.$withBackground?"600":"normal"};;
    }

    &:hover {
        background-color: #323131;
    }

    &:hover ${GradientPickerStyled} {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(-100%);
        -webkit-transform: translateY(-100%);
    }

    &:active svg, &:active > div {
        transform: scale(0.8);
        -webkit-transform: scale(0.8);
    }

    & svg {
        ${tablet(`
            width: 20px !important;
            height: 20px !important;
        `)}
    }

    ${tablet(`
        width: auto;
    `)}
`,ToolName=dt.span`
    color: #9F9F9F;
    font-size: 12px;
`,ColorTool=dt.div`
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: ${e=>e.$gradient};
    box-shadow: rgba(255, 255, 255, 0.7) 0px 0px 0px 2px, rgba(0, 0, 0, 0.5) 0px 3px 6px;

    ${tablet(`
        width: 20px;
        height: 20px;
    `)}
`,RelaysToolContainer=dt.div`
    position: relative;
    width: 100%;

    ${tablet(`
        width: auto;
    `)}
`,RelaysContainer=dt.aside`
    position: absolute;
    top: 0px;
    right: 0px;
    padding: 20px;
    box-shadow: 0 0 15px #444;
    color: #FFF;
    cursor: default;
    z-index: 100;

    border: 1px solid transparent;
    border-radius: 6px;
    background: 
        linear-gradient(90deg, #222, #222), 
        linear-gradient(to right, #FE983B , #CE66FF);

    background-clip: padding-box, border-box;
    background-origin: padding-box, border-box;

    min-width: 300px;

    display: flex;
    flex-direction: column;
    gap: 36px;

    will-change:-webkit-transform,  transform, opacity;
    transition-property: -webkit-transform, transform, opacity;
    transition-duration: 150ms;
    transition-timing-function: cubic-bezier(.4,0,.2,1);
    -webkit-transition-property: -webkit-transform, transform, opacity;
    -webkit-transition-duration: 150ms;
    -webkit-transition-timing-function: cubic-bezier(.4,0,.2,1);

    ${tablet(`
        display: none;
        position: fixed;
        left: 0;
        right: 0;
        width: 100vw;
        height: 100vh;
        z-index: 10000;
    `)}
`,RelaysCardHeader=dt.div`
    display: flex;
    justify-content: space-between;
    font-size: 22px
`,CloseButton=dt.button`
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    -webkit-transition: all 0.2s;
    background-color: transparent;

    &:hover {
        background-color: transparent;
        border: 1px solid #FE3B3B;
    }

    &:focus {
        outline: 1px solid #FE3B3B;
    }
`,InputContainer=dt.div`
    display: flex;
    gap: 8px;
`,Input=dt.input`
    background-color: transparent;
    border: 1px solid #383838;
    border-radius: 6px;
    padding: 12px;
    flex: 1;
    color: #FFF;
`,AddButton=dt.button`
    background-color: #383838;
    width: 42px;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    -webkit-transition: all 0.2s;

    &:hover {
        background-color: transparent;
        border: 1px solid #383838;
    }
`,SaveButton=dt.button`
    border: 1px solid transparent;
    border-radius: 6px;
    background: 
        linear-gradient(90deg, #383838, #383838), 
        linear-gradient(to right, #CE66FF , #FE983B);

    background-clip: padding-box, border-box;
    background-origin: padding-box, border-box;

    width: 100%;
    padding: 10px;
    font-size: 18px;
    font-weight: bold;
    color: #FFF;
    cursor: pointer;
`,RelayList=dt.ul`
    list-style-type: none;
    margin-top: 12px;
    padding: 0;

    display: flex;
    flex-direction: column;
    gap: 2px;
`,RelayItem=dt.li`
    display: flex;
    align-items: center;
    gap: 8px;

    color: #9F9F9F;
    font-size: 14px;
`,breakpoint=getBreakpoint();function RelaysModal({isOpen:e,onClose:t}){const{relays:n,setRelays:s}=useRelaysContext(),[a,l]=reactExports.useState(n||[]),de=reactExports.useRef(null),[pe,me]=reactExports.useState(!1),Le=nt=>{if(nt.preventDefault(),!de||!de.current)return;const ft=de.current.value;l(st=>[...st,ft]),de.current.value=""},Be=nt=>{l(ft=>ft.filter(st=>st!==nt))},Ye=()=>{if(a.length===0){me(!0);return}s(a),t()};let tt={};return breakpoint==="small"||breakpoint==="medium"?tt={display:e?"flex":"none"}:tt={transform:e?"translateX(100%)":"translateX(95%)",opacity:e?1:0,pointerEvents:e?"all":"none"},jsxRuntimeExports.jsxs(RelaysContainer,{className:"relays-modal",style:tt,children:[jsxRuntimeExports.jsxs(RelaysCardHeader,{children:[jsxRuntimeExports.jsx("label",{htmlFor:"relay-address",children:"Relay address"}),jsxRuntimeExports.jsx(CloseButton,{onClick:()=>t(),"aria-label":"Close relay modal button",children:jsxRuntimeExports.jsx(Close,{})})]}),jsxRuntimeExports.jsxs("main",{children:[jsxRuntimeExports.jsx("form",{onSubmit:Le,children:jsxRuntimeExports.jsxs(InputContainer,{children:[jsxRuntimeExports.jsx(Input,{id:"relay-address",type:"text",placeholder:"wss://relay.primal.net",ref:de}),jsxRuntimeExports.jsx(AddButton,{onClick:Le,"aria-label":"Add a relay button",children:jsxRuntimeExports.jsx(Plus,{})})]})}),jsxRuntimeExports.jsxs(RelayList,{children:[pe?jsxRuntimeExports.jsx(ErrorText,{style:{transform:"unset",textAlign:"start"},children:"Set at least one relay"}):null,a.map((nt,ft)=>jsxRuntimeExports.jsxs(RelayItem,{children:[jsxRuntimeExports.jsx("span",{children:nt}),jsxRuntimeExports.jsx(Pointer,{onClick:()=>Be(nt),children:jsxRuntimeExports.jsx(Delete,{})})]},nt+ft))]})]}),jsxRuntimeExports.jsx(SaveButton,{onClick:Ye,children:"Save"})]})}function Toolbar({onDownload:e,onCopy:t,showResponse:n,onChangeShowResponse:s,gradient:a,onGradientChange:l,isDownloading:de,isCopying:pe}){const[me,Le]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(ToolbarContainer,{children:[jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsxs(Tool,{"aria-label":"Gradient picker button",children:[jsxRuntimeExports.jsx(GradientPicker,{gradient:a,onGradientChange:l}),jsxRuntimeExports.jsx(ColorTool,{$gradient:GRADIENTS[a]}),jsxRuntimeExports.jsx(ToolName,{children:"Color"})]})}),jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsxs(Tool,{onClick:()=>s(!n),"aria-label":"Stats toggle button",children:[jsxRuntimeExports.jsx(HeartIcon,{isSelected:n}),jsxRuntimeExports.jsx(ToolName,{children:"Stats"})]})}),jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsxs(RelaysToolContainer,{children:[jsxRuntimeExports.jsxs(Tool,{onClick:()=>Le(Be=>!Be),"aria-label":"Relays toggle button",children:[jsxRuntimeExports.jsx(Relays,{}),jsxRuntimeExports.jsx(ToolName,{children:"Relays"})]}),jsxRuntimeExports.jsx(RelaysModal,{isOpen:me,onClose:()=>{Le(!1)}})]})}),jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsx(Divider,{})}),jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsxs(Tool,{onClick:t,"aria-label":"Copy button",children:[pe?jsxRuntimeExports.jsx("div",{className:"loader"}):jsxRuntimeExports.jsx(CopyIcon,{}),jsxRuntimeExports.jsx(ToolName,{children:"Copy"})]})}),jsxRuntimeExports.jsx(ToolbarListItem,{children:jsxRuntimeExports.jsxs(Tool,{$withBackground:!0,onClick:e,"aria-label":"Download button",children:[de?jsxRuntimeExports.jsx("div",{className:"loader"}):jsxRuntimeExports.jsx(DownloadIcon,{}),jsxRuntimeExports.jsx(ToolName,{children:"Download"})]})})]})}const HomePageContainer=dt.main`
    min-height: 100vh;
    width: 100vw;
    background: rgb(24,25,26);
    background: linear-gradient(130deg, rgba(24,25,26,1) 0%, rgba(39,39,40,1) 100%);
    display: flex;
    flex-direction: column;
`,MainSection=dt.article`
    padding: 20px 60px;

    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;

    ${tablet(`
        flex-direction: column-reverse;
        padding: 20px;
    `)}
`,NoteNotFoundContainer=dt.div`
    display: flex;
    width: 100%;
    justify-content: center;
`,Spacer=dt.div`
    width: 100px;
`;function HomePage(){const e=reactExports.useRef(null),[t,n]=reactExports.useState(!0),[s,a]=reactExports.useState(initialGradient),[l,de]=reactExports.useState(!1),[pe,me]=reactExports.useState(!1),{note:Le,isLoading:Be,isError:Ye}=useNoteContext();function tt(){de(!0);const ft=e.current;ft&&getDataURLFromHTMLDOM(ft).then(st=>downloadImage("nostr-note",st)).finally(()=>{de(!1),B$1.success("Image Downloaded!"),trackEvent("IMAGE_DOWNLOADED",Le.postId)})}function nt(){const ft=e.current;ft&&(me(!0),getDataURLFromHTMLDOM(ft).then(copyDataURL).finally(()=>{me(!1),B$1.success("Image copied!"),trackEvent("IMAGE_COPIED",Le.postId)}))}return jsxRuntimeExports.jsxs(HomePageContainer,{children:[jsxRuntimeExports.jsx(Header,{}),jsxRuntimeExports.jsxs(MainSection,{children:[jsxRuntimeExports.jsx(Toolbar,{onDownload:tt,onCopy:nt,showResponse:t,onChangeShowResponse:ft=>n(ft),gradient:s,onGradientChange:ft=>a(ft),isDownloading:l,isCopying:pe}),jsxRuntimeExports.jsx(Spacer,{}),jsxRuntimeExports.jsx(Q$1,{position:"bottom-left",autoClose:1e3,hideProgressBar:!0,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark",transition:H$1}),Ye?jsxRuntimeExports.jsx(NoteNotFoundContainer,{children:jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{style:{display:"flex",alignItems:"center",gap:20},children:[jsxRuntimeExports.jsx(SadComputer,{}),jsxRuntimeExports.jsx("h1",{children:"Oh snap!"})]}),jsxRuntimeExports.jsx("h3",{children:"The note is not found or invalid. Please double-check the note ID."})]})}):jsxRuntimeExports.jsx(Canvas,{ref:e,noteHTML:Le.html,note:Le,showResponse:t,gradient:GRADIENTS[s],nostrBrandingColor:NOSTR_BRANDING_COLORS[s],isLoading:Be})]})]})}export{HomePage as default};
